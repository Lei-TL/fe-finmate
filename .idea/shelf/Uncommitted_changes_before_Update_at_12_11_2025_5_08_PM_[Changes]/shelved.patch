Index: app/src/main/java/com/finmate/data/dto/TransactionResponse.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.dto;\r\n\r\n/**\r\n * DTO map với TransactionResponse từ BE.\r\n * Anh chỉnh field cho khớp với backend (id, amount, occurredAt...).\r\n */\r\npublic class TransactionResponse {\r\n\r\n    private String id;\r\n    private String categoryName;\r\n    private String walletName;\r\n    private double amount;\r\n    private String type;       // \"INCOME\" / \"EXPENSE\" / \"TRANSFER\"\r\n    private String occurredAt; // ISO datetime dạng String\r\n    private String note;\r\n\r\n    public TransactionResponse() {\r\n    }\r\n\r\n    public String getId() {\r\n        return id;\r\n    }\r\n\r\n    public String getCategoryName() {\r\n        return categoryName;\r\n    }\r\n\r\n    public String getWalletName() {\r\n        return walletName;\r\n    }\r\n\r\n    public double getAmount() {\r\n        return amount;\r\n    }\r\n\r\n    public String getType() {\r\n        return type;\r\n    }\r\n\r\n    public String getOccurredAt() {\r\n        return occurredAt;\r\n    }\r\n\r\n    public String getNote() {\r\n        return note;\r\n    }\r\n\r\n    public void setId(String id) {\r\n        this.id = id;\r\n    }\r\n\r\n    public void setCategoryName(String categoryName) {\r\n        this.categoryName = categoryName;\r\n    }\r\n\r\n    public void setWalletName(String walletName) {\r\n        this.walletName = walletName;\r\n    }\r\n\r\n    public void setAmount(double amount) {\r\n        this.amount = amount;\r\n    }\r\n\r\n    public void setType(String type) {\r\n        this.type = type;\r\n    }\r\n\r\n    public void setOccurredAt(String occurredAt) {\r\n        this.occurredAt = occurredAt;\r\n    }\r\n\r\n    public void setNote(String note) {\r\n        this.note = note;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/dto/TransactionResponse.java b/app/src/main/java/com/finmate/data/dto/TransactionResponse.java
--- a/app/src/main/java/com/finmate/data/dto/TransactionResponse.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/dto/TransactionResponse.java	(date 1765447595509)
@@ -1,18 +1,25 @@
 package com.finmate.data.dto;
 
+import java.math.BigDecimal;
+
 /**
  * DTO map với TransactionResponse từ BE.
- * Anh chỉnh field cho khớp với backend (id, amount, occurredAt...).
+ * Updated to match backend structure.
  */
 public class TransactionResponse {
 
     private String id;
-    private String categoryName;
-    private String walletName;
-    private double amount;
+    private String walletId;
+    private String categoryId;
     private String type;       // "INCOME" / "EXPENSE" / "TRANSFER"
-    private String occurredAt; // ISO datetime dạng String
+    private BigDecimal amount;
+    private String currency;
+    private String occurredAt; // ISO datetime string
     private String note;
+    private String transferRefId;
+    private boolean deleted;
+    private String createdAt;
+    private String updatedAt;
 
     public TransactionResponse() {
     }
@@ -21,55 +28,95 @@
         return id;
     }
 
-    public String getCategoryName() {
-        return categoryName;
-    }
-
-    public String getWalletName() {
-        return walletName;
-    }
-
-    public double getAmount() {
-        return amount;
-    }
-
-    public String getType() {
-        return type;
-    }
-
-    public String getOccurredAt() {
-        return occurredAt;
-    }
-
-    public String getNote() {
-        return note;
-    }
-
     public void setId(String id) {
         this.id = id;
     }
 
-    public void setCategoryName(String categoryName) {
-        this.categoryName = categoryName;
+    public String getWalletId() {
+        return walletId;
+    }
+
+    public void setWalletId(String walletId) {
+        this.walletId = walletId;
+    }
+
+    public String getCategoryId() {
+        return categoryId;
     }
 
-    public void setWalletName(String walletName) {
-        this.walletName = walletName;
+    public void setCategoryId(String categoryId) {
+        this.categoryId = categoryId;
     }
 
-    public void setAmount(double amount) {
-        this.amount = amount;
+    public String getType() {
+        return type;
     }
 
     public void setType(String type) {
         this.type = type;
     }
 
+    public BigDecimal getAmount() {
+        return amount;
+    }
+
+    public void setAmount(BigDecimal amount) {
+        this.amount = amount;
+    }
+
+    public String getCurrency() {
+        return currency;
+    }
+
+    public void setCurrency(String currency) {
+        this.currency = currency;
+    }
+
+    public String getOccurredAt() {
+        return occurredAt;
+    }
+
     public void setOccurredAt(String occurredAt) {
         this.occurredAt = occurredAt;
     }
 
+    public String getNote() {
+        return note;
+    }
+
     public void setNote(String note) {
         this.note = note;
     }
+
+    public String getTransferRefId() {
+        return transferRefId;
+    }
+
+    public void setTransferRefId(String transferRefId) {
+        this.transferRefId = transferRefId;
+    }
+
+    public boolean isDeleted() {
+        return deleted;
+    }
+
+    public void setDeleted(boolean deleted) {
+        this.deleted = deleted;
+    }
+
+    public String getCreatedAt() {
+        return createdAt;
+    }
+
+    public void setCreatedAt(String createdAt) {
+        this.createdAt = createdAt;
+    }
+
+    public String getUpdatedAt() {
+        return updatedAt;
+    }
+
+    public void setUpdatedAt(String updatedAt) {
+        this.updatedAt = updatedAt;
+    }
 }
Index: app/src/main/java/com/finmate/data/dto/WalletResponse.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.dto;\r\n\r\n/**\r\n * DTO map với JSON từ BE /wallets.\r\n * Anh cần chỉnh field name cho khớp với WalletResponse bên BE.\r\n */\r\npublic class WalletResponse {\r\n\r\n    private String id;\r\n    private String name;\r\n    private String currency;\r\n    private double currentBalance;\r\n\r\n    public WalletResponse() {\r\n    }\r\n\r\n    public String getId() {\r\n        return id;\r\n    }\r\n\r\n    public String getName() {\r\n        return name;\r\n    }\r\n\r\n    public String getCurrency() {\r\n        return currency;\r\n    }\r\n\r\n    public double getCurrentBalance() {\r\n        return currentBalance;\r\n    }\r\n\r\n    public void setId(String id) {\r\n        this.id = id;\r\n    }\r\n\r\n    public void setName(String name) {\r\n        this.name = name;\r\n    }\r\n\r\n    public void setCurrency(String currency) {\r\n        this.currency = currency;\r\n    }\r\n\r\n    public void setCurrentBalance(double currentBalance) {\r\n        this.currentBalance = currentBalance;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/dto/WalletResponse.java b/app/src/main/java/com/finmate/data/dto/WalletResponse.java
--- a/app/src/main/java/com/finmate/data/dto/WalletResponse.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/dto/WalletResponse.java	(date 1765447595509)
@@ -1,15 +1,23 @@
 package com.finmate.data.dto;
 
+import java.math.BigDecimal;
+
 /**
  * DTO map với JSON từ BE /wallets.
- * Anh cần chỉnh field name cho khớp với WalletResponse bên BE.
+ * Updated to match backend structure.
  */
 public class WalletResponse {
 
     private String id;
     private String name;
+    private String type;
     private String currency;
-    private double currentBalance;
+    private BigDecimal initialBalance;
+    private boolean archived;
+    private boolean deleted;
+    private String color;
+    private String createdAt;
+    private String updatedAt;
 
     public WalletResponse() {
     }
@@ -18,31 +26,84 @@
         return id;
     }
 
-    public String getName() {
-        return name;
-    }
-
-    public String getCurrency() {
-        return currency;
-    }
-
-    public double getCurrentBalance() {
-        return currentBalance;
-    }
-
     public void setId(String id) {
         this.id = id;
     }
 
+    public String getName() {
+        return name;
+    }
+
     public void setName(String name) {
         this.name = name;
     }
 
+    public String getType() {
+        return type;
+    }
+
+    public void setType(String type) {
+        this.type = type;
+    }
+
+    public String getCurrency() {
+        return currency;
+    }
+
     public void setCurrency(String currency) {
         this.currency = currency;
     }
 
-    public void setCurrentBalance(double currentBalance) {
-        this.currentBalance = currentBalance;
+    public BigDecimal getInitialBalance() {
+        return initialBalance;
+    }
+
+    public void setInitialBalance(BigDecimal initialBalance) {
+        this.initialBalance = initialBalance;
+    }
+
+    public boolean isArchived() {
+        return archived;
+    }
+
+    public void setArchived(boolean archived) {
+        this.archived = archived;
+    }
+
+    public boolean isDeleted() {
+        return deleted;
+    }
+
+    public void setDeleted(boolean deleted) {
+        this.deleted = deleted;
+    }
+
+    public String getColor() {
+        return color;
+    }
+
+    public void setColor(String color) {
+        this.color = color;
+    }
+
+    public String getCreatedAt() {
+        return createdAt;
+    }
+
+    public void setCreatedAt(String createdAt) {
+        this.createdAt = createdAt;
+    }
+
+    public String getUpdatedAt() {
+        return updatedAt;
+    }
+
+    public void setUpdatedAt(String updatedAt) {
+        this.updatedAt = updatedAt;
+    }
+
+    // Helper method for backward compatibility
+    public double getCurrentBalance() {
+        return initialBalance != null ? initialBalance.doubleValue() : 0.0;
     }
 }
Index: app/src/main/java/com/finmate/data/repository/TransactionRemoteRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.repository;\r\n\r\nimport com.finmate.core.network.ApiCallExecutor;\r\nimport com.finmate.core.network.ApiCallback;\r\nimport com.finmate.data.dto.TransactionPageResponse;\r\n\r\nimport javax.inject.Inject;\r\nimport javax.inject.Singleton;\r\n\r\nimport retrofit2.Call;\r\n\r\n@Singleton\r\npublic class TransactionRemoteRepository {\r\n\r\n    private final com.finmate.data.remote.api.TransactionService transactionApi;\r\n    private final ApiCallExecutor apiCallExecutor;\r\n\r\n    @Inject\r\n    public TransactionRemoteRepository(com.finmate.data.remote.api.TransactionService transactionApi,\r\n                                       ApiCallExecutor apiCallExecutor) {\r\n        this.transactionApi = transactionApi;\r\n        this.apiCallExecutor = apiCallExecutor;\r\n    }\r\n\r\n    public void fetchTransactions(String walletId,\r\n                                  ApiCallback<TransactionPageResponse> callback) {\r\n        Call<TransactionPageResponse> call = transactionApi.getTransactions(walletId);\r\n        apiCallExecutor.execute(call, callback);\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/TransactionRemoteRepository.java b/app/src/main/java/com/finmate/data/repository/TransactionRemoteRepository.java
--- a/app/src/main/java/com/finmate/data/repository/TransactionRemoteRepository.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/repository/TransactionRemoteRepository.java	(date 1765447595535)
@@ -1,8 +1,19 @@
 package com.finmate.data.repository;
 
 import com.finmate.core.network.ApiCallExecutor;
-import com.finmate.core.network.ApiCallback;
+import com.finmate.data.remote.api.ApiCallback;
+import com.finmate.data.remote.api.TransactionService;
+import com.finmate.data.remote.dto.CreateTransactionRequest;
 import com.finmate.data.dto.TransactionPageResponse;
+import com.finmate.data.dto.TransactionResponse;
+import com.finmate.data.remote.dto.UpdateTransactionRequest;
+import com.finmate.data.local.database.entity.TransactionEntity;
+import com.finmate.data.local.database.entity.WalletEntity;
+import com.finmate.data.local.database.entity.CategoryEntity;
+
+import java.math.BigDecimal;
+import java.util.List;
+import java.util.concurrent.Executors;
 
 import javax.inject.Inject;
 import javax.inject.Singleton;
@@ -12,19 +23,165 @@
 @Singleton
 public class TransactionRemoteRepository {
 
-    private final com.finmate.data.remote.api.TransactionService transactionApi;
+    private final TransactionService transactionApi;
     private final ApiCallExecutor apiCallExecutor;
+    private final WalletLocalRepository walletLocalRepository;
+    private final CategoryLocalRepository categoryLocalRepository;
 
     @Inject
-    public TransactionRemoteRepository(com.finmate.data.remote.api.TransactionService transactionApi,
-                                       ApiCallExecutor apiCallExecutor) {
+    public TransactionRemoteRepository(TransactionService transactionApi,
+                                       ApiCallExecutor apiCallExecutor,
+                                       WalletLocalRepository walletLocalRepository,
+                                       CategoryLocalRepository categoryLocalRepository) {
         this.transactionApi = transactionApi;
         this.apiCallExecutor = apiCallExecutor;
+        this.walletLocalRepository = walletLocalRepository;
+        this.categoryLocalRepository = categoryLocalRepository;
     }
 
     public void fetchTransactions(String walletId,
+                                  String from,
+                                  String to,
+                                  String categoryId,
+                                  String type,
+                                  int page,
+                                  int size,
                                   ApiCallback<TransactionPageResponse> callback) {
-        Call<TransactionPageResponse> call = transactionApi.getTransactions(walletId);
+        Call<TransactionPageResponse> call = transactionApi.getTransactions(
+                from, to, walletId, categoryId, type, page, size
+        );
         apiCallExecutor.execute(call, callback);
     }
+
+    public void createFromLocal(TransactionEntity tx, ApiCallback<TransactionResponse> callback) {
+        // Look up wallet and category IDs by name
+        walletLocalRepository.getAll(new WalletLocalRepository.Callback() {
+            @Override
+            public void onResult(List<WalletEntity> wallets) {
+                final String[] walletId = {null};
+                final String[] currency = {"VND"}; // default
+                for (WalletEntity w : wallets) {
+                    if (w.getName().equals(tx.walletName)) {
+                        if (w.getRemoteId() != null) {
+                            walletId[0] = w.getRemoteId();
+                        }
+                        currency[0] = w.getCurrency();
+                        break;
+                    }
+                }
+                if (walletId[0] == null) {
+                    callback.onError("Wallet not found or not synced: " + tx.walletName, 400);
+                    return;
+                }
+
+                // Look up category synchronously
+                categoryLocalRepository.getByTypeSync(tx.type != null ? tx.type : "EXPENSE", 
+                    new CategoryLocalRepository.OnResultCallback<List<CategoryEntity>>() {
+                        @Override
+                        public void onResult(List<CategoryEntity> categories) {
+                            if (categories == null || categories.isEmpty()) {
+                                callback.onError("Category not found: " + tx.categoryName, 400);
+                                return;
+                            }
+                            String categoryId = null;
+                            for (CategoryEntity c : categories) {
+                                if (c.getName().equals(tx.categoryName) && c.getRemoteId() != null) {
+                                    categoryId = c.getRemoteId();
+                                    break;
+                                }
+                            }
+                            if (categoryId == null) {
+                                callback.onError("Category not found or not synced: " + tx.categoryName, 400);
+                                return;
+                            }
+
+                            CreateTransactionRequest request = new CreateTransactionRequest(
+                                    walletId[0],
+                                    categoryId,
+                                    tx.type != null ? tx.type : "EXPENSE",
+                                    BigDecimal.valueOf(tx.amount),
+                                    currency[0],
+                                    tx.occurredAt,
+                                    tx.name, // use name as note
+                                    null // transferRefId
+                            );
+                            apiCallExecutor.execute(transactionApi.createTransaction(request), callback);
+                        }
+                    });
+            }
+        });
+    }
+
+    public void updateFromLocal(TransactionEntity tx, ApiCallback<TransactionResponse> callback) {
+        if (tx.remoteId == null) {
+            callback.onError("Missing remoteId for update", 400);
+            return;
+        }
+
+        // Look up wallet and category IDs by name
+        walletLocalRepository.getAll(new WalletLocalRepository.Callback() {
+            @Override
+            public void onResult(List<WalletEntity> wallets) {
+                final String[] walletId = {null};
+                final String[] currency = {"VND"};
+                for (WalletEntity w : wallets) {
+                    if (w.getName().equals(tx.walletName)) {
+                        if (w.getRemoteId() != null) {
+                            walletId[0] = w.getRemoteId();
+                        }
+                        currency[0] = w.getCurrency();
+                        break;
+                    }
+                }
+                if (walletId[0] == null) {
+                    callback.onError("Wallet not found or not synced: " + tx.walletName, 400);
+                    return;
+                }
+
+                // Look up category synchronously
+                categoryLocalRepository.getByTypeSync(tx.type != null ? tx.type : "EXPENSE",
+                    new CategoryLocalRepository.OnResultCallback<List<CategoryEntity>>() {
+                        @Override
+                        public void onResult(List<CategoryEntity> categories) {
+                            if (categories == null || categories.isEmpty()) {
+                                callback.onError("Category not found: " + tx.categoryName, 400);
+                                return;
+                            }
+                            String categoryId = null;
+                            for (CategoryEntity c : categories) {
+                                if (c.getName().equals(tx.categoryName) && c.getRemoteId() != null) {
+                                    categoryId = c.getRemoteId();
+                                    break;
+                                }
+                            }
+                            if (categoryId == null) {
+                                callback.onError("Category not found or not synced: " + tx.categoryName, 400);
+                                return;
+                            }
+
+                            UpdateTransactionRequest request = new UpdateTransactionRequest(
+                                    walletId[0],
+                                    categoryId,
+                                    tx.type != null ? tx.type : "EXPENSE",
+                                    BigDecimal.valueOf(tx.amount),
+                                    currency[0],
+                                    tx.occurredAt,
+                                    tx.name, // use name as note
+                                    null // transferRefId
+                            );
+                            apiCallExecutor.execute(transactionApi.updateTransaction(tx.remoteId, request), callback);
+                        }
+                    });
+            }
+        });
+    }
+
+    public void deleteFromLocal(TransactionEntity tx, ApiCallback<Void> callback) {
+        if (tx.remoteId == null) {
+            // If remoteId is null, it's a pending create, just delete it locally
+            callback.onSuccess(null);
+            return;
+        }
+        apiCallExecutor.execute(transactionApi.deleteTransaction(tx.remoteId), callback);
+    }
 }
Index: app/src/main/java/com/finmate/data/repository/HomeRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.repository;\r\n\r\nimport com.finmate.core.network.ApiCallback;\r\nimport com.finmate.data.dto.TransactionPageResponse;\r\nimport com.finmate.data.dto.TransactionResponse;\r\nimport com.finmate.data.dto.WalletResponse;\r\nimport com.finmate.data.local.database.entity.TransactionEntity;\r\nimport com.finmate.data.local.database.entity.WalletEntity;\r\n\r\nimport java.util.List;\r\n\r\nimport javax.inject.Inject;\r\nimport javax.inject.Singleton;\r\n\r\n@Singleton\r\npublic class HomeRepository {\r\n\r\n    private final WalletRemoteRepository walletRemoteRepository;\r\n    private final WalletRepository walletLocalRepository;\r\n    private final TransactionRemoteRepository transactionRemoteRepository;\r\n    private final TransactionRepository transactionLocalRepository;\r\n\r\n    @Inject\r\n    public HomeRepository(WalletRemoteRepository walletRemoteRepository, WalletRepository walletLocalRepository, TransactionRemoteRepository transactionRemoteRepository, TransactionRepository transactionLocalRepository) {\r\n        this.walletRemoteRepository = walletRemoteRepository;\r\n        this.walletLocalRepository = walletLocalRepository;\r\n        this.transactionRemoteRepository = transactionRemoteRepository;\r\n        this.transactionLocalRepository = transactionLocalRepository;\r\n    }\r\n\r\n    public interface DataCallback<T> {\r\n        void onDataLoaded(T data);\r\n        void onError(String message);\r\n    }\r\n\r\n    // Tạm thời dùng dữ liệu giả\r\n    public void fetchWallets(DataCallback<List<WalletEntity>> callback) {\r\n        // 1) Luôn load local trước để UI có gì đó hiển thị (offline vẫn chạy được)\r\n        walletLocalRepository.getAll(new WalletRepository.Callback() {\r\n            @Override\r\n            public void onResult(List<WalletEntity> list) {\r\n                callback.onDataLoaded(list);\r\n            }\r\n        });\r\n\r\n        // 2) Sau đó, thử gọi BE để lấy dữ liệu mới nhất\r\n        walletRemoteRepository.fetchMyWallets(new ApiCallback<List<WalletResponse>>() {\r\n            @Override\r\n            public void onSuccess(List<WalletResponse> body) {\r\n                // Map WalletResponse -> WalletEntity\r\n                List<WalletEntity> mapped = new java.util.ArrayList<>();\r\n                if (body != null) {\r\n                    for (WalletResponse w : body) {\r\n                        String formattedBalance = String.format(\r\n                                \"%,.0f %s\",\r\n                                w.getCurrentBalance(),\r\n                                w.getCurrency() != null ? w.getCurrency() : \"\"\r\n                        );\r\n\r\n                        WalletEntity entity = new WalletEntity(\r\n                                w.getName(),\r\n                                formattedBalance,\r\n                                0 // iconRes tạm thời = 0, sau này anh map theo type\r\n                        );\r\n                        mapped.add(entity);\r\n                    }\r\n                }\r\n\r\n                // 2.1) Ghi đè vào local cache\r\n                walletLocalRepository.replaceAll(mapped);\r\n\r\n                // 2.2) Đẩy list mới lên UI\r\n                callback.onDataLoaded(mapped);\r\n            }\r\n\r\n            @Override\r\n            public void onError(String message) {\r\n                // BE lỗi (mất mạng, 401 refresh fail, server down...)\r\n                // -> cứ để UI dùng data local đã load ở bước 1\r\n                // optional: callback.onError(message);\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n\r\n    public void fetchTransactions(String walletId, DataCallback<List<TransactionEntity>> callback) {\r\n        // 1) Luôn load local trước → offline vẫn xem được\r\n        transactionLocalRepository.getAll(new TransactionRepository.OnResultCallback<List<TransactionEntity>>() {\r\n            @Override\r\n            public void onResult(List<TransactionEntity> data) {\r\n                // Nếu anh muốn filter theo walletId ở local luôn thì filter thêm ở đây\r\n                callback.onDataLoaded(data);\r\n            }\r\n        });\r\n\r\n        // 2) Gọi BE để lấy dữ liệu mới nhất nếu có mạng\r\n        transactionRemoteRepository.fetchTransactions(walletId, new ApiCallback<TransactionPageResponse>() {\r\n            @Override\r\n            public void onSuccess(TransactionPageResponse page) {\r\n                if (page == null || page.getContent() == null) {\r\n                    return;\r\n                }\r\n\r\n                List<TransactionEntity> mapped = new java.util.ArrayList<>();\r\n                for (TransactionResponse t : page.getContent()) {\r\n                    // Format số tiền + thời gian → map vào TransactionEntity hiện tại\r\n                    String amountFormatted = String.format(\r\n                            \"%,.0f\",\r\n                            t.getAmount()\r\n                    );\r\n\r\n                    // TODO: format occurredAt (ISO) thành \"dd/MM/yyyy\" nếu muốn\r\n                    String dateDisplay = t.getOccurredAt(); // tạm thời dùng raw string\r\n\r\n                    // Ở HomeRepository cũ anh đang dùng ctor:\r\n                    // new TransactionEntity(title, category, amountText, walletName, dateText)\r\n                    String title = (t.getNote() != null && !t.getNote().isEmpty())\r\n                            ? t.getNote()\r\n                            : t.getCategoryName();\r\n\r\n                    TransactionEntity entity = new TransactionEntity(\r\n                            title,\r\n                            t.getCategoryName(),\r\n                            amountFormatted,\r\n                            t.getWalletName(),\r\n                            dateDisplay\r\n                    );\r\n\r\n                    mapped.add(entity);\r\n                }\r\n\r\n                // 2.1) Ghi đè vào local cache\r\n                transactionLocalRepository.replaceAll(mapped);\r\n\r\n                // 2.2) Đẩy list mới lên UI\r\n                callback.onDataLoaded(mapped);\r\n            }\r\n\r\n            @Override\r\n            public void onError(String message) {\r\n                // BE lỗi (mất mạng, refresh fail, server down...)\r\n                // → cứ để UI dùng data local đã load ở bước 1\r\n                // optional: callback.onError(message);\r\n            }\r\n        });\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/HomeRepository.java b/app/src/main/java/com/finmate/data/repository/HomeRepository.java
--- a/app/src/main/java/com/finmate/data/repository/HomeRepository.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/repository/HomeRepository.java	(date 1765447595531)
@@ -1,13 +1,20 @@
 package com.finmate.data.repository;
 
-import com.finmate.core.network.ApiCallback;
+import androidx.annotation.Nullable;
+
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
 import com.finmate.data.dto.TransactionPageResponse;
 import com.finmate.data.dto.TransactionResponse;
 import com.finmate.data.dto.WalletResponse;
 import com.finmate.data.local.database.entity.TransactionEntity;
 import com.finmate.data.local.database.entity.WalletEntity;
+import com.finmate.data.local.database.entity.CategoryEntity;
+import com.finmate.data.remote.api.ApiCallback;
 
+import java.util.HashSet;
 import java.util.List;
+import java.util.Set;
 
 import javax.inject.Inject;
 import javax.inject.Singleton;
@@ -16,16 +23,22 @@
 public class HomeRepository {
 
     private final WalletRemoteRepository walletRemoteRepository;
-    private final WalletRepository walletLocalRepository;
+    private final WalletLocalRepository walletLocalRepository;
     private final TransactionRemoteRepository transactionRemoteRepository;
-    private final TransactionRepository transactionLocalRepository;
+    private final TransactionLocalRepository transactionLocalRepository;
+    private final CategoryLocalRepository categoryLocalRepository;
 
     @Inject
-    public HomeRepository(WalletRemoteRepository walletRemoteRepository, WalletRepository walletLocalRepository, TransactionRemoteRepository transactionRemoteRepository, TransactionRepository transactionLocalRepository) {
+    public HomeRepository(WalletRemoteRepository walletRemoteRepository, 
+                          WalletLocalRepository walletLocalRepository, 
+                          TransactionRemoteRepository transactionRemoteRepository, 
+                          TransactionLocalRepository transactionLocalRepository,
+                          CategoryLocalRepository categoryLocalRepository) {
         this.walletRemoteRepository = walletRemoteRepository;
         this.walletLocalRepository = walletLocalRepository;
         this.transactionRemoteRepository = transactionRemoteRepository;
         this.transactionLocalRepository = transactionLocalRepository;
+        this.categoryLocalRepository = categoryLocalRepository;
     }
 
     public interface DataCallback<T> {
@@ -33,117 +46,163 @@
         void onError(String message);
     }
 
-    // Tạm thời dùng dữ liệu giả
     public void fetchWallets(DataCallback<List<WalletEntity>> callback) {
-        // 1) Luôn load local trước để UI có gì đó hiển thị (offline vẫn chạy được)
-        walletLocalRepository.getAll(new WalletRepository.Callback() {
+        walletLocalRepository.getAll(new WalletLocalRepository.Callback() {
             @Override
             public void onResult(List<WalletEntity> list) {
                 callback.onDataLoaded(list);
             }
         });
 
-        // 2) Sau đó, thử gọi BE để lấy dữ liệu mới nhất
         walletRemoteRepository.fetchMyWallets(new ApiCallback<List<WalletResponse>>() {
             @Override
             public void onSuccess(List<WalletResponse> body) {
-                // Map WalletResponse -> WalletEntity
                 List<WalletEntity> mapped = new java.util.ArrayList<>();
                 if (body != null) {
                     for (WalletResponse w : body) {
-                        String formattedBalance = String.format(
-                                "%,.0f %s",
-                                w.getCurrentBalance(),
-                                w.getCurrency() != null ? w.getCurrency() : ""
-                        );
-
+                        // Use initialBalance from backend, or calculate currentBalance if needed
+                        double balance = w.getInitialBalance() != null ? 
+                                w.getInitialBalance().doubleValue() : w.getCurrentBalance();
                         WalletEntity entity = new WalletEntity(
                                 w.getName(),
-                                formattedBalance,
-                                0 // iconRes tạm thời = 0, sau này anh map theo type
+                                w.getCurrency() != null ? w.getCurrency() : "VND",
+                                balance,
+                                0
                         );
+                        entity.setRemoteId(w.getId());
+                        entity.setSyncStatus(SyncStatus.SYNCED);
+                        entity.setPendingAction(PendingAction.NONE);
+                        entity.setUpdatedAt(System.currentTimeMillis());
                         mapped.add(entity);
                     }
                 }
-
-                // 2.1) Ghi đè vào local cache
                 walletLocalRepository.replaceAll(mapped);
-
-                // 2.2) Đẩy list mới lên UI
                 callback.onDataLoaded(mapped);
             }
 
             @Override
-            public void onError(String message) {
-                // BE lỗi (mất mạng, 401 refresh fail, server down...)
-                // -> cứ để UI dùng data local đã load ở bước 1
-                // optional: callback.onError(message);
+            public void onError(String message, @Nullable Integer code) {
+                // Error from API, do nothing, UI will use local data
             }
         });
     }
-
-
 
     public void fetchTransactions(String walletId, DataCallback<List<TransactionEntity>> callback) {
-        // 1) Luôn load local trước → offline vẫn xem được
-        transactionLocalRepository.getAll(new TransactionRepository.OnResultCallback<List<TransactionEntity>>() {
+        transactionLocalRepository.getAll(new TransactionLocalRepository.OnResultCallback<List<TransactionEntity>>() {
             @Override
             public void onResult(List<TransactionEntity> data) {
-                // Nếu anh muốn filter theo walletId ở local luôn thì filter thêm ở đây
                 callback.onDataLoaded(data);
             }
         });
 
-        // 2) Gọi BE để lấy dữ liệu mới nhất nếu có mạng
-        transactionRemoteRepository.fetchTransactions(walletId, new ApiCallback<TransactionPageResponse>() {
+        // Load wallets and categories for mapping IDs to names
+        walletLocalRepository.getAll(new WalletLocalRepository.Callback() {
             @Override
-            public void onSuccess(TransactionPageResponse page) {
-                if (page == null || page.getContent() == null) {
-                    return;
-                }
+            public void onResult(List<WalletEntity> wallets) {
+                // Now fetch transactions with wallet and category lookups
+                transactionRemoteRepository.fetchTransactions(
+                        walletId, null, null, null, null, 0, 20,
+                        new ApiCallback<TransactionPageResponse>() {
+                            @Override
+                            public void onSuccess(TransactionPageResponse page) {
+                                if (page == null || page.getContent() == null || page.getContent().isEmpty()) {
+                                    callback.onDataLoaded(new java.util.ArrayList<>());
+                                    return;
+                                }
 
-                List<TransactionEntity> mapped = new java.util.ArrayList<>();
-                for (TransactionResponse t : page.getContent()) {
-                    // Format số tiền + thời gian → map vào TransactionEntity hiện tại
-                    String amountFormatted = String.format(
-                            "%,.0f",
-                            t.getAmount()
-                    );
-
-                    // TODO: format occurredAt (ISO) thành "dd/MM/yyyy" nếu muốn
-                    String dateDisplay = t.getOccurredAt(); // tạm thời dùng raw string
-
-                    // Ở HomeRepository cũ anh đang dùng ctor:
-                    // new TransactionEntity(title, category, amountText, walletName, dateText)
-                    String title = (t.getNote() != null && !t.getNote().isEmpty())
-                            ? t.getNote()
-                            : t.getCategoryName();
-
-                    TransactionEntity entity = new TransactionEntity(
-                            title,
-                            t.getCategoryName(),
-                            amountFormatted,
-                            t.getWalletName(),
-                            dateDisplay
-                    );
-
-                    mapped.add(entity);
-                }
-
-                // 2.1) Ghi đè vào local cache
-                transactionLocalRepository.replaceAll(mapped);
-
-                // 2.2) Đẩy list mới lên UI
-                callback.onDataLoaded(mapped);
-            }
-
-            @Override
-            public void onError(String message) {
-                // BE lỗi (mất mạng, refresh fail, server down...)
-                // → cứ để UI dùng data local đã load ở bước 1
-                // optional: callback.onError(message);
-            }
-        });
+                                // Get all categories for all transaction types (INCOME, EXPENSE, TRANSFER)
+                                // We'll collect all unique types first
+                                Set<String> types = new HashSet<>();
+                                for (TransactionResponse t : page.getContent()) {
+                                    if (t.getType() != null) {
+                                        types.add(t.getType());
+                                    }
+                                }
+                                
+                                // If no types found, use default
+                                if (types.isEmpty()) {
+                                    types.add("EXPENSE");
+                                }
+                                
+                                // Collect all categories from all types
+                                final List<CategoryEntity> allCategories = new java.util.ArrayList<>();
+                                final int[] remainingTypes = {types.size()};
+                                
+                                for (String type : types) {
+                                    categoryLocalRepository.getByTypeSync(type, 
+                                        new CategoryLocalRepository.OnResultCallback<List<CategoryEntity>>() {
+                                            @Override
+                                            public void onResult(List<CategoryEntity> categories) {
+                                                if (categories != null) {
+                                                    allCategories.addAll(categories);
+                                                }
+                                                remainingTypes[0]--;
+                                                
+                                                // When all categories are loaded, map transactions
+                                                if (remainingTypes[0] == 0) {
+                                                    mapTransactions(page, wallets, allCategories, callback);
+                                                }
+                                            }
+                                        });
+                                }
+                            }
+
+                            @Override
+                            public void onError(String message, @Nullable Integer code) {
+                                // Error from API, do nothing, UI will use local data
+                            }
+                        });
+            }
+        });
+    }
+    
+    private void mapTransactions(TransactionPageResponse page, 
+                                List<WalletEntity> wallets, 
+                                List<CategoryEntity> allCategories,
+                                DataCallback<List<TransactionEntity>> callback) {
+        List<TransactionEntity> mapped = new java.util.ArrayList<>();
+        for (TransactionResponse t : page.getContent()) {
+            // Look up wallet name
+            String walletName = "";
+            for (WalletEntity w : wallets) {
+                if (w.getRemoteId() != null && w.getRemoteId().equals(t.getWalletId())) {
+                    walletName = w.getName();
+                    break;
+                }
+            }
+            
+            // Look up category name
+            String categoryName = "Unknown";
+            if (t.getCategoryId() != null && allCategories != null) {
+                for (CategoryEntity c : allCategories) {
+                    if (c.getRemoteId() != null && c.getRemoteId().equals(t.getCategoryId())) {
+                        categoryName = c.getName();
+                        break;
+                    }
+                }
+            }
+            
+            String title = (t.getNote() != null && !t.getNote().isEmpty()) ? t.getNote() : categoryName;
+            
+            // Convert BigDecimal to double
+            double amount = t.getAmount() != null ? t.getAmount().doubleValue() : 0.0;
+            
+            TransactionEntity entity = new TransactionEntity(
+                    t.getId(),
+                    title,
+                    categoryName,
+                    amount,
+                    walletName,
+                    t.getOccurredAt() != null ? t.getOccurredAt() : "",
+                    t.getType() != null ? t.getType() : "EXPENSE"
+            );
+            entity.setSyncStatus(SyncStatus.SYNCED);
+            entity.setPendingAction(PendingAction.NONE);
+            entity.setUpdatedAt(System.currentTimeMillis());
+            mapped.add(entity);
+        }
+        
+        transactionLocalRepository.replaceAllSynced(mapped);
+        callback.onDataLoaded(mapped);
     }
-
 }
Index: app/src/main/java/com/finmate/core/network/ApiCallback.java
===================================================================
diff --git a/app/src/main/java/com/finmate/core/network/ApiCallback.java b/app/src/main/java/com/finmate/core/network/ApiCallback.java
deleted file mode 100644
--- a/app/src/main/java/com/finmate/core/network/ApiCallback.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ /dev/null	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
@@ -1,6 +0,0 @@
-package com.finmate.core.network;
-
-public interface ApiCallback<T> {
-    void onSuccess(T body);
-    void onError(String message);
-}
Index: app/src/main/java/com/finmate/ui/activities/StatisticActivity.java
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/activities/StatisticActivity.java b/app/src/main/java/com/finmate/ui/activities/StatisticActivity.java
deleted file mode 100644
--- a/app/src/main/java/com/finmate/ui/activities/StatisticActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ /dev/null	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
@@ -1,194 +0,0 @@
-package com.finmate.ui.activities;
-
-import android.content.Intent;
-import android.graphics.Color;
-import android.os.Bundle;
-import android.widget.ImageView;
-import android.widget.TextView;
-
-import androidx.appcompat.app.AppCompatActivity;
-
-import com.finmate.R;
-import com.finmate.ui.home.WalletActivity;
-import com.github.mikephil.charting.charts.BarChart;
-import com.github.mikephil.charting.charts.PieChart;
-import com.github.mikephil.charting.components.Legend;
-import com.github.mikephil.charting.components.XAxis;
-import com.github.mikephil.charting.data.BarData;
-import com.github.mikephil.charting.data.BarDataSet;
-import com.github.mikephil.charting.data.BarEntry;
-import com.github.mikephil.charting.data.PieData;
-import com.github.mikephil.charting.data.PieDataSet;
-import com.github.mikephil.charting.data.PieEntry;
-import com.google.android.material.bottomnavigation.BottomNavigationView;
-
-import java.util.ArrayList;
-import java.util.List;
-
-public class StatisticActivity extends AppCompatActivity {
-
-    ImageView btnBack;
-    TextView tvExpenseTab, tvIncomeTab, tvTotalExpense;
-
-    BarChart barChartExpense;
-    PieChart pieChartExpense;
-
-    BottomNavigationView bottomNavigation;
-
-    @Override
-    protected void onCreate(Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState);
-        setContentView(R.layout.activity_statistic);
-
-        // ÁNH XẠ
-        btnBack = findViewById(R.id.btnBack);
-        tvExpenseTab = findViewById(R.id.tvExpenseTab);
-        tvIncomeTab = findViewById(R.id.tvIncomeTab);
-        tvTotalExpense = findViewById(R.id.tvTotalExpense);
-
-        barChartExpense = findViewById(R.id.barChartExpense);
-        pieChartExpense = findViewById(R.id.pieChartExpense);
-
-        bottomNavigation = findViewById(R.id.bottomNavigation);
-
-        // BACK
-        btnBack.setOnClickListener(v -> finish());
-
-        // TAB CHI TIÊU (hiện tại)
-        tvExpenseTab.setOnClickListener(v -> {});
-
-        // CHUYỂN QUA THU NHẬP
-        tvIncomeTab.setOnClickListener(v -> {
-            startActivity(new Intent(this, IncomeStatisticActivity.class));
-            overridePendingTransition(android.R.anim.fade_in, android.R.anim.fade_out);
-        });
-
-        // HIGHLIGHT TAB
-        highlightTabs();
-
-        // NẠP DỮ LIỆU CHART
-        loadBarChartData();
-        loadPieChartData();
-
-        // BOTTOM NAV
-        setupBottomNav();
-    }
-
-    // ===================== BAR CHART =====================
-    private void loadBarChartData() {
-
-        List<BarEntry> entries = new ArrayList<>();
-        entries.add(new BarEntry(1, 5000000)); // Tháng 1
-        entries.add(new BarEntry(2, 3500000)); // Tháng 2
-        entries.add(new BarEntry(3, 4200000)); // Tháng 3
-        entries.add(new BarEntry(4, 6100000)); // Tháng 4
-        entries.add(new BarEntry(5, 4800000)); // Tháng 5
-
-        BarDataSet dataSet = new BarDataSet(entries, "Chi tiêu");
-        dataSet.setColor(Color.parseColor("#FF5252"));
-        dataSet.setValueTextColor(Color.WHITE);
-        dataSet.setValueTextSize(10f);
-
-        BarData barData = new BarData(dataSet);
-        barData.setBarWidth(0.4f);
-
-        barChartExpense.setData(barData);
-        barChartExpense.setFitBars(true);
-        barChartExpense.setNoDataText("Không có dữ liệu");
-        barChartExpense.getDescription().setEnabled(false);
-        barChartExpense.getLegend().setEnabled(false);
-
-        XAxis xAxis = barChartExpense.getXAxis();
-        xAxis.setPosition(XAxis.XAxisPosition.BOTTOM);
-        xAxis.setTextColor(Color.WHITE);
-        xAxis.setDrawGridLines(false);
-
-        barChartExpense.animateY(800);
-        barChartExpense.invalidate();
-    }
-
-    // ===================== PIE CHART =====================
-    private void loadPieChartData() {
-
-        List<PieEntry> entries = new ArrayList<>();
-        entries.add(new PieEntry(40f, "Ăn uống"));
-        entries.add(new PieEntry(25f, "Đi lại"));
-        entries.add(new PieEntry(20f, "Giải trí"));
-        entries.add(new PieEntry(15f, "Mua sắm"));
-
-        PieDataSet dataSet = new PieDataSet(entries, "");
-        dataSet.setColors(
-                Color.parseColor("#FF5252"),
-                Color.parseColor("#FF8A65"),
-                Color.parseColor("#FF7043"),
-                Color.parseColor("#FFB74D")
-        );
-
-        dataSet.setValueTextSize(12f);
-        dataSet.setValueTextColor(Color.WHITE);
-
-        PieData pieData = new PieData(dataSet);
-
-        pieChartExpense.setData(pieData);
-        pieChartExpense.setUsePercentValues(true);
-
-        pieChartExpense.setTransparentCircleRadius(50f);
-        pieChartExpense.setHoleRadius(45f);
-
-        pieChartExpense.getDescription().setEnabled(false);
-
-        Legend legend = pieChartExpense.getLegend();
-        legend.setTextColor(Color.WHITE);
-        legend.setTextSize(12f);
-
-        pieChartExpense.animateY(800);
-        pieChartExpense.invalidate();
-    }
-
-    // ===================== HIGHLIGHT TAB =====================
-    private void highlightTabs() {
-        // Chi tiêu ACTIVE
-        tvExpenseTab.setTextColor(Color.WHITE);
-        tvExpenseTab.setTextSize(18f);
-        tvExpenseTab.setTypeface(tvExpenseTab.getTypeface(), android.graphics.Typeface.BOLD);
-
-        // Thu nhập INACTIVE
-        tvIncomeTab.setTextColor(Color.parseColor("#777777"));
-        tvIncomeTab.setTypeface(tvIncomeTab.getTypeface(), android.graphics.Typeface.NORMAL);
-    }
-
-    // ===================== BOTTOM NAV =====================
-    private void setupBottomNav() {
-        bottomNavigation.setSelectedItemId(R.id.nav_statistic);
-
-        bottomNavigation.setOnItemSelectedListener(item -> {
-            int id = item.getItemId();
-
-            if (id == R.id.nav_home) {
-                startActivity(new Intent(this, HomeActivity.class));
-                return true;
-            }
-
-            if (id == R.id.nav_wallet) {
-                startActivity(new Intent(this, WalletActivity.class));
-                return true;
-            }
-
-            if (id == R.id.nav_add) {
-                startActivity(new Intent(this, AddTransactionActivity.class));
-                return true;
-            }
-
-            if (id == R.id.nav_statistic) {
-                return true;
-            }
-
-            if (id == R.id.nav_settings) {
-                startActivity(new Intent(this, SettingsActivity.class));
-                return true;
-            }
-
-            return false;
-        });
-    }
-}
Index: app/src/main/java/com/finmate/data/repository/WalletRepository.java
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/WalletRepository.java b/app/src/main/java/com/finmate/data/repository/WalletRepository.java
deleted file mode 100644
--- a/app/src/main/java/com/finmate/data/repository/WalletRepository.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ /dev/null	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
@@ -1,55 +0,0 @@
-package com.finmate.data.repository;
-
-import android.content.Context;
-
-import com.finmate.data.local.database.AppDatabase;
-import com.finmate.data.local.database.dao.WalletDao;
-import com.finmate.data.local.database.entity.WalletEntity;
-
-import java.util.List;
-import java.util.concurrent.Executors;
-
-import javax.inject.Inject;
-import javax.inject.Singleton;
-
-import dagger.hilt.android.qualifiers.ApplicationContext;
-
-@Singleton
-public class WalletRepository {
-
-    private final WalletDao dao;
-
-    @Inject
-    public WalletRepository(@ApplicationContext Context context) {
-        dao = AppDatabase.getDatabase(context).walletDao();
-    }
-
-    public void insert(WalletEntity wallet) {
-        Executors.newSingleThreadExecutor().execute(() ->
-                dao.insert(wallet)
-        );
-    }
-
-    public void getAll(Callback callback) {
-        Executors.newSingleThreadExecutor().execute(() ->
-                callback.onResult(dao.getAll())
-        );
-    }
-
-    public void replaceAll(List<WalletEntity> wallets) {
-        Executors.newSingleThreadExecutor().execute(() -> {
-            // Cách đơn giản: xóa hết rồi insert lại
-            List<WalletEntity> existing = dao.getAll();
-            for (WalletEntity w : existing) {
-                dao.delete(w);
-            }
-            for (WalletEntity w : wallets) {
-                dao.insert(w);
-            }
-        });
-    }
-
-    public interface Callback {
-        void onResult(List<WalletEntity> list);
-    }
-}
Index: app/src/main/java/com/finmate/data/repository/SharedExpenseRemoteRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/SharedExpenseRemoteRepository.java b/app/src/main/java/com/finmate/data/repository/SharedExpenseRemoteRepository.java
new file mode 100644
--- /dev/null	(date 1765447595535)
+++ b/app/src/main/java/com/finmate/data/repository/SharedExpenseRemoteRepository.java	(date 1765447595535)
@@ -0,0 +1,31 @@
+package com.finmate.data.repository;
+
+import com.finmate.data.local.database.entity.SharedTransactionEntity;
+import com.finmate.data.remote.api.ApiCallback;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import javax.inject.Inject;
+import javax.inject.Singleton;
+
+/**
+ * Stub để ghép API thật sau này.
+ */
+@Singleton
+public class SharedExpenseRemoteRepository {
+
+    @Inject
+    public SharedExpenseRemoteRepository() {}
+
+    public void listShared(ApiCallback<List<SharedTransactionEntity>> callback) {
+        // TODO: call real API; for now return empty
+        callback.onSuccess(new ArrayList<>());
+    }
+
+    public void createShared(SharedTransactionEntity entity, ApiCallback<SharedTransactionEntity> callback) {
+        // TODO: call real API; for now echo back
+        callback.onSuccess(entity);
+    }
+}
+
Index: app/src/main/java/com/finmate/data/repository/StatisticRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/StatisticRepository.java b/app/src/main/java/com/finmate/data/repository/StatisticRepository.java
new file mode 100644
--- /dev/null	(date 1765447595535)
+++ b/app/src/main/java/com/finmate/data/repository/StatisticRepository.java	(date 1765447595535)
@@ -0,0 +1,77 @@
+package com.finmate.data.repository;
+
+import android.content.Context;
+
+import com.finmate.core.offline.PendingAction;
+import com.finmate.data.local.database.AppDatabase;
+import com.finmate.data.local.database.dao.TransactionDao;
+import com.finmate.data.local.database.dao.WalletDao;
+import com.finmate.data.local.database.entity.WalletEntity;
+import com.finmate.data.local.database.model.StatisticPoint;
+import com.finmate.data.repository.model.StatisticFilter;
+import com.finmate.data.repository.model.StatisticGranularity;
+
+import java.util.List;
+import java.util.concurrent.Executor;
+import java.util.concurrent.Executors;
+
+import javax.inject.Inject;
+import javax.inject.Singleton;
+
+import dagger.hilt.android.qualifiers.ApplicationContext;
+
+@Singleton
+public class StatisticRepository {
+
+    private static final Executor EXECUTOR = Executors.newSingleThreadExecutor();
+
+    private final TransactionDao transactionDao;
+    private final WalletDao walletDao;
+
+    @Inject
+    public StatisticRepository(@ApplicationContext Context context) {
+        AppDatabase database = AppDatabase.getDatabase(context);
+        this.transactionDao = database.transactionDao();
+        this.walletDao = database.walletDao();
+    }
+
+    public void loadWallets(Callback<List<WalletEntity>> callback) {
+        EXECUTOR.execute(() -> callback.onResult(walletDao.getAll()));
+    }
+
+    public void loadStatistic(String type, StatisticFilter filter, Callback<StatisticData> callback) {
+        EXECUTOR.execute(() -> {
+            String start = filter.getStartDateIso();
+            String end = filter.getEndDateIso();
+            String wallet = filter.getWalletName();
+            String ignoredAction = PendingAction.DELETE;
+
+            double total = transactionDao.sumAmount(type, start, end, wallet, ignoredAction);
+            List<StatisticPoint> timeline = chooseTimelineQuery(type, filter.getGranularity(), start, end, wallet, ignoredAction);
+            List<StatisticPoint> byCategory = transactionDao.sumByCategory(type, start, end, wallet, ignoredAction);
+            List<StatisticPoint> byWallet = transactionDao.sumByWallet(type, start, end, wallet, ignoredAction);
+
+            callback.onResult(new StatisticData(total, timeline, byCategory, byWallet));
+        });
+    }
+
+    private List<StatisticPoint> chooseTimelineQuery(String type,
+                                                     StatisticGranularity granularity,
+                                                     String start,
+                                                     String end,
+                                                     String wallet,
+                                                     String ignoredAction) {
+        if (granularity == StatisticGranularity.WEEK) {
+            return transactionDao.sumByWeek(type, start, end, wallet, ignoredAction);
+        }
+        if (granularity == StatisticGranularity.MONTH) {
+            return transactionDao.sumByMonth(type, start, end, wallet, ignoredAction);
+        }
+        return transactionDao.sumByDay(type, start, end, wallet, ignoredAction);
+    }
+
+    public interface Callback<T> {
+        void onResult(T data);
+    }
+}
+
Index: app/src/main/java/com/finmate/data/repository/WalletSyncManager.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/WalletSyncManager.java b/app/src/main/java/com/finmate/data/repository/WalletSyncManager.java
new file mode 100644
--- /dev/null	(date 1765447595535)
+++ b/app/src/main/java/com/finmate/data/repository/WalletSyncManager.java	(date 1765447595535)
@@ -0,0 +1,158 @@
+package com.finmate.data.repository;
+
+import androidx.annotation.Nullable;
+
+import com.finmate.core.network.SyncOnlineStatusManager;
+import com.finmate.core.offline.BaseSyncManager;
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+import com.finmate.data.dto.WalletRequest;
+import com.finmate.data.dto.WalletResponse;
+import com.finmate.data.local.database.entity.WalletEntity;
+import com.finmate.data.remote.api.ApiCallback;
+
+import java.math.BigDecimal;
+
+import javax.inject.Inject;
+import javax.inject.Singleton;
+
+@Singleton
+public class WalletSyncManager extends BaseSyncManager<WalletEntity> {
+
+    private final WalletRemoteRepository remoteRepository;
+    private final WalletLocalRepository localRepository;
+
+    @Inject
+    public WalletSyncManager(WalletRemoteRepository remoteRepository,
+                             WalletLocalRepository localRepository,
+                             SyncOnlineStatusManager onlineStatusManager) {
+        super(onlineStatusManager);
+        this.remoteRepository = remoteRepository;
+        this.localRepository = localRepository;
+    }
+
+    public void syncPendingWallets() {
+        localRepository.getPendingForSync(this::syncPending);
+    }
+
+    @Override
+    protected void performSync(WalletEntity wallet, SyncCallback callback) {
+        switch (wallet.getPendingAction()) {
+            case PendingAction.CREATE:
+                syncCreate(wallet, callback);
+                break;
+            case PendingAction.UPDATE:
+                syncUpdate(wallet, callback);
+                break;
+            case PendingAction.DELETE:
+                syncDelete(wallet, callback);
+                break;
+            default:
+                callback.onSkip();
+        }
+    }
+
+    private void syncCreate(WalletEntity wallet, SyncCallback callback) {
+        WalletRequest request = new WalletRequest(
+                wallet.getName(),
+                "CASH", // default type, can be made configurable
+                wallet.getCurrency() != null ? wallet.getCurrency() : "VND",
+                BigDecimal.valueOf(wallet.getBalanceCached()),
+                false, // archived
+                null // color
+        );
+        remoteRepository.createWallet(request, new ApiCallback<WalletResponse>() {
+            @Override
+            public void onSuccess(WalletResponse data) {
+                WalletEntity synced = mapResponse(data);
+                localRepository.markAsSyncedAfterCreate(wallet, synced);
+                callback.onSuccess();
+            }
+
+            @Override
+            public void onError(String message, @Nullable Integer code) {
+                handleError(wallet, code, callback);
+            }
+        });
+    }
+
+    private void syncUpdate(WalletEntity wallet, SyncCallback callback) {
+        if (wallet.getRemoteId() == null) {
+            // fallback treat as create
+            syncCreate(wallet, callback);
+            return;
+        }
+        WalletRequest request = new WalletRequest(
+                wallet.getName(),
+                "CASH", // default type, can be made configurable
+                wallet.getCurrency() != null ? wallet.getCurrency() : "VND",
+                BigDecimal.valueOf(wallet.getBalanceCached()),
+                false, // archived
+                null // color
+        );
+        remoteRepository.updateWallet(wallet.getRemoteId(), request, new ApiCallback<WalletResponse>() {
+            @Override
+            public void onSuccess(WalletResponse data) {
+                wallet.setSyncStatus(SyncStatus.SYNCED);
+                wallet.setPendingAction(PendingAction.NONE);
+                wallet.setUpdatedAt(System.currentTimeMillis());
+                localRepository.updateAsSynced(wallet);
+                callback.onSuccess();
+            }
+
+            @Override
+            public void onError(String message, @Nullable Integer code) {
+                handleError(wallet, code, callback);
+            }
+        });
+    }
+
+    private void syncDelete(WalletEntity wallet, SyncCallback callback) {
+        if (wallet.getRemoteId() == null) {
+            localRepository.deleteImmediate(wallet);
+            callback.onSuccess();
+            return;
+        }
+        remoteRepository.deleteWallet(wallet.getRemoteId(), new ApiCallback<Void>() {
+            @Override
+            public void onSuccess(Void unused) {
+                localRepository.deleteImmediate(wallet);
+                callback.onSuccess();
+            }
+
+            @Override
+            public void onError(String message, @Nullable Integer code) {
+                handleError(wallet, code, callback);
+            }
+        });
+    }
+
+    private void handleError(WalletEntity wallet, @Nullable Integer code, SyncCallback callback) {
+        if (code != null && code >= 400 && code < 500) {
+            wallet.setSyncStatus(SyncStatus.FAILED);
+            wallet.setPendingAction(PendingAction.NONE);
+            localRepository.saveStatusOnly(wallet);
+            callback.onSuccess();
+        } else {
+            callback.onError(code, null);
+        }
+    }
+
+    private WalletEntity mapResponse(WalletResponse res) {
+        // Use initialBalance from backend, or fallback to currentBalance helper
+        double balance = res.getInitialBalance() != null ? 
+                res.getInitialBalance().doubleValue() : res.getCurrentBalance();
+        WalletEntity entity = new WalletEntity(
+                res.getName(),
+                res.getCurrency() != null ? res.getCurrency() : "VND",
+                balance,
+                0
+        );
+        entity.setRemoteId(res.getId());
+        entity.setSyncStatus(SyncStatus.SYNCED);
+        entity.setPendingAction(PendingAction.NONE);
+        entity.setUpdatedAt(System.currentTimeMillis());
+        return entity;
+    }
+}
+
Index: app/src/main/java/com/finmate/data/repository/CategorySyncManager.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/CategorySyncManager.java b/app/src/main/java/com/finmate/data/repository/CategorySyncManager.java
new file mode 100644
--- /dev/null	(date 1765447595528)
+++ b/app/src/main/java/com/finmate/data/repository/CategorySyncManager.java	(date 1765447595528)
@@ -0,0 +1,134 @@
+package com.finmate.data.repository;
+
+import androidx.annotation.Nullable;
+
+import com.finmate.core.network.SyncOnlineStatusManager;
+import com.finmate.core.offline.BaseSyncManager;
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+import com.finmate.data.dto.CategoryRequest;
+import com.finmate.data.dto.CategoryResponse;
+import com.finmate.data.local.database.entity.CategoryEntity;
+import com.finmate.data.remote.api.ApiCallback;
+
+import javax.inject.Inject;
+import javax.inject.Singleton;
+
+@Singleton
+public class CategorySyncManager extends BaseSyncManager<CategoryEntity> {
+
+    private final CategoryRemoteRepository remoteRepository;
+    private final CategoryLocalRepository localRepository;
+
+    @Inject
+    public CategorySyncManager(CategoryRemoteRepository remoteRepository,
+                               CategoryLocalRepository localRepository,
+                               SyncOnlineStatusManager onlineStatusManager) {
+        super(onlineStatusManager);
+        this.remoteRepository = remoteRepository;
+        this.localRepository = localRepository;
+    }
+
+    public void syncPendingCategories() {
+        localRepository.getPendingForSync(this::syncPending);
+    }
+
+    @Override
+    protected void performSync(CategoryEntity item, SyncCallback callback) {
+        switch (item.getPendingAction()) {
+            case PendingAction.CREATE:
+                syncCreate(item, callback);
+                break;
+            case PendingAction.UPDATE:
+                syncUpdate(item, callback);
+                break;
+            case PendingAction.DELETE:
+                syncDelete(item, callback);
+                break;
+            default:
+                callback.onSkip();
+        }
+    }
+
+    private void syncCreate(CategoryEntity e, SyncCallback callback) {
+        CategoryRequest req = new CategoryRequest(e.getName(), e.getType(), e.getIcon());
+        remoteRepository.createCategory(req, new ApiCallback<CategoryResponse>() {
+            @Override
+            public void onSuccess(CategoryResponse res) {
+                CategoryEntity synced = map(res, e.getIconRes());
+                localRepository.markAsSyncedAfterCreate(e, synced);
+                callback.onSuccess();
+            }
+
+            @Override
+            public void onError(String message, @Nullable Integer code) {
+                handleError(e, code, callback);
+            }
+        });
+    }
+
+    private void syncUpdate(CategoryEntity e, SyncCallback callback) {
+        if (e.getRemoteId() == null) {
+            syncCreate(e, callback);
+            return;
+        }
+        CategoryRequest req = new CategoryRequest(e.getName(), e.getType(), e.getIcon());
+        remoteRepository.updateCategory(e.getRemoteId(), req, new ApiCallback<CategoryResponse>() {
+            @Override
+            public void onSuccess(CategoryResponse res) {
+                e.setSyncStatus(SyncStatus.SYNCED);
+                e.setPendingAction(PendingAction.NONE);
+                e.setUpdatedAt(System.currentTimeMillis());
+                localRepository.updateAsSynced(e);
+                callback.onSuccess();
+            }
+
+            @Override
+            public void onError(String message, @Nullable Integer code) {
+                handleError(e, code, callback);
+            }
+        });
+    }
+
+    private void syncDelete(CategoryEntity e, SyncCallback callback) {
+        if (e.getRemoteId() == null) {
+            localRepository.deleteImmediate(e);
+            callback.onSuccess();
+            return;
+        }
+        remoteRepository.deleteCategory(e.getRemoteId(), new ApiCallback<Void>() {
+            @Override
+            public void onSuccess(Void unused) {
+                localRepository.deleteImmediate(e);
+                callback.onSuccess();
+            }
+
+            @Override
+            public void onError(String message, @Nullable Integer code) {
+                handleError(e, code, callback);
+            }
+        });
+    }
+
+    private void handleError(CategoryEntity e, @Nullable Integer code, SyncCallback callback) {
+        if (code != null && code >= 400 && code < 500) {
+            e.setSyncStatus(SyncStatus.FAILED);
+            e.setPendingAction(PendingAction.NONE);
+            localRepository.saveStatusOnly(e);
+            callback.onSuccess();
+        } else {
+            callback.onError(code, null);
+        }
+    }
+
+    private CategoryEntity map(CategoryResponse res, int iconResId) {
+        CategoryEntity entity = new CategoryEntity(res.getName(), res.getType(), iconResId);
+        entity.setIcon(res.getIcon());
+        entity.setRemoteId(res.getId());
+        entity.setSyncStatus(SyncStatus.SYNCED);
+        entity.setPendingAction(PendingAction.NONE);
+        entity.setUpdatedAt(System.currentTimeMillis());
+        return entity;
+    }
+}
+
Index: app/src/main/java/com/finmate/data/repository/GoalRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/GoalRepository.java b/app/src/main/java/com/finmate/data/repository/GoalRepository.java
new file mode 100644
--- /dev/null	(date 1765447595531)
+++ b/app/src/main/java/com/finmate/data/repository/GoalRepository.java	(date 1765447595531)
@@ -0,0 +1,69 @@
+package com.finmate.data.repository;
+
+import android.content.Context;
+
+import com.finmate.core.offline.PendingAction;
+import com.finmate.data.local.database.AppDatabase;
+import com.finmate.data.local.database.dao.TransactionDao;
+import com.finmate.data.local.database.entity.GoalEntity;
+import com.finmate.data.repository.model.GoalProgress;
+
+import java.util.List;
+import java.util.concurrent.Executor;
+import java.util.concurrent.Executors;
+
+import javax.inject.Inject;
+import javax.inject.Singleton;
+
+import dagger.hilt.android.qualifiers.ApplicationContext;
+
+@Singleton
+public class GoalRepository {
+
+    private static final Executor EXECUTOR = Executors.newSingleThreadExecutor();
+
+    private final GoalLocalRepository localRepository;
+    private final TransactionDao transactionDao;
+
+    @Inject
+    public GoalRepository(@ApplicationContext Context context, GoalLocalRepository localRepository) {
+        this.localRepository = localRepository;
+        this.transactionDao = AppDatabase.getDatabase(context).transactionDao();
+    }
+
+    public void listGoals(Callback<List<GoalEntity>> callback) {
+        localRepository.getAll(callback::onResult);
+    }
+
+    public void saveGoal(GoalEntity entity) {
+        if (entity.id == 0) {
+            localRepository.insert(entity);
+        } else {
+            localRepository.update(entity);
+        }
+    }
+
+    public void deleteGoal(GoalEntity entity) {
+        localRepository.delete(entity);
+    }
+
+    /**
+        Simple progress: sum of INCOME transactions into linked wallet (if provided) within all time.
+        This can be refined once BE rules are available.
+     */
+    public void calculateProgress(GoalEntity goal, ProgressCallback callback) {
+        EXECUTOR.execute(() -> {
+            String wallet = goal.linkedWalletName;
+            double saved = transactionDao.sumAmount("INCOME", null, null, wallet, PendingAction.DELETE);
+            callback.onProgress(new GoalProgress(goal.targetAmount, saved));
+        });
+    }
+
+    public interface Callback<T> {
+        void onResult(T data);
+    }
+
+    public interface ProgressCallback {
+        void onProgress(GoalProgress progress);
+    }
+}
Index: app/src/main/java/com/finmate/data/repository/GoalLocalRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/GoalLocalRepository.java b/app/src/main/java/com/finmate/data/repository/GoalLocalRepository.java
new file mode 100644
--- /dev/null	(date 1765447595531)
+++ b/app/src/main/java/com/finmate/data/repository/GoalLocalRepository.java	(date 1765447595531)
@@ -0,0 +1,68 @@
+package com.finmate.data.repository;
+
+import android.content.Context;
+
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+import com.finmate.data.local.database.AppDatabase;
+import com.finmate.data.local.database.dao.GoalDao;
+import com.finmate.data.local.database.entity.GoalEntity;
+
+import java.util.List;
+import java.util.concurrent.Executor;
+import java.util.concurrent.Executors;
+
+import javax.inject.Inject;
+import javax.inject.Singleton;
+
+import dagger.hilt.android.qualifiers.ApplicationContext;
+
+@Singleton
+public class GoalLocalRepository {
+
+    private static final Executor EXECUTOR = Executors.newSingleThreadExecutor();
+
+    private final GoalDao dao;
+
+    @Inject
+    public GoalLocalRepository(@ApplicationContext Context context) {
+        dao = AppDatabase.getDatabase(context).goalDao();
+    }
+
+    public void insert(GoalEntity entity) {
+        entity.setPendingAction(PendingAction.CREATE);
+        entity.setSyncStatus(SyncStatus.PENDING_CREATE);
+        entity.setUpdatedAt(System.currentTimeMillis());
+        EXECUTOR.execute(() -> dao.insert(entity));
+    }
+
+    public void update(GoalEntity entity) {
+        entity.setPendingAction(PendingAction.UPDATE);
+        entity.setSyncStatus(SyncStatus.PENDING_UPDATE);
+        entity.setUpdatedAt(System.currentTimeMillis());
+        EXECUTOR.execute(() -> dao.update(entity));
+    }
+
+    public void delete(GoalEntity entity) {
+        entity.setPendingAction(PendingAction.DELETE);
+        entity.setSyncStatus(SyncStatus.PENDING_DELETE);
+        entity.setUpdatedAt(System.currentTimeMillis());
+        EXECUTOR.execute(() -> dao.update(entity));
+    }
+
+    public void deleteImmediate(GoalEntity entity) {
+        EXECUTOR.execute(() -> dao.delete(entity));
+    }
+
+    public void getAll(Callback callback) {
+        EXECUTOR.execute(() -> callback.onResult(dao.getAll()));
+    }
+
+    public void getPendingForSync(Callback callback) {
+        EXECUTOR.execute(() -> callback.onResult(dao.getPendingForSync()));
+    }
+
+    public interface Callback {
+        void onResult(List<GoalEntity> list);
+    }
+}
Index: app/src/main/java/com/finmate/data/repository/StatisticData.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/StatisticData.java b/app/src/main/java/com/finmate/data/repository/StatisticData.java
new file mode 100644
--- /dev/null	(date 1765447595535)
+++ b/app/src/main/java/com/finmate/data/repository/StatisticData.java	(date 1765447595535)
@@ -0,0 +1,40 @@
+package com.finmate.data.repository;
+
+import com.finmate.data.local.database.model.StatisticPoint;
+
+import java.util.List;
+
+public class StatisticData {
+
+    private final double totalAmount;
+    private final List<StatisticPoint> timeline;
+    private final List<StatisticPoint> byCategory;
+    private final List<StatisticPoint> byWallet;
+
+    public StatisticData(double totalAmount,
+                         List<StatisticPoint> timeline,
+                         List<StatisticPoint> byCategory,
+                         List<StatisticPoint> byWallet) {
+        this.totalAmount = totalAmount;
+        this.timeline = timeline;
+        this.byCategory = byCategory;
+        this.byWallet = byWallet;
+    }
+
+    public double getTotalAmount() {
+        return totalAmount;
+    }
+
+    public List<StatisticPoint> getTimeline() {
+        return timeline;
+    }
+
+    public List<StatisticPoint> getByCategory() {
+        return byCategory;
+    }
+
+    public List<StatisticPoint> getByWallet() {
+        return byWallet;
+    }
+}
+
Index: app/src/main/java/com/finmate/data/repository/FriendLocalRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/FriendLocalRepository.java b/app/src/main/java/com/finmate/data/repository/FriendLocalRepository.java
new file mode 100644
--- /dev/null	(date 1765447595531)
+++ b/app/src/main/java/com/finmate/data/repository/FriendLocalRepository.java	(date 1765447595531)
@@ -0,0 +1,66 @@
+package com.finmate.data.repository;
+
+import android.content.Context;
+
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+import com.finmate.data.local.database.AppDatabase;
+import com.finmate.data.local.database.dao.FriendDao;
+import com.finmate.data.local.database.entity.FriendEntity;
+
+import java.util.List;
+import java.util.concurrent.Executor;
+import java.util.concurrent.Executors;
+
+import javax.inject.Inject;
+import javax.inject.Singleton;
+
+import dagger.hilt.android.qualifiers.ApplicationContext;
+
+@Singleton
+public class FriendLocalRepository {
+
+    private static final Executor EXECUTOR = Executors.newSingleThreadExecutor();
+    private final FriendDao dao;
+
+    @Inject
+    public FriendLocalRepository(@ApplicationContext Context context) {
+        dao = AppDatabase.getDatabase(context).friendDao();
+    }
+
+    public void replaceAll(List<FriendEntity> friends) {
+        EXECUTOR.execute(() -> {
+            dao.deleteAll();
+            for (FriendEntity e : friends) {
+                dao.insert(e);
+            }
+        });
+    }
+
+    public void getAll(OnResultCallback<List<FriendEntity>> callback) {
+        EXECUTOR.execute(() -> callback.onResult(dao.getAll()));
+    }
+
+    public void insertPending(FriendEntity entity) {
+        entity.pendingAction = PendingAction.CREATE;
+        entity.syncStatus = SyncStatus.PENDING_CREATE;
+        entity.updatedAt = System.currentTimeMillis();
+        EXECUTOR.execute(() -> dao.insert(entity));
+    }
+
+    public void markSynced(FriendEntity entity) {
+        entity.pendingAction = PendingAction.NONE;
+        entity.syncStatus = SyncStatus.SYNCED;
+        entity.updatedAt = System.currentTimeMillis();
+        EXECUTOR.execute(() -> dao.update(entity));
+    }
+
+    public void getPendingForSync(OnResultCallback<List<FriendEntity>> callback) {
+        EXECUTOR.execute(() -> callback.onResult(dao.getPendingForSync()));
+    }
+
+    public interface OnResultCallback<T> {
+        void onResult(T data);
+    }
+}
+
Index: app/src/main/java/com/finmate/data/repository/SharedExpenseRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/SharedExpenseRepository.java b/app/src/main/java/com/finmate/data/repository/SharedExpenseRepository.java
new file mode 100644
--- /dev/null	(date 1765447595535)
+++ b/app/src/main/java/com/finmate/data/repository/SharedExpenseRepository.java	(date 1765447595535)
@@ -0,0 +1,85 @@
+package com.finmate.data.repository;
+
+import androidx.annotation.Nullable;
+
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+import com.finmate.data.local.database.dao.SharedTransactionDao;
+import com.finmate.data.local.database.entity.SharedTransactionEntity;
+import com.finmate.data.remote.api.ApiCallback;
+
+import java.util.List;
+import java.util.concurrent.Executor;
+import java.util.concurrent.Executors;
+
+import javax.inject.Inject;
+import javax.inject.Singleton;
+
+/**
+ * V1: chỉ cho phép tạo shared expense khi online.
+ * Nếu offline: trả lỗi để UI show banner "Cần Internet".
+ */
+@Singleton
+public class SharedExpenseRepository {
+
+    private static final Executor EXECUTOR = Executors.newSingleThreadExecutor();
+
+    private final SharedTransactionDao sharedDao;
+    private final SharedExpenseRemoteRepository remoteRepository;
+
+    @Inject
+    public SharedExpenseRepository(SharedTransactionDao sharedDao,
+                                   SharedExpenseRemoteRepository remoteRepository) {
+        this.sharedDao = sharedDao;
+        this.remoteRepository = remoteRepository;
+    }
+
+    public interface Callback<T> {
+        void onResult(T data);
+        void onError(String message);
+    }
+
+    public void loadSharedExpenses(Callback<List<SharedTransactionEntity>> callback) {
+        EXECUTOR.execute(() -> callback.onResult(sharedDao.getAll()));
+
+        remoteRepository.listShared(new ApiCallback<List<SharedTransactionEntity>>() {
+            @Override
+            public void onSuccess(List<SharedTransactionEntity> data) {
+                EXECUTOR.execute(() -> {
+                    sharedDao.deleteAll();
+                    for (SharedTransactionEntity e : data) {
+                        e.syncStatus = SyncStatus.SYNCED;
+                        e.pendingAction = PendingAction.NONE;
+                        e.updatedAt = System.currentTimeMillis();
+                        sharedDao.insert(e);
+                    }
+                });
+                callback.onResult(data);
+            }
+
+            @Override
+            public void onError(String message, @Nullable Integer code) {
+                // keep cached
+            }
+        });
+    }
+
+    public void createSharedExpenseOnline(SharedTransactionEntity entity, Callback<Void> callback) {
+        remoteRepository.createShared(entity, new ApiCallback<SharedTransactionEntity>() {
+            @Override
+            public void onSuccess(SharedTransactionEntity data) {
+                data.syncStatus = SyncStatus.SYNCED;
+                data.pendingAction = PendingAction.NONE;
+                data.updatedAt = System.currentTimeMillis();
+                EXECUTOR.execute(() -> sharedDao.insert(data));
+                callback.onResult(null);
+            }
+
+            @Override
+            public void onError(String message, @Nullable Integer code) {
+                callback.onError(message != null ? message : "Không thể tạo giao dịch chia sẻ");
+            }
+        });
+    }
+}
+
Index: app/src/main/java/com/finmate/data/repository/TransactionRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/TransactionRepository.java b/app/src/main/java/com/finmate/data/repository/TransactionLocalRepository.java
rename from app/src/main/java/com/finmate/data/repository/TransactionRepository.java
rename to app/src/main/java/com/finmate/data/repository/TransactionLocalRepository.java
--- a/app/src/main/java/com/finmate/data/repository/TransactionRepository.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/repository/TransactionLocalRepository.java	(date 1765447595535)
@@ -4,6 +4,7 @@
 
 import com.finmate.data.local.database.AppDatabase;
 import com.finmate.data.local.database.dao.TransactionDao;
+import com.finmate.core.offline.SyncStatus;
 import com.finmate.data.local.database.entity.TransactionEntity;
 
 import java.util.List;
@@ -16,14 +17,14 @@
 import dagger.hilt.android.qualifiers.ApplicationContext;
 
 @Singleton
-public class TransactionRepository {
+public class TransactionLocalRepository {
 
     private static final Executor EXECUTOR = Executors.newSingleThreadExecutor();
 
     private final TransactionDao dao;
 
     @Inject
-    public TransactionRepository(@ApplicationContext Context context) {
+    public TransactionLocalRepository(@ApplicationContext Context context) {
         dao = AppDatabase.getDatabase(context).transactionDao();
     }
 
@@ -35,7 +36,12 @@
         EXECUTOR.execute(() -> callback.onResult(dao.getAll()));
     }
 
+    public void getPendingForSync(OnResultCallback<List<TransactionEntity>> callback) {
+        EXECUTOR.execute(() -> callback.onResult(dao.getPendingForSync()));
+    }
+
     public void update(TransactionEntity entity) {
+        entity.updatedAt = System.currentTimeMillis();
         EXECUTOR.execute(() -> dao.update(entity));
     }
 
@@ -43,22 +49,22 @@
         EXECUTOR.execute(() -> dao.delete(entity));
     }
 
-    /**
-     * Ghi đè toàn bộ transaction local = data mới từ server.
-     * Anh có thể sau này đổi thành sync thông minh hơn.
-     */
-    public void replaceAll(List<TransactionEntity> transactions) {
+    public void replaceAllSynced(List<TransactionEntity> transactions) {
         EXECUTOR.execute(() -> {
-            List<TransactionEntity> existing = dao.getAll();
-            for (TransactionEntity t : existing) {
-                dao.delete(t);
-            }
+            dao.deleteByStatus(SyncStatus.SYNCED);
             for (TransactionEntity t : transactions) {
                 dao.insert(t);
             }
         });
     }
 
+    public void markAsSyncedAfterCreate(TransactionEntity oldPending, TransactionEntity newSynced) {
+        EXECUTOR.execute(() -> {
+            dao.delete(oldPending);
+            dao.insert(newSynced);
+        });
+    }
+    
     public interface OnResultCallback<T> {
         void onResult(T data);
     }
Index: app/src/main/java/com/finmate/data/repository/CategoryRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/CategoryRepository.java b/app/src/main/java/com/finmate/data/repository/CategoryLocalRepository.java
rename from app/src/main/java/com/finmate/data/repository/CategoryRepository.java
rename to app/src/main/java/com/finmate/data/repository/CategoryLocalRepository.java
--- a/app/src/main/java/com/finmate/data/repository/CategoryRepository.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/repository/CategoryLocalRepository.java	(date 1765447595528)
@@ -3,7 +3,10 @@
 import android.content.Context;
 import androidx.lifecycle.LiveData;
 
-import com.finmate.core.network.ApiCallback;
+import androidx.annotation.Nullable;
+import com.finmate.data.remote.api.ApiCallback;
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
 import com.finmate.data.dto.CategoryRequest;
 import com.finmate.data.dto.CategoryResponse;
 import com.finmate.data.local.database.AppDatabase;
@@ -21,7 +24,7 @@
 import dagger.hilt.android.qualifiers.ApplicationContext;
 
 @Singleton
-public class CategoryRepository {
+public class CategoryLocalRepository {
 
     private static final Executor EXECUTOR = Executors.newSingleThreadExecutor();
 
@@ -30,7 +33,7 @@
     private final Context context;
 
     @Inject
-    public CategoryRepository(@ApplicationContext Context ctx,
+    public CategoryLocalRepository(@ApplicationContext Context ctx,
                               CategoryRemoteRepository remoteRepo) {
         this.context = ctx;
         this.dao = AppDatabase.getDatabase(ctx).categoryDao();
@@ -40,14 +43,54 @@
     // ===== LOCAL CRUD =====
 
     public void insert(CategoryEntity e) {
+        e.setPendingAction(PendingAction.CREATE);
+        e.setSyncStatus(SyncStatus.PENDING_CREATE);
+        e.setUpdatedAt(System.currentTimeMillis());
         EXECUTOR.execute(() -> dao.insert(e));
     }
 
     public void update(CategoryEntity e) {
+        e.setPendingAction(PendingAction.UPDATE);
+        e.setSyncStatus(SyncStatus.PENDING_UPDATE);
+        e.setUpdatedAt(System.currentTimeMillis());
         EXECUTOR.execute(() -> dao.update(e));
     }
 
     public void delete(CategoryEntity e) {
+        e.setPendingAction(PendingAction.DELETE);
+        e.setSyncStatus(SyncStatus.PENDING_DELETE);
+        e.setUpdatedAt(System.currentTimeMillis());
+        EXECUTOR.execute(() -> dao.update(e));
+    }
+
+    public void updateAsSynced(CategoryEntity e) {
+        e.setPendingAction(PendingAction.NONE);
+        e.setSyncStatus(SyncStatus.SYNCED);
+        e.setUpdatedAt(System.currentTimeMillis());
+        EXECUTOR.execute(() -> dao.update(e));
+    }
+
+    public void saveStatusOnly(CategoryEntity e) {
+        e.setUpdatedAt(System.currentTimeMillis());
+        EXECUTOR.execute(() -> dao.update(e));
+    }
+
+    public void getPendingForSync(OnResultCallback<List<CategoryEntity>> callback) {
+        EXECUTOR.execute(() -> callback.onResult(dao.getPendingForSync()));
+    }
+
+    public void getPendingCategories(OnResultCallback<List<CategoryEntity>> callback) {
+        getPendingForSync(callback);
+    }
+
+    public void markAsSyncedAfterCreate(CategoryEntity pending, CategoryEntity synced) {
+        EXECUTOR.execute(() -> {
+            dao.delete(pending);
+            dao.insert(synced);
+        });
+    }
+
+    public void deleteImmediate(CategoryEntity e) {
         EXECUTOR.execute(() -> dao.delete(e));
     }
 
@@ -56,6 +99,11 @@
         return dao.getByType(type);
     }
 
+    // Synchronous method for lookups
+    public void getByTypeSync(String type, OnResultCallback<List<CategoryEntity>> callback) {
+        EXECUTOR.execute(() -> callback.onResult(dao.getByTypeSync(type)));
+    }
+
     // Sửa lại: Dùng transaction để đảm bảo tính toàn vẹn khi thay thế dữ liệu.
     private void replaceByType(String type, List<CategoryEntity> list) {
         EXECUTOR.execute(() -> {
@@ -84,17 +132,23 @@
                     int iconResId = context.getResources().getIdentifier(r.getIcon(), "drawable", context.getPackageName());
                     if (iconResId == 0) continue; // Bỏ qua nếu không tìm thấy icon
 
-                    mapped.add(new CategoryEntity(
+                    CategoryEntity entity = new CategoryEntity(
                             r.getName(),
                             r.getType(),
                             iconResId
-                    ));
+                    );
+                    entity.setIcon(r.getIcon());
+                    entity.setRemoteId(r.getId());
+                    entity.setSyncStatus(SyncStatus.SYNCED);
+                    entity.setPendingAction(PendingAction.NONE);
+                    entity.setUpdatedAt(System.currentTimeMillis());
+                    mapped.add(entity);
                 }
                 replaceByType(type, mapped);
             }
 
             @Override
-            public void onError(String msg) {
+            public void onError(String msg, @Nullable Integer code) {
                 // Có thể log lỗi hoặc hiển thị thông báo cho người dùng nếu cần
             }
         });
@@ -123,12 +177,17 @@
                         res.getType(),
                         iconResId
                 );
+                e.setIcon(res.getIcon());
+                e.setRemoteId(res.getId());
+                e.setSyncStatus(SyncStatus.SYNCED);
+                e.setPendingAction(PendingAction.NONE);
+                e.setUpdatedAt(System.currentTimeMillis());
                 insert(e);
                 cb.onSuccess();
             }
 
             @Override
-            public void onError(String msg) {
+            public void onError(String msg, @Nullable Integer code) {
                 cb.onError(msg);
             }
         });
@@ -158,12 +217,17 @@
                         iconResId
                 );
                 updated.setId(edit.getId());
+                updated.setIcon(res.getIcon());
+                updated.setRemoteId(res.getId());
+                updated.setSyncStatus(SyncStatus.SYNCED);
+                updated.setPendingAction(PendingAction.NONE);
+                updated.setUpdatedAt(System.currentTimeMillis());
                 update(updated);
                 cb.onSuccess();
             }
 
             @Override
-            public void onError(String msg) {
+            public void onError(String msg, @Nullable Integer code) {
                 cb.onError(msg);
             }
         });
@@ -175,12 +239,12 @@
         remoteRepo.deleteCategory(id, new ApiCallback<Void>() {
             @Override
             public void onSuccess(Void unused) {
-                delete(e);
+                dao.delete(e);
                 cb.onSuccess();
             }
 
             @Override
-            public void onError(String msg) {
+            public void onError(String msg, @Nullable Integer code) {
                 cb.onError(msg);
             }
         });
@@ -191,4 +255,8 @@
         void onSuccess();
         void onError(String msg);
     }
+
+    public interface OnResultCallback<T> {
+        void onResult(T data);
+    }
 }
Index: app/src/main/java/com/finmate/ui/transaction/StatisticViewModel.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/transaction/StatisticViewModel.java b/app/src/main/java/com/finmate/ui/transaction/StatisticViewModel.java
new file mode 100644
--- /dev/null	(date 1765447595556)
+++ b/app/src/main/java/com/finmate/ui/transaction/StatisticViewModel.java	(date 1765447595556)
@@ -0,0 +1,117 @@
+package com.finmate.ui.transaction;
+
+import androidx.annotation.Nullable;
+import androidx.lifecycle.LiveData;
+import androidx.lifecycle.MutableLiveData;
+import androidx.lifecycle.ViewModel;
+
+import com.finmate.data.local.database.entity.WalletEntity;
+import com.finmate.data.local.database.model.StatisticPoint;
+import com.finmate.data.repository.StatisticData;
+import com.finmate.data.repository.StatisticRepository;
+import com.finmate.data.repository.model.StatisticFilter;
+import com.finmate.data.repository.model.StatisticGranularity;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import javax.inject.Inject;
+
+import dagger.hilt.android.lifecycle.HiltViewModel;
+
+@HiltViewModel
+public class StatisticViewModel extends ViewModel {
+
+    private final StatisticRepository repository;
+
+    private StatisticFilter currentFilter = StatisticFilter.currentMonth();
+
+    private final MutableLiveData<StatisticResult> _statistic = new MutableLiveData<>();
+    public LiveData<StatisticResult> statistic = _statistic;
+
+    private final MutableLiveData<List<WalletEntity>> _wallets = new MutableLiveData<>();
+    public LiveData<List<WalletEntity>> wallets = _wallets;
+
+    private final MutableLiveData<Boolean> _isLoading = new MutableLiveData<>(false);
+    public LiveData<Boolean> isLoading = _isLoading;
+
+    @Inject
+    public StatisticViewModel(StatisticRepository repository) {
+        this.repository = repository;
+    }
+
+    public void loadWallets() {
+        repository.loadWallets(_wallets::postValue);
+    }
+
+    public void loadStatistics(String type) {
+        _isLoading.postValue(true);
+        repository.loadStatistic(type, currentFilter, data -> {
+            _statistic.postValue(mapToUi(data));
+            _isLoading.postValue(false);
+        });
+    }
+
+    public void applyFilter(String type, StatisticFilter filter) {
+        this.currentFilter = filter;
+        loadStatistics(type);
+    }
+
+    public void applyWallet(String type, @Nullable String walletName) {
+        this.currentFilter = currentFilter.withWallet(walletName);
+        loadStatistics(type);
+    }
+
+    public StatisticFilter getCurrentFilter() {
+        return currentFilter;
+    }
+
+    private StatisticResult mapToUi(StatisticData data) {
+        List<ChartPoint> timeline = mapPoints(data.getTimeline(), currentFilter.getGranularity());
+        List<ChartPoint> byCategory = mapPoints(data.getByCategory(), StatisticGranularity.DAY);
+        List<ChartPoint> byWallet = mapPoints(data.getByWallet(), StatisticGranularity.DAY);
+
+        return new StatisticResult(
+                data.getTotalAmount(),
+                timeline,
+                byCategory,
+                byWallet,
+                currentFilter.getDisplayLabel(),
+                currentFilter.getGranularity().name()
+        );
+    }
+
+    private List<ChartPoint> mapPoints(List<StatisticPoint> points, StatisticGranularity granularity) {
+        List<ChartPoint> result = new ArrayList<>();
+        if (points == null) {
+            return result;
+        }
+        for (StatisticPoint p : points) {
+            String label = formatLabel(p.label, granularity);
+            result.add(new ChartPoint(label, p.total));
+        }
+        return result;
+    }
+
+    private String formatLabel(String raw, StatisticGranularity granularity) {
+        if (raw == null) return "";
+        if (granularity == StatisticGranularity.WEEK) {
+            String[] parts = raw.split("-");
+            if (parts.length == 2) {
+                return "Tuần " + parts[1] + "/" + parts[0];
+            }
+        } else if (granularity == StatisticGranularity.MONTH) {
+            String[] parts = raw.split("-");
+            if (parts.length == 2) {
+                return parts[1] + "/" + parts[0];
+            }
+        } else {
+            String[] parts = raw.split("-");
+            if (parts.length == 3) {
+                return parts[2] + "/" + parts[1];
+            }
+        }
+        return raw;
+    }
+}
+
Index: app/src/main/java/com/finmate/ui/transaction/StatisticActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/transaction/StatisticActivity.java b/app/src/main/java/com/finmate/ui/transaction/StatisticActivity.java
new file mode 100644
--- /dev/null	(date 1765447595556)
+++ b/app/src/main/java/com/finmate/ui/transaction/StatisticActivity.java	(date 1765447595556)
@@ -0,0 +1,340 @@
+package com.finmate.ui.transaction;
+
+import android.app.DatePickerDialog;
+import android.content.Intent;
+import android.graphics.Color;
+import android.os.Bundle;
+import android.widget.ImageView;
+import android.widget.TextView;
+
+import androidx.appcompat.app.AlertDialog;
+import androidx.appcompat.app.AppCompatActivity;
+import androidx.lifecycle.ViewModelProvider;
+
+import com.finmate.R;
+import com.finmate.core.util.TransactionFormatter;
+import com.finmate.data.local.database.entity.WalletEntity;
+import com.finmate.data.repository.model.StatisticFilter;
+import com.finmate.ui.activities.AddTransactionActivity;
+import com.finmate.ui.activities.IncomeStatisticActivity;
+import com.finmate.ui.home.HomeActivity;
+import com.finmate.ui.home.WalletActivity;
+import com.finmate.ui.settings.SettingsActivity;
+import com.github.mikephil.charting.charts.BarChart;
+import com.github.mikephil.charting.charts.PieChart;
+import com.github.mikephil.charting.components.Legend;
+import com.github.mikephil.charting.components.XAxis;
+import com.github.mikephil.charting.data.BarData;
+import com.github.mikephil.charting.data.BarDataSet;
+import com.github.mikephil.charting.data.BarEntry;
+import com.github.mikephil.charting.data.PieData;
+import com.github.mikephil.charting.data.PieDataSet;
+import com.github.mikephil.charting.data.PieEntry;
+import com.github.mikephil.charting.formatter.IndexAxisValueFormatter;
+import com.google.android.material.bottomnavigation.BottomNavigationView;
+
+import java.util.ArrayList;
+import java.util.Calendar;
+import java.util.List;
+
+import dagger.hilt.android.AndroidEntryPoint;
+
+@AndroidEntryPoint
+public class StatisticActivity extends AppCompatActivity {
+
+    private static final String TYPE_EXPENSE = "EXPENSE";
+
+    ImageView btnBack;
+    TextView tvExpenseTab, tvIncomeTab, tvTotalExpense, tvDateFilter, tvWalletFilter;
+    BarChart barChartExpense;
+    PieChart pieChartExpense;
+    BottomNavigationView bottomNavigation;
+
+    StatisticViewModel viewModel;
+    List<WalletEntity> walletOptions = new ArrayList<>();
+    String currentWalletLabel = "Tất cả ví";
+
+    @Override
+    protected void onCreate(Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
+        setContentView(R.layout.activity_statistic);
+
+        viewModel = new ViewModelProvider(this).get(StatisticViewModel.class);
+
+        btnBack = findViewById(R.id.btnBack);
+        tvExpenseTab = findViewById(R.id.tvExpenseTab);
+        tvIncomeTab = findViewById(R.id.tvIncomeTab);
+        tvTotalExpense = findViewById(R.id.tvTotalExpense);
+        tvDateFilter = findViewById(R.id.tvDateFilter);
+        tvWalletFilter = findViewById(R.id.tvWalletFilter);
+
+        barChartExpense = findViewById(R.id.barChartExpense);
+        pieChartExpense = findViewById(R.id.pieChartExpense);
+
+        bottomNavigation = findViewById(R.id.bottomNavigation);
+
+        highlightTabs();
+        setupBottomNav();
+        setupEvents();
+        setupObservers();
+
+        updateFilterLabels(viewModel.getCurrentFilter());
+        viewModel.loadWallets();
+        viewModel.loadStatistics(TYPE_EXPENSE);
+    }
+
+    private void setupEvents() {
+        btnBack.setOnClickListener(v -> finish());
+
+        tvExpenseTab.setOnClickListener(v -> { /* already on expense */ });
+
+        tvIncomeTab.setOnClickListener(v -> {
+            startActivity(new Intent(this, IncomeStatisticActivity.class));
+            overridePendingTransition(android.R.anim.fade_in, android.R.anim.fade_out);
+        });
+
+        tvDateFilter.setOnClickListener(v -> showDateFilterDialog());
+        tvWalletFilter.setOnClickListener(v -> showWalletFilterDialog());
+    }
+
+    private void setupObservers() {
+        viewModel.statistic.observe(this, this::renderStatistic);
+        viewModel.wallets.observe(this, wallets -> {
+            walletOptions = wallets != null ? wallets : new ArrayList<>();
+        });
+    }
+
+    private void renderStatistic(StatisticResult result) {
+        String formatted = TransactionFormatter.formatAmount(result.getTotalAmount());
+        tvTotalExpense.setText("-" + formatted + " VND");
+
+        renderBarChart(result.getTimeline());
+        renderPieChart(result.getByCategory());
+    }
+
+    private void renderBarChart(List<ChartPoint> data) {
+        barChartExpense.clear();
+
+        if (data == null || data.isEmpty()) {
+            barChartExpense.setNoDataText("Không có dữ liệu");
+            barChartExpense.invalidate();
+            return;
+        }
+
+        List<BarEntry> entries = new ArrayList<>();
+        List<String> labels = new ArrayList<>();
+        for (int i = 0; i < data.size(); i++) {
+            entries.add(new BarEntry(i, data.get(i).getValue()));
+            labels.add(data.get(i).getLabel());
+        }
+
+        BarDataSet dataSet = new BarDataSet(entries, "Chi tiêu");
+        dataSet.setColor(Color.parseColor("#FF5252"));
+        dataSet.setValueTextColor(Color.WHITE);
+        dataSet.setValueTextSize(10f);
+
+        BarData barData = new BarData(dataSet);
+        barData.setBarWidth(0.4f);
+
+        barChartExpense.setData(barData);
+        barChartExpense.setFitBars(true);
+        barChartExpense.getDescription().setEnabled(false);
+        barChartExpense.getLegend().setEnabled(false);
+
+        XAxis xAxis = barChartExpense.getXAxis();
+        xAxis.setPosition(XAxis.XAxisPosition.BOTTOM);
+        xAxis.setTextColor(Color.WHITE);
+        xAxis.setDrawGridLines(false);
+        xAxis.setGranularity(1f);
+        xAxis.setValueFormatter(new IndexAxisValueFormatter(labels));
+        xAxis.setLabelCount(labels.size());
+
+        barChartExpense.animateY(500);
+        barChartExpense.invalidate();
+    }
+
+    private void renderPieChart(List<ChartPoint> data) {
+        pieChartExpense.clear();
+
+        if (data == null || data.isEmpty()) {
+            pieChartExpense.setNoDataText("Không có dữ liệu");
+            pieChartExpense.invalidate();
+            return;
+        }
+
+        List<PieEntry> entries = new ArrayList<>();
+        for (ChartPoint point : data) {
+            entries.add(new PieEntry(point.getValue(), point.getLabel()));
+        }
+
+        PieDataSet dataSet = new PieDataSet(entries, "");
+        dataSet.setColors(
+                Color.parseColor("#FF5252"),
+                Color.parseColor("#FF8A65"),
+                Color.parseColor("#FF7043"),
+                Color.parseColor("#FFB74D"),
+                Color.parseColor("#FFCC80")
+        );
+
+        dataSet.setValueTextSize(12f);
+        dataSet.setValueTextColor(Color.WHITE);
+
+        PieData pieData = new PieData(dataSet);
+
+        pieChartExpense.setData(pieData);
+        pieChartExpense.setUsePercentValues(true);
+        pieChartExpense.setTransparentCircleRadius(50f);
+        pieChartExpense.setHoleRadius(45f);
+        pieChartExpense.getDescription().setEnabled(false);
+
+        Legend legend = pieChartExpense.getLegend();
+        legend.setTextColor(Color.WHITE);
+        legend.setTextSize(12f);
+
+        pieChartExpense.animateY(500);
+        pieChartExpense.invalidate();
+    }
+
+    private void showDateFilterDialog() {
+        String[] options = new String[]{
+                "7 ngày gần nhất",
+                "30 ngày gần nhất",
+                "Tháng này",
+                "Năm nay",
+                "Chọn ngày tùy chỉnh"
+        };
+
+        new AlertDialog.Builder(this)
+                .setTitle("Khoảng thời gian")
+                .setItems(options, (dialog, which) -> {
+                    switch (which) {
+                        case 0:
+                            applyFilter(StatisticFilter.lastDays(7));
+                            break;
+                        case 1:
+                            applyFilter(StatisticFilter.lastDays(30));
+                            break;
+                        case 2:
+                            applyFilter(StatisticFilter.currentMonth());
+                            break;
+                        case 3:
+                            applyFilter(StatisticFilter.yearToDate());
+                            break;
+                        case 4:
+                            showCustomRangePicker();
+                            break;
+                    }
+                })
+                .show();
+    }
+
+    private void showCustomRangePicker() {
+        Calendar now = Calendar.getInstance();
+        DatePickerDialog startPicker = new DatePickerDialog(
+                this,
+                (view, y, m, d) -> {
+                    Calendar start = Calendar.getInstance();
+                    start.set(y, m, d);
+                    showEndDatePicker(start);
+                },
+                now.get(Calendar.YEAR),
+                now.get(Calendar.MONTH),
+                now.get(Calendar.DAY_OF_MONTH)
+        );
+        startPicker.setTitle("Chọn ngày bắt đầu");
+        startPicker.show();
+    }
+
+    private void showEndDatePicker(Calendar start) {
+        Calendar now = Calendar.getInstance();
+        DatePickerDialog endPicker = new DatePickerDialog(
+                this,
+                (view, y, m, d) -> {
+                    Calendar end = Calendar.getInstance();
+                    end.set(y, m, d);
+                    applyFilter(StatisticFilter.custom(start, end, "Tùy chỉnh"));
+                },
+                now.get(Calendar.YEAR),
+                now.get(Calendar.MONTH),
+                now.get(Calendar.DAY_OF_MONTH)
+        );
+        endPicker.setTitle("Chọn ngày kết thúc");
+        endPicker.show();
+    }
+
+    private void showWalletFilterDialog() {
+        List<String> names = new ArrayList<>();
+        names.add("Tất cả ví");
+        for (WalletEntity wallet : walletOptions) {
+            names.add(wallet.name);
+        }
+
+        new AlertDialog.Builder(this)
+                .setTitle("Chọn ví")
+                .setItems(names.toArray(new String[0]), (dialog, which) -> {
+                    if (which == 0) {
+                        currentWalletLabel = "Tất cả ví";
+                        viewModel.applyWallet(TYPE_EXPENSE, null);
+                    } else {
+                        String selected = names.get(which);
+                        currentWalletLabel = selected;
+                        viewModel.applyWallet(TYPE_EXPENSE, selected);
+                    }
+                    tvWalletFilter.setText(currentWalletLabel);
+                })
+                .show();
+    }
+
+    private void applyFilter(StatisticFilter filter) {
+        updateFilterLabels(filter);
+        viewModel.applyFilter(TYPE_EXPENSE, filter);
+    }
+
+    private void updateFilterLabels(StatisticFilter filter) {
+        tvDateFilter.setText(filter.getDisplayLabel());
+        tvWalletFilter.setText(currentWalletLabel);
+    }
+
+    private void highlightTabs() {
+        tvExpenseTab.setTextColor(Color.WHITE);
+        tvExpenseTab.setTextSize(18f);
+        tvExpenseTab.setTypeface(tvExpenseTab.getTypeface(), android.graphics.Typeface.BOLD);
+
+        tvIncomeTab.setTextColor(Color.parseColor("#777777"));
+        tvIncomeTab.setTypeface(tvIncomeTab.getTypeface(), android.graphics.Typeface.NORMAL);
+    }
+
+    private void setupBottomNav() {
+        bottomNavigation.setSelectedItemId(R.id.nav_statistic);
+
+        bottomNavigation.setOnItemSelectedListener(item -> {
+            int id = item.getItemId();
+
+            if (id == R.id.nav_home) {
+                startActivity(new Intent(this, HomeActivity.class));
+                return true;
+            }
+
+            if (id == R.id.nav_wallet) {
+                startActivity(new Intent(this, WalletActivity.class));
+                return true;
+            }
+
+            if (id == R.id.nav_add) {
+                startActivity(new Intent(this, AddTransactionActivity.class));
+                return true;
+            }
+
+            if (id == R.id.nav_statistic) {
+                return true;
+            }
+
+            if (id == R.id.nav_settings) {
+                startActivity(new Intent(this, SettingsActivity.class));
+                return true;
+            }
+
+            return false;
+        });
+    }
+}
Index: app/src/main/java/com/finmate/data/repository/FriendRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/FriendRepository.java b/app/src/main/java/com/finmate/data/repository/FriendRepository.java
new file mode 100644
--- /dev/null	(date 1765447595531)
+++ b/app/src/main/java/com/finmate/data/repository/FriendRepository.java	(date 1765447595531)
@@ -0,0 +1,94 @@
+package com.finmate.data.repository;
+
+import androidx.annotation.Nullable;
+
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+import com.finmate.data.dto.FriendResponse;
+import com.finmate.data.local.database.entity.FriendEntity;
+import com.finmate.data.remote.api.ApiCallback;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import javax.inject.Inject;
+import javax.inject.Singleton;
+
+@Singleton
+public class FriendRepository {
+
+    private final FriendRemoteRepository remoteRepository;
+    private final FriendLocalRepository localRepository;
+
+    @Inject
+    public FriendRepository(FriendRemoteRepository remoteRepository,
+                            FriendLocalRepository localRepository) {
+        this.remoteRepository = remoteRepository;
+        this.localRepository = localRepository;
+    }
+
+    public interface Callback<T> {
+        void onData(T data);
+    }
+
+    public void loadFriends(Callback<List<FriendEntity>> callback) {
+        // immediately serve cached
+        localRepository.getAll(callback::onData);
+
+        remoteRepository.getFriends(new ApiCallback<List<FriendResponse>>() {
+            @Override
+            public void onSuccess(List<FriendResponse> data) {
+                List<FriendEntity> mapped = mapResponses(data, "ACCEPTED");
+                localRepository.replaceAll(mapped);
+                callback.onData(mapped);
+            }
+
+            @Override
+            public void onError(String message, @Nullable Integer code) {
+                // keep cached
+            }
+        });
+    }
+
+    public void loadIncoming(Callback<List<FriendEntity>> callback) {
+        remoteRepository.getIncoming(new ApiCallback<List<FriendResponse>>() {
+            @Override
+            public void onSuccess(List<FriendResponse> data) {
+                callback.onData(mapResponses(data, "PENDING"));
+            }
+
+            @Override
+            public void onError(String message, @Nullable Integer code) {
+                callback.onData(new ArrayList<>());
+            }
+        });
+    }
+
+    public void sendRequest(String email, ApiCallback<Void> callback) {
+        remoteRepository.sendRequest(email, callback);
+    }
+
+    public void accept(String friendshipId, ApiCallback<Void> callback) {
+        remoteRepository.accept(friendshipId, callback);
+    }
+
+    private List<FriendEntity> mapResponses(List<FriendResponse> responses, String defaultStatus) {
+        List<FriendEntity> list = new ArrayList<>();
+        if (responses == null) return list;
+        for (FriendResponse r : responses) {
+            FriendEntity e = new FriendEntity(defaultStatus);
+            e.remoteId = r.getId();
+            e.friendUserId = r.getFriendUserId();
+            e.name = r.getFriendName();
+            e.email = r.getFriendEmail();
+            e.avatar = null; // FriendResponse doesn't have avatar field
+            e.status = r.getStatus() != null ? r.getStatus() : defaultStatus;
+            e.pendingAction = PendingAction.NONE;
+            e.syncStatus = SyncStatus.SYNCED;
+            e.updatedAt = System.currentTimeMillis();
+            list.add(e);
+        }
+        return list;
+    }
+}
+
Index: app/src/main/java/com/finmate/data/repository/BudgetRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/BudgetRepository.java b/app/src/main/java/com/finmate/data/repository/BudgetRepository.java
new file mode 100644
--- /dev/null	(date 1765447595528)
+++ b/app/src/main/java/com/finmate/data/repository/BudgetRepository.java	(date 1765447595528)
@@ -0,0 +1,69 @@
+package com.finmate.data.repository;
+
+import android.content.Context;
+
+import com.finmate.core.offline.PendingAction;
+import com.finmate.data.local.database.AppDatabase;
+import com.finmate.data.local.database.dao.TransactionDao;
+import com.finmate.data.local.database.entity.BudgetEntity;
+import com.finmate.data.repository.model.BudgetProgress;
+import com.finmate.data.repository.model.StatisticFilter;
+
+import java.util.List;
+import java.util.concurrent.Executor;
+import java.util.concurrent.Executors;
+
+import javax.inject.Inject;
+import javax.inject.Singleton;
+
+import dagger.hilt.android.qualifiers.ApplicationContext;
+
+@Singleton
+public class BudgetRepository {
+
+    private static final Executor EXECUTOR = Executors.newSingleThreadExecutor();
+
+    private final BudgetLocalRepository localRepository;
+    private final TransactionDao transactionDao;
+
+    @Inject
+    public BudgetRepository(@ApplicationContext Context context, BudgetLocalRepository localRepository) {
+        this.localRepository = localRepository;
+        this.transactionDao = AppDatabase.getDatabase(context).transactionDao();
+    }
+
+    public void listBudgets(Callback<List<BudgetEntity>> callback) {
+        localRepository.getAll(callback::onResult);
+    }
+
+    public void saveBudget(BudgetEntity entity) {
+        if (entity.id == 0) {
+            localRepository.insert(entity);
+        } else {
+            localRepository.update(entity);
+        }
+    }
+
+    public void deleteBudget(BudgetEntity entity) {
+        localRepository.delete(entity);
+    }
+
+    public void calculateProgress(BudgetEntity budget, StatisticFilter filter, ProgressCallback callback) {
+        EXECUTOR.execute(() -> {
+            String start = filter.getStartDateIso();
+            String end = filter.getEndDateIso();
+            String wallet = budget.walletName;
+            String category = budget.categoryName;
+            double spent = transactionDao.sumAmountForBudget("EXPENSE", start, end, wallet, category, PendingAction.DELETE);
+            callback.onProgress(new BudgetProgress(budget.amountLimit, spent));
+        });
+    }
+
+    public interface Callback<T> {
+        void onResult(T data);
+    }
+
+    public interface ProgressCallback {
+        void onProgress(BudgetProgress progress);
+    }
+}
Index: app/src/main/java/com/finmate/data/repository/model/StatisticGranularity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/model/StatisticGranularity.java b/app/src/main/java/com/finmate/data/repository/model/StatisticGranularity.java
new file mode 100644
--- /dev/null	(date 1765447595540)
+++ b/app/src/main/java/com/finmate/data/repository/model/StatisticGranularity.java	(date 1765447595540)
@@ -0,0 +1,8 @@
+package com.finmate.data.repository.model;
+
+public enum StatisticGranularity {
+    DAY,
+    WEEK,
+    MONTH
+}
+
Index: app/src/main/java/com/finmate/data/repository/model/StatisticFilter.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/model/StatisticFilter.java b/app/src/main/java/com/finmate/data/repository/model/StatisticFilter.java
new file mode 100644
--- /dev/null	(date 1765447595540)
+++ b/app/src/main/java/com/finmate/data/repository/model/StatisticFilter.java	(date 1765447595540)
@@ -0,0 +1,162 @@
+package com.finmate.data.repository.model;
+
+import androidx.annotation.Nullable;
+
+import java.text.SimpleDateFormat;
+import java.util.Calendar;
+import java.util.Locale;
+import java.util.concurrent.TimeUnit;
+
+/**
+ * Represents a local-only filter for statistic queries.
+ */
+public class StatisticFilter {
+
+    private final String startDateIso;
+    private final String endDateIso;
+    private final StatisticGranularity granularity;
+    @Nullable
+    private final String walletName;
+    private final String displayLabel;
+
+    public StatisticFilter(String startDateIso,
+                           String endDateIso,
+                           StatisticGranularity granularity,
+                           @Nullable String walletName,
+                           String displayLabel) {
+        this.startDateIso = startDateIso;
+        this.endDateIso = endDateIso;
+        this.granularity = granularity;
+        this.walletName = walletName;
+        this.displayLabel = displayLabel;
+    }
+
+    public String getStartDateIso() {
+        return startDateIso;
+    }
+
+    public String getEndDateIso() {
+        return endDateIso;
+    }
+
+    public StatisticGranularity getGranularity() {
+        return granularity;
+    }
+
+    @Nullable
+    public String getWalletName() {
+        return walletName;
+    }
+
+    public String getDisplayLabel() {
+        return displayLabel;
+    }
+
+    public StatisticFilter withWallet(@Nullable String wallet) {
+        return new StatisticFilter(startDateIso, endDateIso, granularity, wallet, displayLabel);
+    }
+
+    public StatisticFilter withDisplayLabel(String label) {
+        return new StatisticFilter(startDateIso, endDateIso, granularity, walletName, label);
+    }
+
+    public static StatisticFilter lastDays(int days) {
+        Calendar end = Calendar.getInstance();
+        Calendar start = (Calendar) end.clone();
+        start.add(Calendar.DAY_OF_YEAR, -Math.max(days - 1, 0));
+        StatisticGranularity granularity = pickGranularity(days);
+        return new StatisticFilter(
+                toIsoStartOfDay(start),
+                toIsoEndOfDay(end),
+                granularity,
+                null,
+                days + " ngày gần nhất"
+        );
+    }
+
+    public static StatisticFilter currentMonth() {
+        Calendar start = Calendar.getInstance();
+        start.set(Calendar.DAY_OF_MONTH, 1);
+        Calendar end = (Calendar) start.clone();
+        end.set(Calendar.DAY_OF_MONTH, end.getActualMaximum(Calendar.DAY_OF_MONTH));
+        StatisticGranularity granularity = StatisticGranularity.DAY;
+        return new StatisticFilter(
+                toIsoStartOfDay(start),
+                toIsoEndOfDay(end),
+                granularity,
+                null,
+                "Tháng này"
+        );
+    }
+
+    public static StatisticFilter yearToDate() {
+        Calendar start = Calendar.getInstance();
+        start.set(Calendar.MONTH, Calendar.JANUARY);
+        start.set(Calendar.DAY_OF_MONTH, 1);
+        Calendar end = Calendar.getInstance();
+        long days = daysBetween(start, end);
+        return new StatisticFilter(
+                toIsoStartOfDay(start),
+                toIsoEndOfDay(end),
+                pickGranularity((int) days),
+                null,
+                "Năm nay"
+        );
+    }
+
+    public static StatisticFilter custom(Calendar start, Calendar end, String label) {
+        Calendar safeStart = (Calendar) start.clone();
+        Calendar safeEnd = (Calendar) end.clone();
+        if (safeEnd.before(safeStart)) {
+            Calendar tmp = (Calendar) safeStart.clone();
+            safeStart = safeEnd;
+            safeEnd = tmp;
+        }
+        long days = daysBetween(safeStart, safeEnd);
+        return new StatisticFilter(
+                toIsoStartOfDay(safeStart),
+                toIsoEndOfDay(safeEnd),
+                pickGranularity((int) days),
+                null,
+                label
+        );
+    }
+
+    private static String toIsoStartOfDay(Calendar calendar) {
+        Calendar clone = (Calendar) calendar.clone();
+        clone.set(Calendar.HOUR_OF_DAY, 0);
+        clone.set(Calendar.MINUTE, 0);
+        clone.set(Calendar.SECOND, 0);
+        clone.set(Calendar.MILLISECOND, 0);
+        return iso().format(clone.getTime());
+    }
+
+    private static String toIsoEndOfDay(Calendar calendar) {
+        Calendar clone = (Calendar) calendar.clone();
+        clone.set(Calendar.HOUR_OF_DAY, 23);
+        clone.set(Calendar.MINUTE, 59);
+        clone.set(Calendar.SECOND, 59);
+        clone.set(Calendar.MILLISECOND, 999);
+        return iso().format(clone.getTime());
+    }
+
+    private static StatisticGranularity pickGranularity(int days) {
+        if (days <= 14) {
+            return StatisticGranularity.DAY;
+        }
+        if (days <= 90) {
+            return StatisticGranularity.WEEK;
+        }
+        return StatisticGranularity.MONTH;
+    }
+
+    private static long daysBetween(Calendar start, Calendar end) {
+        long diff = end.getTimeInMillis() - start.getTimeInMillis();
+        return TimeUnit.MILLISECONDS.toDays(Math.max(diff, 0)) + 1;
+    }
+
+    private static SimpleDateFormat iso() {
+        return new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss", Locale.US);
+    }
+}
+
Index: app/src/main/java/com/finmate/data/remote/api/ApiCallback.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/remote/api/ApiCallback.java b/app/src/main/java/com/finmate/data/remote/api/ApiCallback.java
new file mode 100644
--- /dev/null	(date 1765447595522)
+++ b/app/src/main/java/com/finmate/data/remote/api/ApiCallback.java	(date 1765447595522)
@@ -0,0 +1,8 @@
+package com.finmate.data.remote.api;
+
+import androidx.annotation.Nullable;
+
+public interface ApiCallback<T> {
+    void onSuccess(T data);
+    void onError(String message, @Nullable Integer code);
+}
Index: app/src/main/java/com/finmate/data/repository/model/BudgetPeriod.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/model/BudgetPeriod.java b/app/src/main/java/com/finmate/data/repository/model/BudgetPeriod.java
new file mode 100644
--- /dev/null	(date 1765447595540)
+++ b/app/src/main/java/com/finmate/data/repository/model/BudgetPeriod.java	(date 1765447595540)
@@ -0,0 +1,7 @@
+package com.finmate.data.repository.model;
+
+public enum BudgetPeriod {
+    WEEK,
+    MONTH
+}
+
Index: app/src/main/java/com/finmate/data/repository/GoalSyncManager.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/GoalSyncManager.java b/app/src/main/java/com/finmate/data/repository/GoalSyncManager.java
new file mode 100644
--- /dev/null	(date 1765447595531)
+++ b/app/src/main/java/com/finmate/data/repository/GoalSyncManager.java	(date 1765447595531)
@@ -0,0 +1,49 @@
+package com.finmate.data.repository;
+
+import androidx.annotation.Nullable;
+
+import com.finmate.core.network.SyncOnlineStatusManager;
+import com.finmate.core.offline.BaseSyncManager;
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+import com.finmate.data.local.database.entity.GoalEntity;
+
+import javax.inject.Inject;
+import javax.inject.Singleton;
+
+@Singleton
+public class GoalSyncManager extends BaseSyncManager<GoalEntity> {
+
+    private final GoalLocalRepository localRepository;
+
+    @Inject
+    public GoalSyncManager(
+            GoalLocalRepository localRepository,
+            SyncOnlineStatusManager onlineStatusManager) {
+        super(onlineStatusManager);
+        this.localRepository = localRepository;
+    }
+
+    public void syncPendingGoals() {
+        localRepository.getPendingForSync(new GoalLocalRepository.Callback() {
+            @Override
+            public void onResult(java.util.List<GoalEntity> list) {
+                syncPending(list);
+            }
+        });
+    }
+
+    @Override
+    protected void performSync(GoalEntity item, SyncCallback callback) {
+        // TODO: integrate remote goal API
+        if (item.getPendingAction().equals(PendingAction.DELETE)) {
+            localRepository.deleteImmediate(item);
+            callback.onSuccess();
+            return;
+        }
+        item.setSyncStatus(SyncStatus.SYNCED);
+        item.setPendingAction(PendingAction.NONE);
+        localRepository.update(item);
+        callback.onSuccess();
+    }
+}
Index: app/src/main/java/com/finmate/data/repository/model/GoalProgress.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/model/GoalProgress.java b/app/src/main/java/com/finmate/data/repository/model/GoalProgress.java
new file mode 100644
--- /dev/null	(date 1765447595540)
+++ b/app/src/main/java/com/finmate/data/repository/model/GoalProgress.java	(date 1765447595540)
@@ -0,0 +1,13 @@
+package com.finmate.data.repository.model;
+
+public class GoalProgress {
+    public final double targetAmount;
+    public final double savedAmount;
+    public final double percent;
+
+    public GoalProgress(double targetAmount, double savedAmount) {
+        this.targetAmount = targetAmount;
+        this.savedAmount = savedAmount;
+        this.percent = targetAmount > 0 ? (savedAmount / targetAmount) * 100.0 : 0;
+    }
+}
Index: app/src/main/java/com/finmate/data/repository/model/BudgetProgress.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/model/BudgetProgress.java b/app/src/main/java/com/finmate/data/repository/model/BudgetProgress.java
new file mode 100644
--- /dev/null	(date 1765447595540)
+++ b/app/src/main/java/com/finmate/data/repository/model/BudgetProgress.java	(date 1765447595540)
@@ -0,0 +1,13 @@
+package com.finmate.data.repository.model;
+
+public class BudgetProgress {
+    public final double limit;
+    public final double spent;
+    public final double percent;
+
+    public BudgetProgress(double limit, double spent) {
+        this.limit = limit;
+        this.spent = spent;
+        this.percent = limit > 0 ? (spent / limit) * 100.0 : 0;
+    }
+}
Index: app/src/main/java/com/finmate/data/repository/BudgetLocalRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/BudgetLocalRepository.java b/app/src/main/java/com/finmate/data/repository/BudgetLocalRepository.java
new file mode 100644
--- /dev/null	(date 1765447595524)
+++ b/app/src/main/java/com/finmate/data/repository/BudgetLocalRepository.java	(date 1765447595524)
@@ -0,0 +1,68 @@
+package com.finmate.data.repository;
+
+import android.content.Context;
+
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+import com.finmate.data.local.database.AppDatabase;
+import com.finmate.data.local.database.dao.BudgetDao;
+import com.finmate.data.local.database.entity.BudgetEntity;
+
+import java.util.List;
+import java.util.concurrent.Executor;
+import java.util.concurrent.Executors;
+
+import javax.inject.Inject;
+import javax.inject.Singleton;
+
+import dagger.hilt.android.qualifiers.ApplicationContext;
+
+@Singleton
+public class BudgetLocalRepository {
+
+    private static final Executor EXECUTOR = Executors.newSingleThreadExecutor();
+
+    private final BudgetDao dao;
+
+    @Inject
+    public BudgetLocalRepository(@ApplicationContext Context context) {
+        dao = AppDatabase.getDatabase(context).budgetDao();
+    }
+
+    public void insert(BudgetEntity entity) {
+        entity.setPendingAction(PendingAction.CREATE);
+        entity.setSyncStatus(SyncStatus.PENDING_CREATE);
+        entity.setUpdatedAt(System.currentTimeMillis());
+        EXECUTOR.execute(() -> dao.insert(entity));
+    }
+
+    public void update(BudgetEntity entity) {
+        entity.setPendingAction(PendingAction.UPDATE);
+        entity.setSyncStatus(SyncStatus.PENDING_UPDATE);
+        entity.setUpdatedAt(System.currentTimeMillis());
+        EXECUTOR.execute(() -> dao.update(entity));
+    }
+
+    public void delete(BudgetEntity entity) {
+        entity.setPendingAction(PendingAction.DELETE);
+        entity.setSyncStatus(SyncStatus.PENDING_DELETE);
+        entity.setUpdatedAt(System.currentTimeMillis());
+        EXECUTOR.execute(() -> dao.update(entity));
+    }
+
+    public void deleteImmediate(BudgetEntity entity) {
+        EXECUTOR.execute(() -> dao.delete(entity));
+    }
+
+    public void getAll(Callback callback) {
+        EXECUTOR.execute(() -> callback.onResult(dao.getAll()));
+    }
+
+    public void getPendingForSync(Callback callback) {
+        EXECUTOR.execute(() -> callback.onResult(dao.getPendingForSync()));
+    }
+
+    public interface Callback {
+        void onResult(List<BudgetEntity> list);
+    }
+}
Index: app/src/main/java/com/finmate/data/repository/BudgetSyncManager.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/BudgetSyncManager.java b/app/src/main/java/com/finmate/data/repository/BudgetSyncManager.java
new file mode 100644
--- /dev/null	(date 1765447595528)
+++ b/app/src/main/java/com/finmate/data/repository/BudgetSyncManager.java	(date 1765447595528)
@@ -0,0 +1,49 @@
+package com.finmate.data.repository;
+
+import androidx.annotation.Nullable;
+
+import com.finmate.core.network.SyncOnlineStatusManager;
+import com.finmate.core.offline.BaseSyncManager;
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+import com.finmate.data.local.database.entity.BudgetEntity;
+
+import javax.inject.Inject;
+import javax.inject.Singleton;
+
+@Singleton
+public class BudgetSyncManager extends BaseSyncManager<BudgetEntity> {
+
+    private final BudgetLocalRepository localRepository;
+
+    @Inject
+    public BudgetSyncManager(
+            BudgetLocalRepository localRepository,
+            SyncOnlineStatusManager onlineStatusManager) {
+        super(onlineStatusManager);
+        this.localRepository = localRepository;
+    }
+
+    public void syncPendingBudgets() {
+        localRepository.getPendingForSync(new BudgetLocalRepository.Callback() {
+            @Override
+            public void onResult(java.util.List<BudgetEntity> list) {
+                syncPending(list);
+            }
+        });
+    }
+
+    @Override
+    protected void performSync(BudgetEntity item, SyncCallback callback) {
+        // TODO: integrate remote budget API
+        if (item.getPendingAction().equals(PendingAction.DELETE)) {
+            localRepository.deleteImmediate(item);
+            callback.onSuccess();
+            return;
+        }
+        item.setSyncStatus(SyncStatus.SYNCED);
+        item.setPendingAction(PendingAction.NONE);
+        localRepository.update(item);
+        callback.onSuccess();
+    }
+}
Index: app/src/main/java/com/finmate/data/repository/WalletLocalRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/WalletLocalRepository.java b/app/src/main/java/com/finmate/data/repository/WalletLocalRepository.java
new file mode 100644
--- /dev/null	(date 1765447595535)
+++ b/app/src/main/java/com/finmate/data/repository/WalletLocalRepository.java	(date 1765447595535)
@@ -0,0 +1,110 @@
+package com.finmate.data.repository;
+
+import android.content.Context;
+
+import com.finmate.data.local.database.AppDatabase;
+import com.finmate.data.local.database.dao.WalletDao;
+import com.finmate.data.local.database.entity.WalletEntity;
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+
+import java.util.List;
+import java.util.concurrent.Executors;
+
+import javax.inject.Inject;
+import javax.inject.Singleton;
+
+import dagger.hilt.android.qualifiers.ApplicationContext;
+
+@Singleton
+public class WalletLocalRepository {
+
+    private final WalletDao dao;
+
+    @Inject
+    public WalletLocalRepository(@ApplicationContext Context context) {
+        dao = AppDatabase.getDatabase(context).walletDao();
+    }
+
+    public void insert(WalletEntity wallet) {
+        wallet.setPendingAction(PendingAction.CREATE);
+        wallet.setSyncStatus(SyncStatus.PENDING_CREATE);
+        wallet.setUpdatedAt(System.currentTimeMillis());
+        Executors.newSingleThreadExecutor().execute(() -> dao.insert(wallet));
+    }
+
+    public void getAll(Callback callback) {
+        Executors.newSingleThreadExecutor().execute(() ->
+                callback.onResult(dao.getAll())
+        );
+    }
+
+    public void getPendingWallets(Callback callback) {
+        getPendingForSync(callback);
+    }
+
+    public void replaceAll(List<WalletEntity> wallets) {
+        Executors.newSingleThreadExecutor().execute(() -> {
+            // Cách đơn giản: xóa hết rồi insert lại
+            List<WalletEntity> existing = dao.getAll();
+            for (WalletEntity w : existing) {
+                dao.delete(w);
+            }
+            for (WalletEntity w : wallets) {
+                if (w.getSyncStatus() == null || w.getSyncStatus().isEmpty()) {
+                    w.setSyncStatus(SyncStatus.SYNCED);
+                }
+                w.setPendingAction(PendingAction.NONE);
+                w.setUpdatedAt(System.currentTimeMillis());
+                dao.insert(w);
+            }
+        });
+    }
+
+    public void update(WalletEntity wallet) {
+        wallet.setPendingAction(PendingAction.UPDATE);
+        wallet.setSyncStatus(SyncStatus.PENDING_UPDATE);
+        wallet.setUpdatedAt(System.currentTimeMillis());
+        Executors.newSingleThreadExecutor().execute(() -> dao.update(wallet));
+    }
+
+    public void updateAsSynced(WalletEntity wallet) {
+        wallet.setPendingAction(PendingAction.NONE);
+        wallet.setSyncStatus(SyncStatus.SYNCED);
+        wallet.setUpdatedAt(System.currentTimeMillis());
+        Executors.newSingleThreadExecutor().execute(() -> dao.update(wallet));
+    }
+
+    public void saveStatusOnly(WalletEntity wallet) {
+        wallet.setUpdatedAt(System.currentTimeMillis());
+        Executors.newSingleThreadExecutor().execute(() -> dao.update(wallet));
+    }
+
+    public void flagDelete(WalletEntity wallet) {
+        wallet.setPendingAction(PendingAction.DELETE);
+        wallet.setSyncStatus(SyncStatus.PENDING_DELETE);
+        wallet.setUpdatedAt(System.currentTimeMillis());
+        Executors.newSingleThreadExecutor().execute(() -> dao.update(wallet));
+    }
+
+    public void deleteImmediate(WalletEntity wallet) {
+        Executors.newSingleThreadExecutor().execute(() -> dao.delete(wallet));
+    }
+
+    public void getPendingForSync(Callback callback) {
+        Executors.newSingleThreadExecutor().execute(() ->
+                callback.onResult(dao.getPendingForSync())
+        );
+    }
+
+    public void markAsSyncedAfterCreate(WalletEntity pending, WalletEntity synced) {
+        Executors.newSingleThreadExecutor().execute(() -> {
+            dao.delete(pending);
+            dao.insert(synced);
+        });
+    }
+
+    public interface Callback {
+        void onResult(List<WalletEntity> list);
+    }
+}
Index: app/src/main/java/com/finmate/data/repository/TransactionSyncManager.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/TransactionSyncManager.java b/app/src/main/java/com/finmate/data/repository/TransactionSyncManager.java
new file mode 100644
--- /dev/null	(date 1765447595535)
+++ b/app/src/main/java/com/finmate/data/repository/TransactionSyncManager.java	(date 1765447595535)
@@ -0,0 +1,216 @@
+package com.finmate.data.repository;
+
+import androidx.annotation.Nullable;
+
+import com.finmate.core.network.SyncOnlineStatusManager;
+import com.finmate.core.offline.BaseSyncManager;
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+import com.finmate.data.local.database.entity.TransactionEntity;
+import com.finmate.data.local.database.entity.WalletEntity;
+import com.finmate.data.local.database.entity.CategoryEntity;
+import com.finmate.data.remote.api.ApiCallback;
+import com.finmate.data.dto.TransactionResponse;
+
+import java.math.BigDecimal;
+import java.util.List;
+
+import javax.inject.Inject;
+import javax.inject.Singleton;
+
+@Singleton
+public class TransactionSyncManager extends BaseSyncManager<TransactionEntity> {
+
+    private final TransactionRemoteRepository remoteRepository;
+    private final TransactionLocalRepository localRepository;
+    private final WalletLocalRepository walletLocalRepository;
+    private final CategoryLocalRepository categoryLocalRepository;
+
+    @Inject
+    public TransactionSyncManager(
+            TransactionRemoteRepository remoteRepository,
+            TransactionLocalRepository localRepository,
+            WalletLocalRepository walletLocalRepository,
+            CategoryLocalRepository categoryLocalRepository,
+            SyncOnlineStatusManager onlineStatusManager) {
+        super(onlineStatusManager);
+        this.remoteRepository = remoteRepository;
+        this.localRepository = localRepository;
+        this.walletLocalRepository = walletLocalRepository;
+        this.categoryLocalRepository = categoryLocalRepository;
+    }
+
+    public void syncPendingTransactions() {
+        localRepository.getPendingForSync(this::syncPending);
+    }
+
+    @Override
+    protected void performSync(TransactionEntity tx, SyncCallback callback) {
+        switch (tx.pendingAction) {
+            case PendingAction.CREATE:
+                syncCreate(tx, callback);
+                break;
+            case PendingAction.UPDATE:
+                syncUpdate(tx, callback);
+                break;
+            case PendingAction.DELETE:
+                syncDelete(tx, callback);
+                break;
+            default:
+                callback.onSkip();
+        }
+    }
+
+    private void syncCreate(TransactionEntity tx, SyncCallback callback) {
+        remoteRepository.createFromLocal(tx, new ApiCallback<TransactionResponse>() {
+            @Override
+            public void onSuccess(TransactionResponse data) {
+                mapResponseToEntityAsync(data, new OnEntityMappedCallback() {
+                    @Override
+                    public void onMapped(TransactionEntity synced) {
+                        localRepository.markAsSyncedAfterCreate(tx, synced);
+                        callback.onSuccess();
+                    }
+                });
+            }
+
+            @Override
+            public void onError(String message, @Nullable Integer code) {
+                if (code != null && code >= 400 && code < 500) {
+                    tx.syncStatus = SyncStatus.FAILED;
+                    tx.pendingAction = PendingAction.NONE;
+                    localRepository.update(tx);
+                    callback.onSuccess();
+                } else {
+                    callback.onError(code, null);
+                }
+            }
+        });
+    }
+
+    private void syncUpdate(TransactionEntity tx, SyncCallback callback) {
+        remoteRepository.updateFromLocal(tx, new ApiCallback<TransactionResponse>() {
+            @Override
+            public void onSuccess(TransactionResponse data) {
+                // Update the existing entity with new data from server
+                // Look up names from IDs and update
+                mapResponseToEntityAsync(data, new OnEntityMappedCallback() {
+                    @Override
+                    public void onMapped(TransactionEntity synced) {
+                        // Update existing entity with synced data
+                        tx.remoteId = synced.remoteId;
+                        tx.name = synced.name;
+                        tx.categoryName = synced.categoryName;
+                        tx.amount = synced.amount;
+                        tx.walletName = synced.walletName;
+                        tx.occurredAt = synced.occurredAt;
+                        tx.type = synced.type;
+                        tx.syncStatus = SyncStatus.SYNCED;
+                        tx.pendingAction = PendingAction.NONE;
+                        tx.updatedAt = System.currentTimeMillis();
+                        localRepository.update(tx);
+                        callback.onSuccess();
+                    }
+                });
+            }
+
+            @Override
+            public void onError(String message, @Nullable Integer code) {
+                if (code != null && code >= 400 && code < 500) {
+                    tx.syncStatus = SyncStatus.FAILED;
+                    tx.pendingAction = PendingAction.NONE;
+                    localRepository.update(tx);
+                    callback.onSuccess();
+                } else {
+                    callback.onError(code, null);
+                }
+            }
+        });
+    }
+
+    private void syncDelete(TransactionEntity tx, SyncCallback callback) {
+        remoteRepository.deleteFromLocal(tx, new ApiCallback<Void>() {
+            @Override
+            public void onSuccess(Void ignored) {
+                localRepository.delete(tx);
+                callback.onSuccess();
+            }
+
+            @Override
+            public void onError(String message, @Nullable Integer code) {
+                if (code != null && code >= 400 && code < 500) {
+                    tx.syncStatus = SyncStatus.FAILED;
+                    tx.pendingAction = PendingAction.NONE;
+                    localRepository.delete(tx);
+                    callback.onSuccess();
+                } else {
+                    callback.onError(code, null);
+                }
+            }
+        });
+    }
+
+    private void mapResponseToEntityAsync(TransactionResponse t, OnEntityMappedCallback callback) {
+        // Look up wallet name
+        walletLocalRepository.getAll(new WalletLocalRepository.Callback() {
+            @Override
+            public void onResult(List<WalletEntity> wallets) {
+                final String[] walletName = {""};
+                for (WalletEntity w : wallets) {
+                    if (w.getRemoteId() != null && w.getRemoteId().equals(t.getWalletId())) {
+                        walletName[0] = w.getName();
+                        break;
+                    }
+                }
+                
+                // Look up category name
+                if (t.getCategoryId() != null && t.getType() != null) {
+                    categoryLocalRepository.getByTypeSync(t.getType(), 
+                        new CategoryLocalRepository.OnResultCallback<List<CategoryEntity>>() {
+                            @Override
+                            public void onResult(List<CategoryEntity> categories) {
+                                final String[] categoryName = {""};
+                                if (categories != null) {
+                                    for (CategoryEntity c : categories) {
+                                        if (c.getRemoteId() != null && c.getRemoteId().equals(t.getCategoryId())) {
+                                            categoryName[0] = c.getName();
+                                            break;
+                                        }
+                                    }
+                                }
+                                
+                                // Create entity with mapped names
+                                createEntityFromResponse(t, walletName[0], categoryName[0], callback);
+                            }
+                        });
+                } else {
+                    // No category, create entity without category name
+                    createEntityFromResponse(t, walletName[0], "Unknown", callback);
+                }
+            }
+        });
+    }
+    
+    private void createEntityFromResponse(TransactionResponse t, String walletName, String categoryName, OnEntityMappedCallback callback) {
+        String title = (t.getNote() != null && !t.getNote().isEmpty()) ? t.getNote() : categoryName;
+        double amount = t.getAmount() != null ? t.getAmount().doubleValue() : 0.0;
+        
+        TransactionEntity entity = new TransactionEntity(
+                t.getId(),
+                title,
+                categoryName.isEmpty() ? "Unknown" : categoryName,
+                amount,
+                walletName.isEmpty() ? "Unknown" : walletName,
+                t.getOccurredAt() != null ? t.getOccurredAt() : "",
+                t.getType() != null ? t.getType() : "EXPENSE"
+        );
+        entity.setSyncStatus(SyncStatus.SYNCED);
+        entity.setPendingAction(PendingAction.NONE);
+        entity.setUpdatedAt(System.currentTimeMillis());
+        callback.onMapped(entity);
+    }
+    
+    private interface OnEntityMappedCallback {
+        void onMapped(TransactionEntity entity);
+    }
+}
Index: .idea/misc.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><project version=\"4\">\r\n  <component name=\"ExternalStorageConfigurationManager\" enabled=\"true\" />\r\n  <component name=\"ProjectRootManager\" version=\"2\" languageLevel=\"JDK_21\" default=\"true\" project-jdk-name=\"jbr-21\" project-jdk-type=\"JavaSDK\">\r\n    <output url=\"file://$PROJECT_DIR$/build/classes\" />\r\n  </component>\r\n  <component name=\"ProjectType\">\r\n    <option name=\"id\" value=\"Android\" />\r\n  </component>\r\n  <component name=\"VisualizationToolProject\">\r\n    <option name=\"state\">\r\n      <ProjectState>\r\n        <option name=\"scale\" value=\"0.19237365722656252\" />\r\n      </ProjectState>\r\n    </option>\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/misc.xml b/.idea/misc.xml
--- a/.idea/misc.xml	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/.idea/misc.xml	(date 1765447595490)
@@ -1,3 +1,4 @@
+<?xml version="1.0" encoding="UTF-8"?>
 <project version="4">
   <component name="ExternalStorageConfigurationManager" enabled="true" />
   <component name="ProjectRootManager" version="2" languageLevel="JDK_21" default="true" project-jdk-name="jbr-21" project-jdk-type="JavaSDK">
Index: .idea/vcs.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"VcsDirectoryMappings\">\r\n    <mapping directory=\"\" vcs=\"Git\" />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/vcs.xml b/.idea/vcs.xml
--- a/.idea/vcs.xml	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/.idea/vcs.xml	(date 1765447595491)
@@ -2,5 +2,6 @@
 <project version="4">
   <component name="VcsDirectoryMappings">
     <mapping directory="" vcs="Git" />
+    <mapping directory="$PROJECT_DIR$" vcs="Git" />
   </component>
 </project>
\ No newline at end of file
Index: gradle/libs.versions.toml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>[versions]\r\nagp = \"8.13.1\"\r\nhilt = \"2.48\"\r\njunit = \"4.13.2\"\r\njunitVersion = \"1.3.0\"\r\nespressoCore = \"3.7.0\"\r\nappcompat = \"1.7.1\"\r\nmaterial = \"1.13.0\"\r\nmpandroidchart = \"v3.1.0\"\r\nconstraintlayout = \"2.2.1\"\r\nroom = \"2.6.1\"\r\nretrofit = \"2.9.0\"\r\ndatastore = \"1.0.0\"\r\nlifecycle = \"2.6.2\"\r\nrxjava = \"3.1.8\"\r\nokhttp = \"4.12.0\"\r\n\r\n[libraries]\r\nhilt-android = { group = \"com.google.dagger\", name = \"hilt-android\", version.ref = \"hilt\" }\r\nhilt-compiler = { group = \"com.google.dagger\", name = \"hilt-compiler\", version.ref = \"hilt\" }\r\n\r\njunit = { group = \"junit\", name = \"junit\", version.ref = \"junit\" }\r\next-junit = { group = \"androidx.test.ext\", name = \"junit\", version.ref = \"junitVersion\" }\r\nespresso-core = { group = \"androidx.test.espresso\", name = \"espresso-core\", version.ref = \"espressoCore\" }\r\nappcompat = { group = \"androidx.appcompat\", name = \"appcompat\", version.ref = \"appcompat\" }\r\nmaterial = { group = \"com.google.android.material\", name = \"material\", version.ref = \"material\" }\r\nmpandroidchart = { module = \"com.github.PhilJay:MPAndroidChart\", version.ref = \"mpandroidchart\" }\r\nconstraintlayout = { group = \"androidx.constraintlayout\", name = \"constraintlayout\", version.ref = \"constraintlayout\" }\r\nroom-runtime = { group = \"androidx.room\", name = \"room-runtime\", version.ref = \"room\" }\r\nroom-compiler = { group = \"androidx.room\", name = \"room-compiler\", version.ref = \"room\" }\r\n\r\nretrofit = { group = \"com.squareup.retrofit2\", name = \"retrofit\", version.ref = \"retrofit\" }\r\nretrofit-gson = { group = \"com.squareup.retrofit2\", name = \"converter-gson\", version.ref = \"retrofit\" }\r\nokhttp-logging = { group = \"com.squareup.okhttp3\", name = \"logging-interceptor\", version.ref = \"okhttp\" }\r\n\r\ndatastore-prefs = { group = \"androidx.datastore\", name = \"datastore-preferences\", version.ref = \"datastore\" }\r\ndatastore-rxjava3 = { group = \"androidx.datastore\", name = \"datastore-preferences-rxjava3\", version.ref = \"datastore\" }\r\nrxjava = { group = \"io.reactivex.rxjava3\", name = \"rxjava\", version.ref = \"rxjava\" }\r\n\r\nlifecycle-viewmodel = { group = \"androidx.lifecycle\", name = \"lifecycle-viewmodel\", version.ref = \"lifecycle\" }\r\nlifecycle-livedata = { group = \"androidx.lifecycle\", name = \"lifecycle-livedata\", version.ref = \"lifecycle\" }\r\n\r\n[plugins]\r\nandroid-application = { id = \"com.android.application\", version.ref = \"agp\" }\r\nhilt = { id = \"com.google.dagger.hilt.android\", version.ref = \"hilt\" }\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/gradle/libs.versions.toml b/gradle/libs.versions.toml
--- a/gradle/libs.versions.toml	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/gradle/libs.versions.toml	(date 1765447595569)
@@ -1,6 +1,6 @@
 [versions]
 agp = "8.13.1"
-hilt = "2.48"
+hilt = "2.51.1"
 junit = "4.13.2"
 junitVersion = "1.3.0"
 espressoCore = "3.7.0"
@@ -13,6 +13,7 @@
 datastore = "1.0.0"
 lifecycle = "2.6.2"
 rxjava = "3.1.8"
+rxandroid = "3.0.2"
 okhttp = "4.12.0"
 
 [libraries]
@@ -31,11 +32,14 @@
 
 retrofit = { group = "com.squareup.retrofit2", name = "retrofit", version.ref = "retrofit" }
 retrofit-gson = { group = "com.squareup.retrofit2", name = "converter-gson", version.ref = "retrofit" }
+retrofit-rxjava3-adapter = { group = "com.squareup.retrofit2", name = "adapter-rxjava3", version.ref = "retrofit" }
+
 okhttp-logging = { group = "com.squareup.okhttp3", name = "logging-interceptor", version.ref = "okhttp" }
 
 datastore-prefs = { group = "androidx.datastore", name = "datastore-preferences", version.ref = "datastore" }
 datastore-rxjava3 = { group = "androidx.datastore", name = "datastore-preferences-rxjava3", version.ref = "datastore" }
 rxjava = { group = "io.reactivex.rxjava3", name = "rxjava", version.ref = "rxjava" }
+rxandroid = { group = "io.reactivex.rxjava3", name = "rxandroid", version.ref = "rxandroid" }
 
 lifecycle-viewmodel = { group = "androidx.lifecycle", name = "lifecycle-viewmodel", version.ref = "lifecycle" }
 lifecycle-livedata = { group = "androidx.lifecycle", name = "lifecycle-livedata", version.ref = "lifecycle" }
Index: app/src/main/java/com/finmate/ui/friend/FriendAdapter.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.friend;\r\n\r\nimport android.content.Context;\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.widget.ImageView;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\n\r\npublic class FriendAdapter extends RecyclerView.Adapter<FriendAdapter.FriendViewHolder> {\r\n\r\n    private final List<FriendUIModel> friendList = new ArrayList<>();\r\n\r\n    public FriendAdapter(List<FriendUIModel> initialData) {\r\n        if (initialData != null) {\r\n            friendList.addAll(initialData);\r\n        }\r\n    }\r\n\r\n    @NonNull\r\n    @Override\r\n    public FriendViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\r\n        Context context = parent.getContext();\r\n        View view = LayoutInflater.from(context).inflate(R.layout.item_friend, parent, false);\r\n        return new FriendViewHolder(view);\r\n    }\r\n\r\n    @Override\r\n    public void onBindViewHolder(@NonNull FriendViewHolder holder, int position) {\r\n        FriendUIModel friend = friendList.get(position);\r\n\r\n        // Avatar tạm thời dùng icon chung\r\n        holder.ivAvatar.setImageResource(R.drawable.ic_person); // đổi icon nếu anh có\r\n\r\n        holder.tvStatus.setText(friend.getStatus());\r\n\r\n        holder.ivMoreOptions.setOnClickListener(v -> {\r\n            if (actionListener != null) {\r\n                // Ví dụ: mặc định là remove, hoặc show bottom sheet rồi gọi actionListener\r\n                actionListener.onRemove(friend);\r\n            } else {\r\n                Toast.makeText(\r\n                        holder.itemView.getContext(),\r\n                        \"Tùy chọn cho: \" + friend.getStatus(),\r\n                        Toast.LENGTH_SHORT\r\n                ).show();\r\n            }\r\n        });\r\n    }\r\n\r\n    @Override\r\n    public int getItemCount() {\r\n        return friendList.size();\r\n    }\r\n\r\n    static class FriendViewHolder extends RecyclerView.ViewHolder {\r\n\r\n        ImageView ivAvatar, ivMoreOptions;\r\n        TextView tvStatus;\r\n\r\n        public FriendViewHolder(@NonNull View itemView) {\r\n            super(itemView);\r\n            ivAvatar = itemView.findViewById(R.id.ivFriendAvatar);\r\n            tvStatus = itemView.findViewById(R.id.tvFriendStatus);\r\n            ivMoreOptions = itemView.findViewById(R.id.ivMoreOptions);\r\n        }\r\n    }\r\n\r\n    public void updateData(List<FriendUIModel> newData) {\r\n        friendList.clear();\r\n        if (newData != null) {\r\n            friendList.addAll(newData);\r\n        }\r\n        notifyDataSetChanged();\r\n    }\r\n\r\n    public interface OnActionListener {\r\n        void onRemove(FriendUIModel item);\r\n        void onAccept(FriendUIModel item);\r\n        void onReject(FriendUIModel item);\r\n    }\r\n\r\n    private OnActionListener actionListener;\r\n\r\n    public void setOnActionListener(OnActionListener listener) {\r\n        this.actionListener = listener;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/friend/FriendAdapter.java b/app/src/main/java/com/finmate/ui/friend/FriendAdapter.java
--- a/app/src/main/java/com/finmate/ui/friend/FriendAdapter.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/friend/FriendAdapter.java	(date 1765447595553)
@@ -11,6 +11,8 @@
 import androidx.annotation.NonNull;
 import androidx.recyclerview.widget.RecyclerView;
 
+import com.finmate.R;
+
 import java.util.ArrayList;
 import java.util.List;
 
@@ -38,7 +40,7 @@
         FriendUIModel friend = friendList.get(position);
 
         // Avatar tạm thời dùng icon chung
-        holder.ivAvatar.setImageResource(R.drawable.ic_person); // đổi icon nếu anh có
+        holder.ivAvatar.setImageResource(R.drawable.taikhoan); // đổi icon nếu anh có
 
         holder.tvStatus.setText(friend.getStatus());
 
Index: app/src/main/java/com/finmate/ui/friend/FriendActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.friend;\r\n\r\n\r\nimport android.os.Bundle;\r\nimport android.widget.Button;\r\nimport android.widget.EditText;\r\nimport android.widget.Toast;\r\nimport com.finmate.R;\r\n\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.lifecycle.ViewModelProvider;\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport java.util.ArrayList;\r\n\r\nimport dagger.hilt.android.AndroidEntryPoint;\r\n\r\n@AndroidEntryPoint\r\npublic class FriendActivity extends AppCompatActivity {\r\n\r\n    private RecyclerView recyclerView;\r\n    private FriendAdapter adapter;\r\n\r\n    private EditText etEmail;\r\n    private Button btnAdd;\r\n\r\n    private FriendViewModel viewModel;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_friend);\r\n\r\n        viewModel = new ViewModelProvider(this).get(FriendViewModel.class);\r\n\r\n        recyclerView = findViewById(R.id.rvFriends);\r\n        etEmail = findViewById(R.id.etEmail);\r\n        btnAdd = findViewById(R.id.btnFriend);\r\n\r\n        adapter = new FriendAdapter(new ArrayList<>());\r\n        recyclerView.setLayoutManager(new LinearLayoutManager(this));\r\n        recyclerView.setAdapter(adapter);\r\n\r\n        observeViewModel();\r\n        setupActions();\r\n\r\n        viewModel.loadFriends();\r\n    }\r\n\r\n    private void observeViewModel() {\r\n        viewModel.friends.observe(this, list -> {\r\n            adapter.updateData(list);  // anh thêm hàm này trong FriendAdapter\r\n        });\r\n\r\n        viewModel.loading.observe(this, isLoading -> {\r\n            // show/hide progress bar nếu anh có\r\n        });\r\n\r\n        viewModel.error.observe(this, msg -> {\r\n            if (msg != null && !msg.isEmpty()) {\r\n                Toast.makeText(this, msg, Toast.LENGTH_SHORT).show();\r\n            }\r\n        });\r\n    }\r\n\r\n    private void setupActions() {\r\n        btnAdd.setOnClickListener(v -> {\r\n            String email = etEmail.getText().toString().trim();\r\n            if (email.isEmpty()) {\r\n                Toast.makeText(this, \"Nhập email bạn bè\", Toast.LENGTH_SHORT).show();\r\n                return;\r\n            }\r\n            viewModel.sendRequest(email);\r\n        });\r\n\r\n        // nếu FriendAdapter có callback accept/reject/remove thì pass vào đây\r\n        adapter.setOnActionListener(new FriendAdapter.OnActionListener() {\r\n            @Override\r\n            public void onRemove(FriendUIModel item) {\r\n                viewModel.remove(item.getFriendshipId());\r\n            }\r\n\r\n            @Override\r\n            public void onAccept(FriendUIModel item) {\r\n                viewModel.accept(item.getFriendshipId());\r\n            }\r\n\r\n            @Override\r\n            public void onReject(FriendUIModel item) {\r\n                viewModel.reject(item.getFriendshipId());\r\n            }\r\n        });\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/friend/FriendActivity.java b/app/src/main/java/com/finmate/ui/friend/FriendActivity.java
--- a/app/src/main/java/com/finmate/ui/friend/FriendActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/friend/FriendActivity.java	(date 1765447595551)
@@ -2,8 +2,7 @@
 
 
 import android.os.Bundle;
-import android.widget.Button;
-import android.widget.EditText;
+import android.widget.ImageView;
 import android.widget.Toast;
 import com.finmate.R;
 
@@ -21,9 +20,8 @@
 
     private RecyclerView recyclerView;
     private FriendAdapter adapter;
-
-    private EditText etEmail;
-    private Button btnAdd;
+    private ImageView btnBack;
+    private ImageView btnMore;
 
     private FriendViewModel viewModel;
 
@@ -35,13 +33,18 @@
         viewModel = new ViewModelProvider(this).get(FriendViewModel.class);
 
         recyclerView = findViewById(R.id.rvFriends);
-        etEmail = findViewById(R.id.etEmail);
-        btnAdd = findViewById(R.id.btnFriend);
+        btnBack = findViewById(R.id.btnBack);
+        btnMore = findViewById(R.id.btnMore);
 
         adapter = new FriendAdapter(new ArrayList<>());
         recyclerView.setLayoutManager(new LinearLayoutManager(this));
         recyclerView.setAdapter(adapter);
 
+        btnBack.setOnClickListener(v -> finish());
+        btnMore.setOnClickListener(v -> {
+            // TODO: Show menu options
+        });
+
         observeViewModel();
         setupActions();
 
@@ -65,15 +68,6 @@
     }
 
     private void setupActions() {
-        btnAdd.setOnClickListener(v -> {
-            String email = etEmail.getText().toString().trim();
-            if (email.isEmpty()) {
-                Toast.makeText(this, "Nhập email bạn bè", Toast.LENGTH_SHORT).show();
-                return;
-            }
-            viewModel.sendRequest(email);
-        });
-
         // nếu FriendAdapter có callback accept/reject/remove thì pass vào đây
         adapter.setOnActionListener(new FriendAdapter.OnActionListener() {
             @Override
Index: app/src/main/java/com/finmate/ui/base/BaseActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.base;\r\n\r\nimport android.content.Context;\r\nimport android.os.Bundle;\r\n\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport com.finmate.adapters.LocaleHelper;   // đúng package\r\nimport com.finmate.adapters.ThemeHelper;   // đúng package\r\n\r\npublic class BaseActivity extends AppCompatActivity {\r\n\r\n    @Override\r\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n\r\n        // Áp dụng theme\r\n        ThemeHelper.applyCurrentTheme(this);\r\n\r\n        super.onCreate(savedInstanceState);\r\n    }\r\n\r\n    @Override\r\n    protected void attachBaseContext(Context newBase) {\r\n        super.attachBaseContext(LocaleHelper.applyLocale(newBase));\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/base/BaseActivity.java b/app/src/main/java/com/finmate/ui/base/BaseActivity.java
--- a/app/src/main/java/com/finmate/ui/base/BaseActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/base/BaseActivity.java	(date 1765447595551)
@@ -1,27 +1,18 @@
 package com.finmate.ui.base;
 
-import android.content.Context;
 import android.os.Bundle;
 
 import androidx.annotation.Nullable;
 import androidx.appcompat.app.AppCompatActivity;
 
-import com.finmate.adapters.LocaleHelper;   // đúng package
-import com.finmate.adapters.ThemeHelper;   // đúng package
 
-public class BaseActivity extends AppCompatActivity {
+public abstract class BaseActivity extends AppCompatActivity {
+    protected final String TAG = getClass().getSimpleName();
 
     @Override
     protected void onCreate(@Nullable Bundle savedInstanceState) {
-
-        // Áp dụng theme
-        ThemeHelper.applyCurrentTheme(this);
-
         super.onCreate(savedInstanceState);
+        // Nếu sau này anh muốn set theme, log, analytics... thì nhét ở đây
     }
 
-    @Override
-    protected void attachBaseContext(Context newBase) {
-        super.attachBaseContext(LocaleHelper.applyLocale(newBase));
-    }
 }
Index: app/src/main/java/com/finmate/ui/home/WalletActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.home;\r\n\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.view.MenuItem;\r\nimport android.widget.ProgressBar;\r\nimport android.widget.TextView;\r\nimport com.finmate.ui.base.BaseActivity;\r\nimport androidx.annotation.NonNull;\r\n\r\nimport com.finmate.R;\r\nimport com.finmate.ui.activities.AddTransactionActivity;\r\nimport com.finmate.ui.activities.SettingsActivity;\r\nimport com.finmate.ui.activities.StatisticActivity;\r\nimport com.google.android.material.bottomnavigation.BottomNavigationView;\r\n\r\npublic class WalletActivity extends BaseActivity {\r\n\r\n    TextView tvBalance, tvIncomeValue, tvExpenseValue;\r\n    ProgressBar progIncome, progExpense;\r\n    BottomNavigationView bottomNavigation;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_wallet);\r\n\r\n        // ÁNH XẠ VIEW\r\n        tvBalance = findViewById(R.id.tv_balance);\r\n        tvIncomeValue = findViewById(R.id.tv_income_value);\r\n        tvExpenseValue = findViewById(R.id.tv_expense_value);\r\n\r\n        progIncome = findViewById(R.id.prog_income);\r\n        progExpense = findViewById(R.id.prog_expense);\r\n\r\n        bottomNavigation = findViewById(R.id.bottomNavigation);\r\n\r\n        // Chọn đúng tab hiện tại\r\n        bottomNavigation.setSelectedItemId(R.id.nav_wallet);\r\n\r\n        setupWalletData();\r\n        setupBottomNavigation();\r\n    }\r\n\r\n    // ====================== HIỂN THỊ DỮ LIỆU TĨNH ======================\r\n    private void setupWalletData() {\r\n\r\n        int income = 60000000;    // Thu nhập\r\n        int expense = 10000000;   // Chi tiêu\r\n        int balance = income - expense;\r\n\r\n        // Gán dữ liệu\r\n        tvBalance.setText(formatMoney(balance) + \" VND\");\r\n        tvIncomeValue.setText(\"+\" + formatMoney(income) + \" VND\");\r\n        tvExpenseValue.setText(\"-\" + formatMoney(expense) + \" VND\");\r\n\r\n        // Tính %\r\n        int total = income + expense;\r\n        if (total > 0) {\r\n            int perIncome = (income * 100) / total;\r\n            int perExpense = (expense * 100) / total;\r\n            progIncome.setProgress(perIncome);\r\n            progExpense.setProgress(perExpense);\r\n        } else {\r\n            progIncome.setProgress(0);\r\n            progExpense.setProgress(0);\r\n        }\r\n    }\r\n\r\n    // Format tiền VND đẹp\r\n    private String formatMoney(int amount) {\r\n        return String.format(\"%,d\", amount).replace(\",\", \".\");\r\n    }\r\n\r\n\r\n    // ====================== XỬ LÝ BOTTOM NAVIGATION ======================\r\n    private void setupBottomNavigation() {\r\n        bottomNavigation.setOnNavigationItemSelectedListener(new BottomNavigationView.OnNavigationItemSelectedListener() {\r\n            @Override\r\n            public boolean onNavigationItemSelected(@NonNull MenuItem item) {\r\n                Intent intent = null;\r\n                if (item.getItemId() == R.id.nav_home) {\r\n                    intent = new Intent(WalletActivity.this, HomeActivity.class);\r\n                } else if (item.getItemId() == R.id.nav_wallet) {\r\n                    // Already on Wallet screen\r\n                    return true;\r\n                } else if (item.getItemId() == R.id.nav_add) {\r\n                    intent = new Intent(WalletActivity.this, AddTransactionActivity.class);\r\n                } else if (item.getItemId() == R.id.nav_statistic) {\r\n                    intent = new Intent(WalletActivity.this, StatisticActivity.class);\r\n                } else if (item.getItemId() == R.id.nav_settings) {\r\n                    intent = new Intent(WalletActivity.this, SettingsActivity.class);\r\n                }\r\n\r\n                if (intent != null) {\r\n                    startActivity(intent);\r\n                    overridePendingTransition(android.R.anim.fade_in, android.R.anim.fade_out);\r\n                }\r\n                return true;\r\n            }\r\n        });\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/home/WalletActivity.java b/app/src/main/java/com/finmate/ui/home/WalletActivity.java
--- a/app/src/main/java/com/finmate/ui/home/WalletActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/home/WalletActivity.java	(date 1765447595555)
@@ -7,24 +7,49 @@
 import android.widget.TextView;
 import com.finmate.ui.base.BaseActivity;
 import androidx.annotation.NonNull;
+import androidx.lifecycle.ViewModelProvider;
+import androidx.recyclerview.widget.LinearLayoutManager;
+import androidx.recyclerview.widget.RecyclerView;
 
 import com.finmate.R;
+import com.finmate.core.util.TransactionFormatter;
+import com.finmate.data.local.database.entity.TransactionEntity;
+import com.finmate.data.repository.TransactionSyncManager;
 import com.finmate.ui.activities.AddTransactionActivity;
-import com.finmate.ui.activities.SettingsActivity;
-import com.finmate.ui.activities.StatisticActivity;
+import com.finmate.ui.base.BaseActivity;
+import com.finmate.ui.settings.SettingsActivity;
+import com.finmate.ui.transaction.StatisticActivity;
+import com.finmate.ui.transaction.TransactionAdapter;
+import com.finmate.ui.transaction.TransactionUIModel;
 import com.google.android.material.bottomnavigation.BottomNavigationView;
 
+import java.util.ArrayList;
+import java.util.List;
+
+import javax.inject.Inject;
+
+import dagger.hilt.android.AndroidEntryPoint;
+
+@AndroidEntryPoint
 public class WalletActivity extends BaseActivity {
 
     TextView tvBalance, tvIncomeValue, tvExpenseValue;
     ProgressBar progIncome, progExpense;
     BottomNavigationView bottomNavigation;
+    RecyclerView rvTransactions;
+    TransactionAdapter transactionAdapter;
+    HomeViewModel viewModel;
+
+    @Inject
+    TransactionSyncManager transactionSyncManager;
 
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
         setContentView(R.layout.activity_wallet);
 
+        viewModel = new ViewModelProvider(this).get(HomeViewModel.class);
+
         // ÁNH XẠ VIEW
         tvBalance = findViewById(R.id.tv_balance);
         tvIncomeValue = findViewById(R.id.tv_income_value);
@@ -34,12 +59,22 @@
         progExpense = findViewById(R.id.prog_expense);
 
         bottomNavigation = findViewById(R.id.bottomNavigation);
+        rvTransactions = findViewById(R.id.rvTransactions);
 
         // Chọn đúng tab hiện tại
         bottomNavigation.setSelectedItemId(R.id.nav_wallet);
 
+        setupRecyclerView();
         setupWalletData();
         setupBottomNavigation();
+        observeViewModel();
+    }
+
+    @Override
+    protected void onResume() {
+        super.onResume();
+        viewModel.loadHomeData();
+        transactionSyncManager.syncPendingTransactions();
     }
 
     // ====================== HIỂN THỊ DỮ LIỆU TĨNH ======================
@@ -72,6 +107,40 @@
         return String.format("%,d", amount).replace(",", ".");
     }
 
+    private void setupRecyclerView() {
+        rvTransactions.setLayoutManager(new LinearLayoutManager(this));
+        transactionAdapter = new TransactionAdapter(new ArrayList<>());
+        rvTransactions.setAdapter(transactionAdapter);
+    }
+
+    private void observeViewModel() {
+        viewModel.transactions.observe(this, this::updateTransactionList);
+        viewModel.wallets.observe(this, wallets -> {
+            // Tự động chọn ví đầu tiên nếu có
+            if (wallets != null && !wallets.isEmpty() && viewModel.selectedWalletId.getValue() == null) {
+                viewModel.selectWallet(String.valueOf(wallets.get(0).id));
+            }
+        });
+    }
+
+    private void updateTransactionList(List<TransactionEntity> transactionEntities) {
+        if (transactionEntities == null) return;
+
+        List<TransactionUIModel> uiModels = new ArrayList<>();
+        for (TransactionEntity entity : transactionEntities) {
+            // Format amount và date cho UI tại đây
+            uiModels.add(new TransactionUIModel(
+                    entity.getName(),
+                    entity.getCategoryName(),
+                    TransactionFormatter.formatAmount(entity.getAmount()),
+                    entity.getWalletName(),
+                    TransactionFormatter.formatDate(entity.getOccurredAt())
+            ));
+        }
+
+        transactionAdapter.updateList(uiModels);
+    }
+
 
     // ====================== XỬ LÝ BOTTOM NAVIGATION ======================
     private void setupBottomNavigation() {
Index: app/src/main/java/com/finmate/ui/home/HomeActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.home;\r\n\r\nimport android.content.Intent;\r\nimport android.graphics.Color;\r\nimport android.os.Bundle;\r\nimport android.widget.ImageView;\r\nimport android.widget.PopupMenu;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.appcompat.app.AlertDialog;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.lifecycle.ViewModelProvider;\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport com.finmate.R;\r\nimport com.finmate.ui.activities.AddTransactionActivity;\r\nimport com.finmate.ui.activities.AddWalletActivity;\r\nimport com.finmate.ui.activities.SettingsActivity;\r\nimport com.finmate.ui.activities.StatisticActivity;\r\nimport com.finmate.ui.transaction.TransactionUIModel;\r\nimport com.finmate.ui.transaction.TransactionAdapter;\r\nimport com.finmate.data.local.database.entity.TransactionEntity;\r\nimport com.github.mikephil.charting.charts.LineChart;\r\nimport com.github.mikephil.charting.data.Entry;\r\nimport com.github.mikephil.charting.data.LineData;\r\nimport com.github.mikephil.charting.data.LineDataSet;\r\nimport com.google.android.material.bottomnavigation.BottomNavigationView;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\nimport dagger.hilt.android.AndroidEntryPoint;\r\n\r\n@AndroidEntryPoint\r\npublic class HomeActivity extends AppCompatActivity {\r\n\r\n    private HomeViewModel viewModel;\r\n\r\n    private LineChart lineChart;\r\n    private BottomNavigationView bottomNavigation;\r\n    private RecyclerView rvTransactions;\r\n    private TransactionAdapter transactionAdapter;\r\n    private ImageView btnMenuMore;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_home);\r\n\r\n        viewModel = new ViewModelProvider(this).get(HomeViewModel.class);\r\n\r\n        mapViews();\r\n        setupMenuMore();\r\n        setupRecyclerView();\r\n        setupBottomNavigation();\r\n        \r\n        observeViewModel();\r\n        viewModel.loadHomeData(); // Load initial data\r\n    }\r\n\r\n    private void mapViews() {\r\n        lineChart = findViewById(R.id.lineChart);\r\n        bottomNavigation = findViewById(R.id.bottomNavigation);\r\n        rvTransactions = findViewById(R.id.rvTransactions);\r\n        btnMenuMore = findViewById(R.id.btnMenuMore);\r\n\r\n        bottomNavigation.setSelectedItemId(R.id.nav_home);\r\n    }\r\n\r\n    private void observeViewModel() {\r\n        viewModel.transactions.observe(this, this::updateTransactionList);\r\n        viewModel.wallets.observe(this, wallets -> {\r\n            // Update wallet selector UI if needed\r\n        });\r\n        // Observe chart data later\r\n    }\r\n\r\n    private void updateTransactionList(List<TransactionEntity> transactionEntities) {\r\n        if (transactionEntities == null) return;\r\n\r\n        List<TransactionUIModel> uiModels = new ArrayList<>();\r\n        for (TransactionEntity entity : transactionEntities) {\r\n            uiModels.add(new TransactionUIModel(\r\n                    entity.name,\r\n                    entity.category,\r\n                    entity.amount,\r\n                    entity.wallet,\r\n                    entity.date\r\n            ));\r\n        }\r\n\r\n        transactionAdapter.updateList(uiModels); \r\n    }\r\n\r\n    private void setupMenuMore() {\r\n        btnMenuMore.setOnClickListener(v -> {\r\n            PopupMenu popup = new PopupMenu(HomeActivity.this, btnMenuMore);\r\n            popup.getMenuInflater().inflate(R.menu.menu_wallet_options, popup.getMenu());\r\n\r\n            popup.setOnMenuItemClickListener(item -> {\r\n                int id = item.getItemId();\r\n                if (id == R.id.action_choose_wallet) {\r\n                    openChooseWalletDialog();\r\n                    return true;\r\n                }\r\n                if (id == R.id.action_add_wallet) {\r\n                    startActivity(new Intent(HomeActivity.this, AddWalletActivity.class));\r\n                    return true;\r\n                }\r\n                return false;\r\n            });\r\n            popup.show();\r\n        });\r\n    }\r\n\r\n    private void openChooseWalletDialog() {\r\n        viewModel.wallets.observe(this, wallets -> {\r\n            if (wallets == null || wallets.isEmpty()) return;\r\n\r\n            String[] walletNames = new String[wallets.size()];\r\n            for (int i = 0; i < wallets.size(); i++) {\r\n                walletNames[i] = wallets.get(i).name;\r\n            }\r\n\r\n            AlertDialog.Builder builder = new AlertDialog.Builder(this);\r\n            builder.setTitle(\"Chọn ví\");\r\n            builder.setItems(walletNames, (dialog, which) -> {\r\n                String selectedWalletId = String.valueOf(wallets.get(which).id);\r\n                viewModel.selectWallet(selectedWalletId);\r\n                Toast.makeText(this, \"Đã chọn: \" + walletNames[which], Toast.LENGTH_SHORT).show();\r\n            });\r\n            builder.show();\r\n        });\r\n    }\r\n\r\n    private void setupRecyclerView() {\r\n        rvTransactions.setLayoutManager(new LinearLayoutManager(this));\r\n        transactionAdapter = new TransactionAdapter(new ArrayList<>()); \r\n        rvTransactions.setAdapter(transactionAdapter);\r\n    }\r\n\r\n    private void setupChart(List<TransactionEntity> transactions) {\r\n        // This should be derived from the transaction list\r\n        ArrayList<Entry> income = new ArrayList<>();\r\n        ArrayList<Entry> expense = new ArrayList<>();\r\n\r\n        income.add(new Entry(1, 60));\r\n        expense.add(new Entry(1, 20));\r\n\r\n        LineDataSet incomeSet = new LineDataSet(income, \"Thu nhập\");\r\n        incomeSet.setColor(Color.GREEN);\r\n\r\n        LineDataSet expenseSet = new LineDataSet(expense, \"Chi tiêu\");\r\n        expenseSet.setColor(Color.RED);\r\n\r\n        LineData data = new LineData(incomeSet, expenseSet);\r\n        lineChart.setData(data);\r\n        lineChart.invalidate(); // Refresh chart\r\n    }\r\n\r\n    private void setupBottomNavigation() {\r\n        bottomNavigation.setOnNavigationItemSelectedListener(item -> {\r\n            Intent intent = null;\r\n            int id = item.getItemId();\r\n\r\n            if (id == R.id.nav_home) return true;\r\n            if (id == R.id.nav_wallet) intent = new Intent(this, WalletActivity.class);\r\n            if (id == R.id.nav_add) intent = new Intent(this, AddTransactionActivity.class);\r\n            if (id == R.id.nav_statistic) intent = new Intent(this, StatisticActivity.class);\r\n            if (id == R.id.nav_settings) intent = new Intent(this, SettingsActivity.class);\r\n\r\n            if (intent != null) startActivity(intent);\r\n            return true;\r\n        });\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/home/HomeActivity.java b/app/src/main/java/com/finmate/ui/home/HomeActivity.java
--- a/app/src/main/java/com/finmate/ui/home/HomeActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/home/HomeActivity.java	(date 1765447595555)
@@ -14,27 +14,45 @@
 import androidx.recyclerview.widget.RecyclerView;
 
 import com.finmate.R;
+import com.finmate.core.util.TransactionFormatter;
+import com.finmate.data.repository.TransactionSyncManager;
 import com.finmate.ui.activities.AddTransactionActivity;
 import com.finmate.ui.activities.AddWalletActivity;
-import com.finmate.ui.activities.SettingsActivity;
-import com.finmate.ui.activities.StatisticActivity;
+import com.finmate.ui.settings.SettingsActivity;
+import com.finmate.ui.transaction.StatisticActivity;
 import com.finmate.ui.transaction.TransactionUIModel;
 import com.finmate.ui.transaction.TransactionAdapter;
 import com.finmate.data.local.database.entity.TransactionEntity;
 import com.github.mikephil.charting.charts.LineChart;
+import com.github.mikephil.charting.components.Legend;
+import com.github.mikephil.charting.components.XAxis;
+import com.github.mikephil.charting.components.YAxis;
 import com.github.mikephil.charting.data.Entry;
 import com.github.mikephil.charting.data.LineData;
 import com.github.mikephil.charting.data.LineDataSet;
+import com.github.mikephil.charting.formatter.ValueFormatter;
 import com.google.android.material.bottomnavigation.BottomNavigationView;
 
+import java.text.ParseException;
+import java.text.SimpleDateFormat;
 import java.util.ArrayList;
+import java.util.Calendar;
+import java.util.Date;
+import java.util.HashMap;
 import java.util.List;
+import java.util.Locale;
+import java.util.Map;
+
+import javax.inject.Inject;
 
 import dagger.hilt.android.AndroidEntryPoint;
 
 @AndroidEntryPoint
 public class HomeActivity extends AppCompatActivity {
 
+    @Inject
+    TransactionSyncManager transactionSyncManager;
+
     private HomeViewModel viewModel;
 
     private LineChart lineChart;
@@ -56,7 +74,13 @@
         setupBottomNavigation();
         
         observeViewModel();
-        viewModel.loadHomeData(); // Load initial data
+    }
+
+    @Override
+    protected void onResume() {
+        super.onResume();
+        viewModel.loadHomeData();
+        transactionSyncManager.syncPendingTransactions();
     }
 
     private void mapViews() {
@@ -69,11 +93,16 @@
     }
 
     private void observeViewModel() {
-        viewModel.transactions.observe(this, this::updateTransactionList);
+        viewModel.transactions.observe(this, transactions -> {
+            updateTransactionList(transactions);
+            setupChart(transactions);
+        });
         viewModel.wallets.observe(this, wallets -> {
-            // Update wallet selector UI if needed
+            // Tự động chọn ví đầu tiên nếu có
+            if (wallets != null && !wallets.isEmpty() && viewModel.selectedWalletId.getValue() == null) {
+                viewModel.selectWallet(String.valueOf(wallets.get(0).id));
+            }
         });
-        // Observe chart data later
     }
 
     private void updateTransactionList(List<TransactionEntity> transactionEntities) {
@@ -81,12 +110,13 @@
 
         List<TransactionUIModel> uiModels = new ArrayList<>();
         for (TransactionEntity entity : transactionEntities) {
+            // Format amount và date cho UI tại đây, không lưu format trong Entity
             uiModels.add(new TransactionUIModel(
-                    entity.name,
-                    entity.category,
-                    entity.amount,
-                    entity.wallet,
-                    entity.date
+                    entity.getName(),
+                    entity.getCategoryName(),
+                    TransactionFormatter.formatAmount(entity.getAmount()),  // Format amount
+                    entity.getWalletName(),
+                    TransactionFormatter.formatDate(entity.getOccurredAt())  // Format date
             ));
         }
 
@@ -115,23 +145,25 @@
     }
 
     private void openChooseWalletDialog() {
-        viewModel.wallets.observe(this, wallets -> {
-            if (wallets == null || wallets.isEmpty()) return;
+        List<com.finmate.data.local.database.entity.WalletEntity> wallets = viewModel.wallets.getValue();
+        if (wallets == null || wallets.isEmpty()) {
+            Toast.makeText(this, "Chưa có ví nào", Toast.LENGTH_SHORT).show();
+            return;
+        }
 
-            String[] walletNames = new String[wallets.size()];
-            for (int i = 0; i < wallets.size(); i++) {
-                walletNames[i] = wallets.get(i).name;
-            }
+        String[] walletNames = new String[wallets.size()];
+        for (int i = 0; i < wallets.size(); i++) {
+            walletNames[i] = wallets.get(i).name;
+        }
 
-            AlertDialog.Builder builder = new AlertDialog.Builder(this);
-            builder.setTitle("Chọn ví");
-            builder.setItems(walletNames, (dialog, which) -> {
-                String selectedWalletId = String.valueOf(wallets.get(which).id);
-                viewModel.selectWallet(selectedWalletId);
-                Toast.makeText(this, "Đã chọn: " + walletNames[which], Toast.LENGTH_SHORT).show();
-            });
-            builder.show();
-        });
+        AlertDialog.Builder builder = new AlertDialog.Builder(this);
+        builder.setTitle("Chọn ví");
+        builder.setItems(walletNames, (dialog, which) -> {
+            String selectedWalletId = String.valueOf(wallets.get(which).id);
+            viewModel.selectWallet(selectedWalletId);
+            Toast.makeText(this, "Đã chọn: " + walletNames[which], Toast.LENGTH_SHORT).show();
+        });
+        builder.show();
     }
 
     private void setupRecyclerView() {
@@ -141,22 +173,158 @@
     }
 
     private void setupChart(List<TransactionEntity> transactions) {
-        // This should be derived from the transaction list
-        ArrayList<Entry> income = new ArrayList<>();
-        ArrayList<Entry> expense = new ArrayList<>();
+        if (transactions == null || transactions.isEmpty()) {
+            lineChart.clear();
+            lineChart.invalidate();
+            return;
+        }
 
-        income.add(new Entry(1, 60));
-        expense.add(new Entry(1, 20));
-
-        LineDataSet incomeSet = new LineDataSet(income, "Thu nhập");
-        incomeSet.setColor(Color.GREEN);
-
-        LineDataSet expenseSet = new LineDataSet(expense, "Chi tiêu");
-        expenseSet.setColor(Color.RED);
+        // Tính toán income và expense theo tháng (6 tháng gần nhất)
+        Map<Integer, Double> incomeByMonth = new HashMap<>();
+        Map<Integer, Double> expenseByMonth = new HashMap<>();
+        
+        Calendar calendar = Calendar.getInstance();
+        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss", Locale.US);
+        SimpleDateFormat dateFormatWithMillis = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSS", Locale.US);
+        
+        // Khởi tạo 6 tháng gần nhất với giá trị 0
+        Calendar tempCalendar = Calendar.getInstance();
+        for (int i = 5; i >= 0; i--) {
+            tempCalendar.setTimeInMillis(calendar.getTimeInMillis());
+            tempCalendar.add(Calendar.MONTH, -i);
+            int monthKey = tempCalendar.get(Calendar.YEAR) * 100 + tempCalendar.get(Calendar.MONTH);
+            incomeByMonth.put(monthKey, 0.0);
+            expenseByMonth.put(monthKey, 0.0);
+        }
 
+        // Phân loại transactions theo tháng
+        for (TransactionEntity transaction : transactions) {
+            Date date = null;
+            // Thử parse với format có milliseconds trước
+            try {
+                date = dateFormatWithMillis.parse(transaction.occurredAt);
+            } catch (ParseException e) {
+                // Nếu không được, thử format không có milliseconds
+                try {
+                    date = dateFormat.parse(transaction.occurredAt);
+                } catch (ParseException ex) {
+                    // Bỏ qua transaction không parse được
+                    continue;
+                }
+            }
+            
+            if (date != null) {
+                calendar.setTime(date);
+                int monthKey = calendar.get(Calendar.YEAR) * 100 + calendar.get(Calendar.MONTH);
+                
+                // Chỉ tính toán nếu tháng nằm trong 6 tháng gần nhất
+                if (incomeByMonth.containsKey(monthKey)) {
+                    // Giả định: amount > 0 là income, amount < 0 là expense
+                    // Hoặc có thể dựa vào category type nếu có
+                    if (transaction.amount > 0) {
+                        double currentIncome = incomeByMonth.getOrDefault(monthKey, 0.0);
+                        incomeByMonth.put(monthKey, currentIncome + Math.abs(transaction.amount));
+                    } else {
+                        double currentExpense = expenseByMonth.getOrDefault(monthKey, 0.0);
+                        expenseByMonth.put(monthKey, currentExpense + Math.abs(transaction.amount));
+                    }
+                }
+            }
+        }
+
+        // Tạo entries cho chart (6 tháng gần nhất)
+        ArrayList<Entry> incomeEntries = new ArrayList<>();
+        ArrayList<Entry> expenseEntries = new ArrayList<>();
+        
+        List<Integer> sortedMonths = new ArrayList<>(incomeByMonth.keySet());
+        sortedMonths.sort(Integer::compareTo);
+        
+        int index = 1;
+        for (Integer monthKey : sortedMonths) {
+            double income = incomeByMonth.getOrDefault(monthKey, 0.0);
+            double expense = expenseByMonth.getOrDefault(monthKey, 0.0);
+            
+            // Chuyển đổi sang triệu VND để hiển thị đẹp hơn
+            incomeEntries.add(new Entry(index, (float) (income / 1000000)));
+            expenseEntries.add(new Entry(index, (float) (expense / 1000000)));
+            index++;
+        }
+
+        // Tạo dataset cho income
+        LineDataSet incomeSet = new LineDataSet(incomeEntries, "Thu nhập");
+        incomeSet.setColor(Color.parseColor("#4CAF50"));
+        incomeSet.setLineWidth(2.5f);
+        incomeSet.setCircleColor(Color.parseColor("#4CAF50"));
+        incomeSet.setCircleRadius(4f);
+        incomeSet.setValueTextColor(Color.WHITE);
+        incomeSet.setValueTextSize(10f);
+        incomeSet.setDrawValues(false); // Ẩn giá trị trên điểm để chart gọn hơn
+
+        // Tạo dataset cho expense
+        LineDataSet expenseSet = new LineDataSet(expenseEntries, "Chi tiêu");
+        expenseSet.setColor(Color.parseColor("#FF5252"));
+        expenseSet.setLineWidth(2.5f);
+        expenseSet.setCircleColor(Color.parseColor("#FF5252"));
+        expenseSet.setCircleRadius(4f);
+        expenseSet.setValueTextColor(Color.WHITE);
+        expenseSet.setValueTextSize(10f);
+        expenseSet.setDrawValues(false);
+
         LineData data = new LineData(incomeSet, expenseSet);
+
+        // Cấu hình chart
         lineChart.setData(data);
-        lineChart.invalidate(); // Refresh chart
+        lineChart.getDescription().setEnabled(false);
+        lineChart.setTouchEnabled(true);
+        lineChart.setDragEnabled(true);
+        lineChart.setScaleEnabled(true);
+        lineChart.setPinchZoom(true);
+        lineChart.setDrawGridBackground(false);
+        lineChart.setNoDataText("Không có dữ liệu");
+
+        // Cấu hình legend
+        Legend legend = lineChart.getLegend();
+        legend.setEnabled(true);
+        legend.setTextColor(Color.WHITE);
+        legend.setTextSize(12f);
+        legend.setForm(Legend.LegendForm.LINE);
+        legend.setHorizontalAlignment(Legend.LegendHorizontalAlignment.CENTER);
+
+        // Cấu hình trục X
+        XAxis xAxis = lineChart.getXAxis();
+        xAxis.setPosition(XAxis.XAxisPosition.BOTTOM);
+        xAxis.setTextColor(Color.WHITE);
+        xAxis.setDrawGridLines(false);
+        xAxis.setGranularity(1f);
+        xAxis.setValueFormatter(new ValueFormatter() {
+            @Override
+            public String getFormattedValue(float value) {
+                int monthIndex = (int) value;
+                if (monthIndex >= 1 && monthIndex <= 6) {
+                    String[] monthLabels = {"T1", "T2", "T3", "T4", "T5", "T6"};
+                    return monthLabels[monthIndex - 1];
+                }
+                return "";
+            }
+        });
+
+        // Cấu hình trục Y
+        YAxis leftAxis = lineChart.getAxisLeft();
+        leftAxis.setTextColor(Color.WHITE);
+        leftAxis.setDrawGridLines(true);
+        leftAxis.setGridColor(Color.parseColor("#33FFFFFF"));
+        leftAxis.setValueFormatter(new ValueFormatter() {
+            @Override
+            public String getFormattedValue(float value) {
+                return String.format(Locale.getDefault(), "%.1fM", value);
+            }
+        });
+
+        YAxis rightAxis = lineChart.getAxisRight();
+        rightAxis.setEnabled(false);
+
+        lineChart.animateX(800);
+        lineChart.invalidate();
     }
 
     private void setupBottomNavigation() {
Index: app/src/main/java/com/finmate/ui/auth/SignUpViewModel.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.auth;\r\n\r\nimport androidx.lifecycle.LiveData;\r\nimport androidx.lifecycle.MutableLiveData;\r\nimport androidx.lifecycle.ViewModel;\r\n\r\nimport com.finmate.data.repository.AuthRepository;\r\n\r\nimport javax.inject.Inject;\r\n\r\nimport dagger.hilt.android.lifecycle.HiltViewModel;\r\n\r\n@HiltViewModel\r\npublic class SignUpViewModel extends ViewModel {\r\n\r\n    private final AuthRepository authRepository;\r\n    \r\n    private final MutableLiveData<Boolean> _registerSuccess = new MutableLiveData<>();\r\n    public LiveData<Boolean> registerSuccess = _registerSuccess;\r\n    \r\n    private final MutableLiveData<String> _errorMessage = new MutableLiveData<>();\r\n    public LiveData<String> errorMessage = _errorMessage;\r\n    \r\n    private final MutableLiveData<Boolean> _isLoading = new MutableLiveData<>();\r\n    public LiveData<Boolean> isLoading = _isLoading;\r\n\r\n    @Inject\r\n    public SignUpViewModel(AuthRepository authRepository) {\r\n        this.authRepository = authRepository;\r\n    }\r\n\r\n    public void register(String email, String password) {\r\n        if (email.isEmpty() || password.isEmpty()) {\r\n            _errorMessage.setValue(\"Email and password cannot be empty\");\r\n            return;\r\n        }\r\n        \r\n        _isLoading.setValue(true);\r\n        authRepository.register(email, password, new AuthRepository.RegisterCallback() {\r\n            @Override\r\n            public void onSuccess() {\r\n                _isLoading.setValue(false);\r\n                _registerSuccess.setValue(true);\r\n            }\r\n\r\n            @Override\r\n            public void onError(String message) {\r\n                _isLoading.setValue(false);\r\n                _errorMessage.setValue(message);\r\n            }\r\n        });\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/auth/SignUpViewModel.java b/app/src/main/java/com/finmate/ui/auth/SignUpViewModel.java
--- a/app/src/main/java/com/finmate/ui/auth/SignUpViewModel.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/auth/SignUpViewModel.java	(date 1765447595551)
@@ -9,18 +9,21 @@
 import javax.inject.Inject;
 
 import dagger.hilt.android.lifecycle.HiltViewModel;
+import io.reactivex.rxjava3.disposables.CompositeDisposable;
+import io.reactivex.rxjava3.schedulers.Schedulers;
 
 @HiltViewModel
 public class SignUpViewModel extends ViewModel {
 
     private final AuthRepository authRepository;
-    
+    private final CompositeDisposable disposables = new CompositeDisposable();
+
     private final MutableLiveData<Boolean> _registerSuccess = new MutableLiveData<>();
     public LiveData<Boolean> registerSuccess = _registerSuccess;
-    
+
     private final MutableLiveData<String> _errorMessage = new MutableLiveData<>();
     public LiveData<String> errorMessage = _errorMessage;
-    
+
     private final MutableLiveData<Boolean> _isLoading = new MutableLiveData<>();
     public LiveData<Boolean> isLoading = _isLoading;
 
@@ -29,25 +32,30 @@
         this.authRepository = authRepository;
     }
 
-    public void register(String email, String password) {
+    public void register(String email, String password, String fullName, String avatarUrl) {
         if (email.isEmpty() || password.isEmpty()) {
             _errorMessage.setValue("Email and password cannot be empty");
             return;
         }
-        
+
         _isLoading.setValue(true);
-        authRepository.register(email, password, new AuthRepository.RegisterCallback() {
-            @Override
-            public void onSuccess() {
-                _isLoading.setValue(false);
-                _registerSuccess.setValue(true);
-            }
-
-            @Override
-            public void onError(String message) {
-                _isLoading.setValue(false);
-                _errorMessage.setValue(message);
-            }
-        });
+        disposables.add(authRepository.register(email, password, fullName, avatarUrl)
+                .subscribeOn(Schedulers.io())
+                .subscribe(
+                        () -> {
+                            _isLoading.postValue(false);
+                            _registerSuccess.postValue(true);
+                        },
+                        throwable -> {
+                            _isLoading.postValue(false);
+                            _errorMessage.postValue(throwable.getMessage() != null ? throwable.getMessage() : "Registration failed");
+                        }
+                ));
+    }
+
+    @Override
+    protected void onCleared() {
+        super.onCleared();
+        disposables.clear();
     }
 }
Index: app/src/main/java/com/finmate/ui/auth/LoginViewModel.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.auth;\r\n\r\nimport androidx.lifecycle.LiveData;\r\nimport androidx.lifecycle.MutableLiveData;\r\nimport androidx.lifecycle.ViewModel;\r\n\r\nimport com.finmate.data.repository.AuthRepository;\r\n\r\nimport javax.inject.Inject;\r\n\r\nimport dagger.hilt.android.lifecycle.HiltViewModel;\r\n\r\n@HiltViewModel\r\npublic class LoginViewModel extends ViewModel {\r\n\r\n    private final AuthRepository authRepository;\r\n    \r\n    private final MutableLiveData<Boolean> _loginSuccess = new MutableLiveData<>();\r\n    public LiveData<Boolean> loginSuccess = _loginSuccess;\r\n    \r\n    private final MutableLiveData<String> _errorMessage = new MutableLiveData<>();\r\n    public LiveData<String> errorMessage = _errorMessage;\r\n    \r\n    private final MutableLiveData<Boolean> _isLoading = new MutableLiveData<>();\r\n    public LiveData<Boolean> isLoading = _isLoading;\r\n\r\n    @Inject\r\n    public LoginViewModel(AuthRepository authRepository) {\r\n        this.authRepository = authRepository;\r\n    }\r\n\r\n    public void login(String email, String password) {\r\n        if (email.isEmpty() || password.isEmpty()) {\r\n            _errorMessage.setValue(\"Email and password cannot be empty\");\r\n            return;\r\n        }\r\n        \r\n        _isLoading.setValue(true);\r\n        authRepository.login(email, password, new AuthRepository.LoginCallback() {\r\n            @Override\r\n            public void onSuccess() {\r\n                _isLoading.setValue(false);\r\n                _loginSuccess.setValue(true);\r\n            }\r\n\r\n            @Override\r\n            public void onError(String message) {\r\n                _isLoading.setValue(false);\r\n                _errorMessage.setValue(message);\r\n            }\r\n        });\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/auth/LoginViewModel.java b/app/src/main/java/com/finmate/ui/auth/LoginViewModel.java
--- a/app/src/main/java/com/finmate/ui/auth/LoginViewModel.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/auth/LoginViewModel.java	(date 1765447595546)
@@ -36,18 +36,16 @@
         }
         
         _isLoading.setValue(true);
-        authRepository.login(email, password, new AuthRepository.LoginCallback() {
-            @Override
-            public void onSuccess() {
-                _isLoading.setValue(false);
-                _loginSuccess.setValue(true);
-            }
-
-            @Override
-            public void onError(String message) {
-                _isLoading.setValue(false);
-                _errorMessage.setValue(message);
-            }
-        });
+        authRepository.login(email, password)
+                .subscribe(
+                        () -> {
+                            _isLoading.postValue(false);
+                            _loginSuccess.postValue(true);
+                        },
+                        error -> {
+                            _isLoading.postValue(false);
+                            _errorMessage.postValue(error.getMessage() != null ? error.getMessage() : "Login failed");
+                        }
+                );
     }
 }
Index: app/src/main/java/com/finmate/ui/auth/SignUpActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.auth;\r\n\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.widget.Button;\r\nimport android.widget.EditText;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.lifecycle.ViewModelProvider;\r\n\r\nimport com.finmate.R;\r\nimport com.finmate.ui.home.HomeActivity;\r\n\r\nimport dagger.hilt.android.AndroidEntryPoint;\r\n\r\n@AndroidEntryPoint\r\npublic class SignUpActivity extends AppCompatActivity {\r\n\r\n    EditText etName, etEmail, etPassword;\r\n    Button btnSignup;\r\n    TextView tvAlreadyAccount;\r\n    \r\n    private SignUpViewModel signUpViewModel;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_signup);\r\n        \r\n        signUpViewModel = new ViewModelProvider(this).get(SignUpViewModel.class);\r\n\r\n        // Ánh xạ thành phần giao diện\r\n        etName = findViewById(R.id.etName);\r\n        etEmail = findViewById(R.id.etEmail);\r\n        etPassword = findViewById(R.id.etPassword);\r\n        btnSignup = findViewById(R.id.btnSignup);\r\n        tvAlreadyAccount = findViewById(R.id.tvAlreadyAccount);\r\n        \r\n        observeViewModel();\r\n\r\n        // Xử lý nút SIGNUP\r\n        btnSignup.setOnClickListener(view -> {\r\n\r\n            String name = etName.getText().toString().trim();\r\n            String email = etEmail.getText().toString().trim();\r\n            String pass = etPassword.getText().toString().trim();\r\n\r\n            // VALIDATE\r\n            if (name.isEmpty() || email.isEmpty() || pass.isEmpty()) {\r\n                Toast.makeText(this, \"Vui lòng nhập đầy đủ thông tin!\", Toast.LENGTH_SHORT).show();\r\n                return;\r\n            }\r\n\r\n            if (!email.contains(\"@\")) {\r\n                Toast.makeText(this, \"Email không hợp lệ!\", Toast.LENGTH_SHORT).show();\r\n                return;\r\n            }\r\n\r\n            if (pass.length() < 6) {\r\n                Toast.makeText(this, \"Mật khẩu phải ≥ 6 ký tự!\", Toast.LENGTH_SHORT).show();\r\n                return;\r\n            }\r\n            \r\n            signUpViewModel.register(email, pass);\r\n        });\r\n\r\n        // Quay lại Login\r\n        tvAlreadyAccount.setOnClickListener(view -> {\r\n            Intent intent = new Intent(SignUpActivity.this, LoginActivity.class);\r\n            startActivity(intent);\r\n            overridePendingTransition(android.R.anim.slide_in_left, android.R.anim.slide_out_right);\r\n            finish();\r\n        });\r\n    }\r\n    \r\n    private void observeViewModel() {\r\n        signUpViewModel.isLoading.observe(this, isLoading -> {\r\n            btnSignup.setEnabled(!isLoading);\r\n            btnSignup.setText(isLoading ? \"Đang xử lý...\" : \"Signup\");\r\n        });\r\n        \r\n        signUpViewModel.registerSuccess.observe(this, success -> {\r\n            if (success) {\r\n                Toast.makeText(SignUpActivity.this, \"Đăng ký thành công!\", Toast.LENGTH_SHORT).show();\r\n                Intent intent = new Intent(SignUpActivity.this, HomeActivity.class);\r\n                startActivity(intent);\r\n                overridePendingTransition(android.R.anim.fade_in, android.R.anim.fade_out);\r\n                finish();\r\n            }\r\n        });\r\n        \r\n        signUpViewModel.errorMessage.observe(this, error -> {\r\n            if (error != null && !error.isEmpty()) {\r\n                Toast.makeText(SignUpActivity.this, error, Toast.LENGTH_SHORT).show();\r\n            }\r\n        });\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/auth/SignUpActivity.java b/app/src/main/java/com/finmate/ui/auth/SignUpActivity.java
--- a/app/src/main/java/com/finmate/ui/auth/SignUpActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/auth/SignUpActivity.java	(date 1765447595546)
@@ -63,7 +63,11 @@
                 return;
             }
             
-            signUpViewModel.register(email, pass);
+            // Avatar mặc định - sử dụng tên resource hoặc URL mặc định
+            // Có thể thay đổi thành URL thực tế nếu có server lưu avatar
+            String defaultAvatarUrl = "ic_avatar"; // Tên resource mặc định
+            
+            signUpViewModel.register(email, pass, name, defaultAvatarUrl);
         });
 
         // Quay lại Login
Index: app/src/main/java/com/finmate/ui/activities/AddWalletActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.activities;\r\n\r\nimport android.os.Bundle;\r\nimport android.widget.Button;\r\nimport android.widget.EditText;\r\nimport android.widget.ImageView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport com.finmate.R;\r\nimport com.finmate.data.local.database.entity.WalletEntity;\r\nimport com.finmate.data.repository.WalletRepository;\r\n\r\npublic class AddWalletActivity extends AppCompatActivity {\r\n\r\n    private EditText edtWalletName, edtWalletBalance;\r\n    private Button btnSave, btnCancel;\r\n    private ImageView btnBack;\r\n\r\n    private WalletRepository repo;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_add_wallet);\r\n\r\n        repo = new WalletRepository(this);\r\n\r\n        mapViews();\r\n        handleEvents();\r\n    }\r\n\r\n    private void mapViews() {\r\n        edtWalletName = findViewById(R.id.edtWalletName);\r\n        edtWalletBalance = findViewById(R.id.edtWalletBalance);\r\n\r\n        btnSave = findViewById(R.id.btnSave);\r\n        btnCancel = findViewById(R.id.btnCancel);\r\n        btnBack = findViewById(R.id.btnBack);\r\n    }\r\n\r\n    private void handleEvents() {\r\n        btnBack.setOnClickListener(v -> finish());\r\n        btnCancel.setOnClickListener(v -> finish());\r\n\r\n        btnSave.setOnClickListener(v -> saveWallet());\r\n    }\r\n\r\n    private void saveWallet() {\r\n        String name = edtWalletName.getText().toString().trim();\r\n        String balance = edtWalletBalance.getText().toString().trim();\r\n\r\n        if (name.isEmpty()) {\r\n            edtWalletName.setError(\"Nhập tên ví\");\r\n            return;\r\n        }\r\n\r\n        if (balance.isEmpty()) {\r\n            edtWalletBalance.setError(\"Nhập số dư\");\r\n            return;\r\n        }\r\n\r\n        WalletEntity wallet = new WalletEntity(name, balance, R.drawable.ic_wallet);\r\n\r\n        repo.insert(wallet);\r\n\r\n        Toast.makeText(this, \"Đã thêm ví!\", Toast.LENGTH_SHORT).show();\r\n        finish();\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/activities/AddWalletActivity.java b/app/src/main/java/com/finmate/ui/activities/AddWalletActivity.java
--- a/app/src/main/java/com/finmate/ui/activities/AddWalletActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/activities/AddWalletActivity.java	(date 1765447595544)
@@ -10,7 +10,7 @@
 
 import com.finmate.R;
 import com.finmate.data.local.database.entity.WalletEntity;
-import com.finmate.data.repository.WalletRepository;
+import com.finmate.data.repository.WalletLocalRepository;
 
 public class AddWalletActivity extends AppCompatActivity {
 
@@ -18,14 +18,14 @@
     private Button btnSave, btnCancel;
     private ImageView btnBack;
 
-    private WalletRepository repo;
+    private WalletLocalRepository repo;
 
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
         setContentView(R.layout.activity_add_wallet);
 
-        repo = new WalletRepository(this);
+        repo = new WalletLocalRepository(this);
 
         mapViews();
         handleEvents();
@@ -61,7 +61,15 @@
             return;
         }
 
-        WalletEntity wallet = new WalletEntity(name, balance, R.drawable.ic_wallet);
+        double balanceValue;
+        try {
+            balanceValue = Double.parseDouble(balance.replace(",", ""));
+        } catch (NumberFormatException e) {
+            edtWalletBalance.setError("Số dư không hợp lệ");
+            return;
+        }
+
+        WalletEntity wallet = new WalletEntity(name, "VND", balanceValue, R.drawable.ic_wallet);
 
         repo.insert(wallet);
 
Index: app/src/main/java/com/finmate/ui/activities/IncomeStatisticActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.activities;\r\n\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.widget.ImageView;\r\nimport android.widget.TextView;\r\n\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport com.finmate.R;\r\nimport com.finmate.ui.home.WalletActivity;\r\nimport com.github.mikephil.charting.charts.BarChart;\r\nimport com.github.mikephil.charting.charts.PieChart;\r\nimport com.github.mikephil.charting.components.Legend;\r\nimport com.github.mikephil.charting.components.XAxis;\r\nimport com.github.mikephil.charting.data.BarData;\r\nimport com.github.mikephil.charting.data.BarDataSet;\r\nimport com.github.mikephil.charting.data.BarEntry;\r\nimport com.github.mikephil.charting.data.PieData;\r\nimport com.github.mikephil.charting.data.PieDataSet;\r\nimport com.github.mikephil.charting.data.PieEntry;\r\nimport com.google.android.material.bottomnavigation.BottomNavigationView;\r\n\r\nimport android.graphics.Color;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\npublic class IncomeStatisticActivity extends AppCompatActivity {\r\n\r\n    ImageView btnBack;\r\n    TextView tvExpenseTab, tvIncomeTab;\r\n    TextView tvTotalIncome, tvAddTitle, tvCategoryFilter;\r\n    BarChart barChartIncome;\r\n    PieChart pieChartIncome;\r\n    BottomNavigationView bottomNavigation;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_income_statistic);\r\n\r\n        // ================== ÁNH XẠ VIEW ==================\r\n        btnBack = findViewById(R.id.btnBack);\r\n        tvExpenseTab = findViewById(R.id.tvExpenseTab);\r\n        tvIncomeTab = findViewById(R.id.tvIncomeTab);\r\n        tvTotalIncome = findViewById(R.id.tvTotalIncome);\r\n\r\n        barChartIncome = findViewById(R.id.barChartIncome);\r\n        pieChartIncome = findViewById(R.id.pieChartIncome);\r\n\r\n        bottomNavigation = findViewById(R.id.bottomNavigation);\r\n\r\n        // ================== BACK ==================\r\n        btnBack.setOnClickListener(v -> finish());\r\n\r\n        // ================== TAB CHUYỂN QUA CHI TIÊU ==================\r\n        tvExpenseTab.setOnClickListener(v -> {\r\n            Intent intent = new Intent(this, StatisticActivity.class);\r\n            startActivity(intent);\r\n            finish();\r\n        });\r\n\r\n        // Tab Thu nhập đang active -> Không làm gì\r\n        tvIncomeTab.setOnClickListener(v -> {});\r\n\r\n        // ================== CHART SETUP ==================\r\n        loadBarChartData();\r\n        loadPieChartData();\r\n\r\n        // ================== BOTTOM NAVIGATION ==================\r\n        setupBottomNav();\r\n    }\r\n\r\n    // ================== DỮ LIỆU MẪU THU NHẬP THEO THÁNG ==================\r\n    private void loadBarChartData() {\r\n        List<BarEntry> entries = new ArrayList<>();\r\n        entries.add(new BarEntry(1, 5000000));\r\n        entries.add(new BarEntry(2, 8000000));\r\n        entries.add(new BarEntry(3, 6000000));\r\n        entries.add(new BarEntry(4, 9000000));\r\n        entries.add(new BarEntry(5, 10000000));\r\n\r\n        BarDataSet dataSet = new BarDataSet(entries, \"Thu nhập\");\r\n        dataSet.setColor(Color.parseColor(\"#4CAF50\"));\r\n        dataSet.setValueTextColor(Color.WHITE);\r\n        dataSet.setValueTextSize(10f);\r\n\r\n        BarData barData = new BarData(dataSet);\r\n        barData.setBarWidth(0.35f);\r\n\r\n        barChartIncome.setData(barData);\r\n        barChartIncome.setFitBars(true);\r\n\r\n        // Tắt mô tả\r\n        barChartIncome.getDescription().setEnabled(false);\r\n        barChartIncome.getLegend().setEnabled(false);\r\n\r\n        // Cài đặt trục X\r\n        XAxis xAxis = barChartIncome.getXAxis();\r\n        xAxis.setTextColor(Color.WHITE);\r\n        xAxis.setDrawGridLines(false);\r\n        xAxis.setPosition(XAxis.XAxisPosition.BOTTOM);\r\n\r\n        barChartIncome.invalidate();\r\n    }\r\n\r\n    // ================== BIỂU ĐỒ TRÒN ==================\r\n    private void loadPieChartData() {\r\n        List<PieEntry> entries = new ArrayList<>();\r\n        entries.add(new PieEntry(40f, \"Lương\"));\r\n        entries.add(new PieEntry(25f, \"Thưởng\"));\r\n        entries.add(new PieEntry(15f, \"Kinh doanh\"));\r\n        entries.add(new PieEntry(20f, \"Khác\"));\r\n\r\n        PieDataSet dataSet = new PieDataSet(entries, \"\");\r\n        dataSet.setColors(\r\n                Color.parseColor(\"#4CAF50\"),\r\n                Color.parseColor(\"#8BC34A\"),\r\n                Color.parseColor(\"#CDDC39\"),\r\n                Color.parseColor(\"#FFC107\")\r\n        );\r\n\r\n        dataSet.setValueTextColor(Color.WHITE);\r\n        dataSet.setValueTextSize(12f);\r\n\r\n        PieData pieData = new PieData(dataSet);\r\n\r\n        pieChartIncome.setData(pieData);\r\n        pieChartIncome.setUsePercentValues(true);\r\n\r\n        pieChartIncome.setDrawHoleEnabled(true);\r\n        pieChartIncome.setHoleRadius(40f);\r\n        pieChartIncome.setTransparentCircleRadius(45f);\r\n\r\n        pieChartIncome.getDescription().setEnabled(false);\r\n\r\n        Legend legend = pieChartIncome.getLegend();\r\n        legend.setTextColor(Color.WHITE);\r\n        legend.setTextSize(12f);\r\n\r\n        pieChartIncome.invalidate();\r\n    }\r\n\r\n    // ================== BOTTOM NAV ==================\r\n    private void setupBottomNav() {\r\n        bottomNavigation.setSelectedItemId(R.id.nav_statistic);\r\n\r\n        bottomNavigation.setOnNavigationItemSelectedListener(item -> {\r\n            int id = item.getItemId();\r\n\r\n            if (id == R.id.nav_home) {\r\n                startActivity(new Intent(this, HomeActivity.class));\r\n                return true;\r\n            }\r\n            if (id == R.id.nav_wallet) {\r\n                startActivity(new Intent(this, WalletActivity.class));\r\n                return true;\r\n            }\r\n            if (id == R.id.nav_add) {\r\n                startActivity(new Intent(this, AddTransactionActivity.class));\r\n                return true;\r\n            }\r\n            if (id == R.id.nav_statistic) {\r\n                return true;\r\n            }\r\n            if (id == R.id.nav_settings) {\r\n                startActivity(new Intent(this, SettingsActivity.class));\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/activities/IncomeStatisticActivity.java b/app/src/main/java/com/finmate/ui/activities/IncomeStatisticActivity.java
--- a/app/src/main/java/com/finmate/ui/activities/IncomeStatisticActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/activities/IncomeStatisticActivity.java	(date 1765447595546)
@@ -1,14 +1,28 @@
 package com.finmate.ui.activities;
 
+import android.app.DatePickerDialog;
 import android.content.Intent;
+import android.graphics.Color;
 import android.os.Bundle;
 import android.widget.ImageView;
 import android.widget.TextView;
 
+import androidx.appcompat.app.AlertDialog;
 import androidx.appcompat.app.AppCompatActivity;
+import androidx.lifecycle.ViewModelProvider;
 
 import com.finmate.R;
+import com.finmate.core.util.TransactionFormatter;
+import com.finmate.data.local.database.entity.WalletEntity;
+import com.finmate.data.repository.model.StatisticFilter;
+import com.finmate.ui.activities.AddTransactionActivity;
+import com.finmate.ui.home.HomeActivity;
 import com.finmate.ui.home.WalletActivity;
+import com.finmate.ui.settings.SettingsActivity;
+import com.finmate.ui.transaction.ChartPoint;
+import com.finmate.ui.transaction.StatisticActivity;
+import com.finmate.ui.transaction.StatisticResult;
+import com.finmate.ui.transaction.StatisticViewModel;
 import com.github.mikephil.charting.charts.BarChart;
 import com.github.mikephil.charting.charts.PieChart;
 import com.github.mikephil.charting.components.Legend;
@@ -19,67 +33,103 @@
 import com.github.mikephil.charting.data.PieData;
 import com.github.mikephil.charting.data.PieDataSet;
 import com.github.mikephil.charting.data.PieEntry;
+import com.github.mikephil.charting.formatter.IndexAxisValueFormatter;
 import com.google.android.material.bottomnavigation.BottomNavigationView;
 
-import android.graphics.Color;
-
 import java.util.ArrayList;
+import java.util.Calendar;
 import java.util.List;
 
+import dagger.hilt.android.AndroidEntryPoint;
+
+@AndroidEntryPoint
 public class IncomeStatisticActivity extends AppCompatActivity {
 
+    private static final String TYPE_INCOME = "INCOME";
+
     ImageView btnBack;
     TextView tvExpenseTab, tvIncomeTab;
-    TextView tvTotalIncome, tvAddTitle, tvCategoryFilter;
+    TextView tvTotalIncome, tvDateFilter, tvWalletFilter;
     BarChart barChartIncome;
     PieChart pieChartIncome;
     BottomNavigationView bottomNavigation;
 
+    StatisticViewModel viewModel;
+    List<WalletEntity> walletOptions = new ArrayList<>();
+    String currentWalletLabel = "Tất cả ví";
+
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
         setContentView(R.layout.activity_income_statistic);
 
-        // ================== ÁNH XẠ VIEW ==================
+        viewModel = new ViewModelProvider(this).get(StatisticViewModel.class);
+
         btnBack = findViewById(R.id.btnBack);
         tvExpenseTab = findViewById(R.id.tvExpenseTab);
         tvIncomeTab = findViewById(R.id.tvIncomeTab);
         tvTotalIncome = findViewById(R.id.tvTotalIncome);
+        tvDateFilter = findViewById(R.id.tvDateFilter);
+        tvWalletFilter = findViewById(R.id.tvWalletFilter);
 
         barChartIncome = findViewById(R.id.barChartIncome);
         pieChartIncome = findViewById(R.id.pieChartIncome);
 
         bottomNavigation = findViewById(R.id.bottomNavigation);
 
-        // ================== BACK ==================
+        highlightTabs();
+        setupBottomNav();
+        setupEvents();
+        setupObservers();
+
+        updateFilterLabels(viewModel.getCurrentFilter());
+        viewModel.loadWallets();
+        viewModel.loadStatistics(TYPE_INCOME);
+    }
+
+    private void setupEvents() {
         btnBack.setOnClickListener(v -> finish());
 
-        // ================== TAB CHUYỂN QUA CHI TIÊU ==================
         tvExpenseTab.setOnClickListener(v -> {
             Intent intent = new Intent(this, StatisticActivity.class);
             startActivity(intent);
             finish();
         });
 
-        // Tab Thu nhập đang active -> Không làm gì
-        tvIncomeTab.setOnClickListener(v -> {});
+        tvIncomeTab.setOnClickListener(v -> { /* already on income */ });
+
+        tvDateFilter.setOnClickListener(v -> showDateFilterDialog());
+        tvWalletFilter.setOnClickListener(v -> showWalletFilterDialog());
+    }
+
+    private void setupObservers() {
+        viewModel.statistic.observe(this, this::renderStatistic);
+        viewModel.wallets.observe(this, wallets -> walletOptions = wallets != null ? wallets : new ArrayList<>());
+    }
 
-        // ================== CHART SETUP ==================
-        loadBarChartData();
-        loadPieChartData();
+    private void renderStatistic(StatisticResult result) {
+        String formatted = TransactionFormatter.formatAmount(result.getTotalAmount());
+        tvTotalIncome.setText("+" + formatted + " VND");
 
-        // ================== BOTTOM NAVIGATION ==================
-        setupBottomNav();
+        renderBarChart(result.getTimeline());
+        renderPieChart(result.getByCategory());
     }
 
-    // ================== DỮ LIỆU MẪU THU NHẬP THEO THÁNG ==================
-    private void loadBarChartData() {
+    private void renderBarChart(List<ChartPoint> data) {
+        barChartIncome.clear();
+
+        if (data == null || data.isEmpty()) {
+            barChartIncome.setNoDataText("Không có dữ liệu");
+            barChartIncome.invalidate();
+            return;
+        }
+
         List<BarEntry> entries = new ArrayList<>();
-        entries.add(new BarEntry(1, 5000000));
-        entries.add(new BarEntry(2, 8000000));
-        entries.add(new BarEntry(3, 6000000));
-        entries.add(new BarEntry(4, 9000000));
-        entries.add(new BarEntry(5, 10000000));
+        List<String> labels = new ArrayList<>();
+        for (int i = 0; i < data.size(); i++) {
+            entries.add(new BarEntry(i, data.get(i).getValue()));
+            labels.add(data.get(i).getLabel());
+        }
 
         BarDataSet dataSet = new BarDataSet(entries, "Thu nhập");
         dataSet.setColor(Color.parseColor("#4CAF50"));
@@ -87,38 +137,45 @@
         dataSet.setValueTextSize(10f);
 
         BarData barData = new BarData(dataSet);
-        barData.setBarWidth(0.35f);
-
         barChartIncome.setData(barData);
         barChartIncome.setFitBars(true);
 
-        // Tắt mô tả
         barChartIncome.getDescription().setEnabled(false);
         barChartIncome.getLegend().setEnabled(false);
 
-        // Cài đặt trục X
         XAxis xAxis = barChartIncome.getXAxis();
         xAxis.setTextColor(Color.WHITE);
         xAxis.setDrawGridLines(false);
         xAxis.setPosition(XAxis.XAxisPosition.BOTTOM);
+        xAxis.setGranularity(1f);
+        xAxis.setValueFormatter(new IndexAxisValueFormatter(labels));
+        xAxis.setLabelCount(labels.size());
 
+        barChartIncome.animateY(500);
         barChartIncome.invalidate();
     }
 
-    // ================== BIỂU ĐỒ TRÒN ==================
-    private void loadPieChartData() {
+    private void renderPieChart(List<ChartPoint> data) {
+        pieChartIncome.clear();
+
+        if (data == null || data.isEmpty()) {
+            pieChartIncome.setNoDataText("Không có dữ liệu");
+            pieChartIncome.invalidate();
+            return;
+        }
+
         List<PieEntry> entries = new ArrayList<>();
-        entries.add(new PieEntry(40f, "Lương"));
-        entries.add(new PieEntry(25f, "Thưởng"));
-        entries.add(new PieEntry(15f, "Kinh doanh"));
-        entries.add(new PieEntry(20f, "Khác"));
+        for (ChartPoint point : data) {
+            entries.add(new PieEntry(point.getValue(), point.getLabel()));
+        }
 
         PieDataSet dataSet = new PieDataSet(entries, "");
         dataSet.setColors(
                 Color.parseColor("#4CAF50"),
                 Color.parseColor("#8BC34A"),
                 Color.parseColor("#CDDC39"),
-                Color.parseColor("#FFC107")
+                Color.parseColor("#FFC107"),
+                Color.parseColor("#AED581")
         );
 
         dataSet.setValueTextColor(Color.WHITE);
@@ -128,21 +185,128 @@
 
         pieChartIncome.setData(pieData);
         pieChartIncome.setUsePercentValues(true);
-
         pieChartIncome.setDrawHoleEnabled(true);
         pieChartIncome.setHoleRadius(40f);
         pieChartIncome.setTransparentCircleRadius(45f);
-
         pieChartIncome.getDescription().setEnabled(false);
 
         Legend legend = pieChartIncome.getLegend();
         legend.setTextColor(Color.WHITE);
         legend.setTextSize(12f);
 
+        pieChartIncome.animateY(500);
         pieChartIncome.invalidate();
     }
 
-    // ================== BOTTOM NAV ==================
+    private void showDateFilterDialog() {
+        String[] options = new String[]{
+                "7 ngày gần nhất",
+                "30 ngày gần nhất",
+                "Tháng này",
+                "Năm nay",
+                "Chọn ngày tùy chỉnh"
+        };
+
+        new AlertDialog.Builder(this)
+                .setTitle("Khoảng thời gian")
+                .setItems(options, (dialog, which) -> {
+                    switch (which) {
+                        case 0:
+                            applyFilter(StatisticFilter.lastDays(7));
+                            break;
+                        case 1:
+                            applyFilter(StatisticFilter.lastDays(30));
+                            break;
+                        case 2:
+                            applyFilter(StatisticFilter.currentMonth());
+                            break;
+                        case 3:
+                            applyFilter(StatisticFilter.yearToDate());
+                            break;
+                        case 4:
+                            showCustomRangePicker();
+                            break;
+                    }
+                })
+                .show();
+    }
+
+    private void showCustomRangePicker() {
+        Calendar now = Calendar.getInstance();
+        DatePickerDialog startPicker = new DatePickerDialog(
+                this,
+                (view, y, m, d) -> {
+                    Calendar start = Calendar.getInstance();
+                    start.set(y, m, d);
+                    showEndDatePicker(start);
+                },
+                now.get(Calendar.YEAR),
+                now.get(Calendar.MONTH),
+                now.get(Calendar.DAY_OF_MONTH)
+        );
+        startPicker.setTitle("Chọn ngày bắt đầu");
+        startPicker.show();
+    }
+
+    private void showEndDatePicker(Calendar start) {
+        Calendar now = Calendar.getInstance();
+        DatePickerDialog endPicker = new DatePickerDialog(
+                this,
+                (view, y, m, d) -> {
+                    Calendar end = Calendar.getInstance();
+                    end.set(y, m, d);
+                    applyFilter(StatisticFilter.custom(start, end, "Tùy chỉnh"));
+                },
+                now.get(Calendar.YEAR),
+                now.get(Calendar.MONTH),
+                now.get(Calendar.DAY_OF_MONTH)
+        );
+        endPicker.setTitle("Chọn ngày kết thúc");
+        endPicker.show();
+    }
+
+    private void showWalletFilterDialog() {
+        List<String> names = new ArrayList<>();
+        names.add("Tất cả ví");
+        for (WalletEntity wallet : walletOptions) {
+            names.add(wallet.name);
+        }
+
+        new AlertDialog.Builder(this)
+                .setTitle("Chọn ví")
+                .setItems(names.toArray(new String[0]), (dialog, which) -> {
+                    if (which == 0) {
+                        currentWalletLabel = "Tất cả ví";
+                        viewModel.applyWallet(TYPE_INCOME, null);
+                    } else {
+                        String selected = names.get(which);
+                        currentWalletLabel = selected;
+                        viewModel.applyWallet(TYPE_INCOME, selected);
+                    }
+                    tvWalletFilter.setText(currentWalletLabel);
+                })
+                .show();
+    }
+
+    private void applyFilter(StatisticFilter filter) {
+        updateFilterLabels(filter);
+        viewModel.applyFilter(TYPE_INCOME, filter);
+    }
+
+    private void updateFilterLabels(StatisticFilter filter) {
+        tvDateFilter.setText(filter.getDisplayLabel());
+        tvWalletFilter.setText(currentWalletLabel);
+    }
+
+    private void highlightTabs() {
+        tvIncomeTab.setTextColor(Color.WHITE);
+        tvIncomeTab.setTextSize(18f);
+        tvIncomeTab.setTypeface(tvIncomeTab.getTypeface(), android.graphics.Typeface.BOLD);
+
+        tvExpenseTab.setTextColor(Color.parseColor("#777777"));
+        tvExpenseTab.setTypeface(tvExpenseTab.getTypeface(), android.graphics.Typeface.NORMAL);
+    }
+
     private void setupBottomNav() {
         bottomNavigation.setSelectedItemId(R.id.nav_statistic);
 
Index: app/src/main/java/com/finmate/ui/activities/CategoryExpenseActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.activities;\r\n\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.view.View;\r\nimport android.widget.ImageView;\r\nimport android.widget.LinearLayout;\r\nimport android.widget.TextView;\r\n\r\nimport androidx.recyclerview.widget.GridLayoutManager;\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport com.finmate.R;\r\nimport com.finmate.ui.transaction.CategoryUIModel;\r\nimport com.finmate.ui.transaction.CategoryGridAdapter;\r\nimport com.finmate.ui.transaction.CategoryListAdapter;\r\nimport com.google.android.material.bottomsheet.BottomSheetDialog;\r\nimport com.finmate.ui.base.BaseActivity;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\npublic class CategoryExpenseActivity extends BaseActivity {\r\n\r\n    RecyclerView rvCategories;\r\n    List<CategoryUIModel> list = new ArrayList<>();\r\n\r\n    CategoryGridAdapter adapterGrid;\r\n    CategoryListAdapter adapterList;\r\n\r\n    boolean isGrid = true;\r\n\r\n    ImageView btnBack, btnMore;\r\n    TextView tabExpense, tabIncome;\r\n    LinearLayout layoutAddNew;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_category_expense);\r\n\r\n        initViews();\r\n        loadExpenseCategories();\r\n        showGrid();\r\n        setupEvents();\r\n    }\r\n\r\n    private void initViews() {\r\n        rvCategories = findViewById(R.id.rvCategories);\r\n        btnBack = findViewById(R.id.btnBack);\r\n        btnMore = findViewById(R.id.btnMore);\r\n        tabExpense = findViewById(R.id.tabExpense);\r\n        tabIncome = findViewById(R.id.tabIncome);\r\n        layoutAddNew = findViewById(R.id.layoutAddNew);\r\n    }\r\n\r\n    private void loadExpenseCategories() {\r\n        list.clear();\r\n        list.add(new CategoryUIModel(R.drawable.ic_food, \"Thực phẩm\"));\r\n        list.add(new CategoryUIModel(R.drawable.ic_eat, \"Chế độ ăn\"));\r\n        list.add(new CategoryUIModel(R.drawable.ic_travel, \"Di chuyển\"));\r\n        list.add(new CategoryUIModel(R.drawable.ic_fashion, \"Thời trang\"));\r\n        list.add(new CategoryUIModel(R.drawable.ic_drink, \"Chế độ uống\"));\r\n        list.add(new CategoryUIModel(R.drawable.ic_pet, \"Thú cưng\"));\r\n        list.add(new CategoryUIModel(R.drawable.ic_education, \"Giáo dục\"));\r\n        list.add(new CategoryUIModel(R.drawable.ic_health, \"Sức khỏe\"));\r\n        list.add(new CategoryUIModel(R.drawable.ic_trip, \"Du lịch\"));\r\n        list.add(new CategoryUIModel(R.drawable.ic_entertain, \"Giải trí\"));\r\n        list.add(new CategoryUIModel(R.drawable.ic_waterbill, \"Hóa đơn nước\"));\r\n        list.add(new CategoryUIModel(R.drawable.ic_electricbill, \"Hóa đơn điện\"));\r\n        list.add(new CategoryUIModel(R.drawable.ic_bill, \"Hóa đơn\"));\r\n        list.add(new CategoryUIModel(R.drawable.ic_gift, \"Quà tặng\"));\r\n    }\r\n\r\n    private void showGrid() {\r\n        isGrid = true;\r\n\r\n        rvCategories.setLayoutManager(new GridLayoutManager(this, 3));\r\n        adapterGrid = new CategoryGridAdapter(this, list);\r\n        rvCategories.setAdapter(adapterGrid);\r\n\r\n        highlightTabs();\r\n    }\r\n\r\n    private void showList() {\r\n        isGrid = false;\r\n\r\n        rvCategories.setLayoutManager(new LinearLayoutManager(this));\r\n        adapterList = new CategoryListAdapter(this, list);\r\n        rvCategories.setAdapter(adapterList);\r\n\r\n        highlightTabs();\r\n    }\r\n\r\n    private void highlightTabs() {\r\n        tabExpense.setBackgroundResource(R.drawable.tab_active_bg);\r\n        tabIncome.setBackgroundResource(R.drawable.tab_inactive_bg);\r\n        tabExpense.setTextColor(getColor(R.color.white));\r\n        tabIncome.setTextColor(getColor(R.color.gray));\r\n    }\r\n\r\n    private void setupEvents() {\r\n        btnBack.setOnClickListener(v -> finish());\r\n\r\n        tabIncome.setOnClickListener(v -> {\r\n            startActivity(new Intent(this, CategoryIncomeActivity.class));\r\n            finish();\r\n        });\r\n\r\n        btnMore.setOnClickListener(v -> showMoreMenu());\r\n        layoutAddNew.setOnClickListener(v -> showAddNewCategoryDialog());\r\n    }\r\n\r\n    private void showMoreMenu() {\r\n        BottomSheetDialog dialog = new BottomSheetDialog(this);\r\n        View view = getLayoutInflater().inflate(R.layout.bottom_sheet_category_options, null);\r\n\r\n        LinearLayout tvDelete = view.findViewById(R.id.tvDelete);\r\n        LinearLayout tvToggleView = view.findViewById(R.id.tvToggleView);\r\n        LinearLayout tvDuplicate = view.findViewById(R.id.tvDuplicate);\r\n        LinearLayout tvShare = view.findViewById(R.id.tvShare);\r\n        LinearLayout tvHelp = view.findViewById(R.id.tvHelp);\r\n\r\n        TextView txtToggle = view.findViewById(R.id.tvToggleText);\r\n\r\n        if (txtToggle != null)\r\n            txtToggle.setText(isGrid ? \"Dạng danh sách\" : \"Dạng lưới\");\r\n\r\n        tvToggleView.setOnClickListener(v -> {\r\n            if (isGrid) showList();\r\n            else showGrid();\r\n            dialog.dismiss();\r\n        });\r\n\r\n        tvDelete.setOnClickListener(v -> dialog.dismiss());\r\n        tvDuplicate.setOnClickListener(v -> dialog.dismiss());\r\n        tvShare.setOnClickListener(v -> dialog.dismiss());\r\n        tvHelp.setOnClickListener(v -> dialog.dismiss());\r\n\r\n        dialog.setContentView(view);\r\n        dialog.show();\r\n    }\r\n\r\n    private void showAddNewCategoryDialog() {\r\n        BottomSheetDialog dialog = new BottomSheetDialog(this);\r\n        View view = getLayoutInflater().inflate(R.layout.dialog_add_category, null);\r\n\r\n        TextView btnCancel = view.findViewById(R.id.btnCancel);\r\n        TextView btnSave = view.findViewById(R.id.btnSave);\r\n\r\n        btnCancel.setOnClickListener(v -> dialog.dismiss());\r\n        btnSave.setOnClickListener(v -> dialog.dismiss());\r\n\r\n        dialog.setContentView(view);\r\n        dialog.show();\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/activities/CategoryExpenseActivity.java b/app/src/main/java/com/finmate/ui/activities/CategoryExpenseActivity.java
--- a/app/src/main/java/com/finmate/ui/activities/CategoryExpenseActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/activities/CategoryExpenseActivity.java	(date 1765447595544)
@@ -12,6 +12,7 @@
 import androidx.recyclerview.widget.RecyclerView;
 
 import com.finmate.R;
+import com.finmate.ui.base.BaseActivity;
 import com.finmate.ui.transaction.CategoryUIModel;
 import com.finmate.ui.transaction.CategoryGridAdapter;
 import com.finmate.ui.transaction.CategoryListAdapter;
Index: app/src/main/java/com/finmate/ui/activities/CategoryIncomeActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.activities;\r\n\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.view.View;\r\nimport android.widget.ImageView;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.recyclerview.widget.GridLayoutManager;\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport com.finmate.R;\r\nimport com.finmate.ui.dialogs.AddCategoryDialog;\r\nimport com.finmate.ui.transaction.CategoryUIModel;\r\nimport com.finmate.ui.transaction.CategoryGridAdapter;\r\nimport com.finmate.ui.transaction.CategoryListAdapter;\r\nimport com.finmate.data.local.database.entity.CategoryEntity;\r\nimport com.finmate.data.repository.CategoryRepository;\r\nimport com.google.android.material.bottomsheet.BottomSheetDialog;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\nimport javax.inject.Inject;\r\n\r\npublic class CategoryIncomeActivity extends AppCompatActivity {\r\n\r\n    @Inject\r\n    CategoryRepository categoryRepository;\r\n\r\n    private RecyclerView rvCategories;\r\n    private CategoryGridAdapter gridAdapter;\r\n    private CategoryListAdapter listAdapter;\r\n\r\n    private List<CategoryUIModel> incomeList = new ArrayList<>();\r\n    private boolean isGrid = true;\r\n\r\n    private ImageView btnBack, btnMore;\r\n    private TextView tabExpense, tabIncome;\r\n    private View btnAddNew;\r\n\r\n    private CategoryRepository repo;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_category_income);\r\n\r\n        initViews();\r\n        setupGrid();      // mặc định dạng GRID\r\n        handleEvents();\r\n    }\r\n\r\n    @Override\r\n    protected void onResume() {\r\n        super.onResume();\r\n        loadCategoriesFromDB();\r\n    }\r\n\r\n    private void initViews() {\r\n        rvCategories = findViewById(R.id.rvCategories);\r\n\r\n        btnBack = findViewById(R.id.btnBack);\r\n        btnMore = findViewById(R.id.btnMore);\r\n\r\n        tabExpense = findViewById(R.id.tabExpense);\r\n        tabIncome = findViewById(R.id.tabIncome);\r\n\r\n        btnAddNew = findViewById(R.id.btnAddNewCategory);\r\n    }\r\n\r\n    private void loadCategoriesFromDB() {\r\n        repo.getByType(\"income\", entities -> {\r\n\r\n            List<CategoryUIModel> uiModels = new ArrayList<>();\r\n\r\n            for (CategoryEntity entity : entities) {\r\n                uiModels.add(new CategoryUIModel(entity.iconRes, entity.name));\r\n            }\r\n\r\n            runOnUiThread(() -> {\r\n                incomeList = uiModels;\r\n\r\n                if (isGrid && gridAdapter != null) {\r\n                    gridAdapter.updateList(uiModels);\r\n                } else if (!isGrid && listAdapter != null) {\r\n                    listAdapter.updateList(uiModels);\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    private void setupGrid() {\r\n        isGrid = true;\r\n\r\n        rvCategories.setLayoutManager(new GridLayoutManager(this, 3));\r\n        gridAdapter = new CategoryGridAdapter(this, incomeList);\r\n        rvCategories.setAdapter(gridAdapter);\r\n\r\n        highlightTabs();\r\n    }\r\n\r\n    private void setupList() {\r\n        isGrid = false;\r\n\r\n        rvCategories.setLayoutManager(new LinearLayoutManager(this));\r\n        listAdapter = new CategoryListAdapter(this, incomeList);\r\n        rvCategories.setAdapter(listAdapter);\r\n\r\n        highlightTabs();\r\n    }\r\n\r\n    private void highlightTabs() {\r\n        tabIncome.setBackgroundResource(R.drawable.tab_active_bg);\r\n        tabExpense.setBackgroundResource(R.drawable.tab_inactive_bg);\r\n\r\n        tabIncome.setTextColor(getColor(R.color.white));\r\n        tabExpense.setTextColor(getColor(R.color.black));\r\n    }\r\n\r\n    private void handleEvents() {\r\n\r\n        btnBack.setOnClickListener(v -> finish());\r\n\r\n        tabExpense.setOnClickListener(v -> {\r\n            startActivity(new Intent(this, CategoryExpenseActivity.class));\r\n            finish();\r\n        });\r\n\r\n        tabIncome.setOnClickListener(v -> { /* đang ở đây */ });\r\n\r\n        btnMore.setOnClickListener(v -> openBottomSheet());\r\n\r\n        btnAddNew.setOnClickListener(v -> openAddNewCategoryDialog());\r\n    }\r\n\r\n    private void openBottomSheet() {\r\n\r\n        BottomSheetDialog dialog = new BottomSheetDialog(this);\r\n        View view = getLayoutInflater().inflate(R.layout.bottom_sheet_category_options, null);\r\n\r\n        TextView tvDelete = view.findViewById(R.id.tvDelete);\r\n        TextView tvToggleView = view.findViewById(R.id.tvToggleView);\r\n        TextView tvDuplicate = view.findViewById(R.id.tvDuplicate);\r\n        TextView tvShare = view.findViewById(R.id.tvShare);\r\n        TextView tvHelp = view.findViewById(R.id.tvHelp);\r\n\r\n        // ⭐ Update text toggle đúng với chế độ hiện tại\r\n        if (isGrid) {\r\n            ((TextView) tvToggleView.findViewById(android.R.id.text1))\r\n                    .setText(\"Hiển thị dạng danh sách\");\r\n        } else {\r\n            ((TextView) tvToggleView.findViewById(android.R.id.text1))\r\n                    .setText(\"Hiển thị dạng lưới\");\r\n        }\r\n\r\n        // ⭐ Đổi chế độ GRID / LIST\r\n        tvToggleView.setOnClickListener(v -> {\r\n            if (isGrid) setupList();\r\n            else setupGrid();\r\n            dialog.dismiss();\r\n        });\r\n\r\n        tvDelete.setOnClickListener(v -> {\r\n            Toast.makeText(this, \"Chức năng xóa đang phát triển\", Toast.LENGTH_SHORT).show();\r\n            dialog.dismiss();\r\n        });\r\n\r\n        tvDuplicate.setOnClickListener(v -> {\r\n            Toast.makeText(this, \"Chức năng tạo bản sao đang phát triển\", Toast.LENGTH_SHORT).show();\r\n            dialog.dismiss();\r\n        });\r\n\r\n        tvShare.setOnClickListener(v -> {\r\n            Toast.makeText(this, \"Chia sẻ đang phát triển\", Toast.LENGTH_SHORT).show();\r\n            dialog.dismiss();\r\n        });\r\n\r\n        tvHelp.setOnClickListener(v -> {\r\n            Toast.makeText(this, \"Trợ giúp đang phát triển\", Toast.LENGTH_SHORT).show();\r\n            dialog.dismiss();\r\n        });\r\n\r\n        dialog.setContentView(view);\r\n        dialog.show();\r\n    }\r\n\r\n    private void openAddNewCategoryDialog() {\r\n\r\n        AddCategoryDialog dialog = new AddCategoryDialog(\r\n                this,\r\n                \"income\",\r\n                (name, type) -> saveCategory(name, type)\r\n        );\r\n\r\n        dialog.show();\r\n    }\r\n\r\n    private void saveCategory(String name, String type) {\r\n\r\n        CategoryEntity entity = new CategoryEntity(\r\n                name,\r\n                type,\r\n                R.drawable.ic_default_category\r\n        );\r\n\r\n        repo.insert(entity);\r\n\r\n        Toast.makeText(this, \"Đã thêm danh mục!\", Toast.LENGTH_SHORT).show();\r\n        loadCategoriesFromDB();\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/activities/CategoryIncomeActivity.java b/app/src/main/java/com/finmate/ui/activities/CategoryIncomeActivity.java
--- a/app/src/main/java/com/finmate/ui/activities/CategoryIncomeActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/activities/CategoryIncomeActivity.java	(date 1765447595544)
@@ -18,7 +18,7 @@
 import com.finmate.ui.transaction.CategoryGridAdapter;
 import com.finmate.ui.transaction.CategoryListAdapter;
 import com.finmate.data.local.database.entity.CategoryEntity;
-import com.finmate.data.repository.CategoryRepository;
+import com.finmate.data.repository.CategoryLocalRepository;
 import com.google.android.material.bottomsheet.BottomSheetDialog;
 
 import java.util.ArrayList;
@@ -26,10 +26,13 @@
 
 import javax.inject.Inject;
 
+import dagger.hilt.android.AndroidEntryPoint;
+
+@AndroidEntryPoint
 public class CategoryIncomeActivity extends AppCompatActivity {
 
     @Inject
-    CategoryRepository categoryRepository;
+    CategoryLocalRepository categoryRepository;
 
     private RecyclerView rvCategories;
     private CategoryGridAdapter gridAdapter;
@@ -42,8 +45,6 @@
     private TextView tabExpense, tabIncome;
     private View btnAddNew;
 
-    private CategoryRepository repo;
-
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
@@ -52,11 +53,6 @@
         initViews();
         setupGrid();      // mặc định dạng GRID
         handleEvents();
-    }
-
-    @Override
-    protected void onResume() {
-        super.onResume();
         loadCategoriesFromDB();
     }
 
@@ -73,24 +69,22 @@
     }
 
     private void loadCategoriesFromDB() {
-        repo.getByType("income", entities -> {
+        if (categoryRepository == null) return;
 
+        categoryRepository.getByType("income").observe(this, entities -> {
             List<CategoryUIModel> uiModels = new ArrayList<>();
-
             for (CategoryEntity entity : entities) {
-                uiModels.add(new CategoryUIModel(entity.iconRes, entity.name));
+                uiModels.add(new CategoryUIModel(entity.getIconRes(), entity.getName()));
             }
-
-            runOnUiThread(() -> {
-                incomeList = uiModels;
+            incomeList = uiModels;
 
-                if (isGrid && gridAdapter != null) {
-                    gridAdapter.updateList(uiModels);
-                } else if (!isGrid && listAdapter != null) {
-                    listAdapter.updateList(uiModels);
-                }
-            });
+            if (isGrid && gridAdapter != null) {
+                gridAdapter.updateList(uiModels);
+            } else if (!isGrid && listAdapter != null) {
+                listAdapter.updateList(uiModels);
+            }
         });
+        categoryRepository.fetchRemoteCategoriesByType("income");
     }
 
     private void setupGrid() {
@@ -207,7 +201,9 @@
                 R.drawable.ic_default_category
         );
 
-        repo.insert(entity);
+        if (categoryRepository != null) {
+            categoryRepository.insert(entity);
+        }
 
         Toast.makeText(this, "Đã thêm danh mục!", Toast.LENGTH_SHORT).show();
         loadCategoriesFromDB();
Index: app/src/main/java/com/finmate/ui/activities/FriendActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.activities;\r\n\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\n\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport com.finmate.R;\r\nimport com.finmate.ui.models.FriendUIModel;\r\nimport com.finmate.adapters.FriendAdapter;\r\nimport com.google.android.material.bottomnavigation.BottomNavigationView;\r\nimport com.finmate.ui.base.BaseActivity;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\npublic class FriendActivity extends BaseActivity {\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_friend);\r\n\r\n        // Nút Back\r\n        findViewById(R.id.btnBack).setOnClickListener(v -> finish());\r\n\r\n        // RecyclerView\r\n        RecyclerView rvFriends = findViewById(R.id.rvFriends);\r\n        rvFriends.setLayoutManager(new LinearLayoutManager(this));\r\n\r\n        // Sample data\r\n        List<FriendUIModel> friendList = new ArrayList<>();\r\n        friendList.add(new FriendUIModel(R.drawable.ic_friend, \"Bạn còn thiếu một chút tiền từ Nguyễn An\"));\r\n        friendList.add(new FriendUIModel(R.drawable.ic_friend, \"Nguyễn Văn B đã trả lại bạn 50,000 VND\"));\r\n        friendList.add(new FriendUIModel(R.drawable.ic_friend, \"Bạn đã nhắc nhở Trần Thị C trả tiền\"));\r\n        friendList.add(new FriendUIModel(R.drawable.ic_friend, \"Lê Văn D vừa gửi bạn một yêu cầu chia tiền\"));\r\n        friendList.add(new FriendUIModel(R.drawable.ic_friend, \"Bạn và Phạm Thị E đã hòa tiền\"));\r\n\r\n        FriendAdapter adapter = new FriendAdapter(this, friendList);\r\n        rvFriends.setAdapter(adapter);\r\n\r\n        // Bottom Navigation\r\n        BottomNavigationView bottomNav = findViewById(R.id.bottomNavigation);\r\n        bottomNav.setSelectedItemId(R.id.nav_settings);\r\n\r\n        bottomNav.setOnItemSelectedListener(item -> {\r\n            int id = item.getItemId();\r\n            if (id == R.id.nav_home) {\r\n                startActivity(new Intent(this, HomeActivity.class));\r\n            } else if (id == R.id.nav_wallet) {\r\n                startActivity(new Intent(this, WalletActivity.class));\r\n            } else if (id == R.id.nav_add) {\r\n                startActivity(new Intent(this, AddTransactionActivity.class));\r\n            } else if (id == R.id.nav_statistic) {\r\n                startActivity(new Intent(this, StatisticActivity.class));\r\n            } else if (id == R.id.nav_settings) {\r\n                startActivity(new Intent(this, SettingsActivity.class));\r\n            }\r\n            overridePendingTransition(android.R.anim.fade_in, android.R.anim.fade_out);\r\n            return true;\r\n        });\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/activities/FriendActivity.java b/app/src/main/java/com/finmate/ui/activities/FriendActivity.java
--- a/app/src/main/java/com/finmate/ui/activities/FriendActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/activities/FriendActivity.java	(date 1765447595546)
@@ -7,10 +7,13 @@
 import androidx.recyclerview.widget.RecyclerView;
 
 import com.finmate.R;
-import com.finmate.ui.models.FriendUIModel;
-import com.finmate.adapters.FriendAdapter;
+import com.finmate.ui.friend.FriendUIModel;
+import com.finmate.ui.friend.FriendAdapter;
 import com.google.android.material.bottomnavigation.BottomNavigationView;
 import com.finmate.ui.base.BaseActivity;
+import com.finmate.ui.home.WalletActivity;
+import com.finmate.ui.transaction.StatisticActivity;
+import com.finmate.ui.settings.SettingsActivity;
 
 import java.util.ArrayList;
 import java.util.List;
@@ -31,13 +34,13 @@
 
         // Sample data
         List<FriendUIModel> friendList = new ArrayList<>();
-        friendList.add(new FriendUIModel(R.drawable.ic_friend, "Bạn còn thiếu một chút tiền từ Nguyễn An"));
-        friendList.add(new FriendUIModel(R.drawable.ic_friend, "Nguyễn Văn B đã trả lại bạn 50,000 VND"));
-        friendList.add(new FriendUIModel(R.drawable.ic_friend, "Bạn đã nhắc nhở Trần Thị C trả tiền"));
-        friendList.add(new FriendUIModel(R.drawable.ic_friend, "Lê Văn D vừa gửi bạn một yêu cầu chia tiền"));
-        friendList.add(new FriendUIModel(R.drawable.ic_friend, "Bạn và Phạm Thị E đã hòa tiền"));
+        friendList.add(new FriendUIModel("1", "u1", "Nguyễn An", "an@example.com", "PENDING", true));
+        friendList.add(new FriendUIModel("2", "u2", "Nguyễn Văn B", "b@example.com", "ACCEPTED", false));
+        friendList.add(new FriendUIModel("3", "u3", "Trần Thị C", "c@example.com", "PENDING", true));
+        friendList.add(new FriendUIModel("4", "u4", "Lê Văn D", "d@example.com", "PENDING", true));
+        friendList.add(new FriendUIModel("5", "u5", "Phạm Thị E", "e@example.com", "ACCEPTED", false));
 
-        FriendAdapter adapter = new FriendAdapter(this, friendList);
+        FriendAdapter adapter = new FriendAdapter(friendList);
         rvFriends.setAdapter(adapter);
 
         // Bottom Navigation
Index: app/src/main/java/com/finmate/ui/settings/LanguageUIModel.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.settings;\r\n\r\npublic class LanguageUIModel {\r\n\r\n    private int flagResId;       // R.drawable lá cờ\r\n    private String name;         // \"Vietnamese\", \"English\"\r\n    private String code;         // \"vi\", \"en\"\r\n    private boolean selected;    // trạng thái đã chọn hay chưa\r\n\r\n    public LanguageUIModel(int flagResId, String name, String code, boolean selected) {\r\n        this.flagResId = flagResId;\r\n        this.name = name;\r\n        this.code = code;\r\n        this.selected = selected;\r\n    }\r\n\r\n    // Adapter dùng các hàm này ↓↓↓↓\r\n\r\n    public int getFlagResId() {\r\n        return flagResId;\r\n    }\r\n\r\n    public String getName() {\r\n        return name;\r\n    }\r\n\r\n    public String getCode() {\r\n        return code;\r\n    }\r\n\r\n    public boolean isSelected() {\r\n        return selected;\r\n    }\r\n\r\n    public void setSelected(boolean selected) {\r\n        this.selected = selected;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/settings/LanguageUIModel.java b/app/src/main/java/com/finmate/ui/settings/LanguageUIModel.java
--- a/app/src/main/java/com/finmate/ui/settings/LanguageUIModel.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/settings/LanguageUIModel.java	(date 1765447595556)
@@ -24,6 +24,11 @@
         return name;
     }
 
+    // Legacy adapter helpers
+    public String getLanguageName() {
+        return name;
+    }
+
     public String getCode() {
         return code;
     }
@@ -32,6 +37,10 @@
         return selected;
     }
 
+    public int getFlagRes() {
+        return flagResId;
+    }
+
     public void setSelected(boolean selected) {
         this.selected = selected;
     }
Index: app/src/main/java/com/finmate/ui/settings/LanguageAdapter.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.settings;\r\n\r\nimport android.content.Context;\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.widget.ImageView;\r\nimport android.widget.TextView;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport com.finmate.R;\r\nimport com.finmate.ui.models.LanguageUIModel;\r\n\r\nimport java.util.List;\r\n\r\npublic class LanguageAdapter extends RecyclerView.Adapter<LanguageAdapter.LanguageViewHolder> {\r\n\r\n    private final Context context;\r\n    private final List<LanguageUIModel> languageList;\r\n    private final OnItemClickListener listener;\r\n\r\n    public interface OnItemClickListener {\r\n        void onItemClick(int position);\r\n    }\r\n\r\n    public LanguageAdapter(Context context, List<LanguageUIModel> languageList, OnItemClickListener listener) {\r\n        this.context = context;\r\n        this.languageList = languageList;\r\n        this.listener = listener;\r\n    }\r\n\r\n    @NonNull\r\n    @Override\r\n    public LanguageViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\r\n        View view = LayoutInflater\r\n                .from(parent.getContext())\r\n                .inflate(R.layout.item_language, parent, false);\r\n\r\n        return new LanguageViewHolder(view);\r\n    }\r\n\r\n    @Override\r\n    public void onBindViewHolder(@NonNull LanguageViewHolder holder, int position) {\r\n        LanguageUIModel language = languageList.get(position);\r\n\r\n        // Set tên + icon quốc kỳ\r\n        holder.tvLanguageName.setText(language.getName());\r\n        holder.imgFlag.setImageResource(language.getFlagResId());\r\n\r\n        // Hiện hoặc ẩn tick\r\n        holder.ivCheckmark.setVisibility(language.isSelected() ? View.VISIBLE : View.GONE);\r\n\r\n        // Bắt sự kiện click\r\n        holder.itemView.setOnClickListener(v -> {\r\n            if (listener != null) listener.onItemClick(position);\r\n        });\r\n    }\r\n\r\n    @Override\r\n    public int getItemCount() {\r\n        return (languageList != null) ? languageList.size() : 0;\r\n    }\r\n\r\n    public static class LanguageViewHolder extends RecyclerView.ViewHolder {\r\n        ImageView imgFlag, ivCheckmark;\r\n        TextView tvLanguageName;\r\n\r\n        public LanguageViewHolder(@NonNull View itemView) {\r\n            super(itemView);\r\n            imgFlag = itemView.findViewById(R.id.imgFlag);\r\n            tvLanguageName = itemView.findViewById(R.id.tvLanguageName);\r\n            ivCheckmark = itemView.findViewById(R.id.ivCheckmark);\r\n        }\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/settings/LanguageAdapter.java b/app/src/main/java/com/finmate/ui/settings/LanguageAdapter.java
--- a/app/src/main/java/com/finmate/ui/settings/LanguageAdapter.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/settings/LanguageAdapter.java	(date 1765447595555)
@@ -11,15 +11,15 @@
 import androidx.recyclerview.widget.RecyclerView;
 
 import com.finmate.R;
-import com.finmate.ui.models.LanguageUIModel;
 
 import java.util.List;
 
 public class LanguageAdapter extends RecyclerView.Adapter<LanguageAdapter.LanguageViewHolder> {
 
-    private final Context context;
-    private final List<LanguageUIModel> languageList;
-    private final OnItemClickListener listener;
+    private Context context;
+    private List<LanguageUIModel> languageList;
+    private OnItemClickListener listener;
+    private int selectedPosition = -1;
 
     public interface OnItemClickListener {
         void onItemClick(int position);
@@ -30,37 +30,44 @@
         this.languageList = languageList;
         this.listener = listener;
     }
+    
+    public void setSelectedPosition(int position) {
+        int oldPosition = selectedPosition;
+        selectedPosition = position;
+        if (oldPosition != -1) notifyItemChanged(oldPosition);
+        if (selectedPosition != -1) notifyItemChanged(selectedPosition);
+    }
 
     @NonNull
     @Override
     public LanguageViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
-        View view = LayoutInflater
-                .from(parent.getContext())
-                .inflate(R.layout.item_language, parent, false);
-
+        View view = LayoutInflater.from(context).inflate(R.layout.item_language, parent, false);
         return new LanguageViewHolder(view);
     }
 
     @Override
     public void onBindViewHolder(@NonNull LanguageViewHolder holder, int position) {
         LanguageUIModel language = languageList.get(position);
+        holder.tvLanguageName.setText(language.getLanguageName());
+        holder.imgFlag.setImageResource(language.getFlagRes());
 
-        // Set tên + icon quốc kỳ
-        holder.tvLanguageName.setText(language.getName());
-        holder.imgFlag.setImageResource(language.getFlagResId());
+        if (position == selectedPosition) {
+            holder.ivCheckmark.setVisibility(View.VISIBLE);
+        } else {
+            holder.ivCheckmark.setVisibility(View.GONE);
+        }
 
-        // Hiện hoặc ẩn tick
-        holder.ivCheckmark.setVisibility(language.isSelected() ? View.VISIBLE : View.GONE);
-
-        // Bắt sự kiện click
         holder.itemView.setOnClickListener(v -> {
-            if (listener != null) listener.onItemClick(position);
+            setSelectedPosition(position);
+            if (listener != null) {
+                listener.onItemClick(position);
+            }
         });
     }
 
     @Override
     public int getItemCount() {
-        return (languageList != null) ? languageList.size() : 0;
+        return languageList.size();
     }
 
     public static class LanguageViewHolder extends RecyclerView.ViewHolder {
Index: app/src/main/java/com/finmate/ui/friend/FriendViewModel.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.friend;\r\n\r\nimport androidx.lifecycle.LiveData;\r\nimport androidx.lifecycle.MutableLiveData;\r\nimport androidx.lifecycle.ViewModel;\r\n\r\nimport com.finmate.core.network.ApiCallback;\r\nimport com.finmate.data.dto.FriendResponse;\r\nimport com.finmate.data.repository.FriendRemoteRepository;\r\nimport com.finmate.ui.friend.FriendUIModel;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\nimport javax.inject.Inject;\r\n\r\nimport dagger.hilt.android.lifecycle.HiltViewModel;\r\n\r\n@HiltViewModel\r\npublic class FriendViewModel extends ViewModel {\r\n\r\n    private final FriendRemoteRepository friendRemoteRepository;\r\n\r\n    private final MutableLiveData<List<FriendUIModel>> _friends = new MutableLiveData<>(new ArrayList<>());\r\n    public LiveData<List<FriendUIModel>> friends = _friends;\r\n\r\n    private final MutableLiveData<Boolean> _loading = new MutableLiveData<>(false);\r\n    public LiveData<Boolean> loading = _loading;\r\n\r\n    private final MutableLiveData<String> _error = new MutableLiveData<>();\r\n    public LiveData<String> error = _error;\r\n\r\n    @Inject\r\n    public FriendViewModel(FriendRemoteRepository friendRemoteRepository) {\r\n        this.friendRemoteRepository = friendRemoteRepository;\r\n    }\r\n\r\n    public void loadFriends() {\r\n        _loading.postValue(true);\r\n\r\n        friendRemoteRepository.getFriends(new ApiCallback<List<FriendResponse>>() {\r\n            @Override\r\n            public void onSuccess(List<FriendResponse> body) {\r\n                List<FriendUIModel> ui = new ArrayList<>();\r\n                if (body != null) {\r\n                    for (FriendResponse dto : body) {\r\n                        ui.add(new FriendUIModel(\r\n                                dto.getId(),\r\n                                dto.getFriendUserId(),\r\n                                dto.getFriendName(),\r\n                                dto.getFriendEmail(),\r\n                                dto.getStatus(),\r\n                                dto.isIncoming()\r\n                        ));\r\n                    }\r\n                }\r\n                _friends.postValue(ui);\r\n                _loading.postValue(false);\r\n            }\r\n\r\n            @Override\r\n            public void onError(String message) {\r\n                _error.postValue(message);\r\n                _loading.postValue(false);\r\n            }\r\n        });\r\n    }\r\n\r\n    public void sendRequest(String email) {\r\n        _loading.postValue(true);\r\n        friendRemoteRepository.sendRequest(email, new ApiCallback<Void>() {\r\n            @Override\r\n            public void onSuccess(Void body) {\r\n                // gửi xong, reload list\r\n                loadFriends();\r\n            }\r\n\r\n            @Override\r\n            public void onError(String message) {\r\n                _error.postValue(message);\r\n                _loading.postValue(false);\r\n            }\r\n        });\r\n    }\r\n\r\n    public void accept(String friendshipId) {\r\n        _loading.postValue(true);\r\n        friendRemoteRepository.accept(friendshipId, new ApiCallback<Void>() {\r\n            @Override\r\n            public void onSuccess(Void body) {\r\n                loadFriends();\r\n            }\r\n\r\n            @Override\r\n            public void onError(String message) {\r\n                _error.postValue(message);\r\n                _loading.postValue(false);\r\n            }\r\n        });\r\n    }\r\n\r\n    public void reject(String friendshipId) {\r\n        _loading.postValue(true);\r\n        friendRemoteRepository.reject(friendshipId, new ApiCallback<Void>() {\r\n            @Override\r\n            public void onSuccess(Void body) {\r\n                loadFriends();\r\n            }\r\n\r\n            @Override\r\n            public void onError(String message) {\r\n                _error.postValue(message);\r\n                _loading.postValue(false);\r\n            }\r\n        });\r\n    }\r\n\r\n    public void remove(String friendshipId) {\r\n        _loading.postValue(true);\r\n        friendRemoteRepository.remove(friendshipId, new ApiCallback<Void>() {\r\n            @Override\r\n            public void onSuccess(Void body) {\r\n                loadFriends();\r\n            }\r\n\r\n            @Override\r\n            public void onError(String message) {\r\n                _error.postValue(message);\r\n                _loading.postValue(false);\r\n            }\r\n        });\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/friend/FriendViewModel.java b/app/src/main/java/com/finmate/ui/friend/FriendViewModel.java
--- a/app/src/main/java/com/finmate/ui/friend/FriendViewModel.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/friend/FriendViewModel.java	(date 1765447595553)
@@ -4,10 +4,9 @@
 import androidx.lifecycle.MutableLiveData;
 import androidx.lifecycle.ViewModel;
 
-import com.finmate.core.network.ApiCallback;
 import com.finmate.data.dto.FriendResponse;
+import com.finmate.data.remote.api.ApiCallback;
 import com.finmate.data.repository.FriendRemoteRepository;
-import com.finmate.ui.friend.FriendUIModel;
 
 import java.util.ArrayList;
 import java.util.List;
@@ -59,7 +58,7 @@
             }
 
             @Override
-            public void onError(String message) {
+            public void onError(String message, Integer code) {
                 _error.postValue(message);
                 _loading.postValue(false);
             }
@@ -76,7 +75,7 @@
             }
 
             @Override
-            public void onError(String message) {
+            public void onError(String message, Integer code) {
                 _error.postValue(message);
                 _loading.postValue(false);
             }
@@ -92,7 +91,7 @@
             }
 
             @Override
-            public void onError(String message) {
+            public void onError(String message, Integer code) {
                 _error.postValue(message);
                 _loading.postValue(false);
             }
@@ -108,7 +107,7 @@
             }
 
             @Override
-            public void onError(String message) {
+            public void onError(String message, Integer code) {
                 _error.postValue(message);
                 _loading.postValue(false);
             }
@@ -124,7 +123,7 @@
             }
 
             @Override
-            public void onError(String message) {
+            public void onError(String message, Integer code) {
                 _error.postValue(message);
                 _loading.postValue(false);
             }
Index: app/src/main/java/com/finmate/ui/splash/SplashViewModel.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.splash;\r\n\r\nimport androidx.lifecycle.LiveData;\r\nimport androidx.lifecycle.MutableLiveData;\r\nimport androidx.lifecycle.ViewModel;\r\n\r\nimport com.finmate.data.repository.AuthRepository;\r\n\r\nimport javax.inject.Inject;\r\n\r\nimport dagger.hilt.android.lifecycle.HiltViewModel;\r\n\r\n@HiltViewModel\r\npublic class SplashViewModel extends ViewModel {\r\n\r\n    private final AuthRepository authRepository;\r\n\r\n    private final MutableLiveData<Boolean> _isLoggedIn = new MutableLiveData<>();\r\n    public LiveData<Boolean> isLoggedIn = _isLoggedIn;\r\n\r\n    @Inject\r\n    public SplashViewModel(AuthRepository authRepository) {\r\n        this.authRepository = authRepository;\r\n        checkLoginStatus();\r\n    }\r\n\r\n    private void checkLoginStatus() {\r\n        authRepository.checkLoginStatus(new AuthRepository.LoginCallback() {\r\n            @Override\r\n            public void onSuccess() {\r\n                _isLoggedIn.postValue(true);\r\n            }\r\n\r\n            @Override\r\n            public void onError(String message) {\r\n                _isLoggedIn.postValue(false);\r\n            }\r\n        });\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/splash/SplashViewModel.java b/app/src/main/java/com/finmate/ui/splash/SplashViewModel.java
--- a/app/src/main/java/com/finmate/ui/splash/SplashViewModel.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/splash/SplashViewModel.java	(date 1765447595556)
@@ -9,6 +9,10 @@
 import javax.inject.Inject;
 
 import dagger.hilt.android.lifecycle.HiltViewModel;
+import io.reactivex.rxjava3.android.schedulers.AndroidSchedulers;
+import io.reactivex.rxjava3.core.Single;
+import io.reactivex.rxjava3.schedulers.Schedulers;
+import java.util.concurrent.TimeUnit;
 
 @HiltViewModel
 public class SplashViewModel extends ViewModel {
@@ -25,16 +29,13 @@
     }
 
     private void checkLoginStatus() {
-        authRepository.checkLoginStatus(new AuthRepository.LoginCallback() {
-            @Override
-            public void onSuccess() {
-                _isLoggedIn.postValue(true);
-            }
-
-            @Override
-            public void onError(String message) {
-                _isLoggedIn.postValue(false);
-            }
-        });
+        authRepository.checkLoginStatus()
+                .timeout(3, TimeUnit.SECONDS) // Timeout sau 3 giây để tránh ANR
+                .subscribeOn(Schedulers.io()) // Chạy trên background thread
+                .observeOn(AndroidSchedulers.mainThread()) // Nhận kết quả trên main thread
+                .subscribe(
+                        isLoggedIn -> _isLoggedIn.postValue(isLoggedIn),
+                        error -> _isLoggedIn.postValue(false) // Nếu lỗi hoặc timeout, coi như chưa đăng nhập
+                );
     }
 }
Index: app/src/main/java/com/finmate/ui/splash/SplashActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.splash;\r\n\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\n\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.lifecycle.ViewModelProvider;\r\n\r\nimport com.finmate.ui.auth.LoginActivity;\r\n\r\nimport dagger.hilt.android.AndroidEntryPoint;\r\n\r\n@AndroidEntryPoint\r\npublic class SplashActivity extends AppCompatActivity {\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n\r\n        SplashViewModel viewModel = new ViewModelProvider(this).get(SplashViewModel.class);\r\n\r\n        viewModel.isLoggedIn.observe(this, isLoggedIn -> {\r\n            if (isLoggedIn) {\r\n                startActivity(new Intent(SplashActivity.this, HomeActivity.class));\r\n            } else {\r\n                startActivity(new Intent(SplashActivity.this, LoginActivity.class));\r\n            }\r\n            finish();\r\n        });\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/splash/SplashActivity.java b/app/src/main/java/com/finmate/ui/splash/SplashActivity.java
--- a/app/src/main/java/com/finmate/ui/splash/SplashActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/splash/SplashActivity.java	(date 1765447595556)
@@ -6,7 +6,9 @@
 import androidx.appcompat.app.AppCompatActivity;
 import androidx.lifecycle.ViewModelProvider;
 
+import com.finmate.R;
 import com.finmate.ui.auth.LoginActivity;
+import com.finmate.ui.home.HomeActivity;
 
 import dagger.hilt.android.AndroidEntryPoint;
 
@@ -16,6 +18,7 @@
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
+        setContentView(R.layout.activity_splash);
 
         SplashViewModel viewModel = new ViewModelProvider(this).get(SplashViewModel.class);
 
Index: gradle.properties
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+># Project-wide Gradle settings.\r\n# IDE (e.g. Android Studio) users:\r\n# Gradle settings configured through the IDE *will override*\r\n# any settings specified in this file.\r\n# For more details on how to configure your build environment visit\r\n# http://www.gradle.org/docs/current/userguide/build_environment.html\r\n# Specifies the JVM arguments used for the daemon process.\r\n# The setting is particularly useful for tweaking memory settings.\r\norg.gradle.jvmargs=-Xmx2048m -Dfile.encoding=UTF-8\r\n# When configured, Gradle will run in incubating parallel mode.\r\n# This option should only be used with decoupled projects. For more details, visit\r\n# https://developer.android.com/r/tools/gradle-multi-project-decoupled-projects\r\n# org.gradle.parallel=true\r\n# AndroidX package structure to make it clearer which packages are bundled with the\r\n# Android operating system, and which are packaged with your app's APK\r\n# https://developer.android.com/topic/libraries/support-library/androidx-rn\r\nandroid.useAndroidX=true\r\n# Enables namespacing of each library's R class so that its R class includes only the\r\n# resources declared in the library itself and none from the library's dependencies,\r\n# thereby reducing the size of the R class for that library\r\nandroid.nonTransitiveRClass=true
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>ISO-8859-1
===================================================================
diff --git a/gradle.properties b/gradle.properties
--- a/gradle.properties	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/gradle.properties	(date 1765447595567)
@@ -18,4 +18,5 @@
 # Enables namespacing of each library's R class so that its R class includes only the
 # resources declared in the library itself and none from the library's dependencies,
 # thereby reducing the size of the R class for that library
-android.nonTransitiveRClass=true
\ No newline at end of file
+android.nonTransitiveRClass=true
+org.gradle.configuration-cache=true
\ No newline at end of file
Index: app/src/main/java/com/finmate/ui/activities/HomeActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.activities;\r\n\r\nimport android.content.Intent;\r\nimport android.graphics.Color;\r\nimport android.os.Bundle;\r\nimport android.widget.ImageView;\r\nimport android.widget.PopupMenu;\r\nimport android.widget.Toast;\r\nimport com.finmate.ui.base.BaseActivity;\r\nimport androidx.appcompat.app.AlertDialog;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport com.finmate.R;\r\nimport com.finmate.adapters.TransactionAdapter;\r\nimport com.finmate.ui.models.TransactionUIModel;\r\nimport com.finmate.entities.TransactionEntity;\r\nimport com.finmate.data.repository.TransactionRepository;\r\nimport com.github.mikephil.charting.charts.LineChart;\r\nimport com.github.mikephil.charting.components.Legend;\r\nimport com.github.mikephil.charting.components.XAxis;\r\nimport com.github.mikephil.charting.components.YAxis;\r\nimport com.github.mikephil.charting.data.Entry;\r\nimport com.github.mikephil.charting.data.LineData;\r\nimport com.github.mikephil.charting.data.LineDataSet;\r\nimport com.google.android.material.bottomnavigation.BottomNavigationView;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport com.finmate.R;\r\n\r\npublic class HomeActivity extends BaseActivity {\r\n\r\n    private LineChart lineChart;\r\n    private BottomNavigationView bottomNavigation;\r\n    private RecyclerView rvTransactions;\r\n\r\n    private TransactionAdapter transactionAdapter;\r\n    private List<TransactionUIModel> transactionList;\r\n\r\n    private TransactionRepository repository;\r\n\r\n    private ImageView btnMenuMore;  // MENU 3 CHẤM\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_home);\r\n\r\n        repository = new TransactionRepository(this);\r\n\r\n        mapViews();\r\n        setupMenuMore();         // <–– Thêm MENU 3 CHẤM\r\n        setupChart();\r\n        setupBottomNavigation();\r\n        setupRecyclerView();\r\n        loadTransactionsFromDB();\r\n    }\r\n\r\n    private void mapViews() {\r\n        lineChart = findViewById(R.id.lineChart);\r\n        bottomNavigation = findViewById(R.id.bottomNavigation);\r\n        rvTransactions = findViewById(R.id.rvTransactions);\r\n        btnMenuMore = findViewById(R.id.btnMenuMore); // ánh xạ nút 3 chấm\r\n\r\n        bottomNavigation.setSelectedItemId(R.id.nav_home);\r\n    }\r\n\r\n    // =======================================\r\n    // \uD83D\uDE80 MENU 3 CHẤM: CHỌN VÍ – THÊM VÍ\r\n    // =======================================\r\n    private void setupMenuMore() {\r\n        btnMenuMore.setOnClickListener(v -> {\r\n            PopupMenu popup = new PopupMenu(HomeActivity.this, btnMenuMore);\r\n            popup.getMenuInflater().inflate(R.menu.menu_wallet_options, popup.getMenu());\r\n\r\n            popup.setOnMenuItemClickListener(item -> {\r\n                int id = item.getItemId();\r\n\r\n                if (id == R.id.action_choose_wallet) {\r\n                    openChooseWalletDialog();\r\n                    return true;\r\n                }\r\n\r\n                if (id == R.id.action_add_wallet) {\r\n                    startActivity(new Intent(HomeActivity.this, AddWalletActivity.class));\r\n                    return true;\r\n                }\r\n\r\n                return false;\r\n            });\r\n\r\n            popup.show();\r\n        });\r\n    }\r\n\r\n    private void openChooseWalletDialog() {\r\n        // Tạm thời dùng dữ liệu mẫu\r\n        String[] wallets = {\"Ví của tôi\", \"Ví ngân hàng\", \"Ví tiền mặt\"};\r\n\r\n        AlertDialog.Builder builder = new AlertDialog.Builder(this);\r\n        builder.setTitle(\"Chọn ví\");\r\n\r\n        builder.setItems(wallets, (dialog, which) -> {\r\n            Toast.makeText(this, \"Đã chọn: \" + wallets[which], Toast.LENGTH_SHORT).show();\r\n        });\r\n\r\n        builder.show();\r\n    }\r\n\r\n    // =======================================\r\n    // \uD83D\uDE80 LOAD DATA TRANSACTION\r\n    // =======================================\r\n    private void loadTransactionsFromDB() {\r\n        repository.getAll(entities -> {\r\n            List<TransactionUIModel> uiList = new ArrayList<>();\r\n\r\n            for (TransactionEntity e : entities) {\r\n                uiList.add(new TransactionUIModel(\r\n                        e.name,\r\n                        e.category,\r\n                        e.amount,\r\n                        e.wallet,\r\n                        e.date\r\n                ));\r\n            }\r\n\r\n            runOnUiThread(() -> {\r\n                transactionList.clear();\r\n                transactionList.addAll(uiList);\r\n                transactionAdapter.notifyDataSetChanged();\r\n            });\r\n        });\r\n    }\r\n\r\n    // =======================================\r\n    // \uD83D\uDE80 RECYCLERVIEW\r\n    // =======================================\r\n    private void setupRecyclerView() {\r\n        transactionList = new ArrayList<>();\r\n        transactionAdapter = new TransactionAdapter(transactionList);\r\n\r\n        rvTransactions.setLayoutManager(new LinearLayoutManager(this));\r\n        rvTransactions.setAdapter(transactionAdapter);\r\n    }\r\n\r\n    @Override\r\n    protected void onResume() {\r\n        super.onResume();\r\n        loadTransactionsFromDB();\r\n    }\r\n\r\n    // =======================================\r\n    // \uD83D\uDE80 BIỂU ĐỒ\r\n    // =======================================\r\n    private void setupChart() {\r\n        ArrayList<Entry> income = new ArrayList<>();\r\n        ArrayList<Entry> expense = new ArrayList<>();\r\n\r\n        income.add(new Entry(1, 60));\r\n        income.add(new Entry(2, 80));\r\n        income.add(new Entry(3, 90));\r\n        expense.add(new Entry(1, 20));\r\n        expense.add(new Entry(2, 40));\r\n        expense.add(new Entry(3, 35));\r\n\r\n        LineDataSet incomeSet = new LineDataSet(income, \"Thu nhập\");\r\n        incomeSet.setColor(Color.GREEN);\r\n        incomeSet.setCircleColor(Color.GREEN);\r\n\r\n        LineDataSet expenseSet = new LineDataSet(expense, \"Chi tiêu\");\r\n        expenseSet.setColor(Color.RED);\r\n        expenseSet.setCircleColor(Color.RED);\r\n\r\n        LineData data = new LineData(incomeSet, expenseSet);\r\n        lineChart.setData(data);\r\n\r\n        XAxis xAxis = lineChart.getXAxis();\r\n        xAxis.setTextColor(Color.WHITE);\r\n        xAxis.setPosition(XAxis.XAxisPosition.BOTTOM);\r\n\r\n        YAxis leftAxis = lineChart.getAxisLeft();\r\n        leftAxis.setTextColor(Color.WHITE);\r\n\r\n        lineChart.getAxisRight().setEnabled(false);\r\n        lineChart.getDescription().setEnabled(false);\r\n\r\n        Legend legend = lineChart.getLegend();\r\n        legend.setTextColor(Color.WHITE);\r\n\r\n        lineChart.animateY(800);\r\n    }\r\n\r\n    // =======================================\r\n    // \uD83D\uDE80 NAVIGATION\r\n    // =======================================\r\n    private void setupBottomNavigation() {\r\n        bottomNavigation.setOnNavigationItemSelectedListener(item -> {\r\n            Intent intent = null;\r\n\r\n            if (item.getItemId() == R.id.nav_home) {\r\n                return true;\r\n            } else if (item.getItemId() == R.id.nav_wallet) {\r\n                intent = new Intent(this, WalletActivity.class);\r\n            } else if (item.getItemId() == R.id.nav_add) {\r\n                intent = new Intent(this, AddTransactionActivity.class);\r\n            } else if (item.getItemId() == R.id.nav_statistic) {\r\n                intent = new Intent(this, StatisticActivity.class);\r\n            } else if (item.getItemId() == R.id.nav_settings) {\r\n                intent = new Intent(this, SettingsActivity.class);\r\n            }\r\n\r\n            if (intent != null) startActivity(intent);\r\n            return true;\r\n        });\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/activities/HomeActivity.java b/app/src/main/java/com/finmate/ui/activities/HomeActivity.java
--- a/app/src/main/java/com/finmate/ui/activities/HomeActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/activities/HomeActivity.java	(date 1765447595546)
@@ -8,15 +8,18 @@
 import android.widget.Toast;
 import com.finmate.ui.base.BaseActivity;
 import androidx.appcompat.app.AlertDialog;
-import androidx.appcompat.app.AppCompatActivity;
 import androidx.recyclerview.widget.LinearLayoutManager;
 import androidx.recyclerview.widget.RecyclerView;
 
 import com.finmate.R;
-import com.finmate.adapters.TransactionAdapter;
-import com.finmate.ui.models.TransactionUIModel;
-import com.finmate.entities.TransactionEntity;
-import com.finmate.data.repository.TransactionRepository;
+import com.finmate.core.util.TransactionFormatter;
+import com.finmate.data.local.database.entity.TransactionEntity;
+import com.finmate.data.repository.TransactionLocalRepository;
+import com.finmate.ui.home.WalletActivity;
+import com.finmate.ui.settings.SettingsActivity;
+import com.finmate.ui.transaction.StatisticActivity;
+import com.finmate.ui.transaction.TransactionAdapter;
+import com.finmate.ui.transaction.TransactionUIModel;
 import com.github.mikephil.charting.charts.LineChart;
 import com.github.mikephil.charting.components.Legend;
 import com.github.mikephil.charting.components.XAxis;
@@ -29,11 +32,6 @@
 import java.util.ArrayList;
 import java.util.List;
 
-import androidx.recyclerview.widget.LinearLayoutManager;
-import androidx.recyclerview.widget.RecyclerView;
-
-import com.finmate.R;
-
 public class HomeActivity extends BaseActivity {
 
     private LineChart lineChart;
@@ -43,7 +41,7 @@
     private TransactionAdapter transactionAdapter;
     private List<TransactionUIModel> transactionList;
 
-    private TransactionRepository repository;
+    private TransactionLocalRepository repository;
 
     private ImageView btnMenuMore;  // MENU 3 CHẤM
 
@@ -52,7 +50,7 @@
         super.onCreate(savedInstanceState);
         setContentView(R.layout.activity_home);
 
-        repository = new TransactionRepository(this);
+        repository = new TransactionLocalRepository(getApplicationContext());
 
         mapViews();
         setupMenuMore();         // <–– Thêm MENU 3 CHẤM
@@ -121,12 +119,14 @@
             List<TransactionUIModel> uiList = new ArrayList<>();
 
             for (TransactionEntity e : entities) {
+                String amount = TransactionFormatter.formatAmount(e.getAmount());
+                String date = TransactionFormatter.formatDate(e.getOccurredAt());
                 uiList.add(new TransactionUIModel(
-                        e.name,
-                        e.category,
-                        e.amount,
-                        e.wallet,
-                        e.date
+                        e.getName(),
+                        e.getCategoryName(),
+                        amount,
+                        e.getWalletName(),
+                        date
                 ));
             }
 
Index: app/src/main/java/com/finmate/ui/activities/AddTransactionActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.activities;\r\n\r\nimport android.app.DatePickerDialog;\r\nimport android.graphics.Color;\r\nimport android.os.Bundle;\r\nimport android.text.Editable;\r\nimport android.text.TextWatcher;\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.widget.Button;\r\nimport android.widget.EditText;\r\nimport android.widget.LinearLayout;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\nimport com.finmate.ui.base.BaseActivity;\r\n\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport com.finmate.R;\r\nimport com.google.android.material.bottomsheet.BottomSheetDialog;\r\n\r\nimport java.util.Calendar;\r\n\r\npublic class AddTransactionActivity extends BaseActivity {\r\n\r\n    EditText etCategory, etTitle, etAmount, tvFriend, etNote;\r\n    TextView tvDate;\r\n    Button btnCancel, btnSave;\r\n\r\n    String selectedGroup = \"\";\r\n\r\n    // Ngày\r\n    String startDate = \"\";\r\n    String endDate = \"\";\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_add_transaction);\r\n\r\n        initViews();\r\n        setupEditTextColor();\r\n        setupEvents();\r\n    }\r\n\r\n    private void initViews() {\r\n        etCategory = findViewById(R.id.etCategory);\r\n        etTitle    = findViewById(R.id.etTitle);\r\n        etAmount   = findViewById(R.id.etAmount);\r\n        tvFriend   = findViewById(R.id.tvFriend);\r\n        tvDate     = findViewById(R.id.tvDate);\r\n        etNote     = findViewById(R.id.etNote);\r\n\r\n        btnCancel  = findViewById(R.id.btnCancel);\r\n        btnSave    = findViewById(R.id.btnSave);\r\n    }\r\n\r\n    // ============================================\r\n    // MÀU TEXT: Trống = trắng / Có chữ = đen\r\n    // ============================================\r\n    private void setupEditTextColor() {\r\n        applyWatcher(etCategory);\r\n        applyWatcher(etTitle);\r\n        applyWatcher(etAmount);\r\n        applyWatcher(tvFriend);\r\n        applyWatcher(etNote);\r\n    }\r\n\r\n    private void applyWatcher(EditText editText) {\r\n        editText.addTextChangedListener(new TextWatcher() {\r\n            @Override public void beforeTextChanged(CharSequence s, int start, int count, int after) {}\r\n\r\n            @Override\r\n            public void onTextChanged(CharSequence s, int start, int before, int count) {\r\n                if (s.length() == 0)\r\n                    editText.setTextColor(Color.WHITE);\r\n                else\r\n                    editText.setTextColor(Color.BLACK);\r\n            }\r\n\r\n            @Override public void afterTextChanged(Editable s) {}\r\n        });\r\n    }\r\n\r\n    private void setupEvents() {\r\n\r\n        etCategory.setOnClickListener(v -> showGroupBottomSheet());\r\n\r\n        etTitle.setOnClickListener(v -> {\r\n            if (selectedGroup.isEmpty()) {\r\n                Toast.makeText(this, \"Hãy chọn nhóm giao dịch trước!\", Toast.LENGTH_SHORT).show();\r\n                return;\r\n            }\r\n            showCategoryItemsBottomSheet();\r\n        });\r\n\r\n        tvFriend.setOnClickListener(v -> showFriendBottomSheet());\r\n\r\n        // Chọn ngày\r\n        tvDate.setOnClickListener(v -> showDueDateBottomSheet());\r\n\r\n        btnCancel.setOnClickListener(v -> finish());\r\n\r\n        btnSave.setOnClickListener(v -> saveTransaction());\r\n    }\r\n\r\n    // ================================\r\n    // 1) BottomSheet: Chọn nhóm\r\n    // ================================\r\n    private void showGroupBottomSheet() {\r\n\r\n        BottomSheetDialog dialog = new BottomSheetDialog(this);\r\n        View view = LayoutInflater.from(this).inflate(R.layout.bottom_sheet_group, null);\r\n\r\n        TextView tvIncome  = view.findViewById(R.id.tvIncomeGroup);\r\n        TextView tvExpense = view.findViewById(R.id.tvExpenseGroup);\r\n\r\n        tvIncome.setOnClickListener(v -> {\r\n            selectedGroup = \"Thu nhập\";\r\n            etCategory.setText(selectedGroup);\r\n            etTitle.setText(\"\");\r\n            dialog.dismiss();\r\n        });\r\n\r\n        tvExpense.setOnClickListener(v -> {\r\n            selectedGroup = \"Chi tiêu\";\r\n            etCategory.setText(selectedGroup);\r\n            etTitle.setText(\"\");\r\n            dialog.dismiss();\r\n        });\r\n\r\n        dialog.setContentView(view);\r\n        dialog.show();\r\n    }\r\n\r\n    // ================================\r\n    // 2) BottomSheet: Mục con\r\n    // ================================\r\n    private void showCategoryItemsBottomSheet() {\r\n\r\n        BottomSheetDialog dialog = new BottomSheetDialog(this);\r\n        View view = LayoutInflater.from(this).inflate(R.layout.bottom_sheet_category_items, null);\r\n\r\n        LinearLayout container = view.findViewById(R.id.layoutCategoryItems);\r\n        container.removeAllViews();\r\n\r\n        String[] items;\r\n\r\n        if (selectedGroup.equals(\"Thu nhập\")) {\r\n            items = new String[]{\"Lương\", \"Thưởng\", \"Phụ cấp\", \"Bán hàng\", \"Khác\"};\r\n        } else {\r\n            items = new String[]{\"Ăn uống\", \"Mua sắm\", \"Đi lại\", \"Hóa đơn\", \"Khác\"};\r\n        }\r\n\r\n        for (String item : items) {\r\n            TextView tv = new TextView(this);\r\n            tv.setText(item);\r\n            tv.setTextSize(17);\r\n            tv.setPadding(32, 32, 32, 32);\r\n            tv.setTextColor(Color.WHITE);\r\n            tv.setBackgroundResource(android.R.drawable.list_selector_background);\r\n\r\n            tv.setOnClickListener(v -> {\r\n                etTitle.setText(item);\r\n                dialog.dismiss();\r\n            });\r\n\r\n            container.addView(tv);\r\n        }\r\n\r\n        dialog.setContentView(view);\r\n        dialog.show();\r\n    }\r\n\r\n    // ================================\r\n    // 3) BottomSheet: Danh sách bạn\r\n    // ================================\r\n    private void showFriendBottomSheet() {\r\n\r\n        BottomSheetDialog dialog = new BottomSheetDialog(this);\r\n        View view = LayoutInflater.from(this).inflate(R.layout.bottom_sheet_friends, null);\r\n\r\n        LinearLayout container = view.findViewById(R.id.layoutFriendItems);\r\n        TextView tvNone = view.findViewById(R.id.tvFriendNone);\r\n\r\n        container.removeAllViews();\r\n\r\n        String[] friends = new String[]{\r\n                \"Nguyễn Văn A\",\r\n                \"Trần Minh Hiếu\",\r\n                \"Lê Thị B\",\r\n                \"Ngô Quốc C\",\r\n                \"Phạm Hoàng D\"\r\n        };\r\n\r\n        for (String f : friends) {\r\n            TextView tv = new TextView(this);\r\n            tv.setText(f);\r\n            tv.setTextSize(17);\r\n            tv.setPadding(32, 32, 32, 32);\r\n            tv.setTextColor(Color.WHITE);\r\n            tv.setBackgroundResource(android.R.drawable.list_selector_background);\r\n\r\n            tv.setOnClickListener(v -> {\r\n                tvFriend.setText(f);\r\n                dialog.dismiss();\r\n            });\r\n\r\n            container.addView(tv);\r\n        }\r\n\r\n        tvNone.setOnClickListener(v -> {\r\n            tvFriend.setText(\"\");\r\n            dialog.dismiss();\r\n        });\r\n\r\n        dialog.setContentView(view);\r\n        dialog.show();\r\n    }\r\n\r\n    // ================================\r\n    // 4) BottomSheet: Chọn ngày\r\n    // ================================\r\n    private void showDueDateBottomSheet() {\r\n\r\n        BottomSheetDialog dialog = new BottomSheetDialog(this);\r\n        View view = LayoutInflater.from(this).inflate(R.layout.bottom_sheet_due_date, null);\r\n\r\n        TextView tvToday  = view.findViewById(R.id.tvDueToday);\r\n        TextView tvSingle = view.findViewById(R.id.tvDueSingle);\r\n        TextView tvRange  = view.findViewById(R.id.tvDueRange);\r\n        TextView tvClear  = view.findViewById(R.id.tvDueClear);\r\n\r\n        // 1) Trong ngày\r\n        tvToday.setOnClickListener(v -> {\r\n            Calendar c = Calendar.getInstance();\r\n            int y = c.get(Calendar.YEAR);\r\n            int m = c.get(Calendar.MONTH) + 1;\r\n            int d = c.get(Calendar.DAY_OF_MONTH);\r\n\r\n            tvDate.setText(d + \"/\" + m + \"/\" + y);\r\n            tvDate.setTextColor(Color.BLACK);\r\n            dialog.dismiss();\r\n        });\r\n\r\n        // 2) Chọn 1 ngày\r\n        tvSingle.setOnClickListener(v -> {\r\n            dialog.dismiss();\r\n            showSingleDatePicker();\r\n        });\r\n\r\n        // 3) Chọn từ → đến\r\n        tvRange.setOnClickListener(v -> {\r\n            dialog.dismiss();\r\n            showStartDatePicker();\r\n        });\r\n\r\n        // 4) Xóa\r\n        tvClear.setOnClickListener(v -> {\r\n            tvDate.setText(\"Đến hạn\");\r\n            tvDate.setTextColor(Color.GRAY);\r\n            startDate = \"\";\r\n            endDate = \"\";\r\n            dialog.dismiss();\r\n        });\r\n\r\n        dialog.setContentView(view);\r\n        dialog.show();\r\n    }\r\n\r\n    // 1 NGÀY\r\n    private void showSingleDatePicker() {\r\n        Calendar c = Calendar.getInstance();\r\n\r\n        DatePickerDialog picker = new DatePickerDialog(\r\n                this,\r\n                (view, y, m, d) -> {\r\n                    tvDate.setText(d + \"/\" + (m + 1) + \"/\" + y);\r\n                    tvDate.setTextColor(Color.BLACK);\r\n                },\r\n                c.get(Calendar.YEAR),\r\n                c.get(Calendar.MONTH),\r\n                c.get(Calendar.DAY_OF_MONTH)\r\n        );\r\n\r\n        picker.setTitle(\"Chọn ngày\");\r\n        picker.show();\r\n    }\r\n\r\n    // CHỌN TỪ NGÀY\r\n    private void showStartDatePicker() {\r\n\r\n        Calendar c = Calendar.getInstance();\r\n\r\n        DatePickerDialog picker = new DatePickerDialog(\r\n                this,\r\n                (view, y, m, d) -> {\r\n                    startDate = d + \"/\" + (m + 1) + \"/\" + y;\r\n                    showEndDatePicker();\r\n                },\r\n                c.get(Calendar.YEAR),\r\n                c.get(Calendar.MONTH),\r\n                c.get(Calendar.DAY_OF_MONTH)\r\n        );\r\n\r\n        picker.setTitle(\"Chọn ngày bắt đầu\");\r\n        picker.show();\r\n    }\r\n\r\n    // CHỌN ĐẾN NGÀY\r\n    private void showEndDatePicker() {\r\n\r\n        Calendar c = Calendar.getInstance();\r\n\r\n        DatePickerDialog picker = new DatePickerDialog(\r\n                this,\r\n                (view, y, m, d) -> {\r\n                    endDate = d + \"/\" + (m + 1) + \"/\" + y;\r\n\r\n                    tvDate.setText(startDate + \" → \" + endDate);\r\n                    tvDate.setTextColor(Color.BLACK);\r\n                },\r\n                c.get(Calendar.YEAR),\r\n                c.get(Calendar.MONTH),\r\n                c.get(Calendar.DAY_OF_MONTH)\r\n        );\r\n\r\n        picker.setTitle(\"Chọn ngày kết thúc\");\r\n        picker.show();\r\n    }\r\n\r\n    // ================================\r\n    // 5) Lưu giao dịch\r\n    // ================================\r\n    private void saveTransaction() {\r\n\r\n        String group  = etCategory.getText().toString().trim();\r\n        String title  = etTitle.getText().toString().trim();\r\n        String amount = etAmount.getText().toString().trim();\r\n\r\n        if (group.isEmpty() || title.isEmpty() || amount.isEmpty()) {\r\n            Toast.makeText(this, \"Vui lòng nhập đầy đủ thông tin!\", Toast.LENGTH_SHORT).show();\r\n            return;\r\n        }\r\n\r\n        Toast.makeText(this, \"Đã lưu giao dịch!\", Toast.LENGTH_SHORT).show();\r\n        finish();\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/activities/AddTransactionActivity.java b/app/src/main/java/com/finmate/ui/activities/AddTransactionActivity.java
--- a/app/src/main/java/com/finmate/ui/activities/AddTransactionActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/activities/AddTransactionActivity.java	(date 1765447595540)
@@ -14,22 +14,37 @@
 import android.widget.Toast;
 import com.finmate.ui.base.BaseActivity;
 
-import androidx.appcompat.app.AppCompatActivity;
+import androidx.annotation.Nullable;
 
 import com.finmate.R;
+import com.finmate.core.util.NetworkUtils;
+import com.finmate.core.util.TransactionFormatter;
+import com.finmate.data.local.database.entity.TransactionEntity;
+import com.finmate.data.repository.TransactionLocalRepository;
+import com.finmate.data.repository.TransactionSyncManager;
 import com.google.android.material.bottomsheet.BottomSheetDialog;
 
+import java.text.ParseException;
 import java.util.Calendar;
 
+import javax.inject.Inject;
+
+import dagger.hilt.android.AndroidEntryPoint;
+
+@AndroidEntryPoint
 public class AddTransactionActivity extends BaseActivity {
 
+    @Inject
+    TransactionLocalRepository localRepository;
+    @Inject
+    TransactionSyncManager syncManager;
+
     EditText etCategory, etTitle, etAmount, tvFriend, etNote;
     TextView tvDate;
     Button btnCancel, btnSave;
 
     String selectedGroup = "";
 
-    // Ngày
     String startDate = "";
     String endDate = "";
 
@@ -43,6 +58,61 @@
         setupEvents();
     }
 
+    private void saveTransaction() {
+        String group = etCategory.getText().toString().trim();
+        String title = etTitle.getText().toString().trim();
+        String amountInput = etAmount.getText().toString().trim();
+        String dateDisplay = tvDate.getText().toString().trim();
+        String wallet = "Ví của tôi";
+
+        if (group.isEmpty() || title.isEmpty() || amountInput.isEmpty()) {
+            Toast.makeText(this, "Vui lòng nhập đầy đủ thông tin!", Toast.LENGTH_SHORT).show();
+            return;
+        }
+
+        // Parse amount từ String input → double
+        double amount;
+        try {
+            amount = TransactionFormatter.parseAmount(amountInput);
+        } catch (NumberFormatException e) {
+            Toast.makeText(this, "Số tiền không hợp lệ!", Toast.LENGTH_SHORT).show();
+            return;
+        }
+
+        // Convert date từ display format (dd/MM/yyyy) → ISO format
+        String occurredAt;
+        try {
+            if (dateDisplay.isEmpty() || dateDisplay.equals("Đến hạn")) {
+                // Nếu chưa chọn date, dùng ngày hiện tại
+                Calendar c = Calendar.getInstance();
+                occurredAt = TransactionFormatter.calendarToISO(
+                        c.get(Calendar.YEAR),
+                        c.get(Calendar.MONTH) + 1,
+                        c.get(Calendar.DAY_OF_MONTH)
+                );
+            } else {
+                // Parse từ format hiển thị (dd/MM/yyyy) sang ISO
+                occurredAt = TransactionFormatter.parseDateToISO(dateDisplay);
+            }
+        } catch (ParseException e) {
+            Toast.makeText(this, "Ngày không hợp lệ!", Toast.LENGTH_SHORT).show();
+            return;
+        }
+
+        TransactionEntity transaction = new TransactionEntity(title, group, amount, wallet, occurredAt);
+        localRepository.insert(transaction);
+
+        if (NetworkUtils.isOnline(this)) {
+            syncManager.syncPendingTransactions();
+            Toast.makeText(this, "Đã lưu, đang đồng bộ…", Toast.LENGTH_SHORT).show();
+        } else {
+            Toast.makeText(this, "Lưu tạm (offline)!", Toast.LENGTH_SHORT).show();
+        }
+        finish();
+    }
+
+    // ... (the rest of the methods are unchanged)
+
     private void initViews() {
         etCategory = findViewById(R.id.etCategory);
         etTitle    = findViewById(R.id.etTitle);
@@ -55,9 +125,6 @@
         btnSave    = findViewById(R.id.btnSave);
     }
 
-    // ============================================
-    // MÀU TEXT: Trống = trắng / Có chữ = đen
-    // ============================================
     private void setupEditTextColor() {
         applyWatcher(etCategory);
         applyWatcher(etTitle);
@@ -96,7 +163,6 @@
 
         tvFriend.setOnClickListener(v -> showFriendBottomSheet());
 
-        // Chọn ngày
         tvDate.setOnClickListener(v -> showDueDateBottomSheet());
 
         btnCancel.setOnClickListener(v -> finish());
@@ -104,9 +170,6 @@
         btnSave.setOnClickListener(v -> saveTransaction());
     }
 
-    // ================================
-    // 1) BottomSheet: Chọn nhóm
-    // ================================
     private void showGroupBottomSheet() {
 
         BottomSheetDialog dialog = new BottomSheetDialog(this);
@@ -133,9 +196,6 @@
         dialog.show();
     }
 
-    // ================================
-    // 2) BottomSheet: Mục con
-    // ================================
     private void showCategoryItemsBottomSheet() {
 
         BottomSheetDialog dialog = new BottomSheetDialog(this);
@@ -172,9 +232,6 @@
         dialog.show();
     }
 
-    // ================================
-    // 3) BottomSheet: Danh sách bạn
-    // ================================
     private void showFriendBottomSheet() {
 
         BottomSheetDialog dialog = new BottomSheetDialog(this);
@@ -218,9 +275,6 @@
         dialog.show();
     }
 
-    // ================================
-    // 4) BottomSheet: Chọn ngày
-    // ================================
     private void showDueDateBottomSheet() {
 
         BottomSheetDialog dialog = new BottomSheetDialog(this);
@@ -231,7 +285,6 @@
         TextView tvRange  = view.findViewById(R.id.tvDueRange);
         TextView tvClear  = view.findViewById(R.id.tvDueClear);
 
-        // 1) Trong ngày
         tvToday.setOnClickListener(v -> {
             Calendar c = Calendar.getInstance();
             int y = c.get(Calendar.YEAR);
@@ -243,19 +296,16 @@
             dialog.dismiss();
         });
 
-        // 2) Chọn 1 ngày
         tvSingle.setOnClickListener(v -> {
             dialog.dismiss();
             showSingleDatePicker();
         });
 
-        // 3) Chọn từ → đến
         tvRange.setOnClickListener(v -> {
             dialog.dismiss();
             showStartDatePicker();
         });
 
-        // 4) Xóa
         tvClear.setOnClickListener(v -> {
             tvDate.setText("Đến hạn");
             tvDate.setTextColor(Color.GRAY);
@@ -268,7 +318,6 @@
         dialog.show();
     }
 
-    // 1 NGÀY
     private void showSingleDatePicker() {
         Calendar c = Calendar.getInstance();
 
@@ -287,7 +336,6 @@
         picker.show();
     }
 
-    // CHỌN TỪ NGÀY
     private void showStartDatePicker() {
 
         Calendar c = Calendar.getInstance();
@@ -307,7 +355,6 @@
         picker.show();
     }
 
-    // CHỌN ĐẾN NGÀY
     private void showEndDatePicker() {
 
         Calendar c = Calendar.getInstance();
@@ -328,22 +375,4 @@
         picker.setTitle("Chọn ngày kết thúc");
         picker.show();
     }
-
-    // ================================
-    // 5) Lưu giao dịch
-    // ================================
-    private void saveTransaction() {
-
-        String group  = etCategory.getText().toString().trim();
-        String title  = etTitle.getText().toString().trim();
-        String amount = etAmount.getText().toString().trim();
-
-        if (group.isEmpty() || title.isEmpty() || amount.isEmpty()) {
-            Toast.makeText(this, "Vui lòng nhập đầy đủ thông tin!", Toast.LENGTH_SHORT).show();
-            return;
-        }
-
-        Toast.makeText(this, "Đã lưu giao dịch!", Toast.LENGTH_SHORT).show();
-        finish();
-    }
 }
Index: app/src/main/java/com/finmate/ui/activities/LanguageSettingActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.ui.activities;\r\n\r\nimport android.content.Intent;\r\nimport android.content.SharedPreferences;\r\nimport android.os.Bundle;\r\nimport android.widget.ImageView;\r\nimport android.widget.LinearLayout;\r\n\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport com.finmate.R;\r\nimport com.google.android.material.bottomnavigation.BottomNavigationView;\r\n\r\nimport java.util.Locale;\r\n\r\npublic class LanguageSettingActivity extends AppCompatActivity {\r\n\r\n    ImageView btnBack;\r\n    LinearLayout btnVietnamese, btnEnglish;\r\n    BottomNavigationView bottomNavigation;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n\r\n        // ⭐ Load ngôn ngữ trước khi setContentView\r\n        loadLanguage();\r\n\r\n        setContentView(R.layout.activity_language_settings);\r\n\r\n        // ÁNH XẠ\r\n        btnBack = findViewById(R.id.btnBack);\r\n        btnVietnamese = findViewById(R.id.btnVietnamese);\r\n        btnEnglish = findViewById(R.id.btnEnglish);\r\n        bottomNavigation = findViewById(R.id.bottomNavigation);\r\n\r\n        // QUAY LẠI\r\n        btnBack.setOnClickListener(v -> finish());\r\n\r\n        // ================= CHỌN TIẾNG VIỆT =================\r\n        btnVietnamese.setOnClickListener(v -> {\r\n            saveLanguage(\"vi\");\r\n            restartApp();\r\n        });\r\n\r\n        // ================= CHỌN ENGLISH =================\r\n        btnEnglish.setOnClickListener(v -> {\r\n            saveLanguage(\"en\");\r\n            restartApp();\r\n        });\r\n\r\n\r\n    }\r\n\r\n    // ==================================================\r\n    // ⭐ LƯU NGÔN NGỮ VÀO SharedPreferences\r\n    // ==================================================\r\n    private void saveLanguage(String lang) {\r\n        SharedPreferences.Editor editor =\r\n                getSharedPreferences(\"settings\", MODE_PRIVATE).edit();\r\n\r\n        editor.putString(\"language\", lang);\r\n        editor.apply();\r\n    }\r\n\r\n    // ==================================================\r\n    // ⭐ ÁP DỤNG NGÔN NGỮ KHI MỞ ACTIVITY\r\n    // ==================================================\r\n    private void loadLanguage() {\r\n        SharedPreferences prefs = getSharedPreferences(\"settings\", MODE_PRIVATE);\r\n        String lang = prefs.getString(\"language\", \"vi\");\r\n\r\n        Locale newLocale = new Locale(lang);\r\n        Locale.setDefault(newLocale);\r\n\r\n        android.content.res.Configuration config =\r\n                new android.content.res.Configuration();\r\n\r\n        config.setLocale(newLocale);\r\n\r\n        getResources().updateConfiguration(\r\n                config,\r\n                getResources().getDisplayMetrics()\r\n        );\r\n    }\r\n\r\n    // ==================================================\r\n    // ⭐ RESTART APP SAU KHI ĐỔI NGÔN NGỮ\r\n    // ==================================================\r\n    private void restartApp() {\r\n        Intent intent = new Intent(this, SettingsActivity.class);\r\n        intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP |\r\n                Intent.FLAG_ACTIVITY_NEW_TASK |\r\n                Intent.FLAG_ACTIVITY_CLEAR_TASK);\r\n\r\n        startActivity(intent);\r\n        overridePendingTransition(android.R.anim.fade_in, android.R.anim.fade_out);\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/activities/LanguageSettingActivity.java b/app/src/main/java/com/finmate/ui/activities/LanguageSettingActivity.java
--- a/app/src/main/java/com/finmate/ui/activities/LanguageSettingActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/activities/LanguageSettingActivity.java	(date 1765447595546)
@@ -9,6 +9,7 @@
 import androidx.appcompat.app.AppCompatActivity;
 
 import com.finmate.R;
+import com.finmate.ui.settings.SettingsActivity;
 import com.google.android.material.bottomnavigation.BottomNavigationView;
 
 import java.util.Locale;
Index: app/src/main/AndroidManifest.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    package=\"com.finmate\">\r\n\r\n    <uses-permission android:name=\"android.permission.INTERNET\" />\r\n\r\n    <application\r\n        android:name=\".MainApplication\"\r\n        android:allowBackup=\"true\"\r\n        android:dataExtractionRules=\"@xml/data_extraction_rules\"\r\n        android:fullBackupContent=\"@xml/backup_rules\"\r\n        android:icon=\"@mipmap/ic_launcher\"\r\n        android:label=\"@string/app_name\"\r\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\r\n        android:supportsRtl=\"true\"\r\n        android:theme=\"@style/Theme.FinMate\"\r\n        tools:targetApi=\"31\">\r\n\r\n        <!-- Màn hình Splash (Launcher) -->\r\n        <activity\r\n            android:name=\".ui.splash.SplashActivity\"\r\n            android:exported=\"true\">\r\n            <intent-filter>\r\n                <action android:name=\"android.intent.action.MAIN\" />\r\n                <category android:name=\"android.intent.category.LAUNCHER\" />\r\n            </intent-filter>\r\n        </activity>\r\n\r\n        <!-- Màn hình Auth -->\r\n        <activity android:name=\".ui.auth.LoginActivity\" android:exported=\"false\" />\r\n        <activity android:name=\".ui.auth.SignUpActivity\" android:exported=\"false\" />\r\n\r\n        <!-- Home -->\r\n        <activity android:name=\".ui.home.HomeActivity\" android:exported=\"false\" />\r\n\r\n        <!-- ======= CÁC MÀN HÌNH KHÁC (Vẫn ở package cũ chưa move) ======= -->\r\n        <activity android:name=\".ui.activities.SettingsActivity\" android:exported=\"false\" />\r\n        <activity android:name=\".ui.friend.FriendActivity\" android:exported=\"false\" />\r\n        <activity android:name=\".ui.home.WalletActivity\" android:exported=\"false\" />\r\n        <activity android:name=\".ui.activities.AccountActivity\" android:exported=\"false\" />\r\n        <activity android:name=\".ui.activities.StatisticActivity\" android:exported=\"false\" />\r\n        <activity android:name=\".ui.activities.AddTransactionActivity\" android:exported=\"false\" />\r\n        <activity android:name=\".ui.activities.CategoryIncomeActivity\" android:exported=\"false\" />\r\n        <activity android:name=\".ui.activities.CategoryExpenseActivity\" android:exported=\"false\" />\r\n        <activity android:name=\".ui.activities.IncomeStatisticActivity\" android:exported=\"false\" />\r\n        <activity android:name=\".ui.activities.LanguageSettingActivity\" android:exported=\"false\" />\r\n        <activity android:name=\".ui.activities.AddWalletActivity\" android:exported=\"false\" />\r\n\r\n    </application>\r\n\r\n</manifest>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml
--- a/app/src/main/AndroidManifest.xml	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/AndroidManifest.xml	(date 1765447595493)
@@ -1,7 +1,6 @@
 <?xml version="1.0" encoding="utf-8"?>
 <manifest xmlns:android="http://schemas.android.com/apk/res/android"
-    xmlns:tools="http://schemas.android.com/tools"
-    package="com.finmate">
+    xmlns:tools="http://schemas.android.com/tools">
 
     <uses-permission android:name="android.permission.INTERNET" />
 
@@ -12,6 +11,7 @@
         android:fullBackupContent="@xml/backup_rules"
         android:icon="@mipmap/ic_launcher"
         android:label="@string/app_name"
+        android:networkSecurityConfig="@xml/network_security_config"
         android:roundIcon="@mipmap/ic_launcher_round"
         android:supportsRtl="true"
         android:theme="@style/Theme.FinMate"
@@ -35,11 +35,11 @@
         <activity android:name=".ui.home.HomeActivity" android:exported="false" />
 
         <!-- ======= CÁC MÀN HÌNH KHÁC (Vẫn ở package cũ chưa move) ======= -->
-        <activity android:name=".ui.activities.SettingsActivity" android:exported="false" />
+        <activity android:name=".ui.settings.SettingsActivity" android:exported="false" />
         <activity android:name=".ui.friend.FriendActivity" android:exported="false" />
         <activity android:name=".ui.home.WalletActivity" android:exported="false" />
-        <activity android:name=".ui.activities.AccountActivity" android:exported="false" />
-        <activity android:name=".ui.activities.StatisticActivity" android:exported="false" />
+        <activity android:name=".ui.auth.AccountActivity" android:exported="false" />
+        <activity android:name=".ui.transaction.StatisticActivity" android:exported="false" />
         <activity android:name=".ui.activities.AddTransactionActivity" android:exported="false" />
         <activity android:name=".ui.activities.CategoryIncomeActivity" android:exported="false" />
         <activity android:name=".ui.activities.CategoryExpenseActivity" android:exported="false" />
Index: app/src/main/java/com/finmate/core/network/ApiCallExecutor.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.core.network;\r\n\r\nimport androidx.annotation.NonNull;\r\n\r\nimport com.finmate.data.dto.TokenResponse;\r\nimport com.finmate.data.repository.AuthRepository;\r\n\r\nimport javax.inject.Inject;\r\nimport javax.inject.Singleton;\r\n\r\nimport retrofit2.Call;\r\nimport retrofit2.Callback;\r\nimport retrofit2.Response;\r\n\r\n@Singleton\r\npublic class ApiCallExecutor {\r\n\r\n    private final AuthRepository authRepository;\r\n\r\n    @Inject\r\n    public ApiCallExecutor(AuthRepository authRepository) {\r\n        this.authRepository = authRepository;\r\n    }\r\n\r\n    public <T> void execute(Call<T> call, ApiCallback<T> callback) {\r\n        executeInternal(call, callback, false);\r\n    }\r\n\r\n    private <T> void executeInternal(Call<T> call,\r\n                                     ApiCallback<T> callback,\r\n                                     boolean isRetry) {\r\n\r\n        call.enqueue(new Callback<T>() {\r\n            @Override\r\n            public void onResponse(@NonNull Call<T> call,\r\n                                   @NonNull Response<T> response) {\r\n\r\n                if (response.isSuccessful()) {\r\n                    callback.onSuccess(response.body());\r\n                    return;\r\n                }\r\n\r\n                if (response.code() == 401 && !isRetry) {\r\n                    authRepository.refreshToken(new AuthRepository.RefreshCallback() {\r\n                        @Override\r\n                        public void onSuccess() {\r\n                            Call<T> retryCall = call.clone();\r\n                            executeInternal(retryCall, callback, true);\r\n                        }\r\n\r\n                        @Override\r\n                        public void onError(String message) {\r\n                            callback.onError(\"Refresh token failed: \" + message);\r\n                        }\r\n                    });\r\n                    return;\r\n                }\r\n\r\n                callback.onError(\"Request failed: \" + response.code());\r\n            }\r\n\r\n            @Override\r\n            public void onFailure(@NonNull Call<T> call,\r\n                                  @NonNull Throwable t) {\r\n                callback.onError(t.getMessage());\r\n            }\r\n        });\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/core/network/ApiCallExecutor.java b/app/src/main/java/com/finmate/core/network/ApiCallExecutor.java
--- a/app/src/main/java/com/finmate/core/network/ApiCallExecutor.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/core/network/ApiCallExecutor.java	(date 1765447595493)
@@ -2,8 +2,7 @@
 
 import androidx.annotation.NonNull;
 
-import com.finmate.data.dto.TokenResponse;
-import com.finmate.data.repository.AuthRepository;
+import com.finmate.data.remote.api.ApiCallback;
 
 import javax.inject.Inject;
 import javax.inject.Singleton;
@@ -15,54 +14,24 @@
 @Singleton
 public class ApiCallExecutor {
 
-    private final AuthRepository authRepository;
-
     @Inject
-    public ApiCallExecutor(AuthRepository authRepository) {
-        this.authRepository = authRepository;
+    public ApiCallExecutor() {
     }
 
     public <T> void execute(Call<T> call, ApiCallback<T> callback) {
-        executeInternal(call, callback, false);
-    }
-
-    private <T> void executeInternal(Call<T> call,
-                                     ApiCallback<T> callback,
-                                     boolean isRetry) {
-
         call.enqueue(new Callback<T>() {
             @Override
-            public void onResponse(@NonNull Call<T> call,
-                                   @NonNull Response<T> response) {
-
+            public void onResponse(@NonNull Call<T> call, @NonNull Response<T> response) {
                 if (response.isSuccessful()) {
                     callback.onSuccess(response.body());
-                    return;
+                } else {
+                    callback.onError("Request failed: " + response.code(), response.code());
                 }
-
-                if (response.code() == 401 && !isRetry) {
-                    authRepository.refreshToken(new AuthRepository.RefreshCallback() {
-                        @Override
-                        public void onSuccess() {
-                            Call<T> retryCall = call.clone();
-                            executeInternal(retryCall, callback, true);
-                        }
+            }
 
-                        @Override
-                        public void onError(String message) {
-                            callback.onError("Refresh token failed: " + message);
-                        }
-                    });
-                    return;
-                }
-
-                callback.onError("Request failed: " + response.code());
-            }
-
             @Override
-            public void onFailure(@NonNull Call<T> call,
-                                  @NonNull Throwable t) {
-                callback.onError(t.getMessage());
+            public void onFailure(@NonNull Call<T> call, @NonNull Throwable t) {
+                callback.onError(t.getMessage(), null);
             }
         });
     }
Index: app/src/main/java/com/finmate/core/network/interceptor/AuthInterceptor.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.core.network.interceptor;\r\n\r\nimport androidx.annotation.NonNull;\r\n\r\nimport com.finmate.core.session.SessionManager;\r\n\r\nimport java.io.IOException;\r\n\r\nimport javax.inject.Inject;\r\n\r\nimport okhttp3.Interceptor;\r\nimport okhttp3.Request;\r\nimport okhttp3.Response;\r\n\r\npublic class AuthInterceptor implements Interceptor {\r\n\r\n    private final SessionManager sessionManager;\r\n\r\n    @Inject\r\n    public AuthInterceptor(SessionManager sessionManager) {\r\n        this.sessionManager = sessionManager;\r\n    }\r\n\r\n    @NonNull\r\n    @Override\r\n    public Response intercept(@NonNull Chain chain) throws IOException {\r\n\r\n        String token = sessionManager.getAccessToken();\r\n        Request request = chain.request();\r\n\r\n        // Không add token cho các API auth\r\n        if (token != null && !request.url().encodedPath().startsWith(\"/auth\")) {\r\n            request = request.newBuilder()\r\n                    .addHeader(\"Authorization\", \"Bearer \" + token)\r\n                    .build();\r\n        }\r\n\r\n        return chain.proceed(request);\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/core/network/interceptor/AuthInterceptor.java b/app/src/main/java/com/finmate/core/network/interceptor/AuthInterceptor.java
--- a/app/src/main/java/com/finmate/core/network/interceptor/AuthInterceptor.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/core/network/interceptor/AuthInterceptor.java	(date 1765447595493)
@@ -3,38 +3,91 @@
 import androidx.annotation.NonNull;
 
 import com.finmate.core.session.SessionManager;
+import com.finmate.data.repository.AuthRepository;
 
 import java.io.IOException;
 
 import javax.inject.Inject;
+import javax.inject.Singleton;
 
 import okhttp3.Interceptor;
 import okhttp3.Request;
 import okhttp3.Response;
 
+@Singleton
 public class AuthInterceptor implements Interceptor {
 
     private final SessionManager sessionManager;
+    private final AuthRepository authRepository;
+
+    private volatile boolean isRefreshing = false;
 
     @Inject
-    public AuthInterceptor(SessionManager sessionManager) {
+    public AuthInterceptor(SessionManager sessionManager, AuthRepository authRepository) {
         this.sessionManager = sessionManager;
+        this.authRepository = authRepository;
     }
 
     @NonNull
     @Override
     public Response intercept(@NonNull Chain chain) throws IOException {
+        Request originalRequest = chain.request();
 
+        String path = originalRequest.url().encodedPath();
+        boolean isAuthEndpoint = path.startsWith("/auth");
+
+        // 1. Gắn access token nếu cần
         String token = sessionManager.getAccessToken();
-        Request request = chain.request();
+        Request request = originalRequest;
 
-        // Không add token cho các API auth
-        if (token != null && !request.url().encodedPath().startsWith("/auth")) {
-            request = request.newBuilder()
+        if (!isAuthEndpoint && token != null && !token.isEmpty()) {
+            request = originalRequest.newBuilder()
                     .addHeader("Authorization", "Bearer " + token)
                     .build();
         }
 
-        return chain.proceed(request);
+        // 2. Gửi request lần 1
+        Response response = chain.proceed(request);
+
+        // Nếu không phải 401 hoặc là endpoint /auth thì trả về luôn, không refresh
+        if (response.code() != 401 || isAuthEndpoint) {
+            return response;
+        }
+
+        // 3. Gặp 401 -> thử refresh token
+        response.close(); // đóng response cũ để tránh leak
+
+        synchronized (this) {
+            if (!isRefreshing) {
+                isRefreshing = true;
+                try {
+                    boolean refreshed = authRepository.refreshTokenBlocking();
+                    if (!refreshed) {
+                        // refresh fail -> coi như hết phiên đăng nhập
+                        throw new IOException("Refresh token failed or missing");
+                    }
+                } finally {
+                    isRefreshing = false;
+                }
+            }
+            // Nếu thread này vào sau while refresh đang chạy,
+            // đến đây là refresh đã xong (ok hoặc fail).
+        }
+
+        // 4. Lấy lại token mới từ SessionManager
+        String newToken = sessionManager.getAccessToken();
+        if (newToken == null || newToken.isEmpty()) {
+            throw new IOException("No access token after refresh");
+        }
+
+        // 5. build lại request với token mới
+        Request newRequest = originalRequest.newBuilder()
+                // xóa header cũ (nếu có)
+                .removeHeader("Authorization")
+                .addHeader("Authorization", "Bearer " + newToken)
+                .build();
+
+        // 6. Gửi lại request
+        return chain.proceed(newRequest);
     }
 }
Index: app/src/main/java/com/finmate/core/di/DataStoreModule.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.core.di;\r\n\r\nimport android.content.Context;\r\n\r\nimport androidx.datastore.preferences.core.Preferences;\r\nimport androidx.datastore.preferences.rxjava3.RxPreferenceDataStoreBuilder;\r\nimport androidx.datastore.rxjava3.RxDataStore;\r\n\r\nimport javax.inject.Singleton;\r\n\r\nimport dagger.Module;\r\nimport dagger.Provides;\r\nimport dagger.hilt.InstallIn;\r\nimport dagger.hilt.android.qualifiers.ApplicationContext;\r\nimport dagger.hilt.components.SingletonComponent;\r\n\r\n@Module\r\n@InstallIn(SingletonComponent.class)\r\npublic class DataStoreModule {\r\n\r\n    @Provides\r\n    @Singleton\r\n    public RxDataStore<Preferences> provideDataStore(\r\n            @ApplicationContext Context context\r\n    ) {\r\n        return new RxPreferenceDataStoreBuilder(\r\n                context,\r\n                \"auth_prefs\"   // tên file DataStore\r\n        ).build();\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/core/di/DataStoreModule.java b/app/src/main/java/com/finmate/core/di/DataStoreModule.java
--- a/app/src/main/java/com/finmate/core/di/DataStoreModule.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/core/di/DataStoreModule.java	(date 1765447595493)
@@ -7,6 +7,7 @@
 import androidx.datastore.rxjava3.RxDataStore;
 
 import javax.inject.Singleton;
+import javax.inject.Named;
 
 import dagger.Module;
 import dagger.Provides;
@@ -20,12 +21,25 @@
 
     @Provides
     @Singleton
-    public RxDataStore<Preferences> provideDataStore(
+    @Named("authDataStore")
+    public RxDataStore<Preferences> provideAuthDataStore(
             @ApplicationContext Context context
     ) {
         return new RxPreferenceDataStoreBuilder(
                 context,
-                "auth_prefs"   // tên file DataStore
+                "auth_prefs"   // file lưu token
+        ).build();
+    }
+
+    @Provides
+    @Singleton
+    @Named("settingsDataStore")
+    public RxDataStore<Preferences> provideSettingsDataStore(
+            @ApplicationContext Context context
+    ) {
+        return new RxPreferenceDataStoreBuilder(
+                context,
+                "user_settings"   // file lưu ngôn ngữ/theme/khác
         ).build();
     }
 }
Index: app/src/main/java/com/finmate/core/di/NetworkModule.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.core.di;\r\n\r\nimport com.finmate.core.network.interceptor.AuthInterceptor;\r\nimport com.finmate.core.session.SessionManager;\r\nimport com.finmate.data.remote.api.AuthService;\r\nimport com.finmate.data.remote.api.CategoryService;\r\nimport com.finmate.data.remote.api.FriendService;\r\nimport com.finmate.data.remote.api.TransactionService;\r\nimport com.finmate.data.remote.api.WalletService;\r\n\r\nimport javax.inject.Singleton;\r\n\r\nimport dagger.Module;\r\nimport dagger.Provides;\r\nimport dagger.hilt.InstallIn;\r\nimport dagger.hilt.components.SingletonComponent;\r\nimport okhttp3.OkHttpClient;\r\nimport okhttp3.logging.HttpLoggingInterceptor;\r\nimport retrofit2.Retrofit;\r\nimport retrofit2.converter.gson.GsonConverterFactory;\r\n\r\n@Module\r\n@InstallIn(SingletonComponent.class)\r\npublic class NetworkModule {\r\n\r\n    private static final String BASE_URL = \"http://10.0.2.2:8080/\";\r\n\r\n    @Provides\r\n    @Singleton\r\n    public AuthService provideAuthService(Retrofit retrofit) {\r\n        return retrofit.create(AuthService.class);\r\n    }\r\n\r\n    @Provides\r\n    @Singleton\r\n    public WalletService provideWalletService(Retrofit retrofit) {\r\n        return retrofit.create(WalletService.class);\r\n    }\r\n\r\n    @Provides\r\n    @Singleton\r\n    public TransactionService provideTransactionService(Retrofit retrofit) {\r\n        return retrofit.create(TransactionService.class);\r\n    }\r\n\r\n    @Provides\r\n    @Singleton\r\n    public CategoryService provideCategoryService(Retrofit retrofit) {\r\n        return retrofit.create(CategoryService.class);\r\n    }\r\n\r\n    @Provides\r\n    @Singleton\r\n    public FriendService provideFriendService(Retrofit retrofit) {\r\n        return retrofit.create(FriendService.class);\r\n    }\r\n\r\n    @Provides\r\n    @Singleton\r\n    public Retrofit provideRetrofit(OkHttpClient okHttpClient) {\r\n        return new Retrofit.Builder()\r\n                .baseUrl(BASE_URL)\r\n                .client(okHttpClient)\r\n                .addConverterFactory(GsonConverterFactory.create())\r\n                .build();\r\n    }\r\n\r\n    @Provides\r\n    @Singleton\r\n    public OkHttpClient provideOkHttpClient(AuthInterceptor authInterceptor) {\r\n        HttpLoggingInterceptor logging = new HttpLoggingInterceptor();\r\n        logging.setLevel(HttpLoggingInterceptor.Level.BODY);\r\n\r\n        return new OkHttpClient.Builder()\r\n                .addInterceptor(authInterceptor)\r\n                .addInterceptor(logging)\r\n                .build();\r\n    }\r\n\r\n    // Explicitly providing AuthInterceptor to resolve potential Hilt issues\r\n    @Provides\r\n    @Singleton\r\n    public AuthInterceptor provideAuthInterceptor(SessionManager sessionManager) {\r\n        return new AuthInterceptor(sessionManager);\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/core/di/NetworkModule.java b/app/src/main/java/com/finmate/core/di/NetworkModule.java
--- a/app/src/main/java/com/finmate/core/di/NetworkModule.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/core/di/NetworkModule.java	(date 1765447595493)
@@ -7,6 +7,7 @@
 import com.finmate.data.remote.api.FriendService;
 import com.finmate.data.remote.api.TransactionService;
 import com.finmate.data.remote.api.WalletService;
+import com.finmate.data.repository.AuthRepository;
 
 import javax.inject.Singleton;
 
@@ -17,6 +18,7 @@
 import okhttp3.OkHttpClient;
 import okhttp3.logging.HttpLoggingInterceptor;
 import retrofit2.Retrofit;
+import retrofit2.adapter.rxjava3.RxJava3CallAdapterFactory;
 import retrofit2.converter.gson.GsonConverterFactory;
 
 @Module
@@ -25,28 +27,55 @@
 
     private static final String BASE_URL = "http://10.0.2.2:8080/";
 
+    // Tạo OkHttpClient không có AuthInterceptor cho AuthService (tránh dependency cycle)
     @Provides
     @Singleton
-    public AuthService provideAuthService(Retrofit retrofit) {
-        return retrofit.create(AuthService.class);
+    @javax.inject.Named("authOkHttpClient")
+    public OkHttpClient provideAuthOkHttpClient() {
+        HttpLoggingInterceptor logging = new HttpLoggingInterceptor();
+        logging.setLevel(HttpLoggingInterceptor.Level.BODY);
+
+        return new OkHttpClient.Builder()
+                .addInterceptor(logging)
+                .build();
     }
 
+    // Retrofit riêng cho AuthService (không có AuthInterceptor)
     @Provides
     @Singleton
-    public WalletService provideWalletService(Retrofit retrofit) {
-        return retrofit.create(WalletService.class);
+    @javax.inject.Named("authRetrofit")
+    public Retrofit provideAuthRetrofit(@javax.inject.Named("authOkHttpClient") OkHttpClient okHttpClient) {
+        return new Retrofit.Builder()
+                .baseUrl(BASE_URL)
+                .client(okHttpClient)
+                .addCallAdapterFactory(RxJava3CallAdapterFactory.create())
+                .addConverterFactory(GsonConverterFactory.create())
+                .build();
     }
 
+    // Retrofit chính cho các service khác (có AuthInterceptor)
     @Provides
     @Singleton
-    public TransactionService provideTransactionService(Retrofit retrofit) {
-        return retrofit.create(TransactionService.class);
+    public Retrofit provideRetrofit(OkHttpClient okHttpClient) {
+        return new Retrofit.Builder()
+                .baseUrl(BASE_URL)
+                .client(okHttpClient)
+                .addCallAdapterFactory(RxJava3CallAdapterFactory.create())
+                .addConverterFactory(GsonConverterFactory.create())
+                .build();
     }
 
+    // AuthService dùng Retrofit riêng (không có AuthInterceptor)
     @Provides
     @Singleton
-    public CategoryService provideCategoryService(Retrofit retrofit) {
-        return retrofit.create(CategoryService.class);
+    public AuthService provideAuthService(@javax.inject.Named("authRetrofit") Retrofit retrofit) {
+        return retrofit.create(AuthService.class);
+    }
+
+    @Provides
+    @Singleton
+    public TransactionService provideTransactionService(Retrofit retrofit) {
+        return retrofit.create(TransactionService.class);
     }
 
     @Provides
@@ -57,12 +86,14 @@
 
     @Provides
     @Singleton
-    public Retrofit provideRetrofit(OkHttpClient okHttpClient) {
-        return new Retrofit.Builder()
-                .baseUrl(BASE_URL)
-                .client(okHttpClient)
-                .addConverterFactory(GsonConverterFactory.create())
-                .build();
+    public CategoryService provideCategoryService(Retrofit retrofit) {
+        return retrofit.create(CategoryService.class);
+    }
+
+    @Provides
+    @Singleton
+    public WalletService provideWalletService(Retrofit retrofit) {
+        return retrofit.create(WalletService.class);
     }
 
     @Provides
@@ -77,10 +108,9 @@
                 .build();
     }
 
-    // Explicitly providing AuthInterceptor to resolve potential Hilt issues
     @Provides
     @Singleton
-    public AuthInterceptor provideAuthInterceptor(SessionManager sessionManager) {
-        return new AuthInterceptor(sessionManager);
+    public AuthInterceptor provideAuthInterceptor(SessionManager sessionManager, AuthRepository authRepository) {
+        return new AuthInterceptor(sessionManager, authRepository);
     }
 }
Index: app/build.gradle.kts
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import org.gradle.api.JavaVersion\r\n\r\nplugins {\r\n    id(\"com.android.application\")\r\n    id(\"com.google.dagger.hilt.android\")\r\n}\r\n\r\nandroid {\r\n    namespace = \"com.finmate\"\r\n    compileSdk = 34\r\n\r\n    defaultConfig {\r\n        applicationId = \"com.finmate\"\r\n        minSdk = 26\r\n        targetSdk = 34\r\n        versionCode = 1\r\n        versionName = \"1.0\"\r\n\r\n        testInstrumentationRunner = \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n\r\n    buildTypes {\r\n        release {\r\n            isMinifyEnabled = false\r\n            proguardFiles(\r\n                getDefaultProguardFile(\"proguard-android-optimize.txt\"),\r\n                \"proguard-rules.pro\"\r\n            )\r\n        }\r\n    }\r\n\r\n    compileOptions {\r\n        sourceCompatibility = JavaVersion.VERSION_11\r\n        targetCompatibility = JavaVersion.VERSION_11\r\n    }\r\n\r\n    buildFeatures {\r\n        viewBinding = true\r\n    }\r\n}\r\n\r\ndependencies {\r\n    implementation(\"androidx.appcompat:appcompat:1.7.0\")\r\n    implementation(\"com.google.android.material:material:1.12.0\")\r\n    implementation(\"androidx.constraintlayout:constraintlayout:2.1.4\")\r\n    implementation(\"androidx.activity:activity:1.8.0\")\r\n\r\n    // Chart\r\n    implementation(\"com.github.PhilJay:MPAndroidChart:v3.1.0\")\r\n\r\n    // Room\r\n    implementation(\"androidx.room:room-runtime:2.6.1\")\r\n    annotationProcessor(\"androidx.room:room-compiler:2.6.1\")\r\n\r\n    // -------------------------\r\n    // ✅ Datastore CHUẨN RxJava3\r\n    // -------------------------\r\n    implementation(\"androidx.datastore:datastore-preferences:1.1.1\")\r\n    implementation(\"androidx.datastore:datastore-preferences-rxjava3:1.1.1\")\r\n\r\n    // Lifecycle\r\n    implementation(\"androidx.lifecycle:lifecycle-viewmodel-ktx:2.8.0\")\r\n    implementation(\"androidx.lifecycle:lifecycle-livedata-ktx:2.8.0\")\r\n\r\n    // Hilt\r\n    implementation(\"com.google.dagger:hilt-android:2.51.1\")\r\n    annotationProcessor(\"com.google.dagger:hilt-compiler:2.51.1\")\r\n\r\n    // Retrofit\r\n    implementation(\"com.squareup.retrofit2:retrofit:2.9.0\")\r\n    implementation(\"com.squareup.retrofit2:converter-gson:2.9.0\")\r\n    implementation(\"com.google.code.gson:gson:2.10.1\")\r\n\r\n    // OkHttp\r\n    implementation(\"com.squareup.okhttp3:okhttp:4.11.0\")\r\n    implementation(\"com.squareup.okhttp3:logging-interceptor:4.11.0\")\r\n\r\n    // RxJava\r\n    implementation(\"io.reactivex.rxjava3:rxjava:3.1.8\")\r\n\r\n    // Test\r\n    testImplementation(\"junit:junit:4.13.2\")\r\n    androidTestImplementation(\"androidx.test.ext:junit:1.1.5\")\r\n    androidTestImplementation(\"androidx.test.espresso:espresso-core:3.5.1\")\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/build.gradle.kts b/app/build.gradle.kts
--- a/app/build.gradle.kts	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/build.gradle.kts	(date 1765447595492)
@@ -1,8 +1,6 @@
-import org.gradle.api.JavaVersion
-
 plugins {
-    id("com.android.application")
-    id("com.google.dagger.hilt.android")
+    alias(libs.plugins.android.application)
+    alias(libs.plugins.hilt)
 }
 
 android {
@@ -28,58 +26,42 @@
             )
         }
     }
-
     compileOptions {
         sourceCompatibility = JavaVersion.VERSION_11
         targetCompatibility = JavaVersion.VERSION_11
     }
-
-    buildFeatures {
-        viewBinding = true
-    }
 }
 
 dependencies {
-    implementation("androidx.appcompat:appcompat:1.7.0")
-    implementation("com.google.android.material:material:1.12.0")
-    implementation("androidx.constraintlayout:constraintlayout:2.1.4")
-    implementation("androidx.activity:activity:1.8.0")
-
-    // Chart
     implementation("com.github.PhilJay:MPAndroidChart:v3.1.0")
-
-    // Room
-    implementation("androidx.room:room-runtime:2.6.1")
-    annotationProcessor("androidx.room:room-compiler:2.6.1")
-
-    // -------------------------
-    // ✅ Datastore CHUẨN RxJava3
-    // -------------------------
-    implementation("androidx.datastore:datastore-preferences:1.1.1")
-    implementation("androidx.datastore:datastore-preferences-rxjava3:1.1.1")
-
-    // Lifecycle
-    implementation("androidx.lifecycle:lifecycle-viewmodel-ktx:2.8.0")
-    implementation("androidx.lifecycle:lifecycle-livedata-ktx:2.8.0")
+    implementation(libs.appcompat)
+    implementation(libs.material)
+    implementation(libs.room.runtime)
+    annotationProcessor(libs.room.compiler)
 
     // Hilt
-    implementation("com.google.dagger:hilt-android:2.51.1")
-    annotationProcessor("com.google.dagger:hilt-compiler:2.51.1")
+    implementation(libs.hilt.android)
+    annotationProcessor(libs.hilt.compiler)
 
-    // Retrofit
-    implementation("com.squareup.retrofit2:retrofit:2.9.0")
-    implementation("com.squareup.retrofit2:converter-gson:2.9.0")
-    implementation("com.google.code.gson:gson:2.10.1")
+    // Retrofit & OkHttp
+    implementation(libs.retrofit)
+    implementation(libs.retrofit.gson)
+    implementation(libs.retrofit.rxjava3.adapter)
+    implementation(libs.okhttp.logging)
 
-    // OkHttp
-    implementation("com.squareup.okhttp3:okhttp:4.11.0")
-    implementation("com.squareup.okhttp3:logging-interceptor:4.11.0")
+    // DataStore
+    implementation(libs.datastore.prefs)
+    implementation(libs.datastore.rxjava3) // For Java support
 
     // RxJava
-    implementation("io.reactivex.rxjava3:rxjava:3.1.8")
+    implementation(libs.rxjava)
+    implementation(libs.rxandroid)
 
-    // Test
-    testImplementation("junit:junit:4.13.2")
-    androidTestImplementation("androidx.test.ext:junit:1.1.5")
-    androidTestImplementation("androidx.test.espresso:espresso-core:3.5.1")
+    // Lifecycle
+    implementation(libs.lifecycle.viewmodel)
+    implementation(libs.lifecycle.livedata)
+
+    testImplementation(libs.junit)
+    androidTestImplementation(libs.ext.junit)
+    androidTestImplementation(libs.espresso.core)
 }
Index: app/src/main/java/com/finmate/data/dto/CategoryResponse.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.dto;\r\n\r\npublic class CategoryResponse {\r\n\r\n    private String id;\r\n    private String name;\r\n    private String type;\r\n    private String icon;\r\n    private Integer displayOrder;\r\n\r\n    public CategoryResponse() {\r\n    }\r\n\r\n    public String getId() {\r\n        return id;\r\n    }\r\n\r\n    public String getName() {\r\n        return name;\r\n    }\r\n\r\n    public String getType() {\r\n        return type;\r\n    }\r\n\r\n    public String getIcon() {\r\n        return icon;\r\n    }\r\n\r\n    public Integer getDisplayOrder() {\r\n        return displayOrder;\r\n    }\r\n\r\n    public void setId(String id) {\r\n        this.id = id;\r\n    }\r\n\r\n    public void setName(String name) {\r\n        this.name = name;\r\n    }\r\n\r\n    public void setType(String type) {\r\n        this.type = type;\r\n    }\r\n\r\n    public void setIcon(String icon) {\r\n        this.icon = icon;\r\n    }\r\n\r\n    public void setDisplayOrder(Integer displayOrder) {\r\n        this.displayOrder = displayOrder;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/dto/CategoryResponse.java b/app/src/main/java/com/finmate/data/dto/CategoryResponse.java
--- a/app/src/main/java/com/finmate/data/dto/CategoryResponse.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/dto/CategoryResponse.java	(date 1765447595504)
@@ -1,12 +1,18 @@
 package com.finmate.data.dto;
 
+/**
+ * DTO matching backend CategoryResponse
+ */
 public class CategoryResponse {
 
     private String id;
     private String name;
     private String type;
+    private String parentId;
     private String icon;
-    private Integer displayOrder;
+    private boolean deleted;
+    private String createdAt;
+    private String updatedAt;
 
     public CategoryResponse() {
     }
@@ -15,39 +21,63 @@
         return id;
     }
 
-    public String getName() {
-        return name;
-    }
-
-    public String getType() {
-        return type;
-    }
-
-    public String getIcon() {
-        return icon;
-    }
-
-    public Integer getDisplayOrder() {
-        return displayOrder;
-    }
-
     public void setId(String id) {
         this.id = id;
     }
 
+    public String getName() {
+        return name;
+    }
+
     public void setName(String name) {
         this.name = name;
     }
 
+    public String getType() {
+        return type;
+    }
+
     public void setType(String type) {
         this.type = type;
     }
 
+    public String getParentId() {
+        return parentId;
+    }
+
+    public void setParentId(String parentId) {
+        this.parentId = parentId;
+    }
+
+    public String getIcon() {
+        return icon;
+    }
+
     public void setIcon(String icon) {
         this.icon = icon;
     }
 
-    public void setDisplayOrder(Integer displayOrder) {
-        this.displayOrder = displayOrder;
+    public boolean isDeleted() {
+        return deleted;
+    }
+
+    public void setDeleted(boolean deleted) {
+        this.deleted = deleted;
+    }
+
+    public String getCreatedAt() {
+        return createdAt;
+    }
+
+    public void setCreatedAt(String createdAt) {
+        this.createdAt = createdAt;
+    }
+
+    public String getUpdatedAt() {
+        return updatedAt;
+    }
+
+    public void setUpdatedAt(String updatedAt) {
+        this.updatedAt = updatedAt;
     }
 }
Index: app/src/main/java/com/finmate/data/dto/CategoryRequest.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.dto;\r\n\r\npublic class CategoryRequest {\r\n\r\n    private String name;\r\n    private String type;\r\n    private String icon;\r\n\r\n    public CategoryRequest(String name, String type, String icon) {\r\n        this.name = name;\r\n        this.type = type;\r\n        this.icon = icon;\r\n    }\r\n\r\n    public String getName() { return name; }\r\n    public String getType() { return type; }\r\n    public String getIcon() { return icon; }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/dto/CategoryRequest.java b/app/src/main/java/com/finmate/data/dto/CategoryRequest.java
--- a/app/src/main/java/com/finmate/data/dto/CategoryRequest.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/dto/CategoryRequest.java	(date 1765447595504)
@@ -1,10 +1,17 @@
 package com.finmate.data.dto;
 
+/**
+ * DTO matching backend CategoryRequest
+ */
 public class CategoryRequest {
 
     private String name;
-    private String type;
-    private String icon;
+    private String type; // INCOME / EXPENSE / TRANSFER
+    private String parentId; // optional
+    private String icon; // optional
+
+    public CategoryRequest() {
+    }
 
     public CategoryRequest(String name, String type, String icon) {
         this.name = name;
@@ -12,7 +19,42 @@
         this.icon = icon;
     }
 
-    public String getName() { return name; }
-    public String getType() { return type; }
-    public String getIcon() { return icon; }
+    public CategoryRequest(String name, String type, String parentId, String icon) {
+        this.name = name;
+        this.type = type;
+        this.parentId = parentId;
+        this.icon = icon;
+    }
+
+    public String getName() {
+        return name;
+    }
+
+    public void setName(String name) {
+        this.name = name;
+    }
+
+    public String getType() {
+        return type;
+    }
+
+    public void setType(String type) {
+        this.type = type;
+    }
+
+    public String getParentId() {
+        return parentId;
+    }
+
+    public void setParentId(String parentId) {
+        this.parentId = parentId;
+    }
+
+    public String getIcon() {
+        return icon;
+    }
+
+    public void setIcon(String icon) {
+        this.icon = icon;
+    }
 }
Index: app/src/main/java/com/finmate/data/dto/RegisterRequest.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.dto;\r\n\r\npublic class RegisterRequest {\r\n    private String email;\r\n    private String password;\r\n\r\n    public RegisterRequest(String email, String password) {\r\n        this.email = email;\r\n        this.password = password;\r\n    }\r\n\r\n    public String getEmail() { return email; }\r\n    public String getPassword() { return password; }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/dto/RegisterRequest.java b/app/src/main/java/com/finmate/data/dto/RegisterRequest.java
--- a/app/src/main/java/com/finmate/data/dto/RegisterRequest.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/dto/RegisterRequest.java	(date 1765447595504)
@@ -3,12 +3,18 @@
 public class RegisterRequest {
     private String email;
     private String password;
+    private String fullName;
+    private String avatarUrl;
 
-    public RegisterRequest(String email, String password) {
+    public RegisterRequest(String email, String password, String fullName, String avatarUrl) {
         this.email = email;
         this.password = password;
+        this.fullName = fullName;
+        this.avatarUrl = avatarUrl;
     }
 
     public String getEmail() { return email; }
     public String getPassword() { return password; }
+    public String getFullName() { return fullName; }
+    public String getAvatarUrl() { return avatarUrl; }
 }
Index: app/src/main/java/com/finmate/core/session/SessionManager.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.core.session;\r\n\r\nimport javax.inject.Inject;\r\nimport javax.inject.Singleton;\r\n\r\n@Singleton\r\npublic class SessionManager {\r\n\r\n    private String accessToken;\r\n\r\n    @Inject\r\n    public SessionManager() {}\r\n\r\n    public void saveAccessToken(String token) {\r\n        this.accessToken = token;\r\n    }\r\n\r\n    public String getAccessToken() {\r\n        return accessToken;\r\n    }\r\n\r\n    public void clear() {\r\n        this.accessToken = null;\r\n    }\r\n\r\n    public boolean isLoggedIn() {\r\n        return accessToken != null && !accessToken.isEmpty();\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/core/session/SessionManager.java b/app/src/main/java/com/finmate/core/session/SessionManager.java
--- a/app/src/main/java/com/finmate/core/session/SessionManager.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/core/session/SessionManager.java	(date 1765447595493)
@@ -1,29 +1,33 @@
 package com.finmate.core.session;
 
+import javax.annotation.Nullable;
 import javax.inject.Inject;
 import javax.inject.Singleton;
 
 @Singleton
 public class SessionManager {
 
-    private String accessToken;
+    // chỉ dùng trong RAM cho AuthInterceptor & UI
+    private volatile String accessToken;
 
     @Inject
     public SessionManager() {}
 
-    public void saveAccessToken(String token) {
+    public synchronized void saveAccessToken(@Nullable String token) {
         this.accessToken = token;
     }
 
+    @Nullable
     public String getAccessToken() {
         return accessToken;
     }
 
     public void clear() {
-        this.accessToken = null;
+        saveAccessToken(null);
     }
 
     public boolean isLoggedIn() {
         return accessToken != null && !accessToken.isEmpty();
     }
 }
+
Index: app/src/main/java/com/finmate/data/local/database/dao/CategoryDao.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.local.database.dao;\r\n\r\nimport androidx.lifecycle.LiveData;\r\nimport androidx.room.Dao;\r\nimport androidx.room.Delete;\r\nimport androidx.room.Insert;\r\nimport androidx.room.Query;\r\nimport androidx.room.Update;\r\n\r\nimport com.finmate.data.local.database.entity.CategoryEntity;\r\n\r\nimport java.util.List;\r\n\r\n@Dao\r\npublic interface CategoryDao {\r\n\r\n    @Insert\r\n    long insert(CategoryEntity category);\r\n\r\n    @Update\r\n    int update(CategoryEntity category);\r\n\r\n    @Delete\r\n    int delete(CategoryEntity category);\r\n\r\n    @Query(\"SELECT * FROM categories WHERE type = :type ORDER BY id DESC\")\r\n    LiveData<List<CategoryEntity>> getByType(String type);\r\n\r\n    @Query(\"SELECT * FROM categories ORDER BY id DESC\")\r\n    LiveData<List<CategoryEntity>> getAll();\r\n\r\n    @Query(\"DELETE FROM categories WHERE type = :type\")\r\n    int deleteByType(String type);\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/database/dao/CategoryDao.java b/app/src/main/java/com/finmate/data/local/database/dao/CategoryDao.java
--- a/app/src/main/java/com/finmate/data/local/database/dao/CategoryDao.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/local/database/dao/CategoryDao.java	(date 1765447595509)
@@ -7,12 +7,14 @@
 import androidx.room.Query;
 import androidx.room.Update;
 
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncDao;
 import com.finmate.data.local.database.entity.CategoryEntity;
 
 import java.util.List;
 
 @Dao
-public interface CategoryDao {
+public interface CategoryDao extends SyncDao<CategoryEntity> {
 
     @Insert
     long insert(CategoryEntity category);
@@ -26,9 +28,23 @@
     @Query("SELECT * FROM categories WHERE type = :type ORDER BY id DESC")
     LiveData<List<CategoryEntity>> getByType(String type);
 
+    @Query("SELECT * FROM categories WHERE type = :type ORDER BY id DESC")
+    List<CategoryEntity> getByTypeSync(String type);
+
     @Query("SELECT * FROM categories ORDER BY id DESC")
     LiveData<List<CategoryEntity>> getAll();
 
+    @Query("SELECT * FROM categories ORDER BY id DESC")
+    List<CategoryEntity> getAllSync();
+
     @Query("DELETE FROM categories WHERE type = :type")
     int deleteByType(String type);
+
+    @Query("SELECT * FROM categories WHERE pendingAction != :noneAction ORDER BY updatedAt ASC")
+    List<CategoryEntity> getPendingForSyncInternal(String noneAction);
+
+    @Override
+    default List<CategoryEntity> getPendingForSync() {
+        return getPendingForSyncInternal(PendingAction.NONE);
+    }
 }
Index: app/src/main/java/com/finmate/data/local/database/dao/TransactionDao.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.local.database.dao;\r\n\r\nimport androidx.room.Dao;\r\nimport androidx.room.Delete;\r\nimport androidx.room.Insert;\r\nimport androidx.room.Query;\r\nimport androidx.room.Update;\r\n\r\nimport com.finmate.data.local.database.entity.TransactionEntity;\r\n\r\nimport java.util.List;\r\n\r\n@Dao\r\npublic interface TransactionDao {\r\n\r\n    @Insert\r\n    void insert(TransactionEntity transaction);\r\n\r\n    @Query(\"SELECT * FROM transactions ORDER BY id DESC\")\r\n    List<TransactionEntity> getAll();\r\n\r\n    @Query(\"SELECT * FROM transactions WHERE id = :id\")\r\n    TransactionEntity getById(int id);\r\n\r\n    @Update\r\n    void update(TransactionEntity transaction);\r\n\r\n    @Delete\r\n    void delete(TransactionEntity transaction);\r\n\r\n    @Query(\"DELETE FROM transactions WHERE id = :id\")\r\n    void deleteById(int id);\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/database/dao/TransactionDao.java b/app/src/main/java/com/finmate/data/local/database/dao/TransactionDao.java
--- a/app/src/main/java/com/finmate/data/local/database/dao/TransactionDao.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/local/database/dao/TransactionDao.java	(date 1765447595509)
@@ -6,28 +6,112 @@
 import androidx.room.Query;
 import androidx.room.Update;
 
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncDao;
 import com.finmate.data.local.database.entity.TransactionEntity;
+import com.finmate.data.local.database.model.StatisticPoint;
 
 import java.util.List;
 
 @Dao
-public interface TransactionDao {
+public interface TransactionDao extends SyncDao<TransactionEntity> {
 
     @Insert
-    void insert(TransactionEntity transaction);
-
-    @Query("SELECT * FROM transactions ORDER BY id DESC")
-    List<TransactionEntity> getAll();
-
-    @Query("SELECT * FROM transactions WHERE id = :id")
-    TransactionEntity getById(int id);
+    void insert(TransactionEntity entity);
 
     @Update
-    void update(TransactionEntity transaction);
+    void update(TransactionEntity entity);
 
     @Delete
-    void delete(TransactionEntity transaction);
+    void delete(TransactionEntity entity);
+
+    @Query("SELECT * FROM transactions ORDER BY id DESC")
+    List<TransactionEntity> getAll();
+
+    @Query("DELETE FROM transactions WHERE syncStatus = :status")
+    void deleteByStatus(String status);
+
+    @Query("SELECT * FROM transactions WHERE pendingAction != :noneAction ORDER BY updatedAt ASC")
+    List<TransactionEntity> getPendingForSyncInternal(String noneAction);
+
+    @Override
+    default List<TransactionEntity> getPendingForSync() {
+        return getPendingForSyncInternal(PendingAction.NONE);
+    }
 
-    @Query("DELETE FROM transactions WHERE id = :id")
-    void deleteById(int id);
+    @Query("SELECT IFNULL(SUM(amount), 0) FROM transactions " +
+            "WHERE type = :type " +
+            "AND pendingAction != :ignoredAction " +
+            "AND (:startDate IS NULL OR occurredAt >= :startDate) " +
+            "AND (:endDate IS NULL OR occurredAt <= :endDate) " +
+            "AND (:walletName IS NULL OR :walletName = '' OR walletName = :walletName)")
+    double sumAmount(String type, String startDate, String endDate, String walletName, String ignoredAction);
+
+    @Query("SELECT IFNULL(SUM(amount), 0) FROM transactions " +
+            "WHERE type = :type " +
+            "AND pendingAction != :ignoredAction " +
+            "AND (:startDate IS NULL OR occurredAt >= :startDate) " +
+            "AND (:endDate IS NULL OR occurredAt <= :endDate) " +
+            "AND (:walletName IS NULL OR :walletName = '' OR walletName = :walletName) " +
+            "AND (:categoryName IS NULL OR :categoryName = '' OR categoryName = :categoryName)")
+    double sumAmountWithCategory(String type, String startDate, String endDate, String walletName, String categoryName, String ignoredAction);
+
+    @Query("SELECT IFNULL(SUM(amount), 0) FROM transactions " +
+            "WHERE type = :type " +
+            "AND pendingAction != :ignoredAction " +
+            "AND (:startDate IS NULL OR occurredAt >= :startDate) " +
+            "AND (:endDate IS NULL OR occurredAt <= :endDate) " +
+            "AND (:walletName IS NULL OR :walletName = '' OR walletName = :walletName) " +
+            "AND (:categoryName IS NULL OR :categoryName = '' OR categoryName = :categoryName)")
+    double sumAmountForBudget(String type, String startDate, String endDate, String walletName, String categoryName, String ignoredAction);
+
+    @Query("SELECT strftime('%Y-%m-%d', replace(occurredAt, 'T', ' ')) AS label, SUM(amount) AS total FROM transactions " +
+            "WHERE type = :type " +
+            "AND pendingAction != :ignoredAction " +
+            "AND (:startDate IS NULL OR occurredAt >= :startDate) " +
+            "AND (:endDate IS NULL OR occurredAt <= :endDate) " +
+            "AND (:walletName IS NULL OR :walletName = '' OR walletName = :walletName) " +
+            "GROUP BY label " +
+            "ORDER BY label ASC")
+    List<StatisticPoint> sumByDay(String type, String startDate, String endDate, String walletName, String ignoredAction);
+
+    @Query("SELECT strftime('%Y-%W', replace(occurredAt, 'T', ' ')) AS label, SUM(amount) AS total FROM transactions " +
+            "WHERE type = :type " +
+            "AND pendingAction != :ignoredAction " +
+            "AND (:startDate IS NULL OR occurredAt >= :startDate) " +
+            "AND (:endDate IS NULL OR occurredAt <= :endDate) " +
+            "AND (:walletName IS NULL OR :walletName = '' OR walletName = :walletName) " +
+            "GROUP BY label " +
+            "ORDER BY label ASC")
+    List<StatisticPoint> sumByWeek(String type, String startDate, String endDate, String walletName, String ignoredAction);
+
+    @Query("SELECT strftime('%Y-%m', replace(occurredAt, 'T', ' ')) AS label, SUM(amount) AS total FROM transactions " +
+            "WHERE type = :type " +
+            "AND pendingAction != :ignoredAction " +
+            "AND (:startDate IS NULL OR occurredAt >= :startDate) " +
+            "AND (:endDate IS NULL OR occurredAt <= :endDate) " +
+            "AND (:walletName IS NULL OR :walletName = '' OR walletName = :walletName) " +
+            "GROUP BY label " +
+            "ORDER BY label ASC")
+    List<StatisticPoint> sumByMonth(String type, String startDate, String endDate, String walletName, String ignoredAction);
+
+    @Query("SELECT categoryName AS label, SUM(amount) AS total FROM transactions " +
+            "WHERE type = :type " +
+            "AND pendingAction != :ignoredAction " +
+            "AND (:startDate IS NULL OR occurredAt >= :startDate) " +
+            "AND (:endDate IS NULL OR occurredAt <= :endDate) " +
+            "AND (:walletName IS NULL OR :walletName = '' OR walletName = :walletName) " +
+            "GROUP BY categoryName " +
+            "ORDER BY total DESC")
+    List<StatisticPoint> sumByCategory(String type, String startDate, String endDate, String walletName, String ignoredAction);
+
+    @Query("SELECT walletName AS label, SUM(amount) AS total FROM transactions " +
+            "WHERE type = :type " +
+            "AND pendingAction != :ignoredAction " +
+            "AND (:startDate IS NULL OR occurredAt >= :startDate) " +
+            "AND (:endDate IS NULL OR occurredAt <= :endDate) " +
+            "AND (:walletName IS NULL OR :walletName = '' OR walletName = :walletName) " +
+            "GROUP BY walletName " +
+            "ORDER BY total DESC")
+    List<StatisticPoint> sumByWallet(String type, String startDate, String endDate, String walletName, String ignoredAction);
 }
Index: app/src/main/java/com/finmate/data/local/database/dao/WalletDao.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.local.database.dao;\r\n\r\nimport androidx.room.Dao;\r\nimport androidx.room.Delete;\r\nimport androidx.room.Insert;\r\nimport androidx.room.Query;\r\nimport androidx.room.Update;\r\nimport com.finmate.data.local.database.entity.WalletEntity;\r\nimport java.util.List;\r\n\r\n@Dao\r\npublic interface WalletDao {\r\n\r\n    @Insert\r\n    void insert(WalletEntity wallet);\r\n\r\n    @Update\r\n    void update(WalletEntity wallet);\r\n\r\n    @Delete\r\n    void delete(WalletEntity wallet);\r\n\r\n    @Query(\"SELECT * FROM wallets ORDER BY id DESC\")\r\n    List<WalletEntity> getAll();\r\n\r\n    @Query(\"SELECT * FROM wallets WHERE id = :id LIMIT 1\")\r\n    WalletEntity getById(int id);\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/database/dao/WalletDao.java b/app/src/main/java/com/finmate/data/local/database/dao/WalletDao.java
--- a/app/src/main/java/com/finmate/data/local/database/dao/WalletDao.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/local/database/dao/WalletDao.java	(date 1765447595509)
@@ -5,11 +5,15 @@
 import androidx.room.Insert;
 import androidx.room.Query;
 import androidx.room.Update;
+
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncDao;
 import com.finmate.data.local.database.entity.WalletEntity;
+
 import java.util.List;
 
 @Dao
-public interface WalletDao {
+public interface WalletDao extends SyncDao<WalletEntity> {
 
     @Insert
     void insert(WalletEntity wallet);
@@ -25,4 +29,12 @@
 
     @Query("SELECT * FROM wallets WHERE id = :id LIMIT 1")
     WalletEntity getById(int id);
+
+    @Query("SELECT * FROM wallets WHERE pendingAction != :noneAction ORDER BY updatedAt ASC")
+    List<WalletEntity> getPendingForSyncInternal(String noneAction);
+
+    @Override
+    default List<WalletEntity> getPendingForSync() {
+        return getPendingForSyncInternal(PendingAction.NONE);
+    }
 }
Index: app/src/main/res/layout/activity_income_statistic.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    android:background=\"?attr/backgroundColor\"\r\n    android:orientation=\"vertical\">\r\n\r\n    <!-- ====== BACK BUTTON ====== -->\r\n    <LinearLayout\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:orientation=\"horizontal\"\r\n        android:padding=\"16dp\">\r\n\r\n        <ImageView\r\n            android:id=\"@+id/btnBack\"\r\n            android:layout_width=\"28dp\"\r\n            android:layout_height=\"28dp\"\r\n            android:padding=\"4dp\"\r\n            android:src=\"@drawable/ic_back\"\r\n            app:tint=\"?attr/iconTint\" />\r\n    </LinearLayout>\r\n\r\n    <!-- ====== TAB CHI TIÊU / THU NHẬP ====== -->\r\n    <LinearLayout\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:orientation=\"horizontal\"\r\n        android:paddingHorizontal=\"16dp\"\r\n        android:paddingBottom=\"8dp\">\r\n\r\n        <TextView\r\n            android:id=\"@+id/tvExpenseTab\"\r\n            android:layout_width=\"0dp\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_weight=\"1\"\r\n            android:text=\"@string/expense\"\r\n            android:textSize=\"18sp\"\r\n            android:textColor=\"?attr/textColorSecondary\"\r\n            android:gravity=\"center\" />\r\n\r\n        <TextView\r\n            android:id=\"@+id/tvIncomeTab\"\r\n            android:layout_width=\"0dp\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_weight=\"1\"\r\n            android:text=\"@string/income\"\r\n            android:textSize=\"18sp\"\r\n            android:textStyle=\"bold\"\r\n            android:textColor=\"?attr/textColorPrimary\"\r\n            android:gravity=\"center\" />\r\n    </LinearLayout>\r\n\r\n    <!-- ====== TỔNG THU NHẬP ====== -->\r\n    <TextView\r\n        android:id=\"@+id/tvTotalIncome\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"+60,000,000 VND\"\r\n        android:textColor=\"?attr/textColorPositive\"\r\n        android:textSize=\"16sp\"\r\n        android:layout_marginStart=\"16dp\"\r\n        android:layout_marginBottom=\"12dp\" />\r\n\r\n    <!-- ====== NỘI DUNG CHÍNH ====== -->\r\n    <ScrollView\r\n        android:id=\"@+id/scrollContent\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"0dp\"\r\n        android:layout_weight=\"1\">\r\n\r\n        <LinearLayout\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:orientation=\"vertical\"\r\n            android:padding=\"16dp\">\r\n\r\n            <!-- TITLE -->\r\n            <TextView\r\n                android:id=\"@+id/tvAddTitle\"\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:text=\"@string/statistic_monthly_income\"\r\n                android:textSize=\"16sp\"\r\n                android:textStyle=\"bold\"\r\n                android:textColor=\"?attr/textColorPrimary\"\r\n                android:layout_marginBottom=\"8dp\" />\r\n\r\n            <!-- CATEGORY FILTER -->\r\n            <TextView\r\n                android:id=\"@+id/tvCategoryFilter\"\r\n                android:layout_width=\"140dp\"\r\n                android:layout_height=\"40dp\"\r\n                android:gravity=\"center_vertical\"\r\n                android:paddingHorizontal=\"12dp\"\r\n                android:text=\"@string/filter_by_category\"\r\n                android:background=\"?attr/editTextBackground\"\r\n                android:textColor=\"?attr/editTextColor\"\r\n                android:textSize=\"14sp\" />\r\n\r\n            <!-- BAR CHART -->\r\n            <com.github.mikephil.charting.charts.BarChart\r\n                android:id=\"@+id/barChartIncome\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"220dp\"\r\n                android:layout_marginTop=\"12dp\" />\r\n\r\n            <!-- PIE TITLE -->\r\n            <TextView\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:text=\"@string/compare_income_types\"\r\n                android:textStyle=\"bold\"\r\n                android:textColor=\"?attr/textColorPrimary\"\r\n                android:layout_marginTop=\"24dp\" />\r\n\r\n            <!-- PIE CHART -->\r\n            <com.github.mikephil.charting.charts.PieChart\r\n                android:id=\"@+id/pieChartIncome\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"260dp\"\r\n                android:layout_marginTop=\"8dp\" />\r\n\r\n        </LinearLayout>\r\n    </ScrollView>\r\n\r\n    <!-- ====== BOTTOM NAV ====== -->\r\n    <com.google.android.material.bottomnavigation.BottomNavigationView\r\n        android:id=\"@+id/bottomNavigation\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"65dp\"\r\n        android:background=\"?attr/bottomNavBackgroundColor\"\r\n        app:itemTextColor=\"@color/selector_nav_color\"\r\n        app:menu=\"@menu/menu_bottom\" />\r\n\r\n</LinearLayout>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/layout/activity_income_statistic.xml b/app/src/main/res/layout/activity_income_statistic.xml
--- a/app/src/main/res/layout/activity_income_statistic.xml	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/res/layout/activity_income_statistic.xml	(date 1765447595563)
@@ -52,6 +52,45 @@
             android:gravity="center" />
     </LinearLayout>
 
+    <!-- ====== FILTERS ====== -->
+    <LinearLayout
+        android:id="@+id/layoutFilters"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:orientation="horizontal"
+        android:paddingHorizontal="16dp"
+        android:paddingBottom="8dp">
+
+        <TextView
+            android:id="@+id/tvDateFilter"
+            android:layout_width="0dp"
+            android:layout_height="40dp"
+            android:layout_weight="1"
+            android:gravity="center_vertical"
+            android:paddingHorizontal="12dp"
+            android:text="Tháng này"
+            android:background="?attr/editTextBackground"
+            android:textColor="?attr/editTextColor"
+            android:textSize="14sp" />
+
+        <Space
+            android:layout_width="12dp"
+            android:layout_height="1dp" />
+
+        <TextView
+            android:id="@+id/tvWalletFilter"
+            android:layout_width="0dp"
+            android:layout_height="40dp"
+            android:layout_weight="1"
+            android:gravity="center_vertical"
+            android:paddingHorizontal="12dp"
+            android:text="Tất cả ví"
+            android:background="?attr/editTextBackground"
+            android:textColor="?attr/editTextColor"
+            android:textSize="14sp" />
+
+    </LinearLayout>
+
     <!-- ====== TỔNG THU NHẬP ====== -->
     <TextView
         android:id="@+id/tvTotalIncome"
Index: app/src/main/java/com/finmate/data/local/database/AppDatabase.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.local.database;\r\n\r\nimport android.content.Context;\r\n\r\nimport androidx.room.Database;\r\nimport androidx.room.Room;\r\nimport androidx.room.RoomDatabase;\r\n\r\nimport com.finmate.data.local.database.dao.CategoryDao;\r\nimport com.finmate.data.local.database.dao.TokenDao;\r\nimport com.finmate.data.local.database.dao.TransactionDao;\r\nimport com.finmate.data.local.database.dao.WalletDao;\r\nimport com.finmate.data.local.database.entity.CategoryEntity;\r\nimport com.finmate.data.local.datastore.entity.TokenEntity;\r\nimport com.finmate.data.local.database.entity.TransactionEntity;\r\nimport com.finmate.data.local.database.entity.WalletEntity;\r\n\r\n@Database(entities = {\r\n        TokenEntity.class,\r\n        CategoryEntity.class,\r\n        WalletEntity.class,\r\n        TransactionEntity.class\r\n}, version = 2, exportSchema = false)\r\npublic abstract class AppDatabase extends RoomDatabase {\r\n\r\n    public abstract TokenDao tokenDao();\r\n    public abstract CategoryDao categoryDao();\r\n    public abstract WalletDao walletDao();\r\n    public abstract TransactionDao transactionDao();\r\n\r\n    private static volatile AppDatabase INSTANCE;\r\n\r\n    public static AppDatabase getDatabase(Context context) {\r\n        if (INSTANCE == null) {\r\n            synchronized (AppDatabase.class) {\r\n                if (INSTANCE == null) {\r\n                    INSTANCE = Room.databaseBuilder(context.getApplicationContext(),\r\n                                    AppDatabase.class, \"finmate_database\")\r\n                            .fallbackToDestructiveMigration()\r\n                            .build();\r\n                }\r\n            }\r\n        }\r\n        return INSTANCE;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/database/AppDatabase.java b/app/src/main/java/com/finmate/data/local/database/AppDatabase.java
--- a/app/src/main/java/com/finmate/data/local/database/AppDatabase.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/local/database/AppDatabase.java	(date 1765447595509)
@@ -6,27 +6,35 @@
 import androidx.room.Room;
 import androidx.room.RoomDatabase;
 
+import com.finmate.data.local.database.dao.BudgetDao;
 import com.finmate.data.local.database.dao.CategoryDao;
+import com.finmate.data.local.database.dao.GoalDao;
 import com.finmate.data.local.database.dao.TokenDao;
 import com.finmate.data.local.database.dao.TransactionDao;
 import com.finmate.data.local.database.dao.WalletDao;
+import com.finmate.data.local.database.entity.BudgetEntity;
 import com.finmate.data.local.database.entity.CategoryEntity;
-import com.finmate.data.local.datastore.entity.TokenEntity;
+import com.finmate.data.local.database.entity.GoalEntity;
+import com.finmate.data.local.database.entity.FriendEntity;
+import com.finmate.data.local.database.entity.SharedTransactionEntity;
 import com.finmate.data.local.database.entity.TransactionEntity;
 import com.finmate.data.local.database.entity.WalletEntity;
+import com.finmate.data.local.datastore.entity.TokenEntity;
 
-@Database(entities = {
-        TokenEntity.class,
-        CategoryEntity.class,
-        WalletEntity.class,
-        TransactionEntity.class
-}, version = 2, exportSchema = false)
+@Database(
+        entities = {TokenEntity.class, CategoryEntity.class, WalletEntity.class, TransactionEntity.class, BudgetEntity.class, GoalEntity.class, FriendEntity.class, SharedTransactionEntity.class},
+        version = 9,
+        exportSchema = false
+)
 public abstract class AppDatabase extends RoomDatabase {
-
     public abstract TokenDao tokenDao();
     public abstract CategoryDao categoryDao();
     public abstract WalletDao walletDao();
     public abstract TransactionDao transactionDao();
+    public abstract BudgetDao budgetDao();
+    public abstract GoalDao goalDao();
+    public abstract com.finmate.data.local.database.dao.FriendDao friendDao();
+    public abstract com.finmate.data.local.database.dao.SharedTransactionDao sharedTransactionDao();
 
     private static volatile AppDatabase INSTANCE;
 
@@ -35,8 +43,8 @@
             synchronized (AppDatabase.class) {
                 if (INSTANCE == null) {
                     INSTANCE = Room.databaseBuilder(context.getApplicationContext(),
-                                    AppDatabase.class, "finmate_database")
-                            .fallbackToDestructiveMigration()
+                            AppDatabase.class, "finmate.db")
+                            .fallbackToDestructiveMigration() 
                             .build();
                 }
             }
Index: app/src/main/java/com/finmate/data/local/datastore/UserPreferencesLocalDataSource.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/datastore/UserPreferencesLocalDataSource.java b/app/src/main/java/com/finmate/data/local/datastore/UserPreferencesLocalDataSource.java
new file mode 100644
--- /dev/null	(date 1765447595522)
+++ b/app/src/main/java/com/finmate/data/local/datastore/UserPreferencesLocalDataSource.java	(date 1765447595522)
@@ -0,0 +1,90 @@
+package com.finmate.data.local.datastore;
+
+import androidx.datastore.preferences.core.MutablePreferences;
+import androidx.datastore.preferences.core.Preferences;
+import androidx.datastore.preferences.core.PreferencesKeys;
+import androidx.datastore.rxjava3.RxDataStore;
+
+import javax.inject.Inject;
+import javax.inject.Named;
+import javax.inject.Singleton;
+
+import io.reactivex.rxjava3.core.Completable;
+import io.reactivex.rxjava3.core.Flowable;
+import io.reactivex.rxjava3.core.Single;
+
+@Singleton
+public class UserPreferencesLocalDataSource {
+
+    private final RxDataStore<Preferences> dataStore;
+
+    private static final Preferences.Key<String> KEY_LANGUAGE =
+            PreferencesKeys.stringKey("language");
+    private static final Preferences.Key<String> KEY_THEME =
+            PreferencesKeys.stringKey("theme");
+    private static final Preferences.Key<String> KEY_USER_NAME =
+            PreferencesKeys.stringKey("user_name");
+    private static final Preferences.Key<String> KEY_USER_EMAIL =
+            PreferencesKeys.stringKey("user_email");
+
+    @Inject
+    public UserPreferencesLocalDataSource(@Named("settingsDataStore") RxDataStore<Preferences> dataStore) {
+        this.dataStore = dataStore;
+    }
+
+    public Flowable<String> languageFlow() {
+        return dataStore.data().map(prefs -> prefs.get(KEY_LANGUAGE) != null ? prefs.get(KEY_LANGUAGE) : "");
+    }
+
+    public Flowable<String> themeFlow() {
+        return dataStore.data().map(prefs -> prefs.get(KEY_THEME) != null ? prefs.get(KEY_THEME) : "");
+    }
+
+    public Single<String> getLanguage() {
+        return dataStore.data().firstOrError()
+                .map(prefs -> prefs.get(KEY_LANGUAGE) != null ? prefs.get(KEY_LANGUAGE) : "");
+    }
+
+    public Single<String> getTheme() {
+        return dataStore.data().firstOrError()
+                .map(prefs -> prefs.get(KEY_THEME) != null ? prefs.get(KEY_THEME) : "");
+    }
+
+    public Single<String> getUserName() {
+        return dataStore.data().firstOrError()
+                .map(prefs -> prefs.get(KEY_USER_NAME) != null ? prefs.get(KEY_USER_NAME) : "");
+    }
+
+    public Single<String> getUserEmail() {
+        return dataStore.data().firstOrError()
+                .map(prefs -> prefs.get(KEY_USER_EMAIL) != null ? prefs.get(KEY_USER_EMAIL) : "");
+    }
+
+    public Completable saveAppearance(String language, String theme) {
+        return dataStore.updateDataAsync(prefs -> {
+            MutablePreferences mutable = prefs.toMutablePreferences();
+            if (language != null) {
+                mutable.set(KEY_LANGUAGE, language);
+            }
+            if (theme != null) {
+                mutable.set(KEY_THEME, theme);
+            }
+            return Single.just(mutable);
+        }).ignoreElement();
+    }
+
+    public Completable saveUserProfile(String name, String email) {
+        return dataStore.updateDataAsync(prefs -> {
+            MutablePreferences mutable = prefs.toMutablePreferences();
+            if (name != null) {
+                mutable.set(KEY_USER_NAME, name);
+            }
+            if (email != null) {
+                mutable.set(KEY_USER_EMAIL, email);
+            }
+            return Single.just(mutable);
+        }).ignoreElement();
+    }
+}
+
+
Index: app/src/main/java/com/finmate/data/remote/api/AuthService.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.remote.api;\r\n\r\nimport com.finmate.data.dto.LoginRequest;\r\nimport com.finmate.data.dto.RegisterRequest;\r\nimport com.finmate.data.dto.TokenResponse;\r\nimport com.finmate.data.dto.RefreshTokenRequest;\r\n\r\nimport retrofit2.Call;\r\nimport retrofit2.http.Body;\r\nimport retrofit2.http.POST;\r\n\r\npublic interface AuthService {\r\n    @POST(\"auth/register\")\r\n    Call<TokenResponse> register(@Body RegisterRequest request);\r\n\r\n    @POST(\"auth/login\")\r\n    Call<TokenResponse> login(@Body LoginRequest request);\r\n\r\n    @POST(\"auth/refresh\")\r\n    Call<TokenResponse> refresh(@Body RefreshTokenRequest request);\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/remote/api/AuthService.java b/app/src/main/java/com/finmate/data/remote/api/AuthService.java
--- a/app/src/main/java/com/finmate/data/remote/api/AuthService.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/remote/api/AuthService.java	(date 1765447595522)
@@ -1,21 +1,22 @@
 package com.finmate.data.remote.api;
 
 import com.finmate.data.dto.LoginRequest;
+import com.finmate.data.dto.RefreshTokenRequest;
 import com.finmate.data.dto.RegisterRequest;
 import com.finmate.data.dto.TokenResponse;
-import com.finmate.data.dto.RefreshTokenRequest;
 
-import retrofit2.Call;
+import io.reactivex.rxjava3.core.Single;
 import retrofit2.http.Body;
 import retrofit2.http.POST;
 
 public interface AuthService {
+
     @POST("auth/register")
-    Call<TokenResponse> register(@Body RegisterRequest request);
+    Single<TokenResponse> register(@Body RegisterRequest request);
 
     @POST("auth/login")
-    Call<TokenResponse> login(@Body LoginRequest request);
+    Single<TokenResponse> login(@Body LoginRequest request);
 
     @POST("auth/refresh")
-    Call<TokenResponse> refresh(@Body RefreshTokenRequest request);
+    Single<TokenResponse> refreshToken(@Body RefreshTokenRequest request);
 }
Index: app/src/main/java/com/finmate/data/dto/WalletRequest.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/dto/WalletRequest.java b/app/src/main/java/com/finmate/data/dto/WalletRequest.java
new file mode 100644
--- /dev/null	(date 1765447595509)
+++ b/app/src/main/java/com/finmate/data/dto/WalletRequest.java	(date 1765447595509)
@@ -0,0 +1,77 @@
+package com.finmate.data.dto;
+
+import java.math.BigDecimal;
+
+/**
+ * DTO matching backend WalletRequest
+ */
+public class WalletRequest {
+    private String name;
+    private String type; // CASH, BANK, ...
+    private String currency; // VND, USD...
+    private BigDecimal initialBalance;
+    private Boolean archived;
+    private String color;
+
+    public WalletRequest() {
+    }
+
+    public WalletRequest(String name, String type, String currency, BigDecimal initialBalance, Boolean archived, String color) {
+        this.name = name;
+        this.type = type;
+        this.currency = currency;
+        this.initialBalance = initialBalance;
+        this.archived = archived;
+        this.color = color;
+    }
+
+    public String getName() {
+        return name;
+    }
+
+    public void setName(String name) {
+        this.name = name;
+    }
+
+    public String getType() {
+        return type;
+    }
+
+    public void setType(String type) {
+        this.type = type;
+    }
+
+    public String getCurrency() {
+        return currency;
+    }
+
+    public void setCurrency(String currency) {
+        this.currency = currency;
+    }
+
+    public BigDecimal getInitialBalance() {
+        return initialBalance;
+    }
+
+    public void setInitialBalance(BigDecimal initialBalance) {
+        this.initialBalance = initialBalance;
+    }
+
+    public Boolean getArchived() {
+        return archived;
+    }
+
+    public void setArchived(Boolean archived) {
+        this.archived = archived;
+    }
+
+    public String getColor() {
+        return color;
+    }
+
+    public void setColor(String color) {
+        this.color = color;
+    }
+}
+
+
Index: app/src/main/java/com/finmate/data/remote/api/WalletService.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.remote.api;\r\n\r\nimport com.finmate.data.dto.WalletResponse;\r\n\r\nimport java.util.List;\r\n\r\nimport retrofit2.Call;\r\nimport retrofit2.http.GET;\r\n\r\npublic interface WalletService {\r\n\r\n    // Gắn baseUrl ở Retrofit, chỗ này chỉ cần path\r\n    @GET(\"wallets\")\r\n    Call<List<WalletResponse>> getMyWallets();\r\n\r\n    // Sau này có thể thêm: create/update/delete nếu cần\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/remote/api/WalletService.java b/app/src/main/java/com/finmate/data/remote/api/WalletService.java
--- a/app/src/main/java/com/finmate/data/remote/api/WalletService.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/remote/api/WalletService.java	(date 1765447595524)
@@ -1,11 +1,17 @@
 package com.finmate.data.remote.api;
 
 import com.finmate.data.dto.WalletResponse;
+import com.finmate.data.dto.WalletRequest;
 
 import java.util.List;
 
 import retrofit2.Call;
 import retrofit2.http.GET;
+import retrofit2.http.POST;
+import retrofit2.http.PUT;
+import retrofit2.http.DELETE;
+import retrofit2.http.Body;
+import retrofit2.http.Path;
 
 public interface WalletService {
 
@@ -13,5 +19,15 @@
     @GET("wallets")
     Call<List<WalletResponse>> getMyWallets();
 
-    // Sau này có thể thêm: create/update/delete nếu cần
+    @GET("wallets/{id}")
+    Call<WalletResponse> getWalletById(@Path("id") String id);
+
+    @POST("wallets")
+    Call<WalletResponse> createWallet(@Body WalletRequest request);
+
+    @PUT("wallets/{id}")
+    Call<WalletResponse> updateWallet(@Path("id") String id, @Body WalletRequest request);
+
+    @DELETE("wallets/{id}")
+    Call<Void> deleteWallet(@Path("id") String id);
 }
Index: .vscode/settings.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.vscode/settings.json b/.vscode/settings.json
new file mode 100644
--- /dev/null	(date 1765447595492)
+++ b/.vscode/settings.json	(date 1765447595492)
@@ -0,0 +1,3 @@
+{
+    "java.configuration.updateBuildConfiguration": "interactive"
+}
\ No newline at end of file
Index: app/src/main/java/com/finmate/ui/friend/FriendCacheStatus.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/friend/FriendCacheStatus.kt b/app/src/main/java/com/finmate/ui/friend/FriendCacheStatus.kt
new file mode 100644
--- /dev/null	(date 1765447595553)
+++ b/app/src/main/java/com/finmate/ui/friend/FriendCacheStatus.kt	(date 1765447595553)
@@ -0,0 +1,7 @@
+package com.finmate.ui.friend
+
+enum class FriendCacheStatus {
+    ONLINE,
+    OFFLINE
+}
+
Index: app/src/main/res/layout/activity_home.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    android:background=\"?attr/backgroundColor\"\r\n    android:orientation=\"vertical\"\r\n    tools:context=\".ui.activities.HomeActivity\">\r\n\r\n    <!-- ====== HEADER NGƯỜI DÙNG + MENU 3 CHẤM ====== -->\r\n    <LinearLayout\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:gravity=\"center_vertical\"\r\n        android:orientation=\"horizontal\"\r\n        android:paddingHorizontal=\"16dp\"\r\n        android:paddingTop=\"16dp\"\r\n        android:paddingBottom=\"12dp\">\r\n\r\n        <!-- Avatar -->\r\n        <ImageView\r\n            android:id=\"@+id/imgAvatar\"\r\n            android:layout_width=\"55dp\"\r\n            android:layout_height=\"55dp\"\r\n            android:layout_marginEnd=\"12dp\"\r\n            android:background=\"@drawable/bg_circle\"\r\n            android:padding=\"5dp\"\r\n            android:src=\"@drawable/taikhoan\"\r\n            app:tint=\"@null\"/>\r\n\r\n        <!-- Hello + Name -->\r\n        <LinearLayout\r\n            android:layout_width=\"0dp\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_weight=\"1\"\r\n            android:orientation=\"vertical\">\r\n\r\n            <TextView\r\n                android:id=\"@+id/tvHello\"\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:text=\"@string/greeting\"\r\n                android:textColor=\"?attr/colorOnPrimary\"\r\n                android:textSize=\"16sp\" />\r\n\r\n            <TextView\r\n                android:id=\"@+id/tvName\"\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:text=\"Minh Hoa\"\r\n                android:textColor=\"?attr/colorOnPrimary\"\r\n                android:textSize=\"18sp\"\r\n                android:textStyle=\"bold\" />\r\n        </LinearLayout>\r\n\r\n        <!-- MENU 3 CHẤM -->\r\n        <ImageView\r\n            android:id=\"@+id/btnMenuMore\"\r\n            android:layout_width=\"26dp\"\r\n            android:layout_height=\"26dp\"\r\n            android:padding=\"4dp\"\r\n            android:src=\"@drawable/ic_more_vertical\"\r\n            app:tint=\"#FFFFFF\" />\r\n    </LinearLayout>\r\n\r\n    <LinearLayout\r\n        android:id=\"@+id/chartContainer\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"210dp\"\r\n        android:layout_margin=\"16dp\"\r\n        android:background=\"@drawable/bg_card\"\r\n        android:backgroundTint=\"?attr/cardBackgroundColor\"\r\n        android:elevation=\"4dp\"\r\n        android:orientation=\"vertical\"\r\n        android:padding=\"12dp\">\r\n\r\n        <TextView\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_gravity=\"center_horizontal\"\r\n            android:text=\"@string/chart_title\"\r\n            android:textColor=\"?attr/textColorSecondary\"\r\n            android:textSize=\"14sp\" />\r\n\r\n        <com.github.mikephil.charting.charts.LineChart\r\n            android:id=\"@+id/lineChart\"\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"match_parent\"\r\n            android:layout_marginTop=\"8dp\" />\r\n    </LinearLayout>\r\n\r\n    <!-- ====== DANH SÁCH GIAO DỊCH ====== -->\r\n    <androidx.recyclerview.widget.RecyclerView\r\n        android:id=\"@+id/rvTransactions\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"0dp\"\r\n        android:layout_weight=\"1\"\r\n        android:clipToPadding=\"false\"\r\n        android:paddingBottom=\"16dp\" />\r\n\r\n    <com.google.android.material.bottomnavigation.BottomNavigationView\r\n        android:id=\"@+id/bottomNavigation\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"65dp\"\r\n        android:layout_alignParentBottom=\"true\"\r\n        app:menu=\"@menu/menu_bottom\"\r\n        app:itemIconTint=\"@null\"\r\n        app:itemTextColor=\"@color/bottom_navigation_color\"\r\n        app:itemRippleColor=\"@android:color/transparent\"\r\n        android:background=\"?attr/bottomNavBackgroundColor\"/>\r\n\r\n</LinearLayout>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/layout/activity_home.xml b/app/src/main/res/layout/activity_home.xml
--- a/app/src/main/res/layout/activity_home.xml	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/res/layout/activity_home.xml	(date 1765447595556)
@@ -6,7 +6,7 @@
     android:layout_height="match_parent"
     android:background="?attr/backgroundColor"
     android:orientation="vertical"
-    tools:context=".ui.activities.HomeActivity">
+    tools:context=".ui.home.HomeActivity">
 
     <!-- ====== HEADER NGƯỜI DÙNG + MENU 3 CHẤM ====== -->
     <LinearLayout
Index: app/src/main/java/com/finmate/ui/activities/SettingsActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/activities/SettingsActivity.java b/app/src/main/java/com/finmate/ui/settings/SettingsActivity.java
rename from app/src/main/java/com/finmate/ui/activities/SettingsActivity.java
rename to app/src/main/java/com/finmate/ui/settings/SettingsActivity.java
--- a/app/src/main/java/com/finmate/ui/activities/SettingsActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/settings/SettingsActivity.java	(date 1765447595556)
@@ -1,4 +1,4 @@
-package com.finmate.ui.activities;
+package com.finmate.ui.settings;
 
 import android.content.Intent;
 import android.os.Bundle;
@@ -6,21 +6,27 @@
 import android.widget.LinearLayout;
 
 import com.finmate.R;
+import com.finmate.ui.auth.AccountActivity;
+import com.finmate.ui.activities.CategoryIncomeActivity;
+import com.finmate.ui.activities.LanguageSettingActivity;
+import com.finmate.ui.activities.NotificationSettingsActivity;
 import com.finmate.ui.base.BaseActivity;
 import com.finmate.ui.dialogs.ThemeDialog;
+import com.finmate.ui.friend.FriendActivity;
+
 
 public class SettingsActivity extends BaseActivity {
 
-    private ImageView btnBack;
-    private LinearLayout btnLanguage, btnCategory, btnTheme, btnFriend, btnAccount, btnNotification;
+    ImageView btnBack;
+    LinearLayout btnLanguage, btnCategory, btnTheme, btnFriend, btnAccount, btnNotification;
 
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
         setContentView(R.layout.activity_settings);
 
+        // ÁNH XẠ
         initViews();
-        setupListeners();
     }
 
     private void initViews() {
@@ -31,39 +37,39 @@
         btnFriend = findViewById(R.id.btnFriend);
         btnAccount = findViewById(R.id.btnAccount);
         btnNotification = findViewById(R.id.btnNotification);
-    }
 
-    private void setupListeners() {
-
+        // Nút quay lại
         btnBack.setOnClickListener(v -> finish());
 
-        // Ngôn ngữ
+        // ===================== XỬ LÝ CÁC NÚT ========================
+
+        // 1. Ngôn ngữ
         btnLanguage.setOnClickListener(v ->
                 startActivity(new Intent(this, LanguageSettingActivity.class))
         );
 
-        // Thể loại
+        // 2. Quản lý thể loại
         btnCategory.setOnClickListener(v ->
                 startActivity(new Intent(this, CategoryIncomeActivity.class))
         );
 
-        // Giao diện (Theme)
+        // 3. Giao diện hệ thống (mở BottomSheet / Dialog)
         btnTheme.setOnClickListener(v -> {
             ThemeDialog dialog = new ThemeDialog();
             dialog.show(getSupportFragmentManager(), "theme_dialog");
         });
 
-        // Bạn bè
+        // 4. Bạn bè
         btnFriend.setOnClickListener(v ->
                 startActivity(new Intent(this, FriendActivity.class))
         );
 
-        // Tài khoản
+        // 5. Tài khoản
         btnAccount.setOnClickListener(v ->
                 startActivity(new Intent(this, AccountActivity.class))
         );
 
-        // Thông báo
+        // 6. Thông báo
         btnNotification.setOnClickListener(v ->
                 startActivity(new Intent(this, NotificationSettingsActivity.class))
         );
Index: app/src/main/java/com/finmate/data/remote/api/TransactionService.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.remote.api;\r\n\r\nimport com.finmate.data.dto.TransactionPageResponse;\r\n\r\nimport retrofit2.Call;\r\nimport retrofit2.http.GET;\r\nimport retrofit2.http.Query;\r\n\r\npublic interface TransactionService {\r\n\r\n    /**\r\n     * Gọi tới GET /transactions bên BE.\r\n     * Anh chỉnh lại query param cho khớp với TransactionController (walletId, from, to...).\r\n     */\r\n    @GET(\"transactions\")\r\n    Call<TransactionPageResponse> getTransactions(\r\n            @Query(\"walletId\") String walletId\r\n            // có thể thêm @Query(\"from\") String from, @Query(\"to\") String to nếu cần\r\n    );\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/remote/api/TransactionService.java b/app/src/main/java/com/finmate/data/remote/api/TransactionService.java
--- a/app/src/main/java/com/finmate/data/remote/api/TransactionService.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/remote/api/TransactionService.java	(date 1765447595522)
@@ -1,20 +1,41 @@
 package com.finmate.data.remote.api;
 
 import com.finmate.data.dto.TransactionPageResponse;
+import com.finmate.data.dto.TransactionResponse;
+import com.finmate.data.remote.dto.CreateTransactionRequest;
+import com.finmate.data.remote.dto.UpdateTransactionRequest;
 
 import retrofit2.Call;
+import retrofit2.http.Body;
+import retrofit2.http.DELETE;
 import retrofit2.http.GET;
+import retrofit2.http.POST;
+import retrofit2.http.PUT;
+import retrofit2.http.Path;
 import retrofit2.http.Query;
 
 public interface TransactionService {
 
-    /**
-     * Gọi tới GET /transactions bên BE.
-     * Anh chỉnh lại query param cho khớp với TransactionController (walletId, from, to...).
-     */
     @GET("transactions")
     Call<TransactionPageResponse> getTransactions(
-            @Query("walletId") String walletId
-            // có thể thêm @Query("from") String from, @Query("to") String to nếu cần
+            @Query("from") String from,
+            @Query("to") String to,
+            @Query("walletId") String walletId,
+            @Query("categoryId") String categoryId,
+            @Query("type") String type,
+            @Query("page") int page,
+            @Query("size") int size
     );
+
+    @GET("transactions/{id}")
+    Call<TransactionResponse> getTransactionById(@Path("id") String id);
+
+    @POST("transactions")
+    Call<TransactionResponse> createTransaction(@Body CreateTransactionRequest request);
+
+    @PUT("transactions/{id}")
+    Call<TransactionResponse> updateTransaction(@Path("id") String id, @Body UpdateTransactionRequest request);
+
+    @DELETE("transactions/{id}")
+    Call<Void> deleteTransaction(@Path("id") String id);
 }
Index: app/src/main/java/com/finmate/core/network/SyncOnlineStatusManager.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/core/network/SyncOnlineStatusManager.java b/app/src/main/java/com/finmate/core/network/SyncOnlineStatusManager.java
new file mode 100644
--- /dev/null	(date 1765447595493)
+++ b/app/src/main/java/com/finmate/core/network/SyncOnlineStatusManager.java	(date 1765447595493)
@@ -0,0 +1,61 @@
+package com.finmate.core.network;
+
+import androidx.annotation.Nullable;
+
+import java.util.concurrent.atomic.AtomicBoolean;
+
+import javax.inject.Inject;
+import javax.inject.Singleton;
+
+@Singleton
+public class SyncOnlineStatusManager {
+
+    private static final long BASE_BLOCK_DURATION_MS = 30_000; // 30 seconds
+    private static final int MAX_BACKOFF_LEVEL = 3;
+
+    private final AtomicBoolean blocked = new AtomicBoolean(false);
+    private volatile long blockUntilTimeMillis = 0L;
+    private volatile int backoffLevel = 0;
+
+    @Inject
+    public SyncOnlineStatusManager() {
+    }
+
+    public boolean canSyncNow() {
+        if (!blocked.get()) {
+            return true;
+        }
+
+        if (System.currentTimeMillis() >= blockUntilTimeMillis) {
+            blocked.set(false);
+            backoffLevel = 0; // Reset backoff when block expires
+            return true;
+        }
+
+        return false;
+    }
+
+    public void onSyncSuccess() {
+        blocked.set(false);
+        blockUntilTimeMillis = 0L;
+        backoffLevel = 0;
+    }
+
+    public void onSyncError(@Nullable Integer httpCode, @Nullable Throwable t) {
+        boolean shouldBlock =
+                t instanceof java.io.IOException ||
+                (httpCode != null && httpCode >= 500 && httpCode <= 599);
+
+        if (!shouldBlock) {
+            return; // Not a network/server error, don't block global sync
+        }
+
+        if (backoffLevel < MAX_BACKOFF_LEVEL) {
+            backoffLevel++;
+        }
+
+        long blockDuration = BASE_BLOCK_DURATION_MS * backoffLevel;
+        blocked.set(true);
+        blockUntilTimeMillis = System.currentTimeMillis() + blockDuration;
+    }
+}
Index: app/src/main/res/layout/activity_statistic.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    android:background=\"?attr/backgroundColor\"\r\n    android:orientation=\"vertical\">\r\n\r\n    <!-- BACK BUTTON -->\r\n    <LinearLayout\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:orientation=\"horizontal\"\r\n        android:padding=\"16dp\">\r\n\r\n        <ImageView\r\n            android:id=\"@+id/btnBack\"\r\n            android:layout_width=\"28dp\"\r\n            android:layout_height=\"28dp\"\r\n            android:padding=\"4dp\"\r\n            android:src=\"@drawable/ic_back\"\r\n            app:tint=\"?attr/iconTint\" />\r\n    </LinearLayout>\r\n\r\n    <!-- TAB CHI TIÊU - THU NHẬP -->\r\n    <LinearLayout\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:orientation=\"horizontal\"\r\n        android:paddingHorizontal=\"16dp\"\r\n        android:paddingBottom=\"8dp\">\r\n\r\n        <TextView\r\n            android:id=\"@+id/tvExpenseTab\"\r\n            android:layout_width=\"0dp\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_weight=\"1\"\r\n            android:text=\"Chi tiêu\"\r\n            android:textColor=\"#FFFFFF\"\r\n            android:textStyle=\"bold\"\r\n            android:textSize=\"18sp\"\r\n            android:gravity=\"center\" />\r\n\r\n        <TextView\r\n            android:id=\"@+id/tvIncomeTab\"\r\n            android:layout_width=\"0dp\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_weight=\"1\"\r\n            android:text=\"Thu nhập\"\r\n            android:textColor=\"#777777\"\r\n            android:textSize=\"18sp\"\r\n            android:gravity=\"center\" />\r\n    </LinearLayout>\r\n\r\n    <!-- TOTAL EXPENSE -->\r\n    <TextView\r\n        android:id=\"@+id/tvTotalExpense\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"-12,500,000 VND\"\r\n        android:textColor=\"#FFFFFF\"\r\n        android:textSize=\"16sp\"\r\n        android:layout_marginStart=\"16dp\"\r\n        android:layout_marginBottom=\"12dp\" />\r\n\r\n    <!-- MAIN CONTENT -->\r\n    <ScrollView\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"0dp\"\r\n        android:layout_weight=\"1\">\r\n\r\n        <LinearLayout\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:orientation=\"vertical\"\r\n            android:padding=\"16dp\">\r\n\r\n            <!-- TITLE -->\r\n            <TextView\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:text=\"Thống kê chi tiêu theo tháng\"\r\n                android:textColor=\"#FFFFFF\"\r\n                android:textSize=\"16sp\"\r\n                android:textStyle=\"bold\" />\r\n\r\n            <!-- BAR CHART -->\r\n            <com.github.mikephil.charting.charts.BarChart\r\n                android:id=\"@+id/barChartExpense\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"220dp\"\r\n                android:layout_marginTop=\"12dp\" />\r\n\r\n            <!-- PIE TITLE -->\r\n            <TextView\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:text=\"So sánh các loại chi tiêu\"\r\n                android:textColor=\"#FFFFFF\"\r\n                android:textSize=\"16sp\"\r\n                android:textStyle=\"bold\"\r\n                android:layout_marginTop=\"24dp\" />\r\n\r\n            <!-- PIE CHART -->\r\n            <com.github.mikephil.charting.charts.PieChart\r\n                android:id=\"@+id/pieChartExpense\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"260dp\"\r\n                android:layout_marginTop=\"8dp\" />\r\n\r\n        </LinearLayout>\r\n    </ScrollView>\r\n\r\n    <!-- BOTTOM NAV -->\r\n    <com.google.android.material.bottomnavigation.BottomNavigationView\r\n        android:id=\"@+id/bottomNavigation\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"65dp\"\r\n        android:background=\"?attr/bottomNavBackgroundColor\"\r\n        app:itemTextColor=\"@color/selector_nav_color\"\r\n        app:menu=\"@menu/menu_bottom\" />\r\n\r\n</LinearLayout>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/layout/activity_statistic.xml b/app/src/main/res/layout/activity_statistic.xml
--- a/app/src/main/res/layout/activity_statistic.xml	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/res/layout/activity_statistic.xml	(date 1765447595565)
@@ -52,6 +52,45 @@
             android:gravity="center" />
     </LinearLayout>
 
+    <!-- FILTERS -->
+    <LinearLayout
+        android:id="@+id/layoutFilters"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:orientation="horizontal"
+        android:paddingHorizontal="16dp"
+        android:paddingBottom="8dp">
+
+        <TextView
+            android:id="@+id/tvDateFilter"
+            android:layout_width="0dp"
+            android:layout_height="40dp"
+            android:layout_weight="1"
+            android:gravity="center_vertical"
+            android:paddingHorizontal="12dp"
+            android:text="Tháng này"
+            android:background="?attr/editTextBackground"
+            android:textColor="?attr/editTextColor"
+            android:textSize="14sp" />
+
+        <Space
+            android:layout_width="12dp"
+            android:layout_height="1dp" />
+
+        <TextView
+            android:id="@+id/tvWalletFilter"
+            android:layout_width="0dp"
+            android:layout_height="40dp"
+            android:layout_weight="1"
+            android:gravity="center_vertical"
+            android:paddingHorizontal="12dp"
+            android:text="Tất cả ví"
+            android:background="?attr/editTextBackground"
+            android:textColor="?attr/editTextColor"
+            android:textSize="14sp" />
+
+    </LinearLayout>
+
     <!-- TOTAL EXPENSE -->
     <TextView
         android:id="@+id/tvTotalExpense"
Index: app/src/main/java/com/finmate/data/local/datastore/AuthLocalDataSource.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.local.datastore;\r\n\r\nimport androidx.datastore.preferences.core.MutablePreferences;\r\nimport androidx.datastore.preferences.core.Preferences;\r\nimport androidx.datastore.preferences.core.PreferencesKeys;\r\nimport androidx.datastore.rxjava3.RxDataStore;\r\n\r\nimport javax.inject.Inject;\r\nimport javax.inject.Singleton;\r\n\r\nimport io.reactivex.rxjava3.core.Flowable;\r\nimport io.reactivex.rxjava3.core.Single;\r\n\r\n@Singleton\r\npublic class AuthLocalDataSource {\r\n\r\n    private final RxDataStore<Preferences> dataStore;\r\n    \r\n    private static final Preferences.Key<String> ACCESS_TOKEN_KEY = PreferencesKeys.stringKey(\"access_token\");\r\n    private static final Preferences.Key<String> REFRESH_TOKEN_KEY = PreferencesKeys.stringKey(\"refresh_token\");\r\n\r\n    @Inject\r\n    public AuthLocalDataSource(RxDataStore<Preferences> dataStore) {\r\n        this.dataStore = dataStore;\r\n    }\r\n\r\n    public void saveTokens(String accessToken, String refreshToken) {\r\n        dataStore.updateDataAsync(prefs -> {\r\n            MutablePreferences mutablePreferences = prefs.toMutablePreferences();\r\n            mutablePreferences.set(ACCESS_TOKEN_KEY, accessToken);\r\n            mutablePreferences.set(REFRESH_TOKEN_KEY, refreshToken);\r\n            return Single.just(mutablePreferences);\r\n        });\r\n    }\r\n\r\n    public Flowable<String> getAccessToken() {\r\n        return dataStore.data()\r\n                .map(prefs -> prefs.get(ACCESS_TOKEN_KEY) != null ? prefs.get(ACCESS_TOKEN_KEY) : \"\")\r\n                .distinctUntilChanged();\r\n    }\r\n    \r\n    public Single<String> getAccessTokenSingle() {\r\n        return getAccessToken().first(\"\");\r\n    }\r\n\r\n    public void clearTokens() {\r\n        dataStore.updateDataAsync(prefs -> {\r\n            MutablePreferences mutablePreferences = prefs.toMutablePreferences();\r\n            mutablePreferences.remove(ACCESS_TOKEN_KEY);\r\n            mutablePreferences.remove(REFRESH_TOKEN_KEY);\r\n            return Single.just(mutablePreferences);\r\n        });\r\n    }\r\n\r\n    public Single<String> getRefreshTokenSingle() {\r\n        return dataStore.data()\r\n                .map(prefs -> {\r\n                    String token = prefs.get(REFRESH_TOKEN_KEY);\r\n                    return token != null ? token : \"\";\r\n                })\r\n                .first(\"\");\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/datastore/AuthLocalDataSource.java b/app/src/main/java/com/finmate/data/local/datastore/AuthLocalDataSource.java
--- a/app/src/main/java/com/finmate/data/local/datastore/AuthLocalDataSource.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/local/datastore/AuthLocalDataSource.java	(date 1765447595520)
@@ -7,7 +7,9 @@
 
 import javax.inject.Inject;
 import javax.inject.Singleton;
+import javax.inject.Named;
 
+import io.reactivex.rxjava3.core.Completable;
 import io.reactivex.rxjava3.core.Flowable;
 import io.reactivex.rxjava3.core.Single;
 
@@ -15,50 +17,47 @@
 public class AuthLocalDataSource {
 
     private final RxDataStore<Preferences> dataStore;
-    
-    private static final Preferences.Key<String> ACCESS_TOKEN_KEY = PreferencesKeys.stringKey("access_token");
-    private static final Preferences.Key<String> REFRESH_TOKEN_KEY = PreferencesKeys.stringKey("refresh_token");
+
+    private static final Preferences.Key<String> KEY_ACCESS_TOKEN =
+            PreferencesKeys.stringKey("access_token");
+    private static final Preferences.Key<String> KEY_REFRESH_TOKEN =
+            PreferencesKeys.stringKey("refresh_token");
 
     @Inject
-    public AuthLocalDataSource(RxDataStore<Preferences> dataStore) {
+    public AuthLocalDataSource(@Named("authDataStore") RxDataStore<Preferences> dataStore) {
         this.dataStore = dataStore;
     }
 
-    public void saveTokens(String accessToken, String refreshToken) {
-        dataStore.updateDataAsync(prefs -> {
-            MutablePreferences mutablePreferences = prefs.toMutablePreferences();
-            mutablePreferences.set(ACCESS_TOKEN_KEY, accessToken);
-            mutablePreferences.set(REFRESH_TOKEN_KEY, refreshToken);
-            return Single.just(mutablePreferences);
-        });
-    }
-
-    public Flowable<String> getAccessToken() {
+    public Flowable<String> getAccessTokenFlow() {
         return dataStore.data()
-                .map(prefs -> prefs.get(ACCESS_TOKEN_KEY) != null ? prefs.get(ACCESS_TOKEN_KEY) : "")
-                .distinctUntilChanged();
+                .map(prefs -> prefs.get(KEY_ACCESS_TOKEN) != null ? prefs.get(KEY_ACCESS_TOKEN) : "");
     }
-    
+
     public Single<String> getAccessTokenSingle() {
-        return getAccessToken().first("");
-    }
-
-    public void clearTokens() {
-        dataStore.updateDataAsync(prefs -> {
-            MutablePreferences mutablePreferences = prefs.toMutablePreferences();
-            mutablePreferences.remove(ACCESS_TOKEN_KEY);
-            mutablePreferences.remove(REFRESH_TOKEN_KEY);
-            return Single.just(mutablePreferences);
-        });
+        return dataStore.data().firstOrError()
+                .map(prefs -> prefs.get(KEY_ACCESS_TOKEN) != null ? prefs.get(KEY_ACCESS_TOKEN) : "");
     }
 
     public Single<String> getRefreshTokenSingle() {
-        return dataStore.data()
-                .map(prefs -> {
-                    String token = prefs.get(REFRESH_TOKEN_KEY);
-                    return token != null ? token : "";
-                })
-                .first("");
+        return dataStore.data().firstOrError()
+                .map(prefs -> prefs.get(KEY_REFRESH_TOKEN) != null ? prefs.get(KEY_REFRESH_TOKEN) : "");
+    }
+
+    public Completable saveTokens(String accessToken, String refreshToken) {
+        return dataStore.updateDataAsync(prefs -> {
+            MutablePreferences mutable = prefs.toMutablePreferences();
+            mutable.set(KEY_ACCESS_TOKEN, accessToken);
+            mutable.set(KEY_REFRESH_TOKEN, refreshToken);
+            return Single.just(mutable);
+        }).ignoreElement();
     }
 
+    public Completable clearTokens() {
+        return dataStore.updateDataAsync(prefs -> {
+            MutablePreferences mutable = prefs.toMutablePreferences();
+            mutable.remove(KEY_ACCESS_TOKEN);
+            mutable.remove(KEY_REFRESH_TOKEN);
+            return Single.just(mutable);
+        }).ignoreElement();
+    }
 }
Index: app/src/main/java/com/finmate/data/local/database/entity/TransactionEntity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.local.database.entity;\r\n\r\nimport androidx.room.Entity;\r\nimport androidx.room.PrimaryKey;\r\n\r\n@Entity(tableName = \"transactions\")\r\npublic class TransactionEntity {\r\n\r\n    @PrimaryKey(autoGenerate = true)\r\n    public int id;\r\n\r\n    public String name;\r\n    public String category;\r\n    public String amount;\r\n    public String wallet;\r\n    public String date;\r\n\r\n    public TransactionEntity(String name, String category, String amount, String wallet, String date) {\r\n        this.name = name;\r\n        this.category = category;\r\n        this.amount = amount;\r\n        this.wallet = wallet;\r\n        this.date = date;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/database/entity/TransactionEntity.java b/app/src/main/java/com/finmate/data/local/database/entity/TransactionEntity.java
--- a/app/src/main/java/com/finmate/data/local/database/entity/TransactionEntity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/local/database/entity/TransactionEntity.java	(date 1765447595509)
@@ -1,25 +1,180 @@
 package com.finmate.data.local.database.entity;
 
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
 import androidx.room.Entity;
+import androidx.room.Ignore;
 import androidx.room.PrimaryKey;
 
+import com.finmate.core.offline.OfflineSyncEntity;
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+
+/**
+ * Entity lưu dữ liệu thô (domain model), không format cho UI.
+ * - amount: double (số tiền gốc, không format)
+ * - occurredAt: String (ISO datetime từ BE, hoặc ISO format khi tạo local)
+ */
 @Entity(tableName = "transactions")
-public class TransactionEntity {
+public class TransactionEntity implements OfflineSyncEntity {
 
     @PrimaryKey(autoGenerate = true)
     public int id;
 
+    @Nullable
+    public String remoteId;
+
+    @NonNull
     public String name;
-    public String category;
-    public String amount;
-    public String wallet;
-    public String date;
+    @NonNull
+    public String categoryName;
+    @NonNull
+    public double amount;  // Raw value for calculations
+    @NonNull
+    public String walletName;
+    @NonNull
+    public String occurredAt;  // ISO datetime string
+
+    @NonNull
+    public String type; // INCOME / EXPENSE / TRANSFER
+
+    @NonNull
+    public String syncStatus;
+
+    @NonNull
+    public String pendingAction;
+
+    public long updatedAt;
 
-    public TransactionEntity(String name, String category, String amount, String wallet, String date) {
+    // Constructor for creating a new local (pending) transaction
+    public TransactionEntity(@NonNull String name, @NonNull String categoryName, double amount, @NonNull String walletName, @NonNull String occurredAt) {
+        this.name = name;
+        this.categoryName = categoryName;
+        this.amount = amount;
+        this.walletName = walletName;
+        this.occurredAt = occurredAt;
+        this.type = "EXPENSE";
+        this.syncStatus = SyncStatus.PENDING_CREATE;
+        this.pendingAction = PendingAction.CREATE;
+        this.updatedAt = System.currentTimeMillis();
+    }
+
+    // Constructor for creating a synced transaction from a server response
+    @Ignore
+    public TransactionEntity(@NonNull String remoteId, @NonNull String name, @NonNull String categoryName, double amount, @NonNull String walletName, @NonNull String occurredAt, @NonNull String type) {
+        this.remoteId = remoteId;
+        this.name = name;
+        this.categoryName = categoryName;
+        this.amount = amount;
+        this.walletName = walletName;
+        this.occurredAt = occurredAt;
+        this.type = type;
+        this.syncStatus = SyncStatus.SYNCED;
+        this.pendingAction = PendingAction.NONE;
+        this.updatedAt = System.currentTimeMillis();
+    }
+
+    public int getId() {
+        return id;
+    }
+
+    public void setId(int id) {
+        this.id = id;
+    }
+
+    @Nullable
+    @Override
+    public String getRemoteId() {
+        return remoteId;
+    }
+
+    @Override
+    public void setRemoteId(@Nullable String remoteId) {
+        this.remoteId = remoteId;
+    }
+
+    @NonNull
+    public String getName() {
+        return name;
+    }
+
+    public void setName(@NonNull String name) {
         this.name = name;
-        this.category = category;
+    }
+
+    @NonNull
+    public String getCategoryName() {
+        return categoryName;
+    }
+
+    public void setCategoryName(@NonNull String categoryName) {
+        this.categoryName = categoryName;
+    }
+
+    public double getAmount() {
+        return amount;
+    }
+
+    public void setAmount(double amount) {
         this.amount = amount;
-        this.wallet = wallet;
-        this.date = date;
+    }
+
+    @NonNull
+    public String getWalletName() {
+        return walletName;
+    }
+
+    public void setWalletName(@NonNull String walletName) {
+        this.walletName = walletName;
+    }
+
+    @NonNull
+    public String getType() {
+        return type;
+    }
+
+    public void setType(@NonNull String type) {
+        this.type = type;
+    }
+
+    @NonNull
+    public String getOccurredAt() {
+        return occurredAt;
+    }
+
+    public void setOccurredAt(@NonNull String occurredAt) {
+        this.occurredAt = occurredAt;
+    }
+
+    @NonNull
+    @Override
+    public String getSyncStatus() {
+        return syncStatus;
+    }
+
+    @Override
+    public void setSyncStatus(@NonNull String syncStatus) {
+        this.syncStatus = syncStatus;
+    }
+
+    @NonNull
+    @Override
+    public String getPendingAction() {
+        return pendingAction;
+    }
+
+    @Override
+    public void setPendingAction(@NonNull String pendingAction) {
+        this.pendingAction = pendingAction;
+    }
+
+    @Override
+    public long getUpdatedAt() {
+        return updatedAt;
+    }
+
+    @Override
+    public void setUpdatedAt(long updatedAt) {
+        this.updatedAt = updatedAt;
     }
 }
Index: app/src/main/java/com/finmate/data/local/database/entity/CategoryEntity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.local.database.entity;\r\n\r\nimport androidx.room.Entity;\r\nimport androidx.room.PrimaryKey;\r\n\r\n@Entity(tableName = \"categories\")\r\npublic class CategoryEntity {\r\n\r\n    @PrimaryKey(autoGenerate = true)\r\n    private int id;\r\n\r\n    private String name;     // Tên category\r\n    private String type;     // income / expense\r\n    private String icon;     // Icon dạng string từ server, ví dụ \"ic_food\"\r\n\r\n    public CategoryEntity(String name, String type, String icon) {\r\n        this.name = name;\r\n        this.type = type;\r\n        this.icon = icon;\r\n    }\r\n\r\n    // Getters\r\n    public int getId() {\r\n        return id;\r\n    }\r\n\r\n    public String getName() {\r\n        return name;\r\n    }\r\n\r\n    public String getType() {\r\n        return type;\r\n    }\r\n\r\n    public String getIcon() {\r\n        return icon;\r\n    }\r\n\r\n    // Setters\r\n    public void setId(int id) {\r\n        this.id = id;\r\n    }\r\n\r\n    public void setName(String name) {\r\n        this.name = name;\r\n    }\r\n\r\n    public void setType(String type) {\r\n        this.type = type;\r\n    }\r\n\r\n    public void setIcon(String icon) {\r\n        this.icon = icon;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/database/entity/CategoryEntity.java b/app/src/main/java/com/finmate/data/local/database/entity/CategoryEntity.java
--- a/app/src/main/java/com/finmate/data/local/database/entity/CategoryEntity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/local/database/entity/CategoryEntity.java	(date 1765447595509)
@@ -1,55 +1,124 @@
 package com.finmate.data.local.database.entity;
 
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
 import androidx.room.Entity;
 import androidx.room.PrimaryKey;
 
+import com.finmate.core.offline.OfflineSyncEntity;
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+
 @Entity(tableName = "categories")
-public class CategoryEntity {
+public class CategoryEntity implements OfflineSyncEntity {
 
     @PrimaryKey(autoGenerate = true)
-    private int id;
+    public int id;
+
+    @Nullable
+    public String remoteId;
 
-    private String name;     // Tên category
-    private String type;     // income / expense
-    private String icon;     // Icon dạng string từ server, ví dụ "ic_food"
+    public String name;
+    public String type;
+    public String icon;
+    public int iconRes;
 
-    public CategoryEntity(String name, String type, String icon) {
+    @NonNull
+    public String syncStatus;
+    @NonNull
+    public String pendingAction;
+    public long updatedAt;
+
+    public CategoryEntity(String name, String type, int iconRes) {
         this.name = name;
         this.type = type;
-        this.icon = icon;
+        this.iconRes = iconRes;
+        this.icon = "";
+        this.syncStatus = SyncStatus.PENDING_CREATE;
+        this.pendingAction = PendingAction.CREATE;
+        this.updatedAt = System.currentTimeMillis();
+    }
+
+    @Override
+    public long getUpdatedAt() {
+        return updatedAt;
+    }
+
+    @Override
+    public void setUpdatedAt(long updatedAt) {
+        this.updatedAt = updatedAt;
     }
 
-    // Getters
     public int getId() {
         return id;
     }
 
+    public void setId(int id) {
+        this.id = id;
+    }
+
+    @Nullable
+    @Override
+    public String getRemoteId() {
+        return remoteId;
+    }
+
+    @Override
+    public void setRemoteId(@Nullable String remoteId) {
+        this.remoteId = remoteId;
+    }
+
     public String getName() {
         return name;
     }
 
+    public void setName(String name) {
+        this.name = name;
+    }
+
     public String getType() {
         return type;
     }
 
+    public void setType(String type) {
+        this.type = type;
+    }
+
+    public int getIconRes() {
+        return iconRes;
+    }
+
+    public void setIconRes(int iconRes) {
+        this.iconRes = iconRes;
+    }
+
     public String getIcon() {
         return icon;
     }
 
-    // Setters
-    public void setId(int id) {
-        this.id = id;
-    }
-
-    public void setName(String name) {
-        this.name = name;
-    }
-
-    public void setType(String type) {
-        this.type = type;
-    }
-
     public void setIcon(String icon) {
         this.icon = icon;
     }
+
+    @NonNull
+    @Override
+    public String getSyncStatus() {
+        return syncStatus;
+    }
+
+    @Override
+    public void setSyncStatus(@NonNull String syncStatus) {
+        this.syncStatus = syncStatus;
+    }
+
+    @NonNull
+    @Override
+    public String getPendingAction() {
+        return pendingAction;
+    }
+
+    @Override
+    public void setPendingAction(@NonNull String pendingAction) {
+        this.pendingAction = pendingAction;
+    }
 }
Index: app/src/main/java/com/finmate/data/local/database/entity/WalletEntity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.local.database.entity;\r\n\r\nimport androidx.room.Entity;\r\nimport androidx.room.PrimaryKey;\r\n\r\n@Entity(tableName = \"wallets\")\r\npublic class WalletEntity {\r\n\r\n    @PrimaryKey(autoGenerate = true)\r\n    public int id;\r\n\r\n    public String name;\r\n    public String balance;\r\n    public int iconRes;\r\n\r\n    public WalletEntity(String name, String balance, int iconRes) {\r\n        this.name = name;\r\n        this.balance = balance;\r\n        this.iconRes = iconRes;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/database/entity/WalletEntity.java b/app/src/main/java/com/finmate/data/local/database/entity/WalletEntity.java
--- a/app/src/main/java/com/finmate/data/local/database/entity/WalletEntity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/local/database/entity/WalletEntity.java	(date 1765447595520)
@@ -1,21 +1,124 @@
 package com.finmate.data.local.database.entity;
 
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
 import androidx.room.Entity;
 import androidx.room.PrimaryKey;
 
+import com.finmate.core.offline.OfflineSyncEntity;
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+
 @Entity(tableName = "wallets")
-public class WalletEntity {
+public class WalletEntity implements OfflineSyncEntity {
 
     @PrimaryKey(autoGenerate = true)
     public int id;
 
+    @Nullable
+    public String remoteId;
+
     public String name;
-    public String balance;
+    public String currency;
+    public double balanceCached;
     public int iconRes;
 
-    public WalletEntity(String name, String balance, int iconRes) {
+    @NonNull
+    public String syncStatus;
+    @NonNull
+    public String pendingAction;
+    public long updatedAt;
+
+    public WalletEntity(String name, String currency, double balanceCached, int iconRes) {
+        this.name = name;
+        this.currency = currency;
+        this.balanceCached = balanceCached;
+        this.iconRes = iconRes;
+        this.syncStatus = SyncStatus.PENDING_CREATE;
+        this.pendingAction = PendingAction.CREATE;
+        this.updatedAt = System.currentTimeMillis();
+    }
+
+    public int getId() {
+        return id;
+    }
+
+    public void setId(int id) {
+        this.id = id;
+    }
+
+    @Nullable
+    @Override
+    public String getRemoteId() {
+        return remoteId;
+    }
+
+    @Override
+    public void setRemoteId(@Nullable String remoteId) {
+        this.remoteId = remoteId;
+    }
+
+    public String getName() {
+        return name;
+    }
+
+    public void setName(String name) {
         this.name = name;
-        this.balance = balance;
+    }
+
+    public double getBalanceCached() {
+        return balanceCached;
+    }
+
+    public void setBalanceCached(double balanceCached) {
+        this.balanceCached = balanceCached;
+    }
+
+    public int getIconRes() {
+        return iconRes;
+    }
+
+    public void setIconRes(int iconRes) {
         this.iconRes = iconRes;
     }
+
+    public String getCurrency() {
+        return currency;
+    }
+
+    public void setCurrency(String currency) {
+        this.currency = currency;
+    }
+
+    @NonNull
+    @Override
+    public String getSyncStatus() {
+        return syncStatus;
+    }
+
+    @Override
+    public void setSyncStatus(@NonNull String syncStatus) {
+        this.syncStatus = syncStatus;
+    }
+
+    @NonNull
+    @Override
+    public String getPendingAction() {
+        return pendingAction;
+    }
+
+    @Override
+    public void setPendingAction(@NonNull String pendingAction) {
+        this.pendingAction = pendingAction;
+    }
+
+    @Override
+    public long getUpdatedAt() {
+        return updatedAt;
+    }
+
+    @Override
+    public void setUpdatedAt(long updatedAt) {
+        this.updatedAt = updatedAt;
+    }
 }
Index: app/src/main/java/com/finmate/data/repository/CategoryRemoteRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.repository;\r\n\r\nimport com.finmate.core.network.ApiCallExecutor;\r\nimport com.finmate.core.network.ApiCallback;\r\nimport com.finmate.data.dto.CategoryRequest;\r\nimport com.finmate.data.dto.CategoryResponse;\r\n\r\nimport java.util.List;\r\n\r\nimport javax.inject.Inject;\r\nimport javax.inject.Singleton;\r\n\r\nimport retrofit2.Call;\r\n\r\n@Singleton\r\npublic class CategoryRemoteRepository {\r\n\r\n    private final com.finmate.data.remote.api.CategoryService categoryApi;\r\n    private final ApiCallExecutor apiCallExecutor;\r\n\r\n    @Inject\r\n    public CategoryRemoteRepository(com.finmate.data.remote.api.CategoryService categoryApi,\r\n                                    ApiCallExecutor apiCallExecutor) {\r\n        this.categoryApi = categoryApi;\r\n        this.apiCallExecutor = apiCallExecutor;\r\n    }\r\n\r\n    public void fetchCategoriesByType(String type,\r\n                                      ApiCallback<List<CategoryResponse>> callback) {\r\n        Call<List<CategoryResponse>> call = categoryApi.getCategoriesByType(type);\r\n        apiCallExecutor.execute(call, callback);\r\n    }\r\n\r\n    public void createCategory(CategoryRequest request,\r\n                               ApiCallback<CategoryResponse> callback) {\r\n        Call<CategoryResponse> call = categoryApi.createCategory(request);\r\n        apiCallExecutor.execute(call, callback);\r\n    }\r\n\r\n    public void updateCategory(String id,\r\n                               CategoryRequest request,\r\n                               ApiCallback<CategoryResponse> callback) {\r\n        Call<CategoryResponse> call = categoryApi.updateCategory(id, request);\r\n        apiCallExecutor.execute(call, callback);\r\n    }\r\n\r\n    public void deleteCategory(String id,\r\n                               ApiCallback<Void> callback) {\r\n        Call<Void> call = categoryApi.deleteCategory(id);\r\n        apiCallExecutor.execute(call, callback);\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/CategoryRemoteRepository.java b/app/src/main/java/com/finmate/data/repository/CategoryRemoteRepository.java
--- a/app/src/main/java/com/finmate/data/repository/CategoryRemoteRepository.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/repository/CategoryRemoteRepository.java	(date 1765447595528)
@@ -1,9 +1,9 @@
 package com.finmate.data.repository;
 
 import com.finmate.core.network.ApiCallExecutor;
-import com.finmate.core.network.ApiCallback;
 import com.finmate.data.dto.CategoryRequest;
 import com.finmate.data.dto.CategoryResponse;
+import com.finmate.data.remote.api.ApiCallback;
 
 import java.util.List;
 
Index: app/src/main/java/com/finmate/core/offline/SyncStatus.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/core/offline/SyncStatus.java b/app/src/main/java/com/finmate/core/offline/SyncStatus.java
new file mode 100644
--- /dev/null	(date 1765447595493)
+++ b/app/src/main/java/com/finmate/core/offline/SyncStatus.java	(date 1765447595493)
@@ -0,0 +1,13 @@
+package com.finmate.core.offline;
+
+public final class SyncStatus {
+    private SyncStatus() {}
+
+    public static final String SYNCED = "SYNCED";
+    public static final String PENDING_CREATE = "PENDING_CREATE";
+    public static final String PENDING_UPDATE = "PENDING_UPDATE";
+    public static final String PENDING_DELETE = "PENDING_DELETE";
+    public static final String FAILED = "FAILED";
+}
+
+
Index: app/src/main/java/com/finmate/data/repository/WalletRemoteRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.repository;\r\n\r\nimport com.finmate.core.network.ApiCallExecutor;\r\nimport com.finmate.core.network.ApiCallback;\r\nimport com.finmate.data.dto.WalletResponse;\r\n\r\nimport java.util.List;\r\n\r\nimport javax.inject.Inject;\r\nimport javax.inject.Singleton;\r\n\r\nimport retrofit2.Call;\r\n\r\n@Singleton\r\npublic class WalletRemoteRepository {\r\n\r\n    private final com.finmate.data.remote.api.WalletService walletApi;\r\n    private final ApiCallExecutor apiCallExecutor;\r\n\r\n    @Inject\r\n    public WalletRemoteRepository(com.finmate.data.remote.api.WalletService walletApi,\r\n                                  ApiCallExecutor apiCallExecutor) {\r\n        this.walletApi = walletApi;\r\n        this.apiCallExecutor = apiCallExecutor;\r\n    }\r\n\r\n    public void fetchMyWallets(ApiCallback<List<WalletResponse>> callback) {\r\n        Call<List<WalletResponse>> call = walletApi.getMyWallets();\r\n        apiCallExecutor.execute(call, callback);\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/WalletRemoteRepository.java b/app/src/main/java/com/finmate/data/repository/WalletRemoteRepository.java
--- a/app/src/main/java/com/finmate/data/repository/WalletRemoteRepository.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/repository/WalletRemoteRepository.java	(date 1765447595535)
@@ -1,8 +1,10 @@
 package com.finmate.data.repository;
 
 import com.finmate.core.network.ApiCallExecutor;
-import com.finmate.core.network.ApiCallback;
+import com.finmate.data.dto.WalletRequest;
 import com.finmate.data.dto.WalletResponse;
+import com.finmate.data.remote.api.ApiCallback;
+import com.finmate.data.remote.api.WalletService;
 
 import java.util.List;
 
@@ -14,12 +16,11 @@
 @Singleton
 public class WalletRemoteRepository {
 
-    private final com.finmate.data.remote.api.WalletService walletApi;
+    private final WalletService walletApi;
     private final ApiCallExecutor apiCallExecutor;
 
     @Inject
-    public WalletRemoteRepository(com.finmate.data.remote.api.WalletService walletApi,
-                                  ApiCallExecutor apiCallExecutor) {
+    public WalletRemoteRepository(WalletService walletApi, ApiCallExecutor apiCallExecutor) {
         this.walletApi = walletApi;
         this.apiCallExecutor = apiCallExecutor;
     }
@@ -28,4 +29,16 @@
         Call<List<WalletResponse>> call = walletApi.getMyWallets();
         apiCallExecutor.execute(call, callback);
     }
+
+    public void createWallet(WalletRequest request, ApiCallback<WalletResponse> callback) {
+        apiCallExecutor.execute(walletApi.createWallet(request), callback);
+    }
+
+    public void updateWallet(String id, WalletRequest request, ApiCallback<WalletResponse> callback) {
+        apiCallExecutor.execute(walletApi.updateWallet(id, request), callback);
+    }
+
+    public void deleteWallet(String id, ApiCallback<Void> callback) {
+        apiCallExecutor.execute(walletApi.deleteWallet(id), callback);
+    }
 }
Index: app/src/main/java/com/finmate/core/offline/SyncDao.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/core/offline/SyncDao.java b/app/src/main/java/com/finmate/core/offline/SyncDao.java
new file mode 100644
--- /dev/null	(date 1765447595493)
+++ b/app/src/main/java/com/finmate/core/offline/SyncDao.java	(date 1765447595493)
@@ -0,0 +1,12 @@
+package com.finmate.core.offline;
+
+import java.util.List;
+
+/**
+ * Marker interface for DAOs that expose pending items for syncing.
+ */
+public interface SyncDao<T extends OfflineSyncEntity> {
+    List<T> getPendingForSync();
+}
+
+
Index: app/src/main/java/com/finmate/core/util/TransactionFormatter.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/core/util/TransactionFormatter.java b/app/src/main/java/com/finmate/core/util/TransactionFormatter.java
new file mode 100644
--- /dev/null	(date 1765447595504)
+++ b/app/src/main/java/com/finmate/core/util/TransactionFormatter.java	(date 1765447595504)
@@ -0,0 +1,88 @@
+package com.finmate.core.util;
+
+import java.text.ParseException;
+import java.text.SimpleDateFormat;
+import java.util.Date;
+import java.util.Locale;
+
+/**
+ * Utility class để format TransactionEntity cho UI.
+ * Tách biệt domain model (raw data) và UI presentation.
+ */
+public class TransactionFormatter {
+
+    private static final SimpleDateFormat ISO_FORMAT = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss", Locale.US);
+    private static final SimpleDateFormat DISPLAY_DATE_FORMAT = new SimpleDateFormat("dd/MM/yyyy", Locale.getDefault());
+
+    /**
+     * Format amount từ double sang String hiển thị (có dấu phẩy ngăn cách hàng nghìn)
+     * Ví dụ: 1000.0 → "1,000"
+     */
+    public static String formatAmount(double amount) {
+        return String.format(Locale.getDefault(), "%,.0f", amount);
+    }
+
+    /**
+     * Format occurredAt (ISO datetime string) sang format hiển thị cho UI
+     * Ví dụ: "2024-01-15T10:30:00" → "15/01/2024"
+     */
+    public static String formatDate(String occurredAt) {
+        if (occurredAt == null || occurredAt.isEmpty()) {
+            return "";
+        }
+        try {
+            Date date = ISO_FORMAT.parse(occurredAt);
+            if (date != null) {
+                return DISPLAY_DATE_FORMAT.format(date);
+            }
+        } catch (ParseException e) {
+            // Nếu không parse được ISO format, trả về nguyên bản
+            // (có thể là format khác từ BE hoặc đã format sẵn)
+            return occurredAt;
+        }
+        return occurredAt;
+    }
+
+    /**
+     * Parse amount từ String input của user (có thể có dấu phẩy, khoảng trắng)
+     * Ví dụ: "1,000" → 1000.0, "1 000" → 1000.0
+     */
+    public static double parseAmount(String amountInput) throws NumberFormatException {
+        if (amountInput == null || amountInput.trim().isEmpty()) {
+            throw new NumberFormatException("Amount cannot be empty");
+        }
+        // Loại bỏ dấu phẩy, khoảng trắng, và các ký tự không phải số
+        String cleaned = amountInput.replace(",", "").replace(" ", "").trim();
+        return Double.parseDouble(cleaned);
+    }
+
+    /**
+     * Convert date từ format hiển thị (dd/MM/yyyy) sang ISO format
+     * Ví dụ: "15/01/2024" → "2024-01-15T00:00:00"
+     */
+    public static String parseDateToISO(String displayDate) throws ParseException {
+        if (displayDate == null || displayDate.trim().isEmpty()) {
+            throw new ParseException("Date cannot be empty", 0);
+        }
+        Date date = DISPLAY_DATE_FORMAT.parse(displayDate);
+        if (date != null) {
+            return ISO_FORMAT.format(date);
+        }
+        throw new ParseException("Invalid date format: " + displayDate, 0);
+    }
+
+    /**
+     * Convert Calendar date sang ISO format string
+     * Helper method cho AddTransactionActivity
+     */
+    public static String calendarToISO(int year, int month, int day) {
+        try {
+            // month is 0-based in Calendar, but we pass 1-based
+            String dateStr = String.format(Locale.US, "%04d-%02d-%02dT00:00:00", year, month, day);
+            return dateStr;
+        } catch (Exception e) {
+            return "";
+        }
+    }
+}
+
Index: app/src/main/java/com/finmate/core/util/NetworkUtils.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/core/util/NetworkUtils.java b/app/src/main/java/com/finmate/core/util/NetworkUtils.java
new file mode 100644
--- /dev/null	(date 1765447595504)
+++ b/app/src/main/java/com/finmate/core/util/NetworkUtils.java	(date 1765447595504)
@@ -0,0 +1,13 @@
+package com.finmate.core.util;
+
+import android.content.Context;
+import android.net.ConnectivityManager;
+import android.net.NetworkInfo;
+
+public class NetworkUtils {
+    public static boolean isOnline(Context context) {
+        ConnectivityManager cm = (ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE);
+        NetworkInfo netInfo = cm.getActiveNetworkInfo();
+        return netInfo != null && netInfo.isConnectedOrConnecting();
+    }
+}
Index: app/src/main/java/com/finmate/core/offline/BaseSyncManager.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/core/offline/BaseSyncManager.java b/app/src/main/java/com/finmate/core/offline/BaseSyncManager.java
new file mode 100644
--- /dev/null	(date 1765447595493)
+++ b/app/src/main/java/com/finmate/core/offline/BaseSyncManager.java	(date 1765447595493)
@@ -0,0 +1,72 @@
+package com.finmate.core.offline;
+
+import androidx.annotation.Nullable;
+
+import com.finmate.core.network.SyncOnlineStatusManager;
+
+import java.util.List;
+import java.util.concurrent.atomic.AtomicBoolean;
+
+/**
+ * Generic sequential sync runner that respects online/backoff status.
+ * Subclasses implement performSync to push a single item.
+ */
+public abstract class BaseSyncManager<T extends OfflineSyncEntity> {
+
+    private final SyncOnlineStatusManager onlineStatusManager;
+    private final AtomicBoolean isSyncing = new AtomicBoolean(false);
+
+    protected BaseSyncManager(SyncOnlineStatusManager onlineStatusManager) {
+        this.onlineStatusManager = onlineStatusManager;
+    }
+
+    public void syncPending(List<T> pendingItems) {
+        if (!onlineStatusManager.canSyncNow() || !isSyncing.compareAndSet(false, true)) {
+            return;
+        }
+        if (pendingItems == null || pendingItems.isEmpty()) {
+            onlineStatusManager.onSyncSuccess();
+            isSyncing.set(false);
+            return;
+        }
+        processSequentially(pendingItems, 0);
+    }
+
+    private void processSequentially(List<T> items, int index) {
+        if (index >= items.size()) {
+            onlineStatusManager.onSyncSuccess();
+            isSyncing.set(false);
+            return;
+        }
+
+        performSync(items.get(index), new SyncCallback() {
+            @Override
+            public void onSuccess() {
+                processSequentially(items, index + 1);
+            }
+
+            @Override
+            public void onSkip() {
+                processSequentially(items, index + 1);
+            }
+
+            @Override
+            public void onError(@Nullable Integer httpCode, @Nullable Throwable t) {
+                onlineStatusManager.onSyncError(httpCode, t);
+                isSyncing.set(false);
+            }
+        });
+    }
+
+    protected abstract void performSync(T item, SyncCallback callback);
+
+    public interface SyncCallback {
+        void onSuccess();
+
+        void onSkip();
+
+        void onError(@Nullable Integer httpCode, @Nullable Throwable t);
+    }
+}
+
+
Index: app/src/main/java/com/finmate/data/repository/AuthRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.repository;\r\n\r\nimport com.finmate.core.session.SessionManager;\r\nimport com.finmate.data.dto.LoginRequest;\r\nimport com.finmate.data.dto.RegisterRequest;\r\nimport com.finmate.data.dto.RefreshTokenRequest;\r\nimport com.finmate.data.dto.TokenResponse;\r\nimport com.finmate.data.local.datastore.AuthLocalDataSource;\r\nimport com.finmate.data.remote.api.AuthService;\r\n\r\nimport javax.inject.Inject;\r\nimport javax.inject.Singleton;\r\n\r\nimport retrofit2.Call;\r\nimport retrofit2.Callback;\r\nimport retrofit2.Response;\r\n\r\n@Singleton\r\npublic class AuthRepository {\r\n\r\n    private final AuthService authApi;\r\n    private final AuthLocalDataSource localDataSource;\r\n    private final SessionManager sessionManager;\r\n\r\n    @Inject\r\n    public AuthRepository(AuthService authApi, AuthLocalDataSource localDataSource, SessionManager sessionManager) {\r\n        this.authApi = authApi;\r\n        this.localDataSource = localDataSource;\r\n        this.sessionManager = sessionManager;\r\n    }\r\n\r\n    public interface LoginCallback {\r\n        void onSuccess();\r\n        void onError(String message);\r\n    }\r\n    \r\n    public interface RegisterCallback {\r\n        void onSuccess();\r\n        void onError(String message);\r\n    }\r\n\r\n    public interface RefreshCallback {\r\n        void onSuccess();\r\n        void onError(String message);\r\n    }\r\n\r\n    public void login(String email, String password, LoginCallback callback) {\r\n        authApi.login(new LoginRequest(email, password)).enqueue(new Callback<TokenResponse>() {\r\n            @Override\r\n            public void onResponse(Call<TokenResponse> call, Response<TokenResponse> response) {\r\n                if (response.isSuccessful() && response.body() != null) {\r\n                    TokenResponse tokens = response.body();\r\n                    \r\n                    // Save to DataStore\r\n                    localDataSource.saveTokens(tokens.getAccessToken(), tokens.getRefreshToken());\r\n                    \r\n                    // Save to SessionManager\r\n                    sessionManager.saveAccessToken(tokens.getAccessToken()); // FIX: saveToken -> saveAccessToken\r\n                    \r\n                    callback.onSuccess();\r\n                } else {\r\n                    callback.onError(\"Login failed: \" + response.code());\r\n                }\r\n            }\r\n\r\n            @Override\r\n            public void onFailure(Call<TokenResponse> call, Throwable t) {\r\n                callback.onError(t.getMessage());\r\n            }\r\n        });\r\n    }\r\n    \r\n    public void register(String email, String password, RegisterCallback callback) {\r\n        authApi.register(new RegisterRequest(email, password)).enqueue(new Callback<TokenResponse>() {\r\n            @Override\r\n            public void onResponse(Call<TokenResponse> call, Response<TokenResponse> response) {\r\n                if (response.isSuccessful() && response.body() != null) {\r\n                    TokenResponse tokens = response.body();\r\n\r\n                    // Auto-login: Save tokens\r\n                    localDataSource.saveTokens(tokens.getAccessToken(), tokens.getRefreshToken());\r\n                    sessionManager.saveAccessToken(tokens.getAccessToken()); // FIX: saveToken -> saveAccessToken\r\n\r\n                    callback.onSuccess();\r\n                } else {\r\n                    callback.onError(\"Registration failed: \" + response.code());\r\n                }\r\n            }\r\n\r\n            @Override\r\n            public void onFailure(Call<TokenResponse> call, Throwable t) {\r\n                callback.onError(t.getMessage());\r\n            }\r\n        });\r\n    }\r\n\r\n    public void refreshToken(RefreshCallback callback) {\r\n        // Lấy refresh token từ DataStore\r\n        localDataSource.getRefreshTokenSingle()\r\n                .subscribe(refreshToken -> {\r\n                    if (refreshToken == null || refreshToken.isEmpty()) {\r\n                        callback.onError(\"No refresh token found\");\r\n                        return;\r\n                    }\r\n\r\n                    // Gọi API /auth/refresh\r\n                    authApi.refresh(new RefreshTokenRequest(refreshToken))\r\n                            .enqueue(new Callback<TokenResponse>() {\r\n                                @Override\r\n                                public void onResponse(Call<TokenResponse> call, Response<TokenResponse> response) {\r\n                                    if (response.isSuccessful() && response.body() != null) {\r\n                                        TokenResponse tokens = response.body();\r\n\r\n                                        // Lưu lại token mới\r\n                                        localDataSource.saveTokens(\r\n                                                tokens.getAccessToken(),\r\n                                                tokens.getRefreshToken()\r\n                                        );\r\n                                        sessionManager.saveAccessToken(tokens.getAccessToken());\r\n\r\n                                        callback.onSuccess();\r\n                                    } else {\r\n                                        callback.onError(\"Refresh failed: \" + response.code());\r\n                                    }\r\n                                }\r\n\r\n                                @Override\r\n                                public void onFailure(Call<TokenResponse> call, Throwable t) {\r\n                                    callback.onError(t.getMessage());\r\n                                }\r\n                            });\r\n\r\n                }, throwable -> callback.onError(throwable.getMessage()));\r\n    }\r\n\r\n\r\n    public void checkLoginStatus(LoginCallback callback) {\r\n        // Check DataStore for token\r\n        localDataSource.getAccessTokenSingle()\r\n                .subscribe(token -> {\r\n                    if (token != null && !token.isEmpty()) {\r\n                        sessionManager.saveAccessToken(token); // FIX: saveToken -> saveAccessToken\r\n                        callback.onSuccess();\r\n                    } else {\r\n                        callback.onError(\"No token found\");\r\n                    }\r\n                }, throwable -> callback.onError(throwable.getMessage()));\r\n    }\r\n\r\n    public void logout() {\r\n        localDataSource.clearTokens();\r\n        sessionManager.clear();\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/AuthRepository.java b/app/src/main/java/com/finmate/data/repository/AuthRepository.java
--- a/app/src/main/java/com/finmate/data/repository/AuthRepository.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/repository/AuthRepository.java	(date 1765447595524)
@@ -1,154 +1,79 @@
 package com.finmate.data.repository;
 
 import com.finmate.core.session.SessionManager;
+import com.finmate.data.local.datastore.AuthLocalDataSource;
+import com.finmate.data.remote.api.AuthService;
 import com.finmate.data.dto.LoginRequest;
-import com.finmate.data.dto.RegisterRequest;
 import com.finmate.data.dto.RefreshTokenRequest;
+import com.finmate.data.dto.RegisterRequest;
 import com.finmate.data.dto.TokenResponse;
-import com.finmate.data.local.datastore.AuthLocalDataSource;
-import com.finmate.data.remote.api.AuthService;
 
 import javax.inject.Inject;
 import javax.inject.Singleton;
 
-import retrofit2.Call;
-import retrofit2.Callback;
-import retrofit2.Response;
+import io.reactivex.rxjava3.core.Completable;
+import io.reactivex.rxjava3.core.Single;
 
 @Singleton
 public class AuthRepository {
 
-    private final AuthService authApi;
+    private final AuthService authService;
     private final AuthLocalDataSource localDataSource;
     private final SessionManager sessionManager;
 
     @Inject
-    public AuthRepository(AuthService authApi, AuthLocalDataSource localDataSource, SessionManager sessionManager) {
-        this.authApi = authApi;
+    public AuthRepository(
+            AuthService authService,
+            AuthLocalDataSource localDataSource,
+            SessionManager sessionManager) {
+        this.authService = authService;
         this.localDataSource = localDataSource;
         this.sessionManager = sessionManager;
     }
 
-    public interface LoginCallback {
-        void onSuccess();
-        void onError(String message);
-    }
-    
-    public interface RegisterCallback {
-        void onSuccess();
-        void onError(String message);
+    public Completable login(String username, String password) {
+        return authService.login(new LoginRequest(username, password))
+                .flatMapCompletable(this::handleTokenResponse);
     }
 
-    public interface RefreshCallback {
-        void onSuccess();
-        void onError(String message);
+    public Completable register(String email, String password, String fullName, String avatarUrl) {
+        return authService.register(new RegisterRequest(email, password, fullName, avatarUrl))
+                .flatMapCompletable(this::handleTokenResponse);
     }
-
-    public void login(String email, String password, LoginCallback callback) {
-        authApi.login(new LoginRequest(email, password)).enqueue(new Callback<TokenResponse>() {
-            @Override
-            public void onResponse(Call<TokenResponse> call, Response<TokenResponse> response) {
-                if (response.isSuccessful() && response.body() != null) {
-                    TokenResponse tokens = response.body();
-                    
-                    // Save to DataStore
-                    localDataSource.saveTokens(tokens.getAccessToken(), tokens.getRefreshToken());
-                    
-                    // Save to SessionManager
-                    sessionManager.saveAccessToken(tokens.getAccessToken()); // FIX: saveToken -> saveAccessToken
-                    
-                    callback.onSuccess();
-                } else {
-                    callback.onError("Login failed: " + response.code());
-                }
-            }
 
-            @Override
-            public void onFailure(Call<TokenResponse> call, Throwable t) {
-                callback.onError(t.getMessage());
-            }
-        });
-    }
-    
-    public void register(String email, String password, RegisterCallback callback) {
-        authApi.register(new RegisterRequest(email, password)).enqueue(new Callback<TokenResponse>() {
-            @Override
-            public void onResponse(Call<TokenResponse> call, Response<TokenResponse> response) {
-                if (response.isSuccessful() && response.body() != null) {
-                    TokenResponse tokens = response.body();
-
-                    // Auto-login: Save tokens
-                    localDataSource.saveTokens(tokens.getAccessToken(), tokens.getRefreshToken());
-                    sessionManager.saveAccessToken(tokens.getAccessToken()); // FIX: saveToken -> saveAccessToken
-
-                    callback.onSuccess();
-                } else {
-                    callback.onError("Registration failed: " + response.code());
-                }
-            }
-
-            @Override
-            public void onFailure(Call<TokenResponse> call, Throwable t) {
-                callback.onError(t.getMessage());
-            }
-        });
-    }
-
-    public void refreshToken(RefreshCallback callback) {
-        // Lấy refresh token từ DataStore
-        localDataSource.getRefreshTokenSingle()
-                .subscribe(refreshToken -> {
-                    if (refreshToken == null || refreshToken.isEmpty()) {
-                        callback.onError("No refresh token found");
-                        return;
-                    }
+    public boolean refreshTokenBlocking() {
+        String refreshToken = localDataSource.getRefreshTokenSingle().blockingGet();
+        if (refreshToken == null || refreshToken.isEmpty()) {
+            return false;
+        }
 
-                    // Gọi API /auth/refresh
-                    authApi.refresh(new RefreshTokenRequest(refreshToken))
-                            .enqueue(new Callback<TokenResponse>() {
-                                @Override
-                                public void onResponse(Call<TokenResponse> call, Response<TokenResponse> response) {
-                                    if (response.isSuccessful() && response.body() != null) {
-                                        TokenResponse tokens = response.body();
-
-                                        // Lưu lại token mới
-                                        localDataSource.saveTokens(
-                                                tokens.getAccessToken(),
-                                                tokens.getRefreshToken()
-                                        );
-                                        sessionManager.saveAccessToken(tokens.getAccessToken());
-
-                                        callback.onSuccess();
-                                    } else {
-                                        callback.onError("Refresh failed: " + response.code());
-                                    }
-                                }
-
-                                @Override
-                                public void onFailure(Call<TokenResponse> call, Throwable t) {
-                                    callback.onError(t.getMessage());
-                                }
-                            });
+        try {
+            TokenResponse newTokens = authService.refreshToken(new RefreshTokenRequest(refreshToken)).blockingGet();
+            handleTokenResponse(newTokens).blockingAwait(); // Wait for save to complete
+            return true;
+        } catch (Exception e) {
+            return false;
+        }
+    }
 
-                }, throwable -> callback.onError(throwable.getMessage()));
-    }
-
-
-    public void checkLoginStatus(LoginCallback callback) {
-        // Check DataStore for token
-        localDataSource.getAccessTokenSingle()
-                .subscribe(token -> {
+    public Single<Boolean> checkLoginStatus() {
+        return localDataSource.getAccessTokenSingle()
+                .map(token -> {
                     if (token != null && !token.isEmpty()) {
-                        sessionManager.saveAccessToken(token); // FIX: saveToken -> saveAccessToken
-                        callback.onSuccess();
-                    } else {
-                        callback.onError("No token found");
+                        sessionManager.saveAccessToken(token);
+                        return true;
                     }
-                }, throwable -> callback.onError(throwable.getMessage()));
+                    return false;
+                });
     }
 
-    public void logout() {
-        localDataSource.clearTokens();
+    public Completable logout() {
         sessionManager.clear();
+        return localDataSource.clearTokens();
+    }
+
+    private Completable handleTokenResponse(TokenResponse tokens) {
+        sessionManager.saveAccessToken(tokens.getAccessToken());
+        return localDataSource.saveTokens(tokens.getAccessToken(), tokens.getRefreshToken());
     }
 }
Index: app/src/main/java/com/finmate/core/offline/PendingAction.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/core/offline/PendingAction.java b/app/src/main/java/com/finmate/core/offline/PendingAction.java
new file mode 100644
--- /dev/null	(date 1765447595493)
+++ b/app/src/main/java/com/finmate/core/offline/PendingAction.java	(date 1765447595493)
@@ -0,0 +1,12 @@
+package com.finmate.core.offline;
+
+public final class PendingAction {
+    private PendingAction() {}
+
+    public static final String NONE = "NONE";
+    public static final String CREATE = "CREATE";
+    public static final String UPDATE = "UPDATE";
+    public static final String DELETE = "DELETE";
+}
+
+
Index: app/src/main/java/com/finmate/data/repository/FriendRemoteRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.finmate.data.repository;\r\n\r\nimport com.finmate.core.network.ApiCallExecutor;\r\nimport com.finmate.core.network.ApiCallback;\r\nimport com.finmate.data.dto.FriendRequest;\r\nimport com.finmate.data.dto.FriendResponse;\r\nimport com.finmate.data.remote.api.FriendService;\r\n\r\nimport java.util.List;\r\n\r\nimport javax.inject.Inject;\r\nimport javax.inject.Singleton;\r\n\r\nimport retrofit2.Call;\r\n\r\n@Singleton\r\npublic class FriendRemoteRepository {\r\n\r\n    private final FriendService friendApi;\r\n    private final ApiCallExecutor apiCallExecutor;\r\n\r\n    @Inject\r\n    public FriendRemoteRepository(FriendService friendApi,\r\n                                  ApiCallExecutor apiCallExecutor) {\r\n        this.friendApi = friendApi;\r\n        this.apiCallExecutor = apiCallExecutor;\r\n    }\r\n\r\n    public void getFriends(ApiCallback<List<FriendResponse>> callback) {\r\n        Call<List<FriendResponse>> call = friendApi.getFriends();\r\n        apiCallExecutor.execute(call, callback);\r\n    }\r\n\r\n    public void getIncoming(ApiCallback<List<FriendResponse>> callback) {\r\n        Call<List<FriendResponse>> call = friendApi.getIncomingRequests();\r\n        apiCallExecutor.execute(call, callback);\r\n    }\r\n\r\n    public void getOutgoing(ApiCallback<List<FriendResponse>> callback) {\r\n        Call<List<FriendResponse>> call = friendApi.getOutgoingRequests();\r\n        apiCallExecutor.execute(call, callback);\r\n    }\r\n\r\n    public void sendRequest(String email, ApiCallback<Void> callback) {\r\n        Call<Void> call = friendApi.sendFriendRequest(new FriendRequest(email));\r\n        apiCallExecutor.execute(call, callback);\r\n    }\r\n\r\n    public void accept(String friendshipId, ApiCallback<Void> callback) {\r\n        Call<Void> call = friendApi.acceptRequest(friendshipId);\r\n        apiCallExecutor.execute(call, callback);\r\n    }\r\n\r\n    public void reject(String friendshipId, ApiCallback<Void> callback) {\r\n        Call<Void> call = friendApi.rejectRequest(friendshipId);\r\n        apiCallExecutor.execute(call, callback);\r\n    }\r\n\r\n    public void remove(String friendshipId, ApiCallback<Void> callback) {\r\n        Call<Void> call = friendApi.removeFriend(friendshipId);\r\n        apiCallExecutor.execute(call, callback);\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/repository/FriendRemoteRepository.java b/app/src/main/java/com/finmate/data/repository/FriendRemoteRepository.java
--- a/app/src/main/java/com/finmate/data/repository/FriendRemoteRepository.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/data/repository/FriendRemoteRepository.java	(date 1765447595531)
@@ -1,9 +1,9 @@
 package com.finmate.data.repository;
 
 import com.finmate.core.network.ApiCallExecutor;
-import com.finmate.core.network.ApiCallback;
 import com.finmate.data.dto.FriendRequest;
 import com.finmate.data.dto.FriendResponse;
+import com.finmate.data.remote.api.ApiCallback;
 import com.finmate.data.remote.api.FriendService;
 
 import java.util.List;
Index: app/src/main/java/com/finmate/core/offline/OfflineSyncEntity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/core/offline/OfflineSyncEntity.java b/app/src/main/java/com/finmate/core/offline/OfflineSyncEntity.java
new file mode 100644
--- /dev/null	(date 1765447595493)
+++ b/app/src/main/java/com/finmate/core/offline/OfflineSyncEntity.java	(date 1765447595493)
@@ -0,0 +1,33 @@
+package com.finmate.core.offline;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+
+/**
+ * Base contract for entities that participate in offline-first syncing.
+ * Every entity keeps the server id, current sync status, pending action
+ * and a monotonically increasing updatedAt for conflict resolution.
+ */
+public interface OfflineSyncEntity {
+
+    @Nullable
+    String getRemoteId();
+
+    void setRemoteId(@Nullable String remoteId);
+
+    @NonNull
+    String getSyncStatus();
+
+    void setSyncStatus(@NonNull String syncStatus);
+
+    @NonNull
+    String getPendingAction();
+
+    void setPendingAction(@NonNull String pendingAction);
+
+    long getUpdatedAt();
+
+    void setUpdatedAt(long updatedAt);
+}
+
+
Index: app/src/main/res/xml/network_security_config.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/xml/network_security_config.xml b/app/src/main/res/xml/network_security_config.xml
new file mode 100644
--- /dev/null	(date 1765447595567)
+++ b/app/src/main/res/xml/network_security_config.xml	(date 1765447595567)
@@ -0,0 +1,18 @@
+<?xml version="1.0" encoding="utf-8"?>
+<network-security-config>
+    <!-- Cho phép cleartext traffic cho localhost và Android emulator -->
+    <domain-config cleartextTrafficPermitted="true">
+        <domain includeSubdomains="true">localhost</domain>
+        <domain includeSubdomains="true">127.0.0.1</domain>
+        <domain includeSubdomains="true">10.0.2.2</domain>
+    </domain-config>
+    
+    <!-- Cho phép cleartext cho tất cả các domain trong development (tùy chọn) -->
+    <!-- Chỉ dùng khi development, nên tắt trong production -->
+    <base-config cleartextTrafficPermitted="true">
+        <trust-anchors>
+            <certificates src="system" />
+        </trust-anchors>
+    </base-config>
+</network-security-config>
+
Index: app/src/main/res/layout/activity_splash.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/layout/activity_splash.xml b/app/src/main/res/layout/activity_splash.xml
new file mode 100644
--- /dev/null	(date 1765447595563)
+++ b/app/src/main/res/layout/activity_splash.xml	(date 1765447595563)
@@ -0,0 +1,20 @@
+<?xml version="1.0" encoding="utf-8"?>
+<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent"
+    android:background="@android:color/black">
+
+    <TextView
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content"
+        android:layout_centerInParent="true"
+        android:text="FinMate"
+        android:textColor="@android:color/white"
+        android:textSize="24sp"
+        android:textStyle="bold" />
+
+</RelativeLayout>
+
+
+
+
Index: app/src/main/res/layout/activity_wallet.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    android:background=\"?attr/backgroundColor\"\r\n    android:orientation=\"vertical\">\r\n\r\n    <!-- ====== CARD VÍ TIỀN ====== -->\r\n    <LinearLayout\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_margin=\"16dp\"\r\n        android:padding=\"16dp\"\r\n        android:background=\"@drawable/bg_card\"\r\n        android:backgroundTint=\"?attr/cardBackgroundColor\"\r\n        android:orientation=\"vertical\">\r\n\r\n        <!-- TIÊU ĐỀ + SỐ DƯ -->\r\n        <LinearLayout\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:orientation=\"horizontal\">\r\n\r\n            <TextView\r\n                android:layout_width=\"0dp\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:layout_weight=\"1\"\r\n                android:text=\"@string/my_account\"\r\n                android:textColor=\"?attr/textColorPrimary\"\r\n                android:textSize=\"16sp\"\r\n                android:textStyle=\"bold\"/>\r\n\r\n            <!-- Số dư -->\r\n            <TextView\r\n                android:id=\"@+id/tv_balance\"\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:text=\"0 VND\"\r\n                android:textColor=\"?attr/textColorPrimary\"\r\n                android:textStyle=\"bold\"\r\n                android:textSize=\"16sp\"/>\r\n        </LinearLayout>\r\n\r\n        <!-- Thu nhập -->\r\n        <TextView\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_marginTop=\"12dp\"\r\n            android:text=\"@string/income\"\r\n            android:textColor=\"?attr/textColorPositive\"\r\n            android:textStyle=\"bold\"/>\r\n\r\n        <ProgressBar\r\n            android:id=\"@+id/prog_income\"\r\n            style=\"?android:attr/progressBarStyleHorizontal\"\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"8dp\"\r\n            android:max=\"100\"\r\n            android:progressTint=\"#FF2EBF\"\r\n            android:backgroundTint=\"?attr/progressBarBackgroundColor\"/>\r\n\r\n        <TextView\r\n            android:id=\"@+id/tv_income_value\"\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:text=\"+0 VND\"\r\n            android:textColor=\"?attr/textColorPositive\"\r\n            android:textSize=\"13sp\"\r\n            android:layout_marginBottom=\"12dp\"/>\r\n\r\n        <!-- Chi tiêu -->\r\n        <TextView\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:text=\"@string/expense\"\r\n            android:textColor=\"?attr/textColorSecondary\"\r\n            android:textStyle=\"bold\"/>\r\n\r\n        <ProgressBar\r\n            android:id=\"@+id/prog_expense\"\r\n            style=\"?android:attr/progressBarStyleHorizontal\"\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"8dp\"\r\n            android:max=\"100\"\r\n            android:progressTint=\"#7CE27D\"\r\n            android:backgroundTint=\"?attr/progressBarBackgroundColor\"/>\r\n\r\n        <TextView\r\n            android:id=\"@+id/tv_expense_value\"\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:text=\"-0 VND\"\r\n            android:textColor=\"?attr/textColorNegative\"\r\n            android:textSize=\"13sp\"/>\r\n\r\n    </LinearLayout>\r\n\r\n    <!-- ====== DANH SÁCH GIAO DỊCH ====== -->\r\n    <ScrollView\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"0dp\"\r\n        android:layout_weight=\"1\">\r\n\r\n        <LinearLayout\r\n            android:id=\"@+id/container_transaction\"\r\n            android:orientation=\"vertical\"\r\n            android:paddingHorizontal=\"16dp\"\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"wrap_content\">\r\n\r\n            <include layout=\"@layout/item_transaction\" />\r\n\r\n        </LinearLayout>\r\n    </ScrollView>\r\n\r\n    <!-- ====== BOTTOM NAV ====== -->\r\n    <com.google.android.material.bottomnavigation.BottomNavigationView\r\n        android:id=\"@+id/bottomNavigation\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"65dp\"\r\n        android:background=\"?attr/bottomNavBackgroundColor\"\r\n        app:menu=\"@menu/menu_bottom\"\r\n        app:itemTextColor=\"@color/selector_nav_color\"/>\r\n\r\n</LinearLayout>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/layout/activity_wallet.xml b/app/src/main/res/layout/activity_wallet.xml
--- a/app/src/main/res/layout/activity_wallet.xml	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/res/layout/activity_wallet.xml	(date 1765447595565)
@@ -97,22 +97,13 @@
     </LinearLayout>
 
     <!-- ====== DANH SÁCH GIAO DỊCH ====== -->
-    <ScrollView
+    <androidx.recyclerview.widget.RecyclerView
+        android:id="@+id/rvTransactions"
         android:layout_width="match_parent"
         android:layout_height="0dp"
-        android:layout_weight="1">
-
-        <LinearLayout
-            android:id="@+id/container_transaction"
-            android:orientation="vertical"
-            android:paddingHorizontal="16dp"
-            android:layout_width="match_parent"
-            android:layout_height="wrap_content">
-
-            <include layout="@layout/item_transaction" />
-
-        </LinearLayout>
-    </ScrollView>
+        android:layout_weight="1"
+        android:clipToPadding="false"
+        android:paddingBottom="16dp" />
 
     <!-- ====== BOTTOM NAV ====== -->
     <com.google.android.material.bottomnavigation.BottomNavigationView
Index: app/src/main/java/com/finmate/data/local/database/entity/GoalEntity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/database/entity/GoalEntity.java b/app/src/main/java/com/finmate/data/local/database/entity/GoalEntity.java
new file mode 100644
--- /dev/null	(date 1765447595509)
+++ b/app/src/main/java/com/finmate/data/local/database/entity/GoalEntity.java	(date 1765447595509)
@@ -0,0 +1,103 @@
+package com.finmate.data.local.database.entity;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.room.Entity;
+import androidx.room.PrimaryKey;
+
+import com.finmate.core.offline.OfflineSyncEntity;
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+
+/**
+ * Saving goal tracked locally.
+ */
+@Entity(tableName = "goals")
+public class GoalEntity implements OfflineSyncEntity {
+
+    @PrimaryKey(autoGenerate = true)
+    public int id;
+
+    @Nullable
+    public String remoteId;
+
+    @NonNull
+    public String name;
+
+    @Nullable
+    public String description;
+
+    public double targetAmount;
+
+    @NonNull
+    public String targetDate; // ISO date
+
+    @Nullable
+    public String linkedWalletName;
+
+    @NonNull
+    public String syncStatus;
+
+    @NonNull
+    public String pendingAction;
+
+    public long updatedAt;
+
+    public GoalEntity(@NonNull String name,
+                      @Nullable String description,
+                      double targetAmount,
+                      @NonNull String targetDate,
+                      @Nullable String linkedWalletName) {
+        this.name = name;
+        this.description = description;
+        this.targetAmount = targetAmount;
+        this.targetDate = targetDate;
+        this.linkedWalletName = linkedWalletName;
+        this.syncStatus = SyncStatus.PENDING_CREATE;
+        this.pendingAction = PendingAction.CREATE;
+        this.updatedAt = System.currentTimeMillis();
+    }
+
+    @Nullable
+    @Override
+    public String getRemoteId() {
+        return remoteId;
+    }
+
+    @Override
+    public void setRemoteId(@Nullable String remoteId) {
+        this.remoteId = remoteId;
+    }
+
+    @NonNull
+    @Override
+    public String getSyncStatus() {
+        return syncStatus;
+    }
+
+    @Override
+    public void setSyncStatus(@NonNull String syncStatus) {
+        this.syncStatus = syncStatus;
+    }
+
+    @NonNull
+    @Override
+    public String getPendingAction() {
+        return pendingAction;
+    }
+
+    @Override
+    public void setPendingAction(@NonNull String pendingAction) {
+        this.pendingAction = pendingAction;
+    }
+
+    @Override
+    public long getUpdatedAt() {
+        return updatedAt;
+    }
+
+    @Override
+    public void setUpdatedAt(long updatedAt) {
+        this.updatedAt = updatedAt;
+    }
+}
Index: app/src/main/java/com/finmate/data/local/database/entity/BudgetEntity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/database/entity/BudgetEntity.java b/app/src/main/java/com/finmate/data/local/database/entity/BudgetEntity.java
new file mode 100644
--- /dev/null	(date 1765447595509)
+++ b/app/src/main/java/com/finmate/data/local/database/entity/BudgetEntity.java	(date 1765447595509)
@@ -0,0 +1,98 @@
+package com.finmate.data.local.database.entity;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.room.Entity;
+import androidx.room.PrimaryKey;
+
+import com.finmate.core.offline.OfflineSyncEntity;
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+
+/**
+ * Local-first budget. Wallet/category are optional (by name) to match current schema.
+ */
+@Entity(tableName = "budgets")
+public class BudgetEntity implements OfflineSyncEntity {
+
+    @PrimaryKey(autoGenerate = true)
+    public int id;
+
+    @Nullable
+    public String remoteId;
+
+    @Nullable
+    public String walletName;
+
+    @Nullable
+    public String categoryName;
+
+    @NonNull
+    public String period; // MONTH or WEEK
+
+    public double amountLimit;
+
+    @NonNull
+    public String syncStatus;
+
+    @NonNull
+    public String pendingAction;
+
+    public long updatedAt;
+
+    public BudgetEntity(@Nullable String walletName,
+                        @Nullable String categoryName,
+                        @NonNull String period,
+                        double amountLimit) {
+        this.walletName = walletName;
+        this.categoryName = categoryName;
+        this.period = period;
+        this.amountLimit = amountLimit;
+        this.syncStatus = SyncStatus.PENDING_CREATE;
+        this.pendingAction = PendingAction.CREATE;
+        this.updatedAt = System.currentTimeMillis();
+    }
+
+    @Nullable
+    @Override
+    public String getRemoteId() {
+        return remoteId;
+    }
+
+    @Override
+    public void setRemoteId(@Nullable String remoteId) {
+        this.remoteId = remoteId;
+    }
+
+    @NonNull
+    @Override
+    public String getSyncStatus() {
+        return syncStatus;
+    }
+
+    @Override
+    public void setSyncStatus(@NonNull String syncStatus) {
+        this.syncStatus = syncStatus;
+    }
+
+    @NonNull
+    @Override
+    public String getPendingAction() {
+        return pendingAction;
+    }
+
+    @Override
+    public void setPendingAction(@NonNull String pendingAction) {
+        this.pendingAction = pendingAction;
+    }
+
+    @Override
+    public long getUpdatedAt() {
+        return updatedAt;
+    }
+
+    @Override
+    public void setUpdatedAt(long updatedAt) {
+        this.updatedAt = updatedAt;
+    }
+}
Index: app/src/main/java/com/finmate/ui/transaction/ChartPoint.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/transaction/ChartPoint.java b/app/src/main/java/com/finmate/ui/transaction/ChartPoint.java
new file mode 100644
--- /dev/null	(date 1765447595556)
+++ b/app/src/main/java/com/finmate/ui/transaction/ChartPoint.java	(date 1765447595556)
@@ -0,0 +1,21 @@
+package com.finmate.ui.transaction;
+
+public class ChartPoint {
+
+    private final String label;
+    private final float value;
+
+    public ChartPoint(String label, double value) {
+        this.label = label;
+        this.value = (float) value;
+    }
+
+    public String getLabel() {
+        return label;
+    }
+
+    public float getValue() {
+        return value;
+    }
+}
+
Index: app/src/main/java/com/finmate/ui/transaction/StatisticResult.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/transaction/StatisticResult.java b/app/src/main/java/com/finmate/ui/transaction/StatisticResult.java
new file mode 100644
--- /dev/null	(date 1765447595556)
+++ b/app/src/main/java/com/finmate/ui/transaction/StatisticResult.java	(date 1765447595556)
@@ -0,0 +1,52 @@
+package com.finmate.ui.transaction;
+
+import java.util.List;
+
+public class StatisticResult {
+
+    private final double totalAmount;
+    private final List<ChartPoint> timeline;
+    private final List<ChartPoint> byCategory;
+    private final List<ChartPoint> byWallet;
+    private final String dateLabel;
+    private final String granularity;
+
+    public StatisticResult(double totalAmount,
+                           List<ChartPoint> timeline,
+                           List<ChartPoint> byCategory,
+                           List<ChartPoint> byWallet,
+                           String dateLabel,
+                           String granularity) {
+        this.totalAmount = totalAmount;
+        this.timeline = timeline;
+        this.byCategory = byCategory;
+        this.byWallet = byWallet;
+        this.dateLabel = dateLabel;
+        this.granularity = granularity;
+    }
+
+    public double getTotalAmount() {
+        return totalAmount;
+    }
+
+    public List<ChartPoint> getTimeline() {
+        return timeline;
+    }
+
+    public List<ChartPoint> getByCategory() {
+        return byCategory;
+    }
+
+    public List<ChartPoint> getByWallet() {
+        return byWallet;
+    }
+
+    public String getDateLabel() {
+        return dateLabel;
+    }
+
+    public String getGranularity() {
+        return granularity;
+    }
+}
+
Index: app/src/main/java/com/finmate/data/remote/dto/UpdateTransactionRequest.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/remote/dto/UpdateTransactionRequest.java b/app/src/main/java/com/finmate/data/remote/dto/UpdateTransactionRequest.java
new file mode 100644
--- /dev/null	(date 1765447595524)
+++ b/app/src/main/java/com/finmate/data/remote/dto/UpdateTransactionRequest.java	(date 1765447595524)
@@ -0,0 +1,97 @@
+package com.finmate.data.remote.dto;
+
+import java.math.BigDecimal;
+
+/**
+ * DTO matching backend TransactionRequest (same structure for update)
+ */
+public class UpdateTransactionRequest {
+    private String walletId;
+    private String categoryId;
+    private String type; // INCOME / EXPENSE / TRANSFER
+    private BigDecimal amount;
+    private String currency;
+    private String occurredAt; // ISO datetime string
+    private String note;
+    private String transferRefId; // optional
+
+    public UpdateTransactionRequest() {
+    }
+
+    public UpdateTransactionRequest(String walletId, String categoryId, String type, 
+                                   BigDecimal amount, String currency, String occurredAt, 
+                                   String note, String transferRefId) {
+        this.walletId = walletId;
+        this.categoryId = categoryId;
+        this.type = type;
+        this.amount = amount;
+        this.currency = currency;
+        this.occurredAt = occurredAt;
+        this.note = note;
+        this.transferRefId = transferRefId;
+    }
+
+    public String getWalletId() {
+        return walletId;
+    }
+
+    public void setWalletId(String walletId) {
+        this.walletId = walletId;
+    }
+
+    public String getCategoryId() {
+        return categoryId;
+    }
+
+    public void setCategoryId(String categoryId) {
+        this.categoryId = categoryId;
+    }
+
+    public String getType() {
+        return type;
+    }
+
+    public void setType(String type) {
+        this.type = type;
+    }
+
+    public BigDecimal getAmount() {
+        return amount;
+    }
+
+    public void setAmount(BigDecimal amount) {
+        this.amount = amount;
+    }
+
+    public String getCurrency() {
+        return currency;
+    }
+
+    public void setCurrency(String currency) {
+        this.currency = currency;
+    }
+
+    public String getOccurredAt() {
+        return occurredAt;
+    }
+
+    public void setOccurredAt(String occurredAt) {
+        this.occurredAt = occurredAt;
+    }
+
+    public String getNote() {
+        return note;
+    }
+
+    public void setNote(String note) {
+        this.note = note;
+    }
+
+    public String getTransferRefId() {
+        return transferRefId;
+    }
+
+    public void setTransferRefId(String transferRefId) {
+        this.transferRefId = transferRefId;
+    }
+}
Index: app/src/main/java/com/finmate/data/remote/dto/CreateTransactionRequest.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/remote/dto/CreateTransactionRequest.java b/app/src/main/java/com/finmate/data/remote/dto/CreateTransactionRequest.java
new file mode 100644
--- /dev/null	(date 1765447595524)
+++ b/app/src/main/java/com/finmate/data/remote/dto/CreateTransactionRequest.java	(date 1765447595524)
@@ -0,0 +1,97 @@
+package com.finmate.data.remote.dto;
+
+import java.math.BigDecimal;
+
+/**
+ * DTO matching backend TransactionRequest
+ */
+public class CreateTransactionRequest {
+    private String walletId;
+    private String categoryId;
+    private String type; // INCOME / EXPENSE / TRANSFER
+    private BigDecimal amount;
+    private String currency;
+    private String occurredAt; // ISO datetime string
+    private String note;
+    private String transferRefId; // optional
+
+    public CreateTransactionRequest() {
+    }
+
+    public CreateTransactionRequest(String walletId, String categoryId, String type, 
+                                   BigDecimal amount, String currency, String occurredAt, 
+                                   String note, String transferRefId) {
+        this.walletId = walletId;
+        this.categoryId = categoryId;
+        this.type = type;
+        this.amount = amount;
+        this.currency = currency;
+        this.occurredAt = occurredAt;
+        this.note = note;
+        this.transferRefId = transferRefId;
+    }
+
+    public String getWalletId() {
+        return walletId;
+    }
+
+    public void setWalletId(String walletId) {
+        this.walletId = walletId;
+    }
+
+    public String getCategoryId() {
+        return categoryId;
+    }
+
+    public void setCategoryId(String categoryId) {
+        this.categoryId = categoryId;
+    }
+
+    public String getType() {
+        return type;
+    }
+
+    public void setType(String type) {
+        this.type = type;
+    }
+
+    public BigDecimal getAmount() {
+        return amount;
+    }
+
+    public void setAmount(BigDecimal amount) {
+        this.amount = amount;
+    }
+
+    public String getCurrency() {
+        return currency;
+    }
+
+    public void setCurrency(String currency) {
+        this.currency = currency;
+    }
+
+    public String getOccurredAt() {
+        return occurredAt;
+    }
+
+    public void setOccurredAt(String occurredAt) {
+        this.occurredAt = occurredAt;
+    }
+
+    public String getNote() {
+        return note;
+    }
+
+    public void setNote(String note) {
+        this.note = note;
+    }
+
+    public String getTransferRefId() {
+        return transferRefId;
+    }
+
+    public void setTransferRefId(String transferRefId) {
+        this.transferRefId = transferRefId;
+    }
+}
Index: app/src/main/java/com/finmate/data/local/database/entity/SharedTransactionEntity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/database/entity/SharedTransactionEntity.java b/app/src/main/java/com/finmate/data/local/database/entity/SharedTransactionEntity.java
new file mode 100644
--- /dev/null	(date 1765447595509)
+++ b/app/src/main/java/com/finmate/data/local/database/entity/SharedTransactionEntity.java	(date 1765447595509)
@@ -0,0 +1,101 @@
+package com.finmate.data.local.database.entity;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.room.Entity;
+import androidx.room.PrimaryKey;
+
+import com.finmate.core.offline.OfflineSyncEntity;
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+
+@Entity(tableName = "shared_transactions")
+public class SharedTransactionEntity implements OfflineSyncEntity {
+
+    @PrimaryKey(autoGenerate = true)
+    public int id;
+
+    @Nullable
+    public String remoteId;
+
+    @Nullable
+    public String groupId;
+
+    @Nullable
+    public String groupName;
+
+    public double totalAmount;
+
+    @Nullable
+    public String payerUserId;
+
+    public boolean splitEqually;
+
+    public int memberCount;
+
+    @Nullable
+    public String transactionRemoteId; // link to normal transaction if available
+
+    @NonNull
+    public String createdAtIso;
+
+    @NonNull
+    public String syncStatus;
+
+    @NonNull
+    public String pendingAction;
+
+    public long updatedAt;
+
+    public SharedTransactionEntity(@NonNull String createdAtIso, double totalAmount) {
+        this.createdAtIso = createdAtIso;
+        this.totalAmount = totalAmount;
+        this.syncStatus = SyncStatus.SYNCED; // only created online for v1
+        this.pendingAction = PendingAction.NONE;
+        this.updatedAt = System.currentTimeMillis();
+    }
+
+    @Nullable
+    @Override
+    public String getRemoteId() {
+        return remoteId;
+    }
+
+    @Override
+    public void setRemoteId(@Nullable String remoteId) {
+        this.remoteId = remoteId;
+    }
+
+    @NonNull
+    @Override
+    public String getSyncStatus() {
+        return syncStatus;
+    }
+
+    @Override
+    public void setSyncStatus(@NonNull String syncStatus) {
+        this.syncStatus = syncStatus;
+    }
+
+    @NonNull
+    @Override
+    public String getPendingAction() {
+        return pendingAction;
+    }
+
+    @Override
+    public void setPendingAction(@NonNull String pendingAction) {
+        this.pendingAction = pendingAction;
+    }
+
+    @Override
+    public long getUpdatedAt() {
+        return updatedAt;
+    }
+
+    @Override
+    public void setUpdatedAt(long updatedAt) {
+        this.updatedAt = updatedAt;
+    }
+}
+
Index: app/src/main/java/com/finmate/data/local/database/entity/FriendEntity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/database/entity/FriendEntity.java b/app/src/main/java/com/finmate/data/local/database/entity/FriendEntity.java
new file mode 100644
--- /dev/null	(date 1765447595509)
+++ b/app/src/main/java/com/finmate/data/local/database/entity/FriendEntity.java	(date 1765447595509)
@@ -0,0 +1,94 @@
+package com.finmate.data.local.database.entity;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.room.Entity;
+import androidx.room.PrimaryKey;
+
+import com.finmate.core.offline.OfflineSyncEntity;
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncStatus;
+
+@Entity(tableName = "friends")
+public class FriendEntity implements OfflineSyncEntity {
+
+    @PrimaryKey(autoGenerate = true)
+    public int id;
+
+    @Nullable
+    public String remoteId; // friendship id from server
+
+    @Nullable
+    public String friendUserId;
+
+    @Nullable
+    public String name;
+
+    @Nullable
+    public String email;
+
+    @Nullable
+    public String avatar;
+
+    @NonNull
+    public String status; // PENDING / ACCEPTED / REJECTED
+
+    @NonNull
+    public String syncStatus;
+
+    @NonNull
+    public String pendingAction;
+
+    public long updatedAt;
+
+    public FriendEntity(@NonNull String status) {
+        this.status = status;
+        this.syncStatus = SyncStatus.PENDING_CREATE;
+        this.pendingAction = PendingAction.CREATE;
+        this.updatedAt = System.currentTimeMillis();
+    }
+
+    @Nullable
+    @Override
+    public String getRemoteId() {
+        return remoteId;
+    }
+
+    @Override
+    public void setRemoteId(@Nullable String remoteId) {
+        this.remoteId = remoteId;
+    }
+
+    @NonNull
+    @Override
+    public String getSyncStatus() {
+        return syncStatus;
+    }
+
+    @Override
+    public void setSyncStatus(@NonNull String syncStatus) {
+        this.syncStatus = syncStatus;
+    }
+
+    @NonNull
+    @Override
+    public String getPendingAction() {
+        return pendingAction;
+    }
+
+    @Override
+    public void setPendingAction(@NonNull String pendingAction) {
+        this.pendingAction = pendingAction;
+    }
+
+    @Override
+    public long getUpdatedAt() {
+        return updatedAt;
+    }
+
+    @Override
+    public void setUpdatedAt(long updatedAt) {
+        this.updatedAt = updatedAt;
+    }
+}
+
Index: app/src/main/java/com/finmate/data/local/database/dao/BudgetDao.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/database/dao/BudgetDao.java b/app/src/main/java/com/finmate/data/local/database/dao/BudgetDao.java
new file mode 100644
--- /dev/null	(date 1765447595509)
+++ b/app/src/main/java/com/finmate/data/local/database/dao/BudgetDao.java	(date 1765447595509)
@@ -0,0 +1,37 @@
+package com.finmate.data.local.database.dao;
+
+import androidx.room.Dao;
+import androidx.room.Delete;
+import androidx.room.Insert;
+import androidx.room.Query;
+import androidx.room.Update;
+
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncDao;
+import com.finmate.data.local.database.entity.BudgetEntity;
+
+import java.util.List;
+
+@Dao
+public interface BudgetDao extends SyncDao<BudgetEntity> {
+
+    @Insert
+    void insert(BudgetEntity budget);
+
+    @Update
+    void update(BudgetEntity budget);
+
+    @Delete
+    void delete(BudgetEntity budget);
+
+    @Query("SELECT * FROM budgets ORDER BY id DESC")
+    List<BudgetEntity> getAll();
+
+    @Query("SELECT * FROM budgets WHERE pendingAction != :noneAction ORDER BY updatedAt ASC")
+    List<BudgetEntity> getPendingForSyncInternal(String noneAction);
+
+    @Override
+    default List<BudgetEntity> getPendingForSync() {
+        return getPendingForSyncInternal(PendingAction.NONE);
+    }
+}
Index: app/src/main/java/com/finmate/data/local/database/dao/FriendDao.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/database/dao/FriendDao.java b/app/src/main/java/com/finmate/data/local/database/dao/FriendDao.java
new file mode 100644
--- /dev/null	(date 1765447595509)
+++ b/app/src/main/java/com/finmate/data/local/database/dao/FriendDao.java	(date 1765447595509)
@@ -0,0 +1,41 @@
+package com.finmate.data.local.database.dao;
+
+import androidx.room.Dao;
+import androidx.room.Delete;
+import androidx.room.Insert;
+import androidx.room.Query;
+import androidx.room.Update;
+
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncDao;
+import com.finmate.data.local.database.entity.FriendEntity;
+
+import java.util.List;
+
+@Dao
+public interface FriendDao extends SyncDao<FriendEntity> {
+
+    @Insert
+    void insert(FriendEntity entity);
+
+    @Update
+    void update(FriendEntity entity);
+
+    @Delete
+    void delete(FriendEntity entity);
+
+    @Query("SELECT * FROM friends ORDER BY updatedAt DESC")
+    List<FriendEntity> getAll();
+
+    @Query("DELETE FROM friends")
+    void deleteAll();
+
+    @Query("SELECT * FROM friends WHERE pendingAction != :noneAction ORDER BY updatedAt ASC")
+    List<FriendEntity> getPendingForSyncInternal(String noneAction);
+
+    @Override
+    default List<FriendEntity> getPendingForSync() {
+        return getPendingForSyncInternal(PendingAction.NONE);
+    }
+}
+
Index: app/src/main/java/com/finmate/data/local/database/dao/SharedTransactionDao.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/database/dao/SharedTransactionDao.java b/app/src/main/java/com/finmate/data/local/database/dao/SharedTransactionDao.java
new file mode 100644
--- /dev/null	(date 1765447595509)
+++ b/app/src/main/java/com/finmate/data/local/database/dao/SharedTransactionDao.java	(date 1765447595509)
@@ -0,0 +1,41 @@
+package com.finmate.data.local.database.dao;
+
+import androidx.room.Dao;
+import androidx.room.Delete;
+import androidx.room.Insert;
+import androidx.room.Query;
+import androidx.room.Update;
+
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncDao;
+import com.finmate.data.local.database.entity.SharedTransactionEntity;
+
+import java.util.List;
+
+@Dao
+public interface SharedTransactionDao extends SyncDao<SharedTransactionEntity> {
+
+    @Insert
+    void insert(SharedTransactionEntity entity);
+
+    @Update
+    void update(SharedTransactionEntity entity);
+
+    @Delete
+    void delete(SharedTransactionEntity entity);
+
+    @Query("SELECT * FROM shared_transactions ORDER BY createdAtIso DESC")
+    List<SharedTransactionEntity> getAll();
+
+    @Query("DELETE FROM shared_transactions")
+    void deleteAll();
+
+    @Query("SELECT * FROM shared_transactions WHERE pendingAction != :noneAction ORDER BY updatedAt ASC")
+    List<SharedTransactionEntity> getPendingForSyncInternal(String noneAction);
+
+    @Override
+    default List<SharedTransactionEntity> getPendingForSync() {
+        return getPendingForSyncInternal(PendingAction.NONE);
+    }
+}
+
Index: app/src/main/java/com/finmate/ui/activities/AccountActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/ui/activities/AccountActivity.java b/app/src/main/java/com/finmate/ui/auth/AccountActivity.java
rename from app/src/main/java/com/finmate/ui/activities/AccountActivity.java
rename to app/src/main/java/com/finmate/ui/auth/AccountActivity.java
--- a/app/src/main/java/com/finmate/ui/activities/AccountActivity.java	(revision 8351311f735332df20e5b6c07d3d735a8af5e500)
+++ b/app/src/main/java/com/finmate/ui/auth/AccountActivity.java	(date 1765447595546)
@@ -1,4 +1,4 @@
-package com.finmate.ui.activities;
+package com.finmate.ui.auth;
 
 import android.content.SharedPreferences;
 import android.os.Bundle;
@@ -9,11 +9,13 @@
 import android.widget.ImageView;
 import android.widget.Spinner;
 import android.widget.Toast;
-import com.finmate.ui.base.BaseActivity;
+
+import androidx.appcompat.app.AppCompatActivity;
+
 import com.finmate.R;
-import com.finmate.adapters.ThemeHelper;
+import com.finmate.core.ui.ThemeHelper;
 
-public class AccountActivity extends BaseActivity {
+public class AccountActivity extends AppCompatActivity {
 
     private ImageView btnBack, btnCamera, btnEdit;
     private EditText edtName, edtEmail, edtBirthday, edtNote;
@@ -102,7 +104,6 @@
     private void loadLanguageSelection() {
         SharedPreferences prefs = getSharedPreferences("user_prefs", MODE_PRIVATE);
         String currentLanguage = prefs.getString("language", "en");
-
         if (currentLanguage.equals("vi")) {
             spnLanguage.setSelection(1);
         } else {
@@ -110,7 +111,6 @@
         }
     }
 
-
     private void setupThemeSpinner() {
         ArrayAdapter<CharSequence> adapter = ArrayAdapter.createFromResource(this,
                 R.array.theme_options, android.R.layout.simple_spinner_item);
Index: app/src/main/java/com/finmate/data/local/database/dao/GoalDao.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/database/dao/GoalDao.java b/app/src/main/java/com/finmate/data/local/database/dao/GoalDao.java
new file mode 100644
--- /dev/null	(date 1765447595509)
+++ b/app/src/main/java/com/finmate/data/local/database/dao/GoalDao.java	(date 1765447595509)
@@ -0,0 +1,37 @@
+package com.finmate.data.local.database.dao;
+
+import androidx.room.Dao;
+import androidx.room.Delete;
+import androidx.room.Insert;
+import androidx.room.Query;
+import androidx.room.Update;
+
+import com.finmate.core.offline.PendingAction;
+import com.finmate.core.offline.SyncDao;
+import com.finmate.data.local.database.entity.GoalEntity;
+
+import java.util.List;
+
+@Dao
+public interface GoalDao extends SyncDao<GoalEntity> {
+
+    @Insert
+    void insert(GoalEntity goal);
+
+    @Update
+    void update(GoalEntity goal);
+
+    @Delete
+    void delete(GoalEntity goal);
+
+    @Query("SELECT * FROM goals ORDER BY id DESC")
+    List<GoalEntity> getAll();
+
+    @Query("SELECT * FROM goals WHERE pendingAction != :noneAction ORDER BY updatedAt ASC")
+    List<GoalEntity> getPendingForSyncInternal(String noneAction);
+
+    @Override
+    default List<GoalEntity> getPendingForSync() {
+        return getPendingForSyncInternal(PendingAction.NONE);
+    }
+}
Index: app/src/main/java/com/finmate/data/local/database/model/StatisticPoint.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/finmate/data/local/database/model/StatisticPoint.java b/app/src/main/java/com/finmate/data/local/database/model/StatisticPoint.java
new file mode 100644
--- /dev/null	(date 1765447595520)
+++ b/app/src/main/java/com/finmate/data/local/database/model/StatisticPoint.java	(date 1765447595520)
@@ -0,0 +1,16 @@
+package com.finmate.data.local.database.model;
+
+import androidx.room.ColumnInfo;
+
+/**
+ * Simple projection model for aggregation queries in Room.
+ */
+public class StatisticPoint {
+
+    @ColumnInfo(name = "label")
+    public String label;
+
+    @ColumnInfo(name = "total")
+    public double total;
+}
+
